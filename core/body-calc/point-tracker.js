require("../../@babel/runtime/helpers/Arrayincludes");var t=require("../../@babel/runtime/helpers/classCallCheck"),e=require("../../@babel/runtime/helpers/createClass"),i=require("../../utils/utils"),n=require("../saber"),r=function(){return e((function e(i,n){if(t(this,e),this._points=null,this.amplitude=.1,this.pointKey=null,this.axle=null,this.onChange=null,!i)throw new Error("pointKey不能为空");if(![0,1].includes(n))throw new Error("追踪轴必须为0或1");this.pointKey=i,this.axle=n,this._points=[]}),[{key:"points",get:function(){return this._points}},{key:"isMeetAmplitude",value:function(t,e){var i=this.points[this.points.length-1],r=Math.abs(i-e),s=-1;switch(this.axle){case 0:var h=t.find((function(t){return"left_shoulder"==t.name})),u=t.find((function(t){return"right_shoulder"==t.name}));s=Math.max(h.y,u.y),h=t.find((function(t){return"left_hip"==t.name})),u=t.find((function(t){return"right_hip"==t.name})),s-=Math.min(h.y,u.y),s=Math.abs(s);break;case 1:var a=t.find((function(t){return"nose"==t.name}));s=a.y,a=t.find((function(t){return"left_ankle"==t.name}));var l=t.find((function(t){return"right_ankle"==t.name}));s-=Math.min(a.y,l.y),s=Math.abs(s);break;default:throw new Error("不支持".concat(this.axle,"轴追踪"))}var o=r/s>=this.amplitude;return o||n.writeConsoleDebug("抖动幅度太低",r,s,r/s,this.amplitude),o}},{key:"tracking",value:function(t){var e=this;if(t){var n=t;Array.isArray(t)||(n=t.keypoints);var r=n.find((function(t){return t.name==e.pointKey}));if(!r)return 0;var s=0===this.axle?r.x:r.y;if(i.isNone(this._prev))return this._prev=s,this.points.push(s),i.invoke(this.onChange)(null,s),0;if(s===this._prev)return 0;var h=s>this._prev;if(i.isNone(this._trend)||h==this._trend)return this._trend=h,this._prev=s,0;if(!this.isMeetAmplitude(n,this._prev))return 0;var u=this.points[this.points.length-1];return this.points.push(this._prev),i.invoke(this.onChange)(u,s),this._trend=h,this._prev=s,h?1:2}}},{key:"reset",value:function(){this._points=[],this._prev=null,this._trend=null}}])}();module.exports=r;