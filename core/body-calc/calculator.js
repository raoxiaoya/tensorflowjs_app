var e=require("../../@babel/runtime/helpers/classCallCheck"),r=require("../../@babel/runtime/helpers/createClass"),a=require("../../config"),c=require("../../utils/utils"),l=require("../saber"),i=require("../realtime-logger"),t=require("./calc-angle").CalcAngle,o=require("./calc-horizontal").CalcHorizontal,n=require("./calc-vertical").CalcVertical,s=require("./calc-camera-view").CalcCameraView,u=require("./calc-stand").CalcStand,h=require("./calc-lie").CalcLie,w=require("./calc-whole").CalcWhole,d=require("./calc-collide").CalcCollide,b=require("./calc-position").CalcPosition,C=require("./calc-logic").CalcLogic,f=new i("calculator"),g=function(){return r((function r(){e(this,r),this._calcers={},this.pointThreshold=a.moveNet.pointThreshold}),[{key:"buildCalcer",value:function(e){if(!e)throw new Error("请指定计算器名称calcName");var r=this._calcers[e];if(r)return r.pointThreshold=this.pointThreshold,r;switch(e){case"match-angle":r=new t;break;case"horizontal":r=new o;break;case"vertical":r=new n;break;case"camera-view":r=new s(this);break;case"stand":r=new u;break;case"lie":r=new h;break;case"whole":r=new w(this);break;case"collide":r=new d;break;case"position":r=new b;break;case"$or":case"$and":case"$not":r=this._calcers.$logic||new C(this),e="$logic";break;default:throw new Error("".concat(e,"计算器不支持。"))}return r.pointThreshold=this.pointThreshold,this._calcers[e]=r,r}},{key:"calcRule",value:function(e,r){if(c.isNone(r))throw new Error("计算规则rule不能为空。");if(!r.name)throw new Error("计算规则rule.name没有指定。");if(!r.calc)throw new Error("计算规则rule.calc没有指定。");var a=this.buildCalcer(r.calc).judging(e,r);return a||l.writeConsoleDebug("“".concat(r.name,"” 未通过决断计算。")),a}},{key:"calculating",value:function(e,r){if(c.isNone(e))throw new Error("body人体检测结果不能为空。");if(c.isNone(r))throw new Error("rule不能为空");try{if(arguments.length>2){for(var a={name:"auto-calc",calc:"$and",rules:[]},l=1;l<arguments.length;l++)a.rules.push(arguments[l]);return this.calcRule(e,a)}if(Array.isArray(r)){var i={name:"auto-calc",calc:"$or",rules:r};return this.calcRule(e,i)}return this.calcRule(e,r)}catch(e){return console.warn("calculator",e),f.error("calculator",e),!1}}}])}();module.exports=g;