var e=require("../@babel/runtime/helpers/objectWithoutProperties");require("../@babel/runtime/helpers/Arrayincludes"),require("../@babel/runtime/helpers/Objectvalues"),require("../@babel/runtime/helpers/Objectentries");var t=require("../@babel/runtime/helpers/assertThisInitialized"),n=require("../@babel/runtime/helpers/possibleConstructorReturn"),r=require("../@babel/runtime/helpers/getPrototypeOf"),a=require("../@babel/runtime/helpers/inherits"),o=require("../@babel/runtime/helpers/toConsumableArray"),i=require("../@babel/runtime/helpers/createForOfIteratorHelper"),s=require("../@babel/runtime/helpers/slicedToArray"),u=require("../@babel/runtime/helpers/regeneratorRuntime"),c=require("../@babel/runtime/helpers/asyncToGenerator"),l=require("../@babel/runtime/helpers/classCallCheck"),p=require("../@babel/runtime/helpers/createClass"),d=require("../@babel/runtime/helpers/typeof"),h=["weightData"];function f(e,t,a){return t=r(t),n(e,function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){return!1}}()?Reflect.construct(t,a||[],r(e).constructor):t.apply(e,a))}!function(e,t){"object"==("undefined"==typeof exports?"undefined":d(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["reduce-tfjs"]=t()}(void 0,(function(){function n(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}var r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function m(){throw new Error("setTimeout has not been defined")}function g(){throw new Error("clearTimeout has not been defined")}var v=m,y=g;function b(e){if(v===setTimeout)return setTimeout(e,0);if((v===m||!v)&&setTimeout)return v=setTimeout,setTimeout(e,0);try{return v(e,0)}catch(t){try{return v.call(null,e,0)}catch(t){return v.call(this,e,0)}}}"function"==typeof r.setTimeout&&(v=setTimeout),"function"==typeof r.clearTimeout&&(y=clearTimeout);var x,w=[],k=!1,I=-1;function S(){k&&x&&(k=!1,x.length?w=x.concat(w):I=-1,w.length&&T())}function T(){if(!k){var e=b(S);k=!0;for(var t=w.length;t;){for(x=w,w=[];++I<t;)x&&x[I].run();I=-1,t=w.length}x=null,k=!1,function(e){if(y===clearTimeout)return clearTimeout(e);if((y===g||!y)&&clearTimeout)return y=clearTimeout,clearTimeout(e);try{y(e)}catch(t){try{return y.call(null,e)}catch(t){return y.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function C(){}_.prototype.run=function(){this.fun.apply(null,this.array)};var N=C,E=C,R=C,A=C,O=C,M=C,F=C,D=r.performance||{},P=D.now||D.mozNow||D.msNow||D.oNow||D.webkitNow||function(){return(new Date).getTime()},L=new Date,B={nextTick:function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];w.push(new _(e,t)),1!==w.length||k||b(T)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:N,addListener:E,once:R,off:A,removeListener:O,removeAllListeners:M,emit:F,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*P.call(D),n=Math.floor(t),r=Math.floor(t%1*1e9);return e&&(n-=e[0],(r-=e[1])<0&&(n--,r+=1e9)),[n,r]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-L)/1e3}},U=function(){return p((function e(t,n){l(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}),[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}])}(),V=function(){return p((function e(){l(this,e)}),[{key:"refCount",value:function(e){return W("refCount")}},{key:"incRef",value:function(e){return W("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return W("time")}},{key:"read",value:function(e){return W("read")}},{key:"readSync",value:function(e){return W("readSync")}},{key:"readToGPU",value:function(e,t){return W("readToGPU")}},{key:"numDataIds",value:function(){return W("numDataIds")}},{key:"disposeData",value:function(e,t){return W("disposeData")}},{key:"write",value:function(e,t,n){return W("write")}},{key:"move",value:function(e,t,n,r,a){return W("move")}},{key:"memory",value:function(){return W("memory")}},{key:"floatPrecision",value:function(){return W("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return W("dispose")}}])}();function W(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen"))}function z(e,t,n){return Math.max(e,Math.min(t,n))}function G(e){return e%2==0?e:e+1}function j(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function H(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";H(Q(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function X(e){H(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||ie(e)&&!n)for(var r=0;r<e.length;++r)K(e[r],t,n);else t.push(e);return t}function Y(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Q(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function J(e){return e%1==0}function Z(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function $(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:setTimeout;return new Promise((function(a,o){var i=0;!function s(){if(e())a();else{i++;var u=t(i);null!=n&&i>=n?o():r(s,u)}}()}))}function te(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when there are 0 elements"));if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got ".concat(t," / ").concat(n));var o=e.slice();return o[r]=t/n,o}function ne(e,t){var n=t.length;return H((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but got axis ").concat(e)})),H(e.every((function(e){return J(e)})),(function(){return"All values in axis param must be integers but got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function re(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||a?null:ne(t,e).sort(),i=0,s=0;s<e.length;++s){if(null!=o){if(o[i]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==o[i]||o[i]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),o[i]<=s&&i++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function ae(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function oe(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function ie(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function se(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function ue(e){return"string"==typeof e||e instanceof String}function ce(e){return Array.isArray(e)?ce(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":"number"==typeof e?"float32":ue(e)?"string":function(e){return"boolean"==typeof e}(e)?"bool":"float32"}function le(e){return!!(e&&e.constructor&&e.call&&e.apply)}function pe(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function de(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function he(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var o=t[0]*(r?2:1),i=0;i<o;i++)a[i]=n[e+i];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=he(e+l*c,u,n,r);return a}function fe(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return he(0,e,t,n)}function me(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function ge(e){e.forEach((function(t){H(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape [".concat(e,"].")}))}))}function ve(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function ye(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function be(e){return e&&e.then&&"function"==typeof e.then}var xe="tfjsflags",we=function(){return p((function e(t){l(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=ke,this.populateURLFlags()}),[{key:"setPlatform",value:function(e,t){null!=this.platform&&(Ie().getBool("IS_TEST")||Ie().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. Overwriting the platform with ").concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];Ie().getBool("IS_TEST")||Ie().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:(e=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t in this.flags,e.t0){e.next=5;break}return e.next=4,this.evaluateFlag(t);case 4:this.flags[t]=e.sent;case 5:return e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(be(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. Please use getAsync() instead."));return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t=this.getQueryParams(this.global.location.search);xe in t&&t[xe].split(",").forEach((function(t){var n=t.split(":"),r=s(n,2),a=r[0],o=r[1];e.urlFlags[a]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(a,o)}))}}}]);var e}();function ke(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return function(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}(t,r[0],r[1]),r.join("=")})),t}function Ie(){return Te}var Se,Te=null;function _e(){if(null==Se){var e;if("undefined"!=typeof window)e=window;else if(void 0!==r)e=r;else if(void 0!==B)e=B;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Se=e}return Se}function Ce(e,t){var n=function(){var e=_e();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var Ne="Add",Ee="AddN",Re="ArgMax",Ae="AvgPool",Oe="BatchMatMul",Me="BatchToSpaceND",Fe="Bincount",De="Cast",Pe="ClipByValue",Le="Complex",Be="Concat",Ue="Conv2D",Ve="Conv2DBackpropFilter",We="Conv2DBackpropInput",ze="Cumprod",Ge="Cumsum",je="CropAndResize",He="DepthToSpace",qe="DepthwiseConv2dNative",Xe="DepthwiseConv2dNativeBackpropFilter",Ke="DepthwiseConv2dNativeBackpropInput",Ye="RealDiv",Qe="ExpandDims",Je="Fill",Ze="FlipLeftRight",$e="FloorDiv",et="FusedBatchNorm",tt="GatherV2",nt="GatherNd",rt="Greater",at="GreaterEqual",ot="Identity",it="LeakyRelu",st="LessEqual",ut="LogicalAnd",ct="LogicalNot",lt="LogicalOr",pt="Maximum",dt="MaxPool",ht="Mean",ft="Minimum",mt="MirrorPad",gt="Multiply",vt="NotEqual",yt="NonMaxSuppressionV3",bt="NonMaxSuppressionV4",xt="NonMaxSuppressionV5",wt="OnesLike",kt="OneHot",It="Pack",St="PadV2",Tt="Prelu",_t="Prod",Ct="Range",Nt="Relu",Et="Reshape",Rt="ResizeNearestNeighbor",At="ResizeBilinear",Ot="Relu6",Mt="Reverse",Ft="Round",Dt="ScatterNd",Pt="Select",Lt="Slice",Bt="Sigmoid",Ut="Sqrt",Vt="Sum",Wt="SpaceToBatchND",zt="SplitV",Gt="Softmax",jt="SparseFillEmptyRows",Ht="SparseReshape",qt="SparseSegmentMean",Xt="SparseSegmentSum",Kt="SquaredDifference",Yt="StridedSlice",Qt="StringNGrams",Jt="StringSplit",Zt="StringToHashBucketFast",$t="Tile",en="TopK",tn="Transform",nn="Transpose",rn="Unpack",an="ZerosLike",on="Step",sn="FromPixels",un="RotateWithOffset",cn="_FusedMatMul",ln="FusedConv2D",pn="FusedDepthwiseConv2D";function dn(){var e;Ie().getBool("IS_TEST")||Ie().getBool("PROD")||(e=console).warn.apply(e,arguments)}var hn=Ce("kernelRegistry",(function(){return new Map})),fn=Ce("gradRegistry",(function(){return new Map}));function mn(e,t){var n=bn(e,t);return hn.get(n)}function gn(e){return fn.get(e)}function vn(e){for(var t=hn.entries(),n=[];;){var r=t.next(),a=r.done,o=r.value;if(a)break;var i=s(o,2),u=i[0],c=i[1],l=u.split("_");s(l,1)[0]===e&&n.push(c)}return n}function yn(e){var t=e.kernelName,n=e.backendName,r=bn(t,n);hn.has(r)&&dn("The kernel '".concat(t,"' for backend '").concat(n,"' is already registered")),hn.set(r,e)}function bn(e,t){return"".concat(t,"_").concat(e)}var xn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function wn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function kn(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var n=function e(){return this instanceof e?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var In=Tn,Sn=null;try{Sn=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(n){}function Tn(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function _n(e){return!0===(e&&e.__isLong__)}Tn.prototype.__isLong__,Object.defineProperty(Tn.prototype,"__isLong__",{value:!0}),Tn.isLong=_n;var Cn={},Nn={};function En(e,t){var n,r,a;return t?(a=0<=(e>>>=0)&&e<256)&&(r=Nn[e])?r:(n=An(e,(0|e)<0?-1:0,!0),a&&(Nn[e]=n),n):(a=-128<=(e|=0)&&e<128)&&(r=Cn[e])?r:(n=An(e,e<0?-1:0,!1),a&&(Cn[e]=n),n)}function Rn(e,t){if(isNaN(e))return t?Vn:Un;if(t){if(e<0)return Vn;if(e>=Pn)return Hn}else{if(e<=-Ln)return qn;if(e+1>=Ln)return jn}return e<0?Rn(-e,t).neg():An(e%Dn|0,e/Dn|0,t)}function An(e,t,n){return new Tn(e,t,n)}Tn.fromInt=En,Tn.fromNumber=Rn,Tn.fromBits=An;var On=Math.pow;function Mn(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return Un;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return Mn(e.substring(1),t,n).neg();for(var a=Rn(On(n,8)),o=Un,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),u=parseInt(e.substring(i,i+s),n);if(s<8){var c=Rn(On(n,s));o=o.mul(c).add(Rn(u))}else o=(o=o.mul(a)).add(Rn(u))}return o.unsigned=t,o}function Fn(e,t){return"number"==typeof e?Rn(e,t):"string"==typeof e?Mn(e,t):An(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}Tn.fromString=Mn,Tn.fromValue=Fn;var Dn=4294967296,Pn=Dn*Dn,Ln=Pn/2,Bn=En(1<<24),Un=En(0);Tn.ZERO=Un;var Vn=En(0,!0);Tn.UZERO=Vn;var Wn=En(1);Tn.ONE=Wn;var zn=En(1,!0);Tn.UONE=zn;var Gn=En(-1);Tn.NEG_ONE=Gn;var jn=An(-1,2147483647,!1);Tn.MAX_VALUE=jn;var Hn=An(-1,-1,!0);Tn.MAX_UNSIGNED_VALUE=Hn;var qn=An(0,-2147483648,!1);Tn.MIN_VALUE=qn;var Xn=Tn.prototype;Xn.toInt=function(){return this.unsigned?this.low>>>0:this.low},Xn.toNumber=function(){return this.unsigned?(this.high>>>0)*Dn+(this.low>>>0):this.high*Dn+(this.low>>>0)},Xn.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(qn)){var t=Rn(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=Rn(On(e,6),this.unsigned),o=this,i="";;){var s=o.div(a),u=(o.sub(s.mul(a)).toInt()>>>0).toString(e);if((o=s).isZero())return u+i;for(;u.length<6;)u="0"+u;i=""+u+i}},Xn.getHighBits=function(){return this.high},Xn.getHighBitsUnsigned=function(){return this.high>>>0},Xn.getLowBits=function(){return this.low},Xn.getLowBitsUnsigned=function(){return this.low>>>0},Xn.getNumBitsAbs=function(){if(this.isNegative())return this.eq(qn)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&!(e&1<<t);t--);return 0!=this.high?t+33:t+1},Xn.isZero=function(){return 0===this.high&&0===this.low},Xn.eqz=Xn.isZero,Xn.isNegative=function(){return!this.unsigned&&this.high<0},Xn.isPositive=function(){return this.unsigned||this.high>=0},Xn.isOdd=function(){return!(1&~this.low)},Xn.isEven=function(){return!(1&this.low)},Xn.equals=function(e){return _n(e)||(e=Fn(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},Xn.eq=Xn.equals,Xn.notEquals=function(e){return!this.eq(e)},Xn.neq=Xn.notEquals,Xn.ne=Xn.notEquals,Xn.lessThan=function(e){return this.comp(e)<0},Xn.lt=Xn.lessThan,Xn.lessThanOrEqual=function(e){return this.comp(e)<=0},Xn.lte=Xn.lessThanOrEqual,Xn.le=Xn.lessThanOrEqual,Xn.greaterThan=function(e){return this.comp(e)>0},Xn.gt=Xn.greaterThan,Xn.greaterThanOrEqual=function(e){return this.comp(e)>=0},Xn.gte=Xn.greaterThanOrEqual,Xn.ge=Xn.greaterThanOrEqual,Xn.compare=function(e){if(_n(e)||(e=Fn(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},Xn.comp=Xn.compare,Xn.negate=function(){return!this.unsigned&&this.eq(qn)?qn:this.not().add(Wn)},Xn.neg=Xn.negate,Xn.add=function(e){_n(e)||(e=Fn(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,o=e.high>>>16,i=65535&e.high,s=e.low>>>16,u=0,c=0,l=0,p=0;return l+=(p+=a+(65535&e.low))>>>16,c+=(l+=r+s)>>>16,u+=(c+=n+i)>>>16,u+=t+o,An((l&=65535)<<16|(p&=65535),(u&=65535)<<16|(c&=65535),this.unsigned)},Xn.subtract=function(e){return _n(e)||(e=Fn(e)),this.add(e.neg())},Xn.sub=Xn.subtract,Xn.multiply=function(e){if(this.isZero())return Un;if(_n(e)||(e=Fn(e)),Sn)return An(Sn.mul(this.low,this.high,e.low,e.high),Sn.get_high(),this.unsigned);if(e.isZero())return Un;if(this.eq(qn))return e.isOdd()?qn:Un;if(e.eq(qn))return this.isOdd()?qn:Un;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(Bn)&&e.lt(Bn))return Rn(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,a=65535&this.low,o=e.high>>>16,i=65535&e.high,s=e.low>>>16,u=65535&e.low,c=0,l=0,p=0,d=0;return p+=(d+=a*u)>>>16,l+=(p+=r*u)>>>16,p&=65535,l+=(p+=a*s)>>>16,c+=(l+=n*u)>>>16,l&=65535,c+=(l+=r*s)>>>16,l&=65535,c+=(l+=a*i)>>>16,c+=t*u+n*s+r*i+a*o,An((p&=65535)<<16|(d&=65535),(c&=65535)<<16|(l&=65535),this.unsigned)},Xn.mul=Xn.multiply,Xn.divide=function(e){if(_n(e)||(e=Fn(e)),e.isZero())throw Error("division by zero");var t,n,r;if(Sn)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?An((this.unsigned?Sn.div_u:Sn.div_s)(this.low,this.high,e.low,e.high),Sn.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Vn:Un;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Vn;if(e.gt(this.shru(1)))return zn;r=Vn}else{if(this.eq(qn))return e.eq(Wn)||e.eq(Gn)?qn:e.eq(qn)?Wn:(t=this.shr(1).div(e).shl(1)).eq(Un)?e.isNegative()?Wn:Gn:(n=this.sub(e.mul(t)),r=t.add(n.div(e)));if(e.eq(qn))return this.unsigned?Vn:Un;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Un}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(t)/Math.LN2),o=a<=48?1:On(2,a-48),i=Rn(t),s=i.mul(e);s.isNegative()||s.gt(n);)s=(i=Rn(t-=o,this.unsigned)).mul(e);i.isZero()&&(i=Wn),r=r.add(i),n=n.sub(s)}return r},Xn.div=Xn.divide,Xn.modulo=function(e){return _n(e)||(e=Fn(e)),Sn?An((this.unsigned?Sn.rem_u:Sn.rem_s)(this.low,this.high,e.low,e.high),Sn.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},Xn.mod=Xn.modulo,Xn.rem=Xn.modulo,Xn.not=function(){return An(~this.low,~this.high,this.unsigned)},Xn.and=function(e){return _n(e)||(e=Fn(e)),An(this.low&e.low,this.high&e.high,this.unsigned)},Xn.or=function(e){return _n(e)||(e=Fn(e)),An(this.low|e.low,this.high|e.high,this.unsigned)},Xn.xor=function(e){return _n(e)||(e=Fn(e)),An(this.low^e.low,this.high^e.high,this.unsigned)},Xn.shiftLeft=function(e){return _n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?An(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):An(0,this.low<<e-32,this.unsigned)},Xn.shl=Xn.shiftLeft,Xn.shiftRight=function(e){return _n(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?An(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):An(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},Xn.shr=Xn.shiftRight,Xn.shiftRightUnsigned=function(e){if(_n(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return e<32?An(this.low>>>e|t<<32-e,t>>>e,this.unsigned):An(32===e?t:t>>>e-32,0,this.unsigned)},Xn.shru=Xn.shiftRightUnsigned,Xn.shr_u=Xn.shiftRightUnsigned,Xn.toSigned=function(){return this.unsigned?An(this.low,this.high,!1):this},Xn.toUnsigned=function(){return this.unsigned?this:An(this.low,this.high,!0)},Xn.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},Xn.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},Xn.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Tn.fromBytes=function(e,t,n){return n?Tn.fromBytesLE(e,t):Tn.fromBytesBE(e,t)},Tn.fromBytesLE=function(e,t){return new Tn(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Tn.fromBytesBE=function(e,t){return new Tn(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Kn=wn(In),Yn=Kn||n({__proto__:null,default:Kn},[In]);function Qn(e){return Yn.fromString(e,!0,16)}var Jn=Qn("c3a5c85c97cb3127"),Zn=Qn("b492b66fbe98f273"),$n=Qn("9ae16a3b2f90404f");function er(e){return e.xor(e.shru(47))}function tr(e,t,n){var r=e.slice(t,t+n);return Yn.fromBytes(Array.from(r),!0,!0)}function nr(e,t){return tr(e,t,8)}function rr(e,t){return tr(e,t,4)}function ar(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function or(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Qn("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function ir(e,t,n,r){return function(e,t,n,r,a,o){a=a.add(e),o=ar(o.add(a).add(r),21);var i=a;return a=(a=a.add(t)).add(n),o=o.add(ar(a,44)),[a.add(r),o.add(i)]}(nr(e,t),nr(e,t+8),nr(e,t+16),nr(e,t+24),n,r)}function sr(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,r=Yn.fromNumber(81,!0);if(n<=32)return n<=16?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=$n.add(2*t),r=nr(e,0).add($n),a=nr(e,t-8);return or(ar(a,37).mul(n).add(r),ar(r,25).add(a).mul(n),n)}if(t>=4){var o=$n.add(2*t);return or(rr(e,0).shl(3).add(t),rr(e,t-4),o)}if(t>0){var i=e[0]+(e[t>>1]<<8),s=t+(e[t-1]<<2);return er($n.mul(i).xor(Jn.mul(s))).mul($n)}return $n}(e,n):function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=$n.add(2*t),r=nr(e,0).mul(Zn),a=nr(e,8),o=nr(e,t-8).mul(n),i=nr(e,t-16).mul($n);return or(ar(r.add(a),43).add(ar(o,30)).add(i),r.add(ar(a.add($n),18)).add(o),n)}(e,n);if(n<=64)return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=$n.add(2*t),r=nr(e,0).mul($n),a=nr(e,8),o=nr(e,t-8).mul(n),i=nr(e,t-16).mul($n),s=ar(r.add(a),43).add(ar(o,30)).add(i),u=or(s,r.add(ar(a.add($n),18)).add(o),n),c=nr(e,16).mul(n),l=nr(e,24),p=s.add(nr(e,t-32)).mul(n),d=u.add(nr(e,t-24)).mul(n);return or(ar(c.add(l),43).add(ar(p,30)).add(d),c.add(ar(l.add(r),18)).add(p),n)}(e,n);var a=r,o=r.mul(Zn).add(113),i=er(o.mul($n).add(113)).mul($n),s=[Yn.UZERO,Yn.UZERO],u=[Yn.UZERO,Yn.UZERO];a=a.mul($n).add(nr(e,0));var c=0,l=64*(n-1>>6),p=l+(n-1&63)-63;do{var d;a=ar(a.add(o).add(s[0]).add(nr(e,c+8)),37).mul(Zn),o=ar(o.add(s[1]).add(nr(e,c+48)),42).mul(Zn),a=a.xor(u[1]),o=o.add(s[0]).add(nr(e,c+40)),i=ar(i.add(u[0]),33).mul(Zn),s=ir(e,c,s[1].mul(Zn),a.add(u[0])),u=ir(e,c+32,i.add(u[1]),o.add(nr(e,c+16))),i=(d=[a,i])[0],a=d[1],c+=64}while(c!==l);var h=Zn.add(i.and(255).shl(1));return c=p,u[0]=u[0].add(n-1&63),s[0]=s[0].add(u[0]),u[0]=u[0].add(s[0]),a=ar(a.add(o).add(s[0]).add(nr(e,c+8)),37).mul(h),o=ar(o.add(s[1]).add(nr(e,c+48)),42).mul(h),a=a.xor(u[1].mul(9)),o=o.add(s[0].mul(9).add(nr(e,c+40))),i=ar(i.add(u[0]),33).mul(h),s=ir(e,c,s[1].mul(h),a.add(u[0])),u=ir(e,c+32,i.add(u[1]),o.add(nr(e,c+16))),i=(t=[a,i])[0],a=t[1],or(or(s[0],u[0],h).add(er(o).mul(Jn)).add(i),or(s[1],u[1],h).add(a),h)}function ur(e,t){return"string"===t?pr(e):cr([e],t)}function cr(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=K(e)),Ie().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function lr(){return Ie().platform.now()}function pr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Ie().platform.encode(e,t)}function dr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",Ie().platform.decode(e,t)}var hr=function(){return p((function e(t,n){l(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new fr)}),[{key:"profileKernel",value:function(e,t,n){var r,a,o=function(){r=n()},s=lr();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(o);else{o();var u,c=i(r);try{for(c.s();!(u=c.n()).done;){u.value.dataSync()}}catch(e){c.e(e)}finally{c.f()}a=Promise.resolve({kernelMs:lr()-s})}if(Ie().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var l=function(){var t=r[p];t.data().then((function(n){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(n,t.dtype,e)}))},p=0;p<r.length;p++)l();return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,o=e.inputs,i=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,i]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],o,r[2])}))}))}}])}();var fr=function(){return p((function e(){l(this,e)}),[{key:"logKernelProfile",value:function(e,t,n,r,a,o){var i="number"==typeof r?$("".concat(r,"ms"),9):r.error,s=$(e,25),u=t.rank,c=t.size,l=$(t.shape.toString(),14),p="";for(var d in a){var h=a[d];if(null!=h){var f=h.shape||t.shape,m=f.length;p+="".concat(d,": ").concat(m,"D ").concat(m>0?f:""," ")}}console.log("%c".concat(s,"\t%c").concat(i,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(p,"\t%c").concat(o),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}])}();function mr(e,t,n,r){var a=de(t),i=function(e,t,n,r){var a=Y(t),o=r[r.length-1],i=new Array(o).fill(0),s=t.length,u="complex64"===n?yr(e):e;if(s>1)for(var c=0;c<a/o;c++)for(var l=c*o,p=0;p<o;p++)i[p]=Math.max(i[p],gr(u[l+p],0,n).length);return i}(e,t,n,a),s=t.length,u=function e(t,n,r,a,i){var s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],u="complex64"===r?2:1,c=n[0],l=n.length;if(0===l)return"complex64"===r?[gr(yr(t)[0],0,r)]:"bool"===r?[vr(t[0])]:[t[0].toString()];if(1===l){if(c>20){var p=3*u,d=Array.from(t.slice(0,p)),h=Array.from(t.slice((c-3)*u,c*u));return"complex64"===r&&(d=yr(d),h=yr(h)),["["+d.map((function(e,t){return gr(e,i[t],r)})).join(", ")+", ..., "+h.map((function(e,t){return gr(e,i[c-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?yr(t):Array.from(t)).map((function(e,t){return gr(e,i[t],r)})).join(", ")+"]"]}var f=n.slice(1),m=a.slice(1),g=a[0]*u,v=[];if(c>20){for(var y=0;y<3;y++){var b=y*g,x=b+g;v.push.apply(v,o(e(t.slice(b,x),f,r,m,i,!1)))}v.push("...");for(var w=c-3;w<c;w++){var k=w*g,I=k+g;v.push.apply(v,o(e(t.slice(k,I),f,r,m,i,w===c-1)))}}else for(var S=0;S<c;S++){var T=S*g,_=T+g;v.push.apply(v,o(e(t.slice(T,_),f,r,m,i,S===c-1)))}var C=2===l?",":"";v[0]="["+v[0]+C;for(var N=1;N<v.length-1;N++)v[N]=" "+v[N]+C;for(var E=",\n",R=2;R<l;R++)E+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(s?"":E),v}(e,t,n,a,i),c=["Tensor"];return r&&(c.push("  dtype: ".concat(n)),c.push("  rank: ".concat(s)),c.push("  shape: [".concat(t,"]")),c.push("  values:")),c.push(u.map((function(e){return"    "+e})).join("\n")),c.join("\n")}function gr(e,t,n){return $(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ").concat(parseFloat(e[1].toFixed(7)),"j"):ue(e)?"'".concat(e,"'"):"bool"===n?vr(e):parseFloat(e.toFixed(7)).toString(),t)}function vr(e){return 0===e?"false":"true"}function yr(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var br=function(){return p((function e(t,n,r){var a=this;if(l(this,e),this.dtype=n,this.shape=t.slice(),this.size=Y(t),null!=r){var o=r.length;H(o===this.size,(function(){return"Length of values '".concat(o,"' does not match the size inferred by the shape '").concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||oe(n,this.size),this.strides=de(t)}),[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),H(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must match the rank (").concat(t.rank,")")}));var o=this.locToIndex(r);this.values[o]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,o=t;a<o.length;a++){var i=o[a];if(i<0||i>=this.shape[r]){var s="Requested out of range element at ".concat(t,".   Buffer shape=").concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return xr().makeTensor(this.values,this.shape,this.dtype)}}])}(),xr=null,wr=null,kr=function(){return p((function e(t,n,r,a){l(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=Y(t),this.strides=de(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}),[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:(r=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",wr.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"bufferSync",value:function(){return wr.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:(n=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",fe(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"arraySync",value:function(){return fe(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:(t=c(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=xr().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return dr(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(){return t.apply(this,arguments)})},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),xr().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=xr().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return dr(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:(e=c(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,xr().read(this.dataId);case 3:return t=e.sent,e.abrupt("return","string"===this.dtype?t:new Uint8Array(t.buffer));case 5:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"dispose",value:function(){this.isDisposed||(xr().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return wr.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),wr.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return mr(this.dataSync(),this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),wr.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),xr().makeVariable(this,e,t,n)}}]);var e,t,n,r}();Object.defineProperty(kr,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Ce("Tensor",(function(){return kr}));var Ir,Sr,Tr,_r,Cr,Nr=function(e){function t(e,n,r,a){var o;return l(this,t),(o=f(this,t,[e.shape,e.dtype,e.dataId,a])).trainable=n,o.name=r,o}return a(t,e),p(t,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and previous value (").concat(this.dtype,") must match"));if(!Q(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and previous value (").concat(this.shape,") must match"));xr().disposeTensor(this),this.dataId=e.dataId,xr().incRef(this,null)}},{key:"dispose",value:function(){xr().disposeVariable(this),this.isDisposedInternal=!0}}])}(kr);Object.defineProperty(Nr,Symbol.hasInstance,{value:function(e){return e instanceof kr&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(Ir||(Ir={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(Sr||(Sr={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(Tr||(Tr={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(_r||(_r={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Cr||(Cr={}));var Er={float32:_r,int32:Sr,bool:Tr,complex64:Cr};function Rr(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Er[e][t]}function Ar(e){return Rr(e,"int32")}function Or(e,t){if(e.dtype===t.dtype)return[e,t];var n=Rr(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Mr(e){var t=[];return function e(t,n,r){if(null==t)return;if(t instanceof kr)return void n.push(t);if(a=t,!Array.isArray(a)&&"object"!=d(a))return;var a,o=t;for(var i in o){var s=o[i];r.has(s)||(r.add(s),e(s,n,r))}}(e,t,new Set),t}function Fr(e){return null!=e.kernelName}var Dr=function(){return p((function e(){l(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}),[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}])}(),Pr=function(){function e(t){l(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Dr}return p(e,[{key:"ready",value:(a=c(u().mark((function e(){var t,n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=17;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=14;break}return e.next=13,this.setBackend(r);case 13:return e.abrupt("return",void e.sent);case 14:n++,e.next=6;break;case 17:throw new Error("Could not initialize any backends, all backend initializations failed.");case 18:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods"));this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(dn("".concat(e," backend was already registered. Reusing existing backend factory.")),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:(r=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=14;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=11;break}return e.next=8,r;case 8:e.t0=e.sent,e.next=12;break;case 11:e.t0=r;case 12:if(e.t0){e.next=14;break}return e.abrupt("return",!1);case 14:return e.abrupt("return",(this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new hr(this.backendInstance),!0));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setupRegisteredKernels",value:function(){var e=this;vn(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;vn(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof V||"function"!=typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,o=r.then((function(n){return!(a<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,dn("Initialization of backend ".concat(e," failed")),dn(n.stack||n.message)),!1}));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}catch(n){return dn("Initialization of backend ".concat(e," failed")),dn(n.stack||n.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,o=r.asyncInit;if(o||a)return{name:n,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),o=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,o),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Br.runKernel(ot,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e};return Br.runKernel(De,t,{dtype:"float32"})}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,null==mn(e,this.backendName))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var o=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-t-a-o;if(i>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak (").concat(i," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,o=[],i=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=Fr(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Fr(e)){var l=e.kernelName,p=e.inputs,d=e.attrs;null==this.backendName&&this.backend;var h=mn(l,this.backendName);H(null!=h,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=h.kernelFunc({inputs:p,attrs:d,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(i){var s=a.getTensorsForGradient(l,p,n);o=a.saveTensorsForBackwardMode(s)}return n}}else{var f=e.forwardFunc,m=function(e){i&&(o=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return f(a.backend,m)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var g,v=e.inputs,y=e.attrs,b=Fr(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(g=a.profiler.profileKernel(c,v,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(g),t=g.outputs):t=n()})),i&&this.addTapeNode(c,v,t,b,o,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(v).map((function(e){return null!=v[e]?v[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=gn(e);if(null!=r){var a,o=r.inputsToSave||[],i=r.outputsToSave||[];r.saveAllInputs?(H(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=o.map((function(e){return t[e]}));var s=n.filter((function(e,t){return i[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&ue(e[0])&&(a=e.map((function(e){return pr(e)})));var o=r.write(a,t,n),i=new kr(t,n,o,this.nextTensorId());if(this.trackTensor(i,r),"string"===n){var s=this.state.tensorInfo.get(o),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return i}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,o=new kr(r,a,n,this.nextTensorId());return this.trackTensor(o,t),o}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Nr(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*se(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Nr||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*se(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:(n=c(u().mark((function e(t){var n,r,a,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=5,t();case 5:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,o(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=i(this.state.activeProfile.kernels),e.prev=11,a.s();case 13:if((s=a.n()).done){e.next=23;break}return c=s.value,e.next=17,c.kernelTimeMs;case 17:return c.kernelTimeMs=e.sent,e.next=20,c.extraInfo;case 20:c.extraInfo=e.sent;case 21:e.next=13;break;case 23:e.next=28;break;case 25:e.prev=25,e.t0=e.catch(11),a.e(e.t0);case 28:return e.prev=28,a.f(),e.finish(28);case 31:return e.abrupt("return",this.state.activeProfile);case 32:case"end":return e.stop()}}),e,this,[[11,25,28,31]])}))),function(e){return n.apply(this,arguments)})},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,o){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=gn(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=me(r.size,r.dtype);return i.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,o)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Mr(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var o=this.state.activeScope.track[a];o.kept||r.has(o.id)||o.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==i.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(H(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var o=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));H(o instanceof kr,(function(){return"The result y returned by f() must be a tensor."}));var s=function(e,t,n){for(var r={},a={},o=0;o<t.length;o++)r[t[o].id]=!0;for(var i=0;i<e.length;i++){var s=e[i],u=s.inputs;for(var c in u){for(var l=u[c],p=!1,d=0;d<t.length;d++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),p=!0,a[s.id]=!0;break}if(p)break}}var h={};h[n.id]=!0;for(var f={},m=e.length-1;m>=0;m--)for(var g=e[m],v=g.inputs,y=0;y<g.outputs.length;y++)if(h[g.outputs[y].id]){for(var b in v)h[v[b].id]=!0,f[g.id]=!0;break}for(var x=[],w=0;w<e.length;w++){var k=e[w];if(a[k.id]&&f[k.id]){var I={};for(var S in k.inputs){var T=k.inputs[S];r[T.id]&&(I[S]=T)}var _=Object.assign({},k);_.inputs=I,_.outputs=k.outputs,x.push(_)}}return x}(this.state.activeTape,t,o);if(!a&&0===s.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[o.id]=null==n?function(e){var t=function(e,t){for(var n=me(e,"float32"),r=0;r<n.length;r++)n[r]=1;return n}(Y(e));return Br.makeTensor(t,e,"float32")}(o.shape):n,function(e,t,n,a){for(var o=function(){var n=t[i],o=[];if(n.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==n.gradient)throw new Error("Cannot compute gradient: gradient function not found for ".concat(n.kernelName,"."));var s=n.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". Available gradients found: ").concat(Object.keys(s),"."));var o=function(e){return r.tidy(e)}((function(){return s[t]()}));if("float32"!==o.dtype)throw new Error("Error in gradient for op ".concat(n.kernelName,". The gradient of input ").concat(t," must have 'float32' dtype, but has '").concat(o.dtype,"'"));var i=n.inputs[t];if(!Q(o.shape,i.shape))throw new Error("Error in gradient for op ".concat(n.kernelName,". The gradient of input '").concat(t,"' has shape '").concat(o.shape,"', which does not match the shape of the input '").concat(i.shape,"'"));if(null==e[i.id])e[i.id]=o;else{var u=e[i.id];e[i.id]=a(u,o),u.dispose()}};for(var c in n.inputs)u(c)},i=t.length-1;i>=0;i--)o()}(e,s,0,Ur);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=i(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(e){n.e(e)}finally{n.f()}})),r.state.activeTape=null),{value:o,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return H(le(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var o;H(r.every((function(e){return e instanceof kr})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var i={};return r.forEach((function(e,t){i[t]=e})),t.runKernelFunc({forwardFunc:function(t,n){return H((o=e.apply(void 0,r.concat([n]))).value instanceof kr,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),H(le(o.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),o.value},backwardsFunc:function(e,t){var n=o.gradFunc(e,t),a=Array.isArray(n)?n:[n];H(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),H(a.every((function(e){return e instanceof kr})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var i={};return a.forEach((function(e,t){i[t]=function(){return e}})),i},inputs:i})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:(t=c(u().mark((function e(t){var n,r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=lr(),e.next=3,this.backend.time(t);case 3:return r=e.sent,e.abrupt("return",(r.wallMs=lr()-n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Dr,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]);var t,n,r,a}();function Lr(){var e,t=_e();if(null==t._tfengine){var n=new we(t);t._tfengine=new Pr(n)}return e=t._tfengine.ENV,Te=e,xr=function(){return t._tfengine},t._tfengine}Pr.nextTensorId=0,Pr.nextVariableId=0;var Br=Lr();function Ur(e,t){var n={a:e,b:t};return Br.runKernel(Ne,n)}function Vr(e){if(e||"undefined"!=typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!=typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Wr(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var zr=Ie();zr.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),zr.registerFlag("IS_BROWSER",(function(){return Wr()})),zr.registerFlag("IS_NODE",(function(){return void 0!==B&&void 0!==B.versions&&void 0!==B.versions.node})),zr.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),zr.registerFlag("PROD",(function(){return!1})),zr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return zr.getBool("DEBUG")})),zr.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),zr.registerFlag("IS_TEST",(function(){return!1})),zr.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),zr.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),zr.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1})),zr.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1})),zr.registerFlag("USE_SETTIMEOUTCUSTOM",(function(){return!1}));var Gr=[],jr=[],Hr="undefined"!=typeof Uint8Array?Uint8Array:Array,qr=!1;function Xr(){qr=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)Gr[t]=e[t],jr[e.charCodeAt(t)]=t;jr["-".charCodeAt(0)]=62,jr["_".charCodeAt(0)]=63}function Kr(e,t,n){for(var r,a,o=[],i=t;i<n;i+=3)r=(e[i]<<16)+(e[i+1]<<8)+e[i+2],o.push(Gr[(a=r)>>18&63]+Gr[a>>12&63]+Gr[a>>6&63]+Gr[63&a]);return o.join("")}function Yr(e){var t;qr||Xr();for(var n=e.length,r=n%3,a="",o=[],i=16383,s=0,u=n-r;s<u;s+=i)o.push(Kr(e,s,s+i>u?u:s+i));return 1===r?(t=e[n-1],a+=Gr[t>>2],a+=Gr[t<<4&63],a+="=="):2===r&&(t=(e[n-2]<<8)+e[n-1],a+=Gr[t>>10],a+=Gr[t>>4&63],a+=Gr[t<<2&63],a+="="),o.push(a),o.join("")}function Qr(e,t,n,r,a){var o,i,s=8*a-r-1,u=(1<<s)-1,c=u>>1,l=-7,p=n?a-1:0,d=n?-1:1,h=e[t+p];for(p+=d,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+e[t+p],p+=d,l-=8);for(i=o&(1<<-l)-1,o>>=-l,l+=r;l>0;i=256*i+e[t+p],p+=d,l-=8);if(0===o)o=1-c;else{if(o===u)return i?NaN:1/0*(h?-1:1);i+=Math.pow(2,r),o-=c}return(h?-1:1)*i*Math.pow(2,o-r)}function Jr(e,t,n,r,a,o){var i,s,u,c=8*o-a-1,l=(1<<c)-1,p=l>>1,d=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,f=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,i=l):(i=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-i))<1&&(i--,u*=2),(t+=i+p>=1?d/u:d*Math.pow(2,1-p))*u>=2&&(i++,u/=2),i+p>=l?(s=0,i=l):i+p>=1?(s=(t*u-1)*Math.pow(2,a),i+=p):(s=t*Math.pow(2,p-1)*Math.pow(2,a),i=0));a>=8;e[n+h]=255&s,h+=f,s/=256,a-=8);for(i=i<<a|s,c+=a;c>0;e[n+h]=255&i,h+=f,i/=256,c-=8);e[n+h-f]|=128*m}var Zr={}.toString,$r=Array.isArray||function(e){return"[object Array]"==Zr.call(e)};function ea(){return na.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ta(e,t){if(ea()<t)throw new RangeError("Invalid typed array length");return na.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=na.prototype:(null===e&&(e=new na(t)),e.length=t),e}function na(e,t,n){if(!(na.TYPED_ARRAY_SUPPORT||this instanceof na))return new na(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return oa(this,e)}return ra(this,e,t,n)}function ra(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r),na.TYPED_ARRAY_SUPPORT?(e=t).__proto__=na.prototype:e=ia(e,t),e}(e,t,n,r):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!na.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|ca(t,n),a=(e=ta(e,r)).write(t,n);return a!==r&&(e=e.slice(0,a)),e}(e,t,n):function(e,t){if(ua(t)){var n=0|sa(t.length);return 0===(e=ta(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?ta(e,0):ia(e,t);if("Buffer"===t.type&&$r(t.data))return ia(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function aa(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function oa(e,t){if(aa(t),e=ta(e,t<0?0:0|sa(t)),!na.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function ia(e,t){var n=t.length<0?0:0|sa(t.length);e=ta(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function sa(e){if(e>=ea())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+ea().toString(16)+" bytes");return 0|e}function ua(e){return!(null==e||!e._isBuffer)}function ca(e,t){if(ua(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Pa(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return La(e).length;default:if(r)return Pa(e).length;t=(""+t).toLowerCase(),r=!0}}function la(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Ta(this,t,n);case"utf8":case"utf-8":return wa(this,t,n);case"ascii":return Ia(this,t,n);case"latin1":case"binary":return Sa(this,t,n);case"base64":return xa(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _a(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function pa(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function da(e,t,n,r,a){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"==typeof t&&(t=na.from(t,r)),ua(t))return 0===t.length?-1:ha(e,t,n,r,a);if("number"==typeof t)return t&=255,na.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):ha(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function ha(e,t,n,r,a){var o,i=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;i=2,s/=2,u/=2,n/=2}function c(e,t){return 1===i?e[t]:e.readUInt16BE(t*i)}if(a){var l=-1;for(o=n;o<s;o++)if(c(e,o)===c(t,-1===l?0:o-l)){if(-1===l&&(l=o),o-l+1===u)return l*i}else-1!==l&&(o-=o-l),l=-1}else for(n+u>s&&(n=s-u),o=n;o>=0;o--){for(var p=!0,d=0;d<u;d++)if(c(e,o+d)!==c(t,d)){p=!1;break}if(p)return o}return-1}function fa(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var i=0;i<r;++i){var s=parseInt(t.substr(2*i,2),16);if(isNaN(s))return i;e[n+i]=s}return i}function ma(e,t,n,r){return Ba(Pa(t,e.length-n),e,n,r)}function ga(e,t,n,r){return Ba(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function va(e,t,n,r){return ga(e,t,n,r)}function ya(e,t,n,r){return Ba(La(t),e,n,r)}function ba(e,t,n,r){return Ba(function(e,t){for(var n,r,a,o=[],i=0;i<e.length&&!((t-=2)<0);++i)r=(n=e.charCodeAt(i))>>8,a=n%256,o.push(a),o.push(r);return o}(t,e.length-n),e,n,r)}function xa(e,t,n){return 0===t&&n===e.length?Yr(e):Yr(e.slice(t,n))}function wa(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var o,i,s,u,c=e[a],l=null,p=c>239?4:c>223?3:c>191?2:1;if(a+p<=n)switch(p){case 1:c<128&&(l=c);break;case 2:128==(192&(o=e[a+1]))&&(u=(31&c)<<6|63&o)>127&&(l=u);break;case 3:o=e[a+1],i=e[a+2],128==(192&o)&&128==(192&i)&&(u=(15&c)<<12|(63&o)<<6|63&i)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:o=e[a+1],i=e[a+2],s=e[a+3],128==(192&o)&&128==(192&i)&&128==(192&s)&&(u=(15&c)<<18|(63&o)<<12|(63&i)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,p=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),a+=p}return function(e){var t=e.length;if(t<=ka)return String.fromCharCode.apply(String,e);for(var n="",r=0;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=ka));return n}(r)}na.TYPED_ARRAY_SUPPORT=void 0===r.TYPED_ARRAY_SUPPORT||r.TYPED_ARRAY_SUPPORT,ea(),na.poolSize=8192,na._augment=function(e){return e.__proto__=na.prototype,e},na.from=function(e,t,n){return ra(null,e,t,n)},na.TYPED_ARRAY_SUPPORT&&(na.prototype.__proto__=Uint8Array.prototype,na.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&na[Symbol.species]),na.alloc=function(e,t,n){return function(e,t,n,r){return aa(t),t<=0?ta(e,t):void 0!==n?"string"==typeof r?ta(e,t).fill(n,r):ta(e,t).fill(n):ta(e,t)}(null,e,t,n)},na.allocUnsafe=function(e){return oa(null,e)},na.allocUnsafeSlow=function(e){return oa(null,e)},na.isBuffer=function(e){return null!=e&&(!!e._isBuffer||Ua(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&Ua(e.slice(0,0))}(e))},na.compare=function(e,t){if(!ua(e)||!ua(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,a=0,o=Math.min(n,r);a<o;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},na.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},na.concat=function(e,t){if(!$r(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return na.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=na.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var o=e[n];if(!ua(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,a),a+=o.length}return r},na.byteLength=ca,na.prototype._isBuffer=!0,na.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)pa(this,t,t+1);return this},na.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)pa(this,t,t+3),pa(this,t+1,t+2);return this},na.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)pa(this,t,t+7),pa(this,t+1,t+6),pa(this,t+2,t+5),pa(this,t+3,t+4);return this},na.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?wa(this,0,e):la.apply(this,arguments)},na.prototype.equals=function(e){if(!ua(e))throw new TypeError("Argument must be a Buffer");return this===e||0===na.compare(this,e)},na.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},na.prototype.compare=function(e,t,n,r,a){if(!ua(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(a>>>=0)-(r>>>=0),i=(n>>>=0)-(t>>>=0),s=Math.min(o,i),u=this.slice(r,a),c=e.slice(t,n),l=0;l<s;++l)if(u[l]!==c[l]){o=u[l],i=c[l];break}return o<i?-1:i<o?1:0},na.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},na.prototype.indexOf=function(e,t,n){return da(this,e,t,n,!0)},na.prototype.lastIndexOf=function(e,t,n){return da(this,e,t,n,!1)},na.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return fa(this,e,t,n);case"utf8":case"utf-8":return ma(this,e,t,n);case"ascii":return ga(this,e,t,n);case"latin1":case"binary":return va(this,e,t,n);case"base64":return ya(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ba(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},na.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ka=4096;function Ia(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function Sa(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function Ta(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",o=t;o<n;++o)a+=Da(e[o]);return a}function _a(e,t,n){for(var r=e.slice(t,n),a="",o=0;o<r.length;o+=2)a+=String.fromCharCode(r[o]+256*r[o+1]);return a}function Ca(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function Na(e,t,n,r,a,o){if(!ua(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function Ea(e,t,n,r){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-n,2);a<o;++a)e[n+a]=(t&255<<8*(r?a:1-a))>>>8*(r?a:1-a)}function Ra(e,t,n,r){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-n,4);a<o;++a)e[n+a]=t>>>8*(r?a:3-a)&255}function Aa(e,t,n,r,a,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Oa(e,t,n,r,a){return a||Aa(e,0,n,4),Jr(e,t,n,r,23,4),n+4}function Ma(e,t,n,r,a){return a||Aa(e,0,n,8),Jr(e,t,n,r,52,8),n+8}na.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),na.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=na.prototype;else{var a=t-e;n=new na(a,void 0);for(var o=0;o<a;++o)n[o]=this[o+e]}return n},na.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Ca(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r},na.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Ca(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},na.prototype.readUInt8=function(e,t){return t||Ca(e,1,this.length),this[e]},na.prototype.readUInt16LE=function(e,t){return t||Ca(e,2,this.length),this[e]|this[e+1]<<8},na.prototype.readUInt16BE=function(e,t){return t||Ca(e,2,this.length),this[e]<<8|this[e+1]},na.prototype.readUInt32LE=function(e,t){return t||Ca(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},na.prototype.readUInt32BE=function(e,t){return t||Ca(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},na.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Ca(e,t,this.length);for(var r=this[e],a=1,o=0;++o<t&&(a*=256);)r+=this[e+o]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},na.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Ca(e,t,this.length);for(var r=t,a=1,o=this[e+--r];r>0&&(a*=256);)o+=this[e+--r]*a;return o>=(a*=128)&&(o-=Math.pow(2,8*t)),o},na.prototype.readInt8=function(e,t){return t||Ca(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},na.prototype.readInt16LE=function(e,t){t||Ca(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},na.prototype.readInt16BE=function(e,t){t||Ca(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},na.prototype.readInt32LE=function(e,t){return t||Ca(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},na.prototype.readInt32BE=function(e,t){return t||Ca(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},na.prototype.readFloatLE=function(e,t){return t||Ca(e,4,this.length),Qr(this,e,!0,23,4)},na.prototype.readFloatBE=function(e,t){return t||Ca(e,4,this.length),Qr(this,e,!1,23,4)},na.prototype.readDoubleLE=function(e,t){return t||Ca(e,8,this.length),Qr(this,e,!0,52,8)},na.prototype.readDoubleBE=function(e,t){return t||Ca(e,8,this.length),Qr(this,e,!1,52,8)},na.prototype.writeUIntLE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Na(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[t]=255&e;++o<n&&(a*=256);)this[t+o]=e/a&255;return t+n},na.prototype.writeUIntBE=function(e,t,n,r){e=+e,t|=0,n|=0,r||Na(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+n},na.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,1,255,0),na.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},na.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,2,65535,0),na.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ea(this,e,t,!0),t+2},na.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,2,65535,0),na.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ea(this,e,t,!1),t+2},na.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,4,4294967295,0),na.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Ra(this,e,t,!0),t+4},na.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,4,4294967295,0),na.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ra(this,e,t,!1),t+4},na.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Na(this,e,t,n,a-1,-a)}var o=0,i=1,s=0;for(this[t]=255&e;++o<n&&(i*=256);)e<0&&0===s&&0!==this[t+o-1]&&(s=1),this[t+o]=(e/i|0)-s&255;return t+n},na.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var a=Math.pow(2,8*n-1);Na(this,e,t,n,a-1,-a)}var o=n-1,i=1,s=0;for(this[t+o]=255&e;--o>=0&&(i*=256);)e<0&&0===s&&0!==this[t+o+1]&&(s=1),this[t+o]=(e/i|0)-s&255;return t+n},na.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,1,127,-128),na.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},na.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,2,32767,-32768),na.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ea(this,e,t,!0),t+2},na.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,2,32767,-32768),na.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ea(this,e,t,!1),t+2},na.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,4,2147483647,-2147483648),na.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Ra(this,e,t,!0),t+4},na.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||Na(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),na.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Ra(this,e,t,!1),t+4},na.prototype.writeFloatLE=function(e,t,n){return Oa(this,e,t,!0,n)},na.prototype.writeFloatBE=function(e,t,n){return Oa(this,e,t,!1,n)},na.prototype.writeDoubleLE=function(e,t,n){return Ma(this,e,t,!0,n)},na.prototype.writeDoubleBE=function(e,t,n){return Ma(this,e,t,!1,n)},na.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a,o=r-n;if(this===e&&n<t&&t<r)for(a=o-1;a>=0;--a)e[a+t]=this[a+n];else if(o<1e3||!na.TYPED_ARRAY_SUPPORT)for(a=0;a<o;++a)e[a+t]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},na.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!na.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var i=ua(e)?e:Pa(new na(e,r).toString()),s=i.length;for(o=0;o<n-t;++o)this[o+t]=i[o%s]}return this};var Fa=/[^+\/0-9A-Za-z-_]/g;function Da(e){return e<16?"0"+e.toString(16):e.toString(16)}function Pa(e,t){var n;t=t||1/0;for(var r=e.length,a=null,o=[],i=0;i<r;++i){if((n=e.charCodeAt(i))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(i+1===r){(t-=3)>-1&&o.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function La(e){return function(e){var t,n,r,a,o,i;qr||Xr();var s=e.length;if(s%4>0)throw new Error("Invalid string. Length must be a multiple of 4");o="="===e[s-2]?2:"="===e[s-1]?1:0,i=new Hr(3*s/4-o),r=o>0?s-4:s;var u=0;for(t=0,n=0;t<r;t+=4,n+=3)a=jr[e.charCodeAt(t)]<<18|jr[e.charCodeAt(t+1)]<<12|jr[e.charCodeAt(t+2)]<<6|jr[e.charCodeAt(t+3)],i[u++]=a>>16&255,i[u++]=a>>8&255,i[u++]=255&a;return 2===o?(a=jr[e.charCodeAt(t)]<<2|jr[e.charCodeAt(t+1)]>>4,i[u++]=255&a):1===o&&(a=jr[e.charCodeAt(t)]<<10|jr[e.charCodeAt(t+1)]<<4|jr[e.charCodeAt(t+2)]>>2,i[u++]=a>>8&255,i[u++]=255&a),i}(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(Fa,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function Ba(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function Ua(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function Va(e,t){var n=e;if(ie(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||ie(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&Ie().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],!Array.isArray(t)&&!ie(t))return void H(0===n.length,(function(){return"Element arr[".concat(r.join("]["),"] is a primitive, but should be an array/TypedArray of ").concat(n[0]," elements")}));H(n.length>0,(function(){return"Element arr[".concat(r.join("]["),"] should be a primitive, but is an array of ").concat(t.length," elements")})),H(t.length===n[0],(function(){return"Element arr[".concat(r.join("]["),"] should have ").concat(n[0]," elements, but has ").concat(t.length," elements")}));for(var a=n.slice(1),o=0;o<t.length;++o)e(t[o],a,r.concat(o))}(e,r,[]),r}function Wa(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must be ").concat(e," tensor, but got ").concat(t," tensor"))}}function za(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof kr)return Wa(r,e.dtype,t,n),e;var a=ce(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Wa(r,a,t,n),null==e||!ie(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e){var o=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a Tensor or TensorLike, but got '").concat(o,"'"))}var i=Va(e,a);ie(e)||Array.isArray(e)||(e=[e]);var s="string"!==a?cr(e,a):K(e,[],!0);return Br.makeTensor(s,i,a)}function Ga(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a `Tensor[]` or `TensorLike[]`"));return e.map((function(e,a){return za(e,"".concat(t,"[").concat(a,"]"),n,r)}))}function ja(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with ".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){Br.startScope(n);try{var e=r.apply(void 0,arguments);return be(e)&&console.error("Cannot return a Promise inside of tidy."),Br.endScope(e),e}catch(e){throw Br.endScope(null),e}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Ha=ja({complex_:function(e,t){var n=za(e,"real","complex"),r=za(t,"imag","complex");q(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", must match in call to tf.complex()."));var a={real:n,imag:r};return Br.runKernel(Le,a)}});function qa(e,t,n,r){if(null==r&&(r=ce(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ie(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){ge(t);var a=Y(t),o=Y(n);H(a===o,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ").concat(a," values but has ").concat(o)}));for(var i=0;i<n.length;++i){var s=n[i],u=i!==n.length-1||s!==Y(t.slice(i));H(n[i]===t[i]||!u,(function(){return"Error creating a new Tensor. Inferred shape (".concat(n,") does not match the provided shape (").concat(t,"). ")}))}}return ie(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?cr(e,r):K(e,[],!0),Br.makeTensor(e,t,r)}function Xa(e,t,n){return qa(e,t,Va(e,n),n)}var Ka={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function Ya(e,t){var n,r,a={},o=0,s=i(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,c=u.name,l=u.dtype,p=u.shape,d=Y(p),h=void 0;if("quantization"in u){var f=u.quantization;if("uint8"===f.dtype||"uint16"===f.dtype){if(!("min"in f)||!("scale"in f))throw new Error("Weight ".concat(u.name," with quantization ").concat(f.dtype," doesn't have corresponding metadata min and scale."))}else{if("float16"!==f.dtype)throw new Error("Weight ".concat(u.name," has unknown quantization dtype ").concat(f.dtype,". Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'."));if("float32"!==l)throw new Error("Weight ".concat(u.name," is quantized with ").concat(f.dtype," which only supports weights of type float32 not ").concat(l,"."))}var m=Ka[f.dtype],g=e.slice(o,o+d*m),v="uint8"===f.dtype?new Uint8Array(g):new Uint16Array(g);if("float32"===l)if("uint8"===f.dtype||"uint16"===f.dtype){h=new Float32Array(v.length);for(var y=0;y<v.length;y++){var b=v[y];h[y]=b*f.scale+f.min}}else{if("float16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," for weight type float32."));void 0===n&&(n=so()),h=n(v)}else{if("int32"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));if("uint8"!==f.dtype&&"uint16"!==f.dtype)throw new Error("Unsupported quantization type ".concat(f.dtype," for weight type int32."));h=new Int32Array(v.length);for(var x=0;x<v.length;x++){var w=v[x];h[x]=Math.round(w*f.scale+f.min)}}o+=d*m}else if("string"===l){var k=Y(u.shape);h=[];for(var I=0;I<k;I++){var S=new Uint32Array(e.slice(o,o+4))[0];o+=4;var T=new Uint8Array(e.slice(o,o+S));h.push(T),o+=S}}else{var _=Ka[l],C=e.slice(o,o+d*_);if("float32"===l)h=new Float32Array(C);else if("int32"===l)h=new Int32Array(C);else if("bool"===l)h=new Uint8Array(C);else{if("complex64"!==l)throw new Error("Unsupported dtype in weight '".concat(c,"': ").concat(l));h=new Float32Array(C);for(var N=new Float32Array(h.length/2),E=new Float32Array(h.length/2),R=0;R<N.length;R++)N[R]=h[2*R],E[R]=h[2*R+1];var A=Xa(N,p,"float32"),O=Xa(E,p,"float32");a[c]=Ha(A,O),A.dispose(),O.dispose()}o+=d*_}"complex64"!==l&&(a[c]=Xa(h,p,l))}}catch(e){s.e(e)}finally{s.f()}return a}function Qa(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var Ja=void 0!==na&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function Za(e){return Ja?na.byteLength(e):new Blob([e]).size}function $a(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function eo(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function to(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function no(e,t,n){var r={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};if(null!=e.trainingConfig&&(r.trainingConfig=e.trainingConfig),null!=e.weightsManifest){if(!t)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");r.weightSpecs=t,r.weightData=n}return null!=e.signature&&(r.signature=e.signature),null!=e.userDefinedMetadata&&(r.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(r.modelInitializer=e.modelInitializer),r}function ro(e,t){return ao.apply(this,arguments)}function ao(){return(ao=c(u().mark((function e(t,n){var r,a,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null!=t.weightsManifest,!e.t0){e.next=9;break}return e.next=4,n(t.weightsManifest);case 4:r=e.sent,a=s(r,2),o=a[0],i=a[1];case 9:return e.abrupt("return",no(t,o,i));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function oo(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Za(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Za(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function io(e){var t,n=[],r=i(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push.apply(n,o(a.weights))}}catch(e){r.e(e)}finally{r.f()}return n}function so(){var e=function(){var e=function(e){for(var t=e<<13,n=0;!(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|(n+=947912704)},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),o=new Uint32Array(a),i=0;i<r.length;i++){var s=r[i],u=e[n[s>>10]+(1023&s)]+t[s>>10];o[i]=u}return new Float32Array(a)}}var uo=function(){function e(){l(this,e),this.saveRouters=[],this.loadRouters=[]}return p(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}])}(),co="tensorflowjs",lo="models_store",po="model_info_store";function ho(){if(!Ie().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"==typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function fo(e){var t=e.result;t.createObjectStore(lo,{keyPath:"modelPath"}),t.createObjectStore(po,{keyPath:"modelPath"})}var mo=function(){return p((function e(t){if(l(this,e),this.indexedDB=ho(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}),[{key:"save",value:(t=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"load",value:(e=c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(co,1);a.onupgradeneeded=function(){return fo(a)},a.onsuccess=function(){var o=a.result;if(null==t){var i=o.transaction(lo,"readonly"),s=i.objectStore(lo).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return o.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' in IndexedDB.")));e(s.result.modelArtifacts)},s.onerror=function(e){return o.close(),r(s.error)},i.oncomplete=function(){return o.close()}}else{var u,c=oo(t),l=o.transaction(po,"readwrite"),p=l.objectStore(po),d=p.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var a=(u=o.transaction(lo,"readwrite")).objectStore(lo).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(p=l.objectStore(po)).delete(n.modelPath);t.onsuccess=function(){return o.close(),r(a.error)},t.onerror=function(e){return o.close(),r(a.error)}}},d.onerror=function(e){return o.close(),r(d.error)},l.oncomplete=function(){null==u?o.close():u.oncomplete=function(){return o.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]);var e,t}();mo.URL_SCHEME="indexeddb://";var go=function(e){return Ie().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(mo.URL_SCHEME)?(t=e.slice(mo.URL_SCHEME.length),new mo(t)):null;var t};uo.registerSaveRouter(go),uo.registerLoadRouter(go);var vo=function(){return p((function e(){l(this,e),this.indexedDB=ho()}),[{key:"listModels",value:(t=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(co,1);r.onupgradeneeded=function(){return fo(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(po,"readonly"),o=a.objectStore(po).getAll();o.onsuccess=function(){var t,n={},r=i(o.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(e){r.e(e)}finally{r.f()}e(n)},o.onerror=function(e){return t.close(),n(o.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"removeModel",value:(e=c(u().mark((function e(t){var n,r=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(t=(n=t).startsWith(mo.URL_SCHEME)?n.slice(mo.URL_SCHEME.length):n,new Promise((function(e,n){var a=r.indexedDB.open(co,1);a.onupgradeneeded=function(){return fo(a)},a.onsuccess=function(){var r,o=a.result,i=o.transaction(po,"readwrite"),s=i.objectStore(po),u=s.get(t);u.onsuccess=function(){if(null==u.result)return o.close(),n(new Error("Cannot find model with path '".concat(t,"' in IndexedDB.")));var a=s.delete(t),i=function(){var a=(r=o.transaction(lo,"readwrite")).objectStore(lo).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return n(u.error)}};a.onsuccess=i,a.onerror=function(e){return i(),o.close(),n(u.error)}},u.onerror=function(e){return o.close(),n(u.error)},i.oncomplete=function(){null==r?o.close():r.oncomplete=function(){return o.close()}}},a.onerror=function(e){return n(a.error)}}))));case 1:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})}]);var e,t}(),yo="/",bo="tensorflowjs_models",xo="info",wo="model_topology",ko="weight_specs",Io="weight_data",So="model_metadata";function To(e){return{info:[bo,e,xo].join(yo),topology:[bo,e,wo].join(yo),weightSpecs:[bo,e,ko].join(yo),weightData:[bo,e,Io].join(yo),modelMetadata:[bo,e,So].join(yo)}}function _o(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function Co(e){var t=e.split(yo);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(yo)}var No=function(){return p((function e(t){if(l(this,e),!Ie().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=To(this.modelPath)}),[{key:"save",value:(t=c(u().mark((function e(t){var n,r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=oo(t),e.prev=3,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(e){if(Ja)return na.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(t.weightData)),o={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},e.abrupt("return",(this.LS.setItem(this.keys.modelMetadata,JSON.stringify(o)),{modelArtifactsInfo:a}));case 9:throw e.prev=9,e.t0=e.catch(3),_o(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=").concat(a.modelTopologyBytes,", weightSpecsBytes=").concat(a.weightSpecsBytes,", weightDataBytes=").concat(a.weightDataBytes,"."));case 12:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return t.apply(this,arguments)})},{key:"load",value:(e=c(u().mark((function e(){var t,n,r,a,o,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=8;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' is missing."));case 8:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=12;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' are missing."));case 12:if(n.weightSpecs=a,null!=(o=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(o),n.format=i.format,n.generatedBy=i.generatedBy,n.convertedBy=i.convertedBy,null!=i.signature&&(n.signature=i.signature),null!=i.userDefinedMetadata&&(n.userDefinedMetadata=i.userDefinedMetadata),null!=i.modelInitializer&&(n.modelInitializer=i.modelInitializer),null!=i.trainingConfig&&(n.trainingConfig=i.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=18;break}throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));case 18:return e.abrupt("return",(n.weightData=function(e){if(Ja){var t=na.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}(s),n));case 19:case"end":return e.stop()}}),e,this)}))),function(){return e.apply(this,arguments)})}]);var e,t}();No.URL_SCHEME="localstorage://";var Eo=function(e){return Ie().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(No.URL_SCHEME)?(t=e.slice(No.URL_SCHEME.length),new No(t)):null;var t};uo.registerSaveRouter(Eo),uo.registerLoadRouter(Eo);var Ro=function(){return p((function e(){l(this,e),H(Ie().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),H("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}),[{key:"listModels",value:(t=c(u().mark((function e(){var t,n,r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=bo+yo,r=yo+xo,a=0;a<this.LS.length;++a)(o=this.LS.key(a)).startsWith(n)&&o.endsWith(r)&&(t[Co(o)]=JSON.parse(this.LS.getItem(o)));return e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"removeModel",value:(e=c(u().mark((function e(t){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=To(t=(n=t).startsWith(No.URL_SCHEME)?n.slice(No.URL_SCHEME.length):n),null!=this.LS.getItem(r.info)){e.next=3;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 3:return a=JSON.parse(this.LS.getItem(r.info)),e.abrupt("return",(_o(r),a));case 5:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t}();function Ao(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Oo=function(){return p((function e(t){if(l(this,e),!Ie().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}),[{key:"save",value:(e=c(u().mark((function e(t){var n,r,a,o,i;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!=typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=5;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 5:return r=to(t,[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}]),a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=a,e.next=10,Ao((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 10:if(null==t.weightData){e.next=16;break}return(i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=n,e.next=16,Ao((function(){return i.dispatchEvent(new MouseEvent("click"))}));case 16:return e.abrupt("return",{modelArtifactsInfo:oo(t)});case 17:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e}();Oo.URL_SCHEME="downloads://";var Mo=function(){return p((function e(t){if(l(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}),[{key:"load",value:(e=c(u().mark((function e(){var t=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),o=a.modelTopology;if(null!=o)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var i=ro(a,(function(e){return t.loadWeights(e)}));e(i)}else e({modelTopology:o});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading Keras-style tf.Model artifacts only."))},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)}))),function(){return e.apply(this,arguments)})},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],s=i(e);try{for(s.s();!(t=s.n()).done;){var u=t.value;r.push.apply(r,o(u.weights)),a.push.apply(a,o(u.paths))}}catch(e){s.e(e)}finally{s.f()}var c=this.checkManifestAndWeightFiles(e),l=a.map((function(e){return n.loadWeightsFile(e,c[e])}));return Promise.all(l).then((function(e){return[r,$a(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return eo(e.name)})),o={},s=i(e);try{for(s.s();!(t=s.n()).done;){t.value.paths.forEach((function(e){var t=eo(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: '".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));o[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(e){s.e(e)}finally{s.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest (".concat(r.length,") and the number of weight files provided (").concat(this.weightsFiles.length,")."));return o}}]);var e}();function Fo(e,t,n,r){!function(e){H(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){H(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction ".concat(e)})),H(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction ".concat(t)})),H(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction ".concat(e," and endFraction ").concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(o){return o.then((function(o){var i=n+ ++a/e.length*(r-n);return t(i),o})),o})))}function Do(e,t){return Po.apply(this,arguments)}function Po(){return(Po=c(u().mark((function e(t,n){var r,a,o;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?Ie().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),null!=n.onProgress){e.next=9;break}return e.next=6,Promise.all(a);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,Fo(a,n.onProgress,0,.5);case 11:e.t0=e.sent;case 12:if(o=e.t0.map((function(e){return e.arrayBuffer()})),null!=n.onProgress){e.next=19;break}return e.next=16,Promise.all(o);case 16:e.t1=e.sent,e.next=22;break;case 19:return e.next=21,Fo(o,n.onProgress,.5,1);case 21:e.t1=e.sent;case 22:return e.abrupt("return",e.t1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lo(e){return function(){var t=c(u().mark((function t(n){var r,a,o,i,s,c,l,p,d,h,f,m,g=arguments;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=g.length>1&&void 0!==g[1]?g[1]:"",a=g.length>2?g[2]:void 0,o=n.map((function(){return!1})),i={},s=null!=a?a.map((function(){return!1})):[],c=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,u=Ka[r]*Y(e.shape),l=function(){o[t]=!0,null==i[t]&&(i[t]=[]),i[t].push({manifestEntry:e,groupOffset:n,sizeBytes:u})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),c.push(e.name),n+=u}))})),s.every((function(e){return e}))){t.next=6;break}throw l=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: ".concat(l.join(", "),". \nManifest JSON has weights with names: ").concat(c.join(", "),"."));case 6:return p=o.reduce((function(e,t,n){return t&&e.push(n),e}),[]),d=[],p.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;d.push(t)}))})),t.next=10,e(d);case 10:return h=t.sent,f={},m=0,t.abrupt("return",(p.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=h[m+a].byteLength;for(var o=new ArrayBuffer(r),s=new Uint8Array(o),u=0,c=0;c<t;c++){var l=new Uint8Array(h[m+c]);s.set(l,u),u+=l.byteLength}i[e].forEach((function(e){var t=Ya(o.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),m+=t})),f));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}uo.registerSaveRouter((function(e){return Ie().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Oo.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Oo(e)}(e.slice(Oo.URL_SCHEME.length)):null}));var Bo=function(){return p((function e(t,n){if(l(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(H("function"==typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=Ie().platform.fetch,H(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&H(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}),[{key:"save",value:(n=c(u().mark((function e(t){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=to(t,[{paths:["./model.weights.bin"],weights:t.weightSpecs}]),n.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=8,this.fetch(this.path,n);case 8:if(!(a=e.sent).ok){e.next=11;break}return e.abrupt("return",{modelArtifactsInfo:oo(t),responses:[a]});case 11:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status ".concat(a.status,"."));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"load",value:(t=c(u().mark((function e(){var t,n,r,a,o,i=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ").concat(t.status,". Please verify this URL points to the model JSON of the model to load."));case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 15:if(a=n.modelTopology,o=n.weightsManifest,null!=a||null!=o){e.next=18;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model topology or manifest for weights."));case 18:return e.abrupt("return",ro(n,(function(e){return i.loadWeights(e)})));case 19:case"end":return e.stop()}}),e,this,[[5,11]])}))),function(){return t.apply(this,arguments)})},{key:"loadWeights",value:(e=c(u().mark((function e(t){var n,r,a,c,l,p,d,h,f,m,g,v,y,b,x;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(n),a=s(r,2),c=a[0],l=a[1],p=this.weightPathPrefix||c,d=io(t),h=[],f=[],m=i(t);try{for(m.s();!(g=m.n()).done;){v=g.value,y=i(v.paths);try{for(y.s();!(b=y.n()).done;)x=b.value,null!=this.weightUrlConverter?f.push(this.weightUrlConverter(x)):h.push(p+x+l)}catch(e){y.e(e)}finally{y.f()}}}catch(e){m.e(e)}finally{m.f()}if(e.t0=this.weightUrlConverter,!e.t0){e.next=13;break}return e.t1=h.push,e.t2=h,e.t3=o,e.next=10,Promise.all(f);case 10:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5);case 13:return e.t6=d,e.t7=$a,e.next=17,Do(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 17:return e.t8=e.sent,e.t9=(0,e.t7)(e.t8),e.abrupt("return",[e.t6,e.t9]);case 20:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})}]);var e,t,n}();function Uo(e){return null!=e.match(Bo.URL_SCHEME_REGEX)}Bo.URL_SCHEME_REGEX=/^https?:\/\//;var Vo=function(e,t){if("undefined"==typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Uo(e)})):Uo(e))?Wo(e,t):null};function Wo(e,t){return new Bo(e,t)}uo.registerSaveRouter(Vo),uo.registerLoadRouter(Vo);var zo=function(){return p((function e(t){l(this,e),this.modelArtifacts=t}),[{key:"load",value:function(){return this.modelArtifacts}}])}(),Go=function(){return p((function e(t){l(this,e),this.saveHandler=t}),[{key:"save",value:function(e){return this.saveHandler(e)}}])}(),jo=p((function e(t){l(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function Ho(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new zo(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zo({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zo({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))}var qo="://",Xo=function(){function e(){l(this,e),this.managers={}}return p(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){H(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(qo)&&(t=t.slice(0,t.indexOf(qo))),H(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();H(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}])}();function Ko(e){if(-1===e.indexOf(qo))throw new Error("The url string provided does not contain a scheme. Supported schemes are: ".concat(Xo.getSchemes().join(",")));return{scheme:e.split(qo)[0],path:e.split(qo)[1]}}function Yo(e,t){return Qo.apply(this,arguments)}function Qo(){return(Qo=c(u().mark((function e(t,n){var r,a,o,i,s,c,l,p,d,h,f=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=f.length>2&&void 0!==f[2]&&f[2],H(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),H((a=uo.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),H(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") load handlers for source URL ").concat(t,".")})),o=a[0],H((i=uo.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination URL ".concat(n,".")})),H(i.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") save handlers for destination URL ").concat(n,".")})),s=i[0],c=Ko(t).scheme,l=Ko(t).path,p=c===Ko(t).scheme,e.next=12,o.load();case 12:if(d=e.sent,e.t0=r&&p,!e.t0){e.next=17;break}return e.next=17,Xo.getManager(c).removeModel(l);case 17:return e.next=19,s.save(d);case 19:if(h=e.sent,e.t1=r&&!p,!e.t1){e.next=24;break}return e.next=24,Xo.getManager(c).removeModel(l);case 24:return e.abrupt("return",h.modelArtifactsInfo);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Jo,Zo,$o,ei,ti,ni,ri,ai=Object.freeze({__proto__:null,browserFiles:function(e){return new Mo(e)},browserHTTPRequest:function(e,t){return Wo(e,t)},concatenateArrayBuffers:$a,copyModel:(ni=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Yo(t,n,!1));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return ni.apply(this,arguments)}),decodeWeights:Ya,encodeWeights:(ti=c(u().mark((function e(t,n){var r,a,o,i,s;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],a=[],o=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),i=u().mark((function e(){var i,l,p,d;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o[s],"float32"===(l=Array.isArray(t)?t[s].tensor:t[i]).dtype||"int32"===l.dtype||"bool"===l.dtype||"string"===l.dtype||"complex64"===l.dtype){e.next=3;break}throw new Error("Unsupported dtype in weight '".concat(i,"': ").concat(l.dtype));case 3:p={name:i,shape:l.shape,dtype:l.dtype},"string"===l.dtype?(d=new Promise(function(){var e=c(u().mark((function e(t){var n,r,a,o,i,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),o=0,i=0;i<n.length;i++)s=n[i],c=new Uint8Array(new Uint32Array([s.length]).buffer),a.set(c,o),o+=4,a.set(s,o),o+=s.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.push(d)):a.push(l.data()),null!=n&&(p.group=n),r.push(p);case 6:case"end":return e.stop()}}),e)})),s=0;case 3:if(!(s<o.length)){e.next=8;break}return e.delegateYield(i(),"t0",5);case 5:++s,e.next=3;break;case 8:return e.t1=Qa,e.next=11,Promise.all(a);case 11:return e.t2=e.sent,e.t3=(0,e.t1)(e.t2),e.t4=r,e.abrupt("return",{data:e.t3,specs:e.t4});case 15:case"end":return e.stop()}}),e)}))),function(e,t){return ti.apply(this,arguments)}),fromMemory:function(e,t,n,r){return new jo(Ho.apply(void 0,arguments))},fromMemorySync:Ho,getLoadHandlers:function(e,t){return uo.getLoadHandlers(e,t)},getModelArtifactsForJSON:ro,getModelArtifactsForJSONSync:no,getModelArtifactsInfoForJSON:oo,getSaveHandlers:function(e){return uo.getSaveHandlers(e)},getWeightSpecs:io,http:Wo,isHTTPScheme:Uo,listModels:(ei=c(u().mark((function e(){var t,n,r,a,o,s,c;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Xo.getSchemes(),n={},r=i(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=12;break}return o=a.value,e.next=8,Xo.getManager(o).listModels();case 8:for(c in s=e.sent)n[o+qo+c]=s[c];case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(2),r.e(e.t0);case 17:return e.prev=17,r.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,null,[[2,14,17,20]])}))),function(){return ei.apply(this,arguments)}),loadWeights:($o=c(u().mark((function e(t){var n,r,a,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,e.abrupt("return",Lo((function(e){return Do(e,{requestInit:a})}))(t,n,r));case 4:case"end":return e.stop()}}),e)}))),function(e){return $o.apply(this,arguments)}),moveModel:(Zo=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Yo(t,n,!0));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return Zo.apply(this,arguments)}),registerLoadRouter:function(e){return uo.registerLoadRouter(e)},registerSaveRouter:function(e){return uo.registerSaveRouter(e)},removeModel:(Jo=c(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ko(t),e.abrupt("return",Xo.getManager(n.scheme).removeModel(n.path));case 2:case"end":return e.stop()}}),e)}))),function(e){return Jo.apply(this,arguments)}),weightsLoaderFactory:Lo,withSaveHandler:function(e){return new Go(e)},withSaveHandlerSync:function(e){return new Go(e)}}),oi=ja({cast_:function(e,t){var n=za(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Br.runKernel(De,r,a)}});function ii(){return Br}function si(e,t){return Br.tidy(e,t)}function ui(e){Mr(e).forEach((function(e){return e.dispose()}))}function ci(e){return Br.keep(e)}function li(e){return Br.setBackend(e)}function pi(){return Br.backendName}function di(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Br.registerBackend(e,t,n)}function hi(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var o=n-1-a,i=e[o]||1;(t[t.length-1-a]||1)>1&&1===i&&r.unshift(o)}return r}function fi(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],o=t.length-r-1,i=t[o];(null==a||1===a&&i>1)&&n.unshift(o)}return n}function mi(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var o=e[e.length-a-1];null==o&&(o=1);var i=t[t.length-a-1];if(null==i&&(i=1),1===o)n.unshift(i);else if(1===i)n.unshift(o);else{if(o!==i)throw Error("Operands could not be broadcast together with shapes ".concat(e," and ").concat(t,"."));n.unshift(o)}}return n}function gi(e,t){return vi.apply(this,arguments)}function vi(){return(vi=c(u().mark((function e(t,n){var r,a,o,i,c,l,p,d,h,f,m,g,v,y,b,x,w;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=za(t,"img","toPixels"),t instanceof kr||(r=oi(a=r,"int32"),a.dispose()),2===r.rank||3===r.rank){e.next=4;break}throw new Error("toPixels only supports rank 2 or 3 tensors, got rank ".concat(r.rank,"."));case 4:if(o=r.shape.slice(0,2),i=s(o,2),c=i[0],l=i[1],!((p=2===r.rank?1:r.shape[2])>4||2===p)){e.next=7;break}throw new Error("toPixels only supports depth of size 1, 3 or 4 but got ".concat(p));case 7:if("float32"===r.dtype||"int32"===r.dtype){e.next=9;break}throw new Error("Unsupported type for toPixels: ".concat(r.dtype,". Please use float32 or int32 tensors."));case 9:return e.next=11,r.data();case 11:d=e.sent,h="float32"===r.dtype?255:1,f=new Uint8ClampedArray(l*c*4),m=0;case 15:if(!(m<c*l)){e.next=36;break}g=[0,0,0,255],v=0;case 18:if(!(v<p)){e.next=31;break}if(y=d[m*p+v],"float32"!==r.dtype){e.next=25;break}if(!(y<0||y>1)){e.next=23;break}throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ".concat(y,"."));case 23:e.next=27;break;case 25:if("int32"!==r.dtype||!(y<0||y>255)){e.next=27;break}throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ".concat(y,"."));case 27:1===p?(g[0]=y*h,g[1]=y*h,g[2]=y*h):g[v]=y*h;case 28:v++,e.next=18;break;case 31:f[(b=4*m)+0]=Math.round(g[0]),f[b+1]=Math.round(g[1]),f[b+2]=Math.round(g[2]),f[b+3]=Math.round(g[3]);case 33:++m,e.next=15;break;case 36:return null!=n&&(n.width=l,n.height=c,x=n.getContext("2d"),w=new ImageData(f,l,c),x.putImageData(w,0,0)),e.abrupt("return",(r!==t&&r.dispose(),f));case 38:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var yi=ja({fromPixels_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,o=!1,i=!1,u=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)o=!0;else if(null!=e.getContext)i=!0;else{if(!("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ".concat(e.constructor.name));u=!0}if(null!=mn(sn,Br.backendName)){var c={pixels:e},l={numChannels:t};return Br.runKernel(sn,c,l)}var p,d,h=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],f=s(h,2),m=f[0],g=f[1];if(i)p=e.getContext("2d").getImageData(0,0,m,g).data;else if(r||n)p=e.data;else if(o||a||u){if(null==ri)if("undefined"==typeof document){if("undefined"==typeof OffscreenCanvas||"undefined"==typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");ri=new OffscreenCanvas(1,1).getContext("2d")}else ri=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});ri.canvas.width=m,ri.canvas.height=g,ri.drawImage(e,0,0,m,g),p=ri.getImageData(0,0,m,g).data}if(4===t)d=new Int32Array(p);else{var v=m*g;d=new Int32Array(v*t);for(var y=0;y<v;y++)for(var b=0;b<t;++b)d[y*t+b]=p[4*y+b]}return function(e,t,n){if(X(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Va(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return qa(e,t,r,n)}(d,[g,m,t],"int32")}});function bi(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: ".concat(t.shape[r-1]," vs. ").concat(n));if(0===Y(e.shape))throw new Error("Requested more than 0 entries, but input is empty. Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],s=1,u=0;u<a.length-1;++u)s*=a[u];var c=e.shape,l=a.slice();l.pop();for(var p=1,d=i;d<n;++d)p*=c[d],l.push(c[d]);var h=[].concat(o(de(e.shape).map((function(e){return e/p}))),[1]).slice(0,i);return[l,s,p,h]}function xi(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ".concat(n.shape,", indices.shape: ").concat(t.shape,", shape: ").concat(e,", sliceDim: ").concat(r,", and batchDim: ").concat(a,".");if(n.rank<a)throw new Error(o+" update.rank < ".concat(a,". "));if(e.length<r+(n.rank-a))throw new Error(o+" Output shape length < ".concat(r+(n.rank-a)));if(n.rank!==a+e.length-r)throw new Error(o+" update.rank != "+(a+e.length-r));for(var i=0;i<a;++i)if(n.shape[i]!==t.shape[i])throw new Error(o+" updates.shape[".concat(i,"] (").concat(n.shape[i],") != indices.shape[").concat(i,"] (").concat(t.shape[i],")."));for(var s=0;s<n.rank-a;++s)if(n.shape[s+a]!==e[s+r])throw new Error(o+" updates.shape[".concat(s+a,"] (").concat(n.shape[s+a],") != shape[").concat(s+a,"] (").concat(e[s+a],")"))}function wi(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,s=1,u=a;u<i;++u)s*=n[u];var c=a<1?1:a;return{sliceRank:a,numUpdates:Y(t.shape)/c,sliceSize:s,strides:[].concat(o(de(n.slice(0,a))),[1]),outputSize:Y(n)}}function ki(e,t,n){var r=e.shape.length;H(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must match the rank of the array (").concat(r,").")})),H(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must match the rank of the array (").concat(r,").")}));for(var a=function(a){H(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] (").concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},o=0;o<r;++o)a(o)}function Ii(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function Si(e,t,n,r){for(var a=o(e),i=a.length;i<r.length;i++)a.push(1);for(var s=0;s<n;s++)0===s?a[t]=1:(a.splice(t,0,1),a.pop());return a}function Ti(e,t,n){return n<=e?n:n-(t-1)}function _i(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function Ci(e,t,n,r,a){for(var i=o(a),s=_i(n,t),u=0;u<i.length;u++)if(s.indexOf(u)>-1)i[u]=0;else{var c=Ti(t,n,u),l=r[c];e&1<<c&&(l=0),i[u]=l}return i}function Ni(e,t,n,r,a){for(var i=o(a),s=_i(n,t),u=0;u<i.length;u++)if(s.indexOf(u)>-1)i[u]=Number.MAX_SAFE_INTEGER;else{var c=Ti(t,n,u),l=r[c];e&1<<c&&(l=Number.MAX_SAFE_INTEGER),i[u]=l}for(var p=0;p<i.length;p++){var d=a[p];i[p]<0&&(i[p]+=d),i[p]=z(0,i[p],a[p])}return i}function Ei(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function Ri(e,t,n,r,a,o){var i=t[a],s=n[a]||1;(e&1<<a||o&1<<a||null==i)&&(i=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return i<0&&(i+=u),i=z(0,i,u-1)}function Ai(e,t,n,r,a,o){var i=t[a],s=n[a]||1;(e&1<<a||o&1<<a||null==i)&&(i=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return i<0&&(i+=u),i=s>0?z(0,i,u):z(-1,i,u-1)}function Oi(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var o=r+1;o<n.length;o++)if(t[o]>0||n[o]!==e[o])return!1;return!0}function Mi(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function Fi(e,t,n){var r,a,i=e.shape.length;return(r="number"==typeof t?[t].concat(o(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){H(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"==typeof n?[n].concat(o(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(H(-1===t,(function(){return"Negative size values should be exactly -1 but got ".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function Di(e,t,n,r,a,o,i,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=i&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,p={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:o,ellipsisMask:i,newAxisMask:s,shrinkAxisMask:u},d=0;d<p.dims;d++)l&&1<<d&s&&p.numAddAxisAfterEllipsis++,1<<d&i&&(l=!0);l||(p.ellipsisMask|=1<<p.dims,p.dims++);var h={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input has only ").concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(p,h);for(var f=!0,m=!0,g=!0,v=[],y=[],b=0;b<e.length;++b){if(0===h.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(h.shrinkAxisMask&1<<b),w=e[b];if(-1!==w){var k=[h.beginMask&1<<b,h.endMask&1<<b],I=[h.strides[b]>0?0:-1,h.strides[b]>0?w:w-1];if(x&&h.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&1===h.strides[b];var S=!!(h.beginMask&1<<b&&h.endMask&1<<b);if(h.beginValid&&h.endValid){if(x){var T=h.begin[b]<0?w+h.begin[b]:h.begin[b];if(h.begin[b]=T,h.end[b]=h.begin[b]+1,T<0||T>=w)throw Error("slice index ".concat(h.begin[b]," of dimension ").concat(b," out of bounds."))}else h.begin[b]=Pi(h.begin[b],0,h.strides[b],w,k,I),h.end[b]=Pi(h.end[b],1,h.strides[b],w,k,I);var _=1===h.strides[b]&&0===h.begin[b]&&h.end[b]===w;f=f&&_,m=m&&(0===b&&1===h.strides[b]||_)}else f=f&&1===h.strides[b]&&S,m=m&&(0===b&&1===h.strides[b]||S);var C=void 0,N=!1;if(h.beginValid&&h.endValid?(C=h.end[b]-h.begin[b],N=!0):x?(C=1,N=!0):S&&w>=0&&(C=h.strides[b]<0?-w:w,N=!0),N){var E;E=0===C||C<0!=h.strides[b]<0?0:Math.trunc(C/h.strides[b])+(C%h.strides[b]!=0?1:0),v.push(E)}else v.push(-1)}else v.push(x?1:-1)}for(var R=0;R<h.finalShapeGatherIndices.length;++R){var A=h.finalShapeGatherIndices[R];A>=0?y.push(v[A]):-2===A&&y.push(1)}return{finalShapeSparse:y.filter((function(e,t){return-2!==h.finalShapeGatherIndices[t]})),finalShape:y,isIdentity:f,sliceDim0:m,isSimpleSlice:g,begin:h.begin,end:h.end,strides:h.strides}}function Pi(e,t,n,r,a,o){if(a[t])return n>0?o[t]:o[t+1&1];var i=e<0?r+e:e;return i<o[0]?o[0]:i>o[1]?o[1]:i}var Li=Object.freeze({__proto__:null,assertParamsValid:ki,computeFlatOffset:Mi,computeOutShape:Ii,getNormalizedAxes:function(e,t,n,r,a,o,i,s,u){var c=e.length,l=new Array(c),p=new Array(c),d=new Array(c);if(t.length&&n>0){var h=t[0],f=n+1;l=Ci(i,h,f,r,e),p=Ni(s,h,f,a,e),d=Si(o,h,f,e)}else for(var m=0;m<c;m++)l[m]=Ri(i,r,o,e,m,u),p[m]=Ai(s,a,o,e,m,u),d[m]=Ei(o,m,u);return{begin:l,end:p,strides:d}},isSliceContinous:Oi,maskToAxes:function(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t},parseSliceParams:Fi,sliceInfo:Di,startForAxis:Ri,startIndicesWithElidedDims:Ci,stopForAxis:Ai,stopIndicesWithElidedDims:Ni,stridesForAxis:Ei,stridesWithElidedDims:Si}),Bi=ja({add_:function(e,t){var n=za(e,"a","add"),r=za(t,"b","add"),a=Or(n,r),o=s(a,2),i={a:n=o[0],b:r=o[1]};return Br.runKernel(Ne,i)}}),Ui=ja({floorDiv_:function(e,t){var n=za(e,"a","floorDiv"),r=za(t,"b","floorDiv"),a=Or(n,r),o=s(a,2),i={a:n=o[0],b:r=o[1]};return Br.runKernel($e,i)}}),Vi=ja({div_:function(e,t){var n,r,a=za(e,"a","div"),o=za(t,"b","div");if(n=Or(a,o),a=(r=s(n,2))[0],o=r[1],"int32"===a.dtype&&"int32"===o.dtype)return Ui(a,o);var i={a:a,b:o};return Br.runKernel(Ye,i,{})}}),Wi=ja({mul_:function(e,t){var n=za(e,"a","mul"),r=za(t,"b","mul"),a=Or(n,r),o=s(a,2),i={a:n=o[0],b:r=o[1]};return Br.runKernel(gt,i)}}),zi=ja({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:za(e,"x","argMax")},r={axis:t};return Br.runKernel(Re,n,r)}});function Gi(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0;return qi(e,[].concat(o(t),[e[3]]),n,i,r,null,null,ts(a))}function ji(e,t,n,r,a,o){var i,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",c=Yi(t),l=s(c,2),p=l[0],d=l[1];if("channelsLast"===u)i=[p,d,e[3],e[3]];else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));i=[p,d,e[1],e[1]]}return qi(e,i,n,r,a,o,!1,u)}function Hi(e,t,n,r,a,o){var i,u,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",l=Qi(t),p=s(l,3),d=p[0],h=p[1],f=p[2];if("NDHWC"===c)u="channelsLast",i=[d,h,f,e[4],e[4]];else{if("NCDHW"!==c)throw new Error("Unknown dataFormat ".concat(c));u="channelsFirst",i=[d,h,f,e[1],e[1]]}return Xi(e,i,n,r,a,!1,u,o)}function qi(e,t,n,r,a,o){var i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",c=-1,l=-1,p=-1,h=-1;if("channelsLast"===u){var f=s(e,4);c=f[0],l=f[1],p=f[2],h=f[3]}else{if("channelsFirst"!==u)throw new Error("Unknown dataFormat ".concat(u));var m=s(e,4);c=m[0],h=m[1],l=m[2],p=m[3]}var g,v=s(t,4),y=v[0],b=v[1],x=v[3],w=Yi(n),k=s(w,2),I=k[0],S=k[1],T=Yi(r),_=s(T,2),C=_[0],N=_[1],E=Ji(y,C),R=Ji(b,N),A=function(e,t,n,r,a,o,i,s,u){var c,l,p;if("number"==typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,a){null==r&&(r=Ki(e,t,n));var o=e[1];return[Zi((e[0]-t+2*r)/n+1,a),Zi((o-t+2*r)/n+1,a)]}([t,n],o,r,e,s);l=h[0],p=h[1]}else if("same"===e){l=Math.ceil(t/r),p=Math.ceil(n/a);var f=Math.max(0,(l-1)*r+o-t),m=Math.max(0,(p-1)*a+i-n),g=Math.floor(f/2),v=f-g,y=Math.floor(m/2);c={top:g,bottom:v,left:y,right:m-y,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-o+1)/r),p=Math.ceil((n-i+1)/a);else{if("object"!=d(e))throw Error("Unknown padding parameter: ".concat(e));var b="channelsLast"===u?e[1][0]:e[2][0],x="channelsLast"===u?e[1][1]:e[2][1],w="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:b,bottom:x,left:w,right:k,type:0===b&&0===x&&0===w&&0===k?"VALID":"EXPLICIT"},l=Zi((t-o+b+x)/r+1,s),p=Zi((n-i+w+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:p}}(a,l,p,I,S,E,R,o,u),O=A.padInfo,M=A.outHeight,F=A.outWidth,D=i?x*h:x;return"channelsFirst"===u?g=[c,D,M,F]:"channelsLast"===u&&(g=[c,M,F,D]),{batchSize:c,dataFormat:u,inHeight:l,inWidth:p,inChannels:h,outHeight:M,outWidth:F,outChannels:D,padInfo:O,strideHeight:I,strideWidth:S,filterHeight:y,filterWidth:b,effectiveFilterHeight:E,effectiveFilterWidth:R,dilationHeight:C,dilationWidth:N,inShape:e,outShape:g,filterShape:t}}function Xi(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=arguments.length>7?arguments[7]:void 0,c=-1,l=-1,p=-1,d=-1,h=-1;if("channelsLast"===i){var f=s(e,5);c=f[0],l=f[1],p=f[2],d=f[3],h=f[4]}else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat ".concat(i));var m=s(e,5);c=m[0],h=m[1],l=m[2],p=m[3],d=m[4]}var g,v=s(t,5),y=v[0],b=v[1],x=v[2],w=v[4],k=Qi(n),I=s(k,3),S=I[0],T=I[1],_=I[2],C=Qi(r),N=s(C,3),E=N[0],R=N[1],A=N[2],O=Ji(y,E),M=Ji(b,R),F=Ji(x,A),D=function(e,t,n,r,a,o,i,s,u,c,l){var p,d,h,f;if("number"==typeof e){p={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var m=function(e,t,n,r,a,o){null==a&&(a=Ki(e,t,r));var i=e[1],s=e[2];return[Zi((e[0]-t+2*a)/r+1,o),Zi((i-t+2*a)/r+1,o),Zi((s-t+2*a)/r+1,o),1]}([t,n,r,1],s,0,a,e,l);d=m[0],h=m[1],f=m[2]}else if("same"===e){var g=((d=Math.ceil(t/a))-1)*a+s-t,v=((h=Math.ceil(n/o))-1)*o+u-n,y=((f=Math.ceil(r/i))-1)*i+c-r,b=Math.floor(g/2),x=g-b,w=Math.floor(v/2),k=v-w,I=Math.floor(y/2);p={top:w,bottom:k,left:I,right:y-I,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((t-s+1)/a),h=Math.ceil((n-u+1)/o),f=Math.ceil((r-c+1)/i)}return{padInfo:p,outDepth:d,outHeight:h,outWidth:f}}(a,l,p,d,S,T,_,O,M,F,u),P=D.padInfo,L=D.outDepth,B=D.outHeight,U=D.outWidth,V=o?w*h:w;return"channelsFirst"===i?g=[c,V,L,B,U]:"channelsLast"===i&&(g=[c,L,B,U,V]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:p,inWidth:d,inChannels:h,outDepth:L,outHeight:B,outWidth:U,outChannels:V,padInfo:P,strideDepth:S,strideHeight:T,strideWidth:_,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:O,effectiveFilterHeight:M,effectiveFilterWidth:F,dilationDepth:E,dilationHeight:R,dilationWidth:A,inShape:e,outShape:g,filterShape:t}}function Ki(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Ji(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Yi(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Qi(e){return"number"==typeof e?[e,e,e]:e}function Ji(e,t){return t<=1?e:e+(e-1)*(t-1)}function Zi(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function $i(e){var t=Yi(e),n=s(t,3),r=n[0],a=n[1],o=n[2];return 1===r&&1===a&&1===o}function es(e,t){return $i(e)||$i(t)}function ts(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function ns(e,t,n){if(null!=n){if("string"==typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,"."));if("number"==typeof t)H(J(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}));else{if("object"!=d(t))throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){H(J(t),(function(){return"Error in ".concat(e,": pad must be an integer when using dimRoundingMode ").concat(n," but got pad ").concat(t,".")}))}))}))}}}var rs=ja({reshape_:function(e,t){var n={x:za(e,"x","reshape","string_or_numeric")},r={shape:t};return Br.runKernel(Et,n,r)}}),as=ja({clone_:function(e){var t={x:za(e,"x","clone","string_or_numeric")};return Br.runKernel(ot,t)}}),os=ja({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;H(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Ga(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return as(n[0]);var r=n,a={axis:t};return Br.runKernel(Be,r,a)}}),is=ja({sigmoid_:function(e){var t={x:za(e,"x","sigmoid","float32")};return Br.runKernel(Bt,t)}}),ss=ja({slice_:function(e,t,n){var r=za(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},o={begin:t,size:n};return Br.runKernel(Lt,a,o)}}),us=ja({bincount_:function(e,t,n){var r=za(e,"x","bincount"),a=za(t,"weights","bincount");H("int32"===r.dtype,(function(){return"Error in bincount: input dtype must be int32, but got ".concat(r.dtype)})),H(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),H(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or0-length, but got input shape: ".concat(r.shape,", weights shape: ").concat(a.shape,".")}));var o={x:r,weights:a},i={size:n};return Br.runKernel(Fe,o,i)}}),cs=ja({broadcastTo_:function(e,t){var n=za(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=rs(n,a)}for(var o=n.shape,i=Array.from(t),s=t.length-1;s>=0;s--)if(o[s]===t[s])i[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));if(0===i.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0})).length)return as(n);var u={x:n},c={reps:i};return Br.runKernel($t,u,c)}});function ls(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",ge(e),new br(e,t,n)}function ps(e,t,n){var r={shape:e,value:t,dtype:n};return Br.runKernel(Je,{},r)}var ds=ja({clipByValue_:function(e,t,n){var r=za(e,"x","clipByValue");if(H(t<=n,(function(){return"Error in clip: min (".concat(t,") must be less than or equal to max (").concat(n,").")})),t===n)return ps(r.shape,t,r.dtype);var a={x:r},o={clipValueMin:t,clipValueMax:n};return Br.runKernel(Pe,a,o)}}),hs=ja({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],i=arguments.length>6?arguments[6]:void 0,s=za(e,"x","conv2d","float32"),u=za(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=rs(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),H(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank ".concat(u.rank,".")})),ns("conv2d",r,i);var p="NHWC"===a?c.shape[3]:c.shape[1];H(p===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(p,") must match input depth for filter ").concat(u.shape[2],".")})),H(es(n,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(n," and dilations '").concat(o,"'")}));var d={x:c,filter:u},h={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:i},f=Br.runKernel(Ue,d,h);return l?rs(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),fs=ja({conv2DBackpropInput_:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",i=arguments.length>6?arguments[6]:void 0;H(e.length===t.rank,(function(){return"Length of inShape (".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),H(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length ".concat(s.length,".")})),H(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank ".concat(u.rank)})),H(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank ".concat(n.rank)}));var l="NHWC"===o?s[3]:s[1],p="NHWC"===o?u.shape[3]:u.shape[1];H(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must match input depth for filter ").concat(n.shape[2],".")})),H(p===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(p,") must match output depth for filter ").concat(n.shape[3],".")})),ns("conv2dDerInput",a,i);var d={dy:u,filter:n},h={strides:r,pad:a,dataFormat:o,dimRoundingMode:i,inputShape:s},f=Br.runKernel(We,d,h);return c?rs(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),ms=ja({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],i=arguments.length>6?arguments[6]:void 0,s=za(e,"x","depthwiseConv2d","float32"),u=za(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=rs(s,[1,s.shape[0],s.shape[1],s.shape[2]])),H(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),H(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank ".concat(u.rank,".")}));var p="NHWC"===a?c.shape[3]:c.shape[1];H(p===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels (".concat(p,") must match the inChannels dimension in filter ").concat(u.shape[2],".")})),ns("depthwiseConv2d",r,i);var d={x:c,filter:u},h={strides:n,pad:r,dataFormat:a,dilations:o,dimRoundingMode:i},f=Br.runKernel(qe,d,h);return l?rs(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),gs=ja({where_:function(e,t,n){var r=za(t,"a","where"),a=za(n,"b","where"),o=za(e,"condition","where","bool"),i=mi(mi(o.shape,r.shape),a.shape),s={condition:cs(o,i),t:cs(r,i),e:cs(a,i)};return Br.runKernel(Pt,s)}}),vs=ja({elu_:function(e){var t={x:za(e,"x","elu","float32")};return Br.runKernel("Elu",t)}});function ys(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function bs(e,t,n){for(var r=e.length+t.length,a=[],o=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[o++]):a.push(t[i++]);return a}function xs(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);return[n,t.map((function(t){return e[t]}))]}function ws(e,t){return bs(e,t.map((function(e){return 1})),t)}function ks(e,t,n){H(ys(t,n),(function(){return"".concat(e," supports only inner-most axes for now. Got axes ").concat(t," and rank-").concat(n," input.")}))}function Is(e,t){if(ys(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Ss(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Ts(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function _s(e,t){if((ie(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&ie(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return qa(e,[],[],t)}var Cs=ja({sqrt_:function(e){var t={x:za(e,"x","sqrt","float32")};return Br.runKernel(Ut,t)}}),Ns=ja({square_:function(e){var t=za(e,"x","square");return Br.runKernel("Square",{x:t},{})}}),Es=ja({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=za(e,"x","sum");"bool"===r.dtype&&(r=oi(r,"int32"));var a={x:r},o={axis:t,keepDims:n};return Br.runKernel(Vt,a,o)}}),Rs=ja({exp_:function(e){var t={x:za(e,"x","exp")};return Br.runKernel("Exp",t)}}),As=ja({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=za(e,"x","expandDims","string_or_numeric");H(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Br.runKernel(Qe,r,a)}}),Os=ja({tile_:function(e,t){var n=za(e,"x","tile","string_or_numeric");H(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," must match length of reps ").concat(t,".")}));var r={x:n},a={reps:t};return Br.runKernel($t,r,a)}}),Ms=ja({greater_:function(e,t){var n,r,a=za(e,"a","greater","string_or_numeric"),o=za(t,"b","greater","string_or_numeric");n=Or(a,o),a=(r=s(n,2))[0],o=r[1],mi(a.shape,o.shape);var i={a:a,b:o};return Br.runKernel(rt,i)}}),Fs=ja({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n={x:za(e,"x","leakyRelu")},r={alpha:t};return Br.runKernel(it,n,r)}}),Ds=ja({lessEqual_:function(e,t){var n,r,a=za(e,"a","lessEqual","string_or_numeric"),o=za(t,"b","lessEqual","string_or_numeric");n=Or(a,o),a=(r=s(n,2))[0],o=r[1],mi(a.shape,o.shape);var i={a:a,b:o};return Br.runKernel(st,i)}});function Ps(e){return Br.customGrad(e)}var Ls=ja({sub_:function(e,t){var n=za(e,"a","sub"),r=za(t,"b","sub"),a=Or(n,r),o=s(a,2),i={a:n=o[0],b:r=o[1]};return Br.runKernel("Sub",i)}});function Bs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Bs(e,"float32"),r=Bs(e,"float32");return Ha(n,r)}var a=me(Y(e),t);return Br.makeTensor(a,e,t)}var Us=ja({minimum_:function(e,t){var n,r,a=za(e,"a","minimum"),o=za(t,"b","minimum");n=Or(a,o),a=(r=s(n,2))[0],o=r[1],"bool"===a.dtype&&(a=oi(a,"int32"),o=oi(o,"int32")),mi(a.shape,o.shape);var i={a:a,b:o};return Br.runKernel(ft,i)}}),Vs=ja({mirrorPad_:function(e,t,n){H("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. Got ".concat(n,".")}));var r=za(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");H(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". Got ").concat(t.length,".")}));for(var a="reflect"===n?1:0,o=function(e){H(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),H(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal to ").concat(r.shape[e]-a," or less than 0 for input of shape ").concat(r.shape)}))},i=0;i<r.rank;i++)o(i);var s={paddings:t,mode:n},u={x:r};return Br.runKernel(mt,u,s)}}),Ws=ja({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=za(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},o={x:r};return Br.runKernel(St,o,a)}}),zs=ja({prelu_:function(e,t){var n={x:za(e,"x","prelu"),alpha:za(t,"alpha","prelu")};return Br.runKernel(Tt,n)}});function Gs(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Br.runKernel(Ct,{},a)}var js=ja({relu_:function(e){var t={x:za(e,"x","relu")};return Br.runKernel(Nt,t)}}),Hs=ja({relu6_:function(e){var t={x:za(e,"x","relu6")};return Br.runKernel(Ot,t)}}),qs=ja({round_:function(e){var t={x:za(e,"x","round")};return Br.runKernel(Ft,t)}}),Xs=ja({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r={x:za(e,"x","split")},a={numOrSizeSplits:t,axis:n};return Br.runKernel(zt,r,a)}}),Ks=ja({squaredDifference_:function(e,t){var n,r,a=za(e,"a","squaredDifference"),o=za(t,"b","squaredDifference");n=Or(a,o),a=(r=s(n,2))[0],o=r[1],mi(a.shape,o.shape);var i={a:a,b:o};return Br.runKernel(Kt,i,{})}}),Ys=ja({squeeze_:function(e,t){var n=za(e,"x","squeeze","string_or_numeric");return rs(n,re(n.shape,t).newShape)}}),Qs=ja({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ga(e,"tensors","stack","string_or_numeric");H(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&H(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Br.runKernel(It,r,a)}}),Js=ja({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n={x:za(e,"x","step")},r={alpha:t};return Br.runKernel(on,n,r)}});function Zs(e,t){X(e);var n=Va(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return qa(e,null,n,t)}function $s(e,t,n){if(X(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Va(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return qa(e,t,r,n)}var eu=ja({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=za(e,"x","unstack","string_or_numeric");H(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Br.runKernel(rn,r,a)}}),tu=ja({gatherND_:function(e,t){var n=za(t,"indices","gatherND","int32"),r={params:za(e,"x","gatherND","string_or_numeric"),indices:n};return Br.runKernel(nt,r)}}),nu=ja({conv2DBackpropFilter_:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",i=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=rs(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]])),H(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape ".concat(s.shape,".")})),H(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape ".concat(u.shape,".")})),H(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got ".concat(n,".")}));var c="NHWC"===o?s.shape[3]:s.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];H(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must match input depth in filter (").concat(n[2],".")})),H(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must match output depth for filter (").concat(n[3],").")})),ns("conv2dDerFilter",a,i);var p={x:s,dy:u},d={strides:r,pad:a,dataFormat:o,dimRoundingMode:i,filterShape:n};return Br.runKernel(Ve,p,d)}});function ru(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Wi(e,Js(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function au(e,t){var n=t,r=fi(e.shape,t.shape);return r.length>0&&(n=Es(n,r)),rs(n,e.shape)}function ou(e,t,n,r){if("linear"===t)return e;if("relu"===t)return js(e);if("elu"===t)return vs(e);if("relu6"===t)return Hs(e);if("prelu"===t)return zs(e,n);if("leakyrelu"===t)return Fs(e,r);if("sigmoid"===t)return is(e);throw new Error("Unknown fused activation ".concat(t,"."))}var iu=function(e,t){return!(e>0)||"linear"===t},su=ja({fusedConv2d_:function(e){var t,n,r=e.x,a=e.filter,o=e.strides,i=e.pad,u=e.dataFormat,c=void 0===u?"NHWC":u,l=e.dilations,p=void 0===l?[1,1]:l,d=e.dimRoundingMode,h=e.bias,f=e.activation,m=void 0===f?"linear":f,g=e.preluActivationWeights,v=e.leakyreluAlpha;if(m=m||"linear",!1===iu(Br.state.gradientDepth,m)){H("NHWC"===c,(function(){return"Error in fused conv2d: got dataFormat of ".concat(c," but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.")}));var y=hs(r,a,o,i,c,p,d);return null!=h&&(y=Bi(y,h)),ou(y,m,g,v)}var b=za(r,"x","conv2d","float32"),x=za(a,"filter","conv2d","float32"),w=b,k=!1;3===b.rank&&(k=!0,w=rs(b,[1,b.shape[0],b.shape[1],b.shape[2]])),H(4===w.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank ".concat(w.rank,".")})),H(4===x.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),ns("fused conv2d",i,d);var I="NHWC"===c?w.shape[3]:w.shape[1];H(x.shape[2]===I,(function(){return"Error in conv2d: depth of input (".concat(I,") must match input depth for filter ").concat(x.shape[2],".")})),H(es(o,p),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(p,"'")}));var S,T,_=qi(w.shape,x.shape,o,p,i,d);if(null!=h&&(t=Or(S=za(h,"bias","fused conv2d"),b),n=s(t,1),S=n[0],"NHWC"===c?mi(_.outShape,S.shape):(H(S.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-".concat(S.shape.length,".")})),H(0===S.shape.length||S.shape[0]===_.outChannels||1===S.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(S.shape,") is not compatible with the number of output channels (").concat(_.outChannels,")")})))),null!=g){var C=g.shape;if(H(C.length<=1||3===C.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-".concat(C.length,".")})),1===C.length)H(1===C[0]||C[0]===_.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights (".concat(C,") is not compatible with the number of output channels (").concat(_.outChannels,").")}));else if(3===C.length)try{mi(C,_.outShape)}catch(a){var N="Error in fused conv2d: PReLU activation weights (".concat(C,") is not compatible with the output shape of the conv2d (").concat(_.outShape,").");throw Error(N)}T=za(g,"prelu weights","fused conv2d")}var E=function(e,t){H("NHWC"===c,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(c," but only NHWC is currently supported.")}));var n=s(t,4),r=n[0],a=n[1],u=n[2],l=n[3],d=ru(e,u,m);H($i(p),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '".concat(p,"'")}));var h=[fs(a.shape,d,r,o,i),nu(a,d,r.shape,o,i)];if(null!=l){var f=au(l,d);h.push(f)}return h},R={x:w,filter:x,bias:S,preluActivationWeights:T},A={strides:o,pad:i,dataFormat:c,dilations:p,dimRoundingMode:d,activation:m,leakyreluAlpha:v};return null==h?Ps((function(e,t,n){var r=Br.runKernel(ln,R,A);return n([t,e,r]),k&&(r=rs(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:E}}))(w,x):Ps((function(e,t,n,r){var a=Br.runKernel(ln,R,A);return r([t,e,a,n]),k&&(a=rs(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:E}}))(w,x,S)}}),uu=ja({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],i=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=rs(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:i,dilations:o,filterShape:n};return Br.runKernel(Xe,c,l)}}),cu=ja({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],i=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=rs(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:i,dilations:o,inputShape:e},p=Br.runKernel(Ke,c,l);return u?rs(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),lu=ja({fusedDepthwiseConv2d_:function(e){var t,n,r=e.x,a=e.filter,o=e.strides,i=e.pad,u=e.dataFormat,c=void 0===u?"NHWC":u,l=e.dilations,p=void 0===l?[1,1]:l,d=e.dimRoundingMode,h=e.bias,f=e.activation,m=void 0===f?"linear":f,g=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===iu(Br.state.gradientDepth,m)){var y=ms(r,a,o,i,c,p,d);return null!=h&&(y=Bi(y,h)),ou(y,m,g,v)}var b=za(r,"x","depthwiseConv2d","float32"),x=za(a,"filter","depthwiseConv2d","float32"),w=b,k=!1;3===b.rank&&(k=!0,w=rs(b,[1,b.shape[0],b.shape[1],b.shape[2]])),H(4===w.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank ".concat(w.rank,".")})),H(4===x.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank ".concat(x.rank,".")})),H(w.shape[3]===x.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels (".concat(w.shape[3],") must match the inChannels dimension in filter ").concat(x.shape[2],".")})),null==p&&(p=[1,1]),H(es(o,p),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(o," and dilations '").concat(p,"'")})),ns("fused depthwiseConv2d",i,d);var I,S,T=qi(w.shape,x.shape,o,p,i,d,!0);null!=h&&(t=Or(I=za(h,"bias","fused conv2d"),b),n=s(t,1),I=n[0],mi(T.outShape,I.shape)),null!=g&&(S=za(g,"prelu weights","fused depthwiseConv2d"));var _=function(e,t){H($i(p),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '".concat(p,"'")}));var n=s(t,4),r=n[0],a=n[1],u=n[2],c=n[3],l=ru(e,u,m),h=cu(a.shape,l,r,o,i,p,d),f=uu(a,l,r.shape,o,i,p,d);return null!=c?[h,f,au(I,l)]:[h,f]},C={x:w,filter:x,bias:I,preluActivationWeights:S},N={strides:o,pad:i,dataFormat:c,dilations:p,dimRoundingMode:d,activation:m,leakyreluAlpha:v};return null==h?Ps((function(e,t,n){var r=Br.runKernel(pn,C,N);return n([t,e,r]),k&&(r=rs(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:_}}))(w,x):Ps((function(e,t,n,r){var a=Br.runKernel(pn,C,N);return r([t,e,a,n]),k&&(a=rs(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:_}}))(w,x,I)}}),pu=ja({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=za(e,"image","cropAndResize"),s=za(t,"boxes","cropAndResize","float32"),u=za(n,"boxInd","cropAndResize","int32"),c=s.shape[0];H(4===i.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank ".concat(i.rank,".")})),H(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] but had shape ").concat(s.shape,".")})),H(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] but had shape ").concat(s.shape,".")})),H(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length ".concat(r.length,".")})),H(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),H("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:i,boxes:s,boxInd:u},p={method:a,extrapolationValue:o,cropSize:r};return Br.runKernel(je,l,p)}}),du=ja({flipLeftRight_:function(e){var t=za(e,"image","flipLeftRight","float32");H(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,but got rank ".concat(t.rank,".")}));var n={image:t};return Br.runKernel(Ze,n,{})}}),hu=ja({grayscaleToRGB_:function(e){var t=za(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];H(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, but got rank ".concat(t.rank,".")})),H(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,Os(t,a)}}),fu=ja({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=za(e,"image","rotateWithOffset","float32");H(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,but got rank ".concat(a.rank,".")}));var o={image:a},i={radians:t,fillValue:n,center:r};return Br.runKernel(un,o,i)}});function mu(e,t,n,r,a,o){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==o&&(o=0);var i=e.shape[0];return n=Math.min(n,i),H(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),H(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),H(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),H(1===t.rank,(function(){return"scores must be a 1D tensor"})),H(t.shape[0]===i,(function(){return"scores has incompatible shape with boxes. Expected ".concat(i,", but was ").concat(t.shape[0])})),H(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(o,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:o}}var gu=ja({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,o=za(e,"boxes","nonMaxSuppression","float32"),i=za(t,"scores","nonMaxSuppression","float32"),s=mu(o,i,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Br.runKernel(yt,{boxes:o,scores:i},u)}});function vu(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,a=e.length,o=0,i=!1;r<a;){var s=n(t,e[o=r+(a-r>>>1)]);s>0?r=o+1:(a=o,i=!s)}return i?r:-r-1}(e,t,n||yu)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function yu(e,t){return e>t?1:e<t?-1:0}function bu(e,t,n,r,a){return ku(e,t,n,r,a,0)}function xu(e,t,n,r,a,o){return ku(e,t,n,r,a,0,!1,o,!0)}function wu(e,t,n,r,a,o){return ku(e,t,n,r,a,o,!0)}function ku(e,t,n,r,a,i){for(var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8],l=[],p=0;p<t.length;p++)t[p]>a&&l.push({score:t[p],boxIndex:p,suppressBeginIndex:0});l.sort(Tu);for(var d=i>0?-.5/i:0,h=[],f=[];h.length<n&&l.length>0;){var m=l.pop(),g=m.score,v=m.boxIndex,y=m.suppressBeginIndex;if(g<a)break;for(var b=!1,x=h.length-1;x>=y;--x){var w=Iu(e,v,h[x]);if(w>=r){b=!0;break}if(m.score=m.score*Su(r,d,w),m.score<=a)break}m.suppressBeginIndex=h.length,b||(m.score===g?(h.push(v),f.push(m.score)):m.score>a&&vu(l,m,Tu))}var k=h.length,I=n-k;u&&I>0&&(h.push.apply(h,o(new Array(I).fill(0))),f.push.apply(f,o(new Array(I).fill(0))));var S={selectedIndices:h};return s&&(S.selectedScores=f),c&&(S.validOutputs=k),S}function Iu(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),d=Math.max(a[1],a[3]),h=(s-o)*(u-i),f=(p-c)*(d-l);if(h<=0||f<=0)return 0;var m=Math.max(o,c),g=Math.max(i,l),v=Math.min(s,p),y=Math.min(u,d),b=Math.max(v-m,0)*Math.max(y-g,0);return b/(h+f-b)}function Su(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Tu(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}var _u,Cu=function(){var e=c(u().mark((function e(t,n,r){var a,o,i,s,c,l,p,d,h,f,m=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=m.length>3&&void 0!==m[3]?m[3]:.5,o=m.length>4&&void 0!==m[4]?m[4]:Number.NEGATIVE_INFINITY,i=za(t,"boxes","nonMaxSuppressionAsync"),s=za(n,"scores","nonMaxSuppressionAsync"),c=mu(i,s,r,a,o),r=c.maxOutputSize,a=c.iouThreshold,o=c.scoreThreshold,e.next=6,Promise.all([i.data(),s.data()]);case 6:return l=e.sent,p=l[0],d=l[1],h=bu(p,d,r,a,o),f=h.selectedIndices,e.abrupt("return",(i!==t&&i.dispose(),s!==n&&s.dispose(),Zs(f,"int32")));case 12:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Nu=ja({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=za(e,"boxes","nonMaxSuppression"),s=za(t,"scores","nonMaxSuppression"),u=mu(i,s,n,r,a,o),c={boxes:i,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},p=Br.runKernel(xt,c,l);return{selectedIndices:p[0],selectedScores:p[1]}}}),Eu=function(){var e=c(u().mark((function e(t,n,r){var a,o,i,s,c,l,p,d,h,f,m,g,v=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,o=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,i=v.length>5&&void 0!==v[5]?v[5]:0,s=za(t,"boxes","nonMaxSuppressionAsync"),c=za(n,"scores","nonMaxSuppressionAsync"),l=mu(s,c,r,a,o,i),r=l.maxOutputSize,a=l.iouThreshold,o=l.scoreThreshold,i=l.softNmsSigma,e.next=7,Promise.all([s.data(),c.data()]);case 7:return p=e.sent,d=p[0],h=p[1],f=wu(d,h,r,a,o,i),m=f.selectedIndices,g=f.selectedScores,e.abrupt("return",(s!==t&&s.dispose(),c!==n&&c.dispose(),{selectedIndices:Zs(m,"int32"),selectedScores:Zs(g)}));case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ru=ja({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=za(e,"boxes","nonMaxSuppression"),s=za(t,"scores","nonMaxSuppression"),u=mu(i,s,n,r,a,null),c={boxes:i,scores:s},l={maxOutputSize:u.maxOutputSize,iouThreshold:u.iouThreshold,scoreThreshold:u.scoreThreshold,padToMaxOutputSize:o},p=Br.runKernel(bt,c,l);return{selectedIndices:p[0],validOutputs:p[1]}}}),Au=function(){var e=c(u().mark((function e(t,n,r){var a,o,i,c,l,p,d,h,f,m,g,v,y,b,x,w,k=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=k.length>3&&void 0!==k[3]?k[3]:.5,o=k.length>4&&void 0!==k[4]?k[4]:Number.NEGATIVE_INFINITY,i=k.length>5&&void 0!==k[5]&&k[5],c=za(t,"boxes","nonMaxSuppressionAsync"),l=za(n,"scores","nonMaxSuppressionAsync"),p=mu(c,l,r,a,o,null),d=p.maxOutputSize,h=p.iouThreshold,f=p.scoreThreshold,e.next=11,Promise.all([c.data(),l.data()]);case 11:return m=e.sent,g=s(m,2),v=g[0],y=g[1],b=xu(v,y,d,h,f,i),x=b.selectedIndices,w=b.validOutputs,e.abrupt("return",(c!==t&&c.dispose(),l!==n&&l.dispose(),{selectedIndices:Zs(x,"int32"),validOutputs:_s(w,"int32")}));case 19:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ou=ja({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=za(e,"images","resizeBilinear");H(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),H(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape ".concat(t,".")})),H(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var o=a,i=!1;3===a.rank&&(i=!0,o=rs(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var s={images:o},u={alignCorners:n,halfPixelCenters:r,size:t},c=Br.runKernel(At,s,u);return i?rs(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),Mu={flipLeftRight:du,grayscaleToRGB:hu,resizeNearestNeighbor:ja({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=za(e,"images","resizeNearestNeighbor");H(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ".concat(a.rank,".")})),H(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape ".concat(t,".")})),H("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),H(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var o=a,i=!1;3===a.rank&&(i=!0,o=rs(a,[1,a.shape[0],a.shape[1],a.shape[2]]));var s={images:o},u={alignCorners:n,halfPixelCenters:r,size:t},c=Br.runKernel(Rt,s,u);return i?rs(c,[c.shape[1],c.shape[2],c.shape[3]]):c}}),resizeBilinear:Ou,rotateWithOffset:fu,cropAndResize:pu,nonMaxSuppression:gu,nonMaxSuppressionAsync:Cu,nonMaxSuppressionWithScore:Nu,nonMaxSuppressionWithScoreAsync:Eu,nonMaxSuppressionPadded:Ru,nonMaxSuppressionPaddedAsync:Au,threshold:ja({threshold_:function(e){var t,n,r,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,c=za(e,"image","threshold"),l=c.shape[0]*c.shape[1],p=Wi(Zs([u]),255);if(H(3===c.rank,(function(){return"Error in threshold: image must be rank 3,but got rank ".concat(c.rank,".")})),H(3===c.shape[2]||1===c.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1but got ".concat(c.shape[2],".")})),H("int32"===c.dtype||"float32"===c.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,but got dtype ".concat(c.dtype,".")})),H("otsu"===o||"binary"===o,(function(){return"Method must be binary or otsu, but was ".concat(o)})),3===c.shape[2]){var d=Xs(c,[1,1,1],-1),h=s(d,3);t=h[0],n=h[1],r=h[2];var f=Wi(t,.2989),m=Wi(n,.587),g=Wi(r,.114);a=Bi(Bi(f,m),g)}else a=e;"otsu"===o&&(p=function(e,t){for(var n,r,a,o,i,s,u=Zs([-1]),c=Zs([0]),l=Zs([0]),p=0;p<e.size-1;p++){n=ss(e,0,p+1),r=ss(e,p+1),i=Vi(Es(n),t),s=Vi(Es(r),t);var d=Es(Wi(n,Gs(0,n.size)));a=Vi(d,Es(n));var h=ps(r.shape,n.size),f=Bi(Gs(0,r.size),h),m=Wi(r,f);o=Vi(Es(m),Es(r));var g=Ls(a,o),v=Ls(a,o),y=Wi(i,s);l=Wi(Wi(y,g),v);var b=Ms(l,c);c=gs(b,l,c),u=gs(b,Zs([p]),u)}return u}(us(oi(qs(a),"int32"),Xa([]),256),l));var v=i?Ds(a,p):Ms(a,p);return oi(Wi(v,255),"int32")}}),transform:ja({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,i=za(e,"image","transform","float32"),s=za(t,"transforms","transform","float32");H(4===i.rank,(function(){return"Error in transform: image must be rank 4,but got rank ".concat(i.rank,".")})),H(2===s.rank&&(s.shape[0]===i.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),H(null==o||2===o.length,(function(){return"Error in transform: outputShape must be [height, width] or null, but got ".concat(o,".")}));var u={image:i,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:o};return Br.runKernel(tn,u,c)}})},Fu="undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate?setImmediate:function(e){return e()};function Du(e,t){var n=e[0].length;e.forEach((function(e,t){H(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same as the rank of the rest (").concat(n,")")}))})),H(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var o=0;o<n;o++)H(o===t||e[o]===r[o],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") does not match the shape of the rest (").concat(r,") along the non-concatenated axis ").concat(a,".")}))}))}function Pu(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Lu(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var o=n[a],i=r[r.length-n.length+a],s=r[i];if(o>=0)if(s>=0){if(s!==o)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(o," but shape[").concat(a+e,"] = ").concat(s))}else r[i]=o}return r}function Bu(e){var t,n={FIRST_DIM_SIZE:_u.FIRST_DIM_SIZE,VALUE_ROWIDS:_u.VALUE_ROWIDS,ROW_LENGTHS:_u.ROW_LENGTHS,ROW_SPLITS:_u.ROW_SPLITS,ROW_LIMITS:_u.ROW_LIMITS,ROW_STARTS:_u.ROW_STARTS},r=[],a=i(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(!(o in n))break;r.push(n[o])}}catch(e){a.e(e)}finally{a.f()}return r}function Uu(e){return 0===e.length?0:e[0]===_u.FIRST_DIM_SIZE?e.length-1:e.length}function Vu(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var o=e[a],i=t[a+1];if(o>=0&&i>=0&&1!==o&&o!==i)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(o," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(i))}}}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(_u||(_u={}));function Wu(e){return e<=30?e:pe(e,Math.floor(Math.sqrt(e)))}function zu(e,t,n){return[n*("number"==typeof e?e:e[0]),t*("number"==typeof e?e:e[1])]}function Gu(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var o=t.length,i=0;i<o;++i)a=a.concat([e[i+1]/t[i],t[i]]);a=a.concat(e.slice(o+1))}return a}function ju(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var o=[],i=[],s=1;s<e;++s)s>=2*t+1||s%2==1?i.push(s):o.push(s);r.push.apply(r,o),r.push(0),r.push.apply(r,i)}return r}function Hu(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var o=1;o<e.length;++o)o<=t.length?r?a.push(t[o-1]*e[o]):a.push(e[o]/t[o-1]):a.push(e[o]);return a}function qu(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function Xu(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}var Ku=1.0507009873554805,Yu=.3275911,Qu=.254829592,Ju=-.284496736,Zu=1.421413741,$u=-1.453152027,ec=1.061405429;function tc(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}var nc=/->/g;function rc(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(nc,"").length)/"->".length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat("->",'").'));var r=e.split("->"),a=s(r,2),o=a[0],i=a[1];H(-1===o.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var u=o.split(","),c=u.length;if(t!==c)throw new Error("Expected ".concat(c," input tensors, received ").concat(t));if(c>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var l=[],p=function(){var e=i[d];if(!u.some((function(t){return-1!==t.indexOf(e)})))throw new Error("Output subscripts contain the label ".concat(e," not present in the input subscripts."));-1===l.indexOf(e)&&l.push(e)},d=0;d<i.length;++d)p();for(var h=0;h<o.length;++h){var f=o[h];-1===l.indexOf(f)&&","!==f&&l.push(f)}for(var m=new Array(u.length),g=0;g<c;++g){if(new Set(u[g].split("")).size!==u[g].length)throw new Error("Found duplicate axes in input component ".concat(u[g],". Support for duplicate axes in input is not implemented yet."));m[g]=[];for(var v=0;v<u[g].length;++v)m[g].push(l.indexOf(u[g][v]))}for(var y=l.length,b=[],x=i.length;x<y;++x)b.push(x);return{allDims:l,summedDims:b,idDims:m}}function ac(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],o=0;o<e;++o)-1===n[o]&&a.push(o);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function oc(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,o=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:H(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," of input shaped ").concat(JSON.stringify(a),", but got dimension ").concat(a[n])}))},i=0;i<t[e].length;++i)o(i)},o=0;o<n.length;++o)a(o)}function ic(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var o=0;o<n;++o)a.push([]);for(var s=[],u=0;u<r.length;++u){var c,l=uc(t,r[u]),p=i(l);try{for(p.s();!(c=p.n()).done;){var d=c.value;-1===s.indexOf(d)&&(a[u].push(d),s.push(d))}}catch(e){p.e(e)}finally{p.f()}}return{path:r,steps:a}}function sc(e){return e.every((function(e,t){return e===t}))}function uc(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function cc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"==typeof t)H(e.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{H(t.reduce((function(e,t){return-1===t&&(e+=1),e}),0)<=1,(function(){return"There should be only one negative value in split array."}));var a=t.indexOf(-1);if(-1!==a){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[a]=e.shape[n]-o}H(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function lc(e){return"Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(e)}function pc(e,t){return"indices(".concat(e,", 0) is invalid: ").concat(t," < 0")}function dc(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function hc(e,t){return"only one output dimension may be -1, not both ".concat(e," and ").concat(t)}function fc(e,t){return"size ".concat(e," must be non-negative, not ").concat(t)}function mc(e,t){return"Input to reshape is a SparseTensor with ".concat(Y(e),"\n  dense values, but the requested shape requires a multiple of ").concat(Y(t),". inputShape=").concat(e," outputShape= ").concat(t)}function gc(e,t){return"Input to reshape is a tensor with ".concat(Y(e)," dense values, but the requested shape has ").concat(Y(t),". inputShape=").concat(e," outputShape=").concat(t)}function vc(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function yc(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function bc(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=pe(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=pe(e,n+1);return n}function xc(e,t,n){for(var r=[],a=e.length,o=0;o<a;o++)o!==t?r.push(e[o]):r.push(n);return r}function wc(e,t,n,r){var a=t.shape.length,o=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>o)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(o,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var i=0;i<r;++i)if(e.shape[i]!==t.shape[i])throw new Error("x.shape[".concat(i,"]: ").concat(e.shape[i]," should be equal to indices.shape[").concat(i,"]: ").concat(t.shape[i],"."));for(var s=e.shape[n],u=[],c=1,l=1,p=1,d=0;d<r;++d)u.push(e.shape[d]),c*=e.shape[d];for(var h=r;h<n;h++)u.push(e.shape[h]),l*=e.shape[h];for(var f=r;f<a;f++)u.push(t.shape[f]);for(var m=n+1;m<o;m++)u.push(e.shape[m]),p*=e.shape[m];return{batchSize:c,sliceSize:p,outerSize:l,dimSize:s,outputShape:u}}var kc=Object.freeze({__proto__:null,collectGatherOpShapeInfo:wc,computeOutShape:xc,segOpComputeOptimalWindowSize:bc});function Ic(e){try{return e.map((function(e){return dr(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(e))}}function Sc(e){return e.map((function(e){return pr(e)}))}var Tc=Object.freeze({__proto__:null,ERF_A1:Qu,ERF_A2:Ju,ERF_A3:Zu,ERF_A4:$u,ERF_A5:ec,ERF_P:Yu,PARALLELIZE_THRESHOLD:30,get RowPartitionType(){return _u},SELU_SCALE:Ku,SELU_SCALEALPHA:1.7580993408473768,applyActivation:ou,assertAndGetBroadcastShape:mi,assertAxesAreInnerMostDims:ks,assertParamsConsistent:Du,assignToTypedArray:function(e,t,n,r){e[2*r]=t,e[2*r+1]=n},axesAreInnerMostDims:ys,calculateShapes:wi,checkEinsumDimSizes:oc,checkPadOnDimRoundingMode:ns,combineLocations:bs,combineRaggedTensorToTensorShapes:Lu,complexWithEvenIndex:function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}},complexWithOddIndex:function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}},computeConv2DInfo:qi,computeConv3DInfo:Xi,computeDefaultPad:Ki,computeDilation2DInfo:Gi,computeOptimalWindowSize:Wu,computeOutAndReduceShapes:xs,computeOutShape:Pu,computePool2DInfo:ji,computePool3DInfo:Hi,convertConv2DDataFormat:ts,decodeEinsumEquation:rc,eitherStridesOrDilationsAreOne:es,expandShapeToKeepDim:ws,exponent:function(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}},exponents:function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var o=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(o),r[a]=Math.sin(o)}return{real:n,imag:r}},fromStringArrayToUint8:Sc,fromUint8ToStringArray:Ic,getAxesPermutation:Is,getBroadcastDims:hi,getComplexWithIndex:function(e,t){return{real:e[2*t],imag:e[2*t+1]}},getEinsumComputePath:ic,getEinsumPermutation:ac,getFusedBiasGradient:au,getFusedDyActivation:ru,getImageCenter:zu,getInnerMostAxes:Ts,getPermuted:ju,getRaggedRank:Uu,getReductionAxes:fi,getReshaped:Gu,getReshapedPermuted:Hu,getRowPartitionTypesHelper:Bu,getSliceBeginCoords:qu,getSliceSize:Xu,getSparseFillEmptyRowsIndicesDenseShapeMismatch:lc,getSparseFillEmptyRowsNegativeIndexErrorMessage:pc,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:dc,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:function(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"},getSparseReshapeInputOutputMismatchErrorMessage:gc,getSparseReshapeInputOutputMultipleErrorMessage:mc,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:hc,getSparseReshapeNegativeOutputDimErrorMessage:fc,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:yc,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:function(){return"segment ids must be >= 0"},getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:function(){return"segment ids are not increasing"},getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:vc,getUndoAxesPermutation:Ss,isIdentityPermutation:sc,log:function(){var e;Ie().getBool("IS_TEST")||Ie().getBool("PROD")||(e=console).log.apply(e,arguments)},mergeRealAndImagArrays:tc,prepareAndValidate:bi,prepareSplitSize:cc,segment_util:kc,shouldFuse:iu,slice_util:Li,splitRealAndImagArrays:function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}},tupleValuesAreOne:$i,upcastType:Rr,validateDefaultValueShape:Vu,validateInput:function(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ".concat(t.rank,"."));if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ".concat(e.rank,"."));if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: ".concat(t.dtype));if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: ".concat(n));if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: ".concat(t.shape));if(0===e.size)throw new Error("Updates specified for empty output. updates shape: ".concat(e.shape))}xi(n,t,e)},validateUpdateShape:xi,warn:dn}),_c=function(){return p((function e(){l(this,e),this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}),[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}},{key:"setTimeoutCustom",value:function(e,t){var n=this;window&&Ie().getBool("USE_SETTIMEOUTCUSTOM")?(this.functionRefs.push(e),setTimeout((function(){window.postMessage({name:n.messageName,index:n.functionRefs.length-1},"*")}),t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",(function(e){e.source===window&&e.data.name===n.messageName&&(e.stopPropagation(),(0,n.functionRefs[e.data.index])(),n.handledMessageCount++,n.handledMessageCount===n.functionRefs.length&&(n.functionRefs=[],n.handledMessageCount=0))}),!0))):setTimeout(e,t)}}])}();if(Ie().get("IS_BROWSER")){Ie().setPlatform("browser",new _c);try{Xo.registerManager(No.URL_SCHEME,new Ro)}catch(n){}try{Xo.registerManager(mo.URL_SCHEME,new vo)}catch(n){}}var Cc,Nc=function(){return p((function e(){l(this,e),this.util=require("util"),this.textEncoder=new this.util.TextEncoder}),[{key:"fetch",value:function(e,t){return null!=Ie().global.fetch?Ie().global.fetch(e,t):(null==Cc&&(Cc=require("node-fetch")),Cc(e,t))}},{key:"now",value:function(){var e=B.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}])}();Ie().get("IS_NODE")&&!Ie().get("IS_BROWSER")&&Ie().setPlatform("node",new Nc),Lr(),wr={buffer:ls,cast:oi,clone:as,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};var Ec,Rc,Ac,Oc={},Mc={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Fc(e,t){Oc[e]=t}function Dc(e,t){if(!(e in Oc)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;return n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Oc[e]}),!1),Ie().getBool("SOFTWARE_WEBGL_ENABLED")&&(Mc.failIfMajorPerformanceCaveat=!1),1===e?n.getContext("webgl",Mc)||n.getContext("experimental-webgl",Mc):n.getContext("webgl2",Mc)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;Oc[e]=n}var r=Oc[e];return null==r||r.isContextLost()?(delete Oc[e],Dc(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),Oc[e])}function Pc(e,t){return[t,e]}function Lc(e){var t=Y(e);return Z(Math.ceil(t/4))}function Bc(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Uc(e,t){var n,r,a,o,i,s,u,c,l,p,d=e;return 2===Ie().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,a=d.RGBA16F,o=d.RGBA32F,i=d.RED,u=4,c=1,l=d.HALF_FLOAT,p=d.FLOAT,s=d.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,o=d.RGBA,i=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,p=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:p}}function Vc(e,t){var n=t();return Ie().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}function Wc(e){return!!(Ie().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function zc(e,t){return Zc(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Ec||(Ec={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Rc||(Rc={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Ac||(Ac={}));var Gc,jc,Hc=/ERROR: [0-9]+:([0-9]+):/g;function qc(e,t){var n=Hc.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),o=a.length.toString().length+2,i=a.map((function(e,t){return $((t+1).toString(),o)+e})),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var c=i.slice(0,r-1),l=i.slice(r-1,r),p=i.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat($(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(p.join("\n"))}function Xc(e,t){if(Vc(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Kc(e,t,n,r,a,o,i){var s=e.getAttribLocation(t,n);return-1!==s&&(Vc(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Vc(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,o,i)})),Vc(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function Yc(e,t,n){Vc(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Vc(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function Qc(e,t){Vc(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),Vc(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function Jc(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function Zc(e,t,n){var r=Vc(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function $c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Y(e.slice(0,e.length-t))}function el(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function tl(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[$c(e)].concat(o(el(e)))),t}function nl(e){return e%2==0}function rl(e,t){if(Q(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(nl(n)&&nl(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&nl(e[0])&&nl(t[0])}function al(e,t){return null!=e.getExtension(t)}function ol(e){try{if(null!=Dc(e))return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function il(e){var t=Uc(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function sl(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&H("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the WebGL backend.")}))}))}var ul=Ie();function cl(){var e,t,n,r,a,o,i,s,u,c;return 2===Ie().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",o="outputColor",i="out vec4 outputColor;",s=Ie().getBool("WEBGL2_ISNAN_CUSTOM")?"\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ":"",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",o="gl_FragColor",i="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:o,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function ll(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=de(t);return r.map((function(t,a){return"".concat("int ".concat(e[a]," = ").concat(n," / ").concat(t),"; ",a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t),";")})).join("")}function pl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=de(t);return r.map((function(t,a){return"".concat("int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),"; ",a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]"),";")})).join("")}function dl(e){var t=de(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}ul.registerFlag("HAS_WEBGL",(function(){return ul.getNumber("WEBGL_VERSION")>0})),ul.registerFlag("WEBGL_VERSION",(function(){return ol(2)?2:ol(1)?1:0})),ul.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),ul.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===ul.get("WEBGL_VERSION")})),ul.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),ul.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),ul.registerFlag("WEBGL_PACK",(function(){return ul.getBool("HAS_WEBGL")})),ul.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_CLIP",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_PACK_REDUCE",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_CONV_IM2COL",(function(){return ul.getBool("WEBGL_PACK")})),ul.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==Gc){var t=Dc(e);Gc=t.getParameter(t.MAX_TEXTURE_SIZE)}return Gc}(ul.getNumber("WEBGL_VERSION"))})),ul.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==jc){var t=Dc(e);jc=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,jc)}(ul.getNumber("WEBGL_VERSION"))})),ul.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=ul.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=Dc(e);return al(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:al(t,"EXT_disjoint_timer_query")?1:0}(e)})),ul.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return ul.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Vr()})),ul.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=Dc(e);if(1===e){if(!al(t,"OES_texture_float"))return!1}else if(!al(t,"EXT_color_buffer_float"))return!1;return il(t)}(ul.getNumber("WEBGL_VERSION"))})),ul.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!ul.getBool("WEBGL_FORCE_F16_TEXTURES")&&ul.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),ul.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return function(e){if(0===e)return!1;var t=Dc(e);if(1!==e){if(al(t,"EXT_color_buffer_float"))return il(t);var n="EXT_color_buffer_half_float";if(al(t,n)){var r=t.getExtension(n);return function(e,t){var n=Uc(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var a=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,a),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(a),o}(t,r)}return!1}return!!al(t,"OES_texture_float")&&(!!al(t,"WEBGL_color_buffer_float")&&il(t))}(ul.getNumber("WEBGL_VERSION"))})),ul.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=ul.getNumber("WEBGL_VERSION"))&&null!=Dc(e).fenceSync;var e})),ul.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return ul.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),ul.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ".concat(e,"."))})),ul.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return Vr()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ".concat(e,"."))})),ul.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),ul.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),ul.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),ul.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),ul.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),ul.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return ul.getBool("IS_TEST")})),ul.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",(function(){return 1/0})),ul.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",(function(){return!1})),ul.registerFlag("WEBGL2_ISNAN_CUSTOM",(function(){return!1}));var hl="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",fl=Tc.getBroadcastDims;function ml(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=s(e.shapeInfo.texShape,2),o=a[0],i=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var u=wl(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var c=s(e.shapeInfo.texShape,2),l=c[0],p=c[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(l,", ").concat(p,", ").concat(u,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(kl(e),"\n      }\n    ");var a=e.shapeInfo.texShape,o=a[0],i=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=wl(n);return 1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(o,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(o,", ").concat(i,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape;if(null!=o&&Q(n,o)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var i=o[0];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o[1],".0, ").concat(i,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var s=re(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){return"\n      ".concat(ml(Tl(e,l),t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(_l(["row","col"],c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(kl(e),"\n      }\n    ");var p=o[0],d=o[1],h=wl(r);return 1===d?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(p,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===p?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(h,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(d,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(h,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(h,";\n    vec2 uv = uvFromFlat(").concat(p,", ").concat(d,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],i=n[2],s=re(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){return"\n        ".concat(ml(Tl(e,l),t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(_l(["row","col","depth"],c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(o,", ").concat(i,", 1)));\n        ").concat(kl(e),"\n      }\n    ");var p=e.shapeInfo.texShape,d=p[0],h=p[1],f=e.shapeInfo.flatOffset;if(h===o&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(i,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(h,".0, ").concat(d,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(h===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(h,".0, ").concat(d,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var m=wl(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * stride0 + col * stride1 + depth + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(o," + col * ").concat(i," + depth + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(h,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}(e,t);case 4:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],i=n[2]*o,s=n[1]*i,u=re(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){return"\n      ".concat(ml(Tl(e,c),t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(_l(["row","col","depth","depth2"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(i,", ").concat(o,", 1)));\n        ").concat(kl(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],f=d[1],m="int stride2 = ".concat(r,"Shape[3];"),g="int stride1 = ".concat(r,"Shape[2] * stride2;"),v="int stride0 = ".concat(r,"Shape[1] * stride1;");if(f===s&&null==p)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(m,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(i,", ").concat(o,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(h,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(f===o&&null==p)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(h,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var y=wl(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(m,"\n      ").concat(g,"\n      ").concat(v,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(y,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(i," +\n          depth * ").concat(o," + depth2;\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(f,", index + ").concat(y,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}(e,t);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],o=t[3]*a,i=t[2]*o,s=t[1]*i,u=re(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){return"\n      ".concat(ml(Tl(e,c)),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(_l(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(i,", ").concat(o,", ").concat(a,")) +\n          depth3;\n        ").concat(kl(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,h=d[0],f=d[1];if(f===s&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(i,", ").concat(o,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(f,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(f===a&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(f,".0, ").concat(h,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var m=wl(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(i," + depth * ").concat(o," +\n          depth2 * ").concat(a," + depth3 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(h,", ").concat(f,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=re(t),o=a.newShape,i=a.keptDims;if(o.length<t.length){return"\n      ".concat(ml(Tl(e,o)),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(_l(["row","col","depth","depth2","depth3","depth4"],i),");\n      }\n    ")}var s=t[5],u=t[4]*s,c=t[3]*u,l=t[2]*c,p=t[1]*l;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(p,", ").concat(l,", ").concat(c,", ").concat(u,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(s,", 1)));\n        ").concat(kl(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,f=h[0],m=h[1];if(m===p&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(l,", ").concat(c,", ").concat(u,", ").concat(s,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(f,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=wl(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(p," + col * ").concat(l," + depth * ").concat(c," +\n          depth2 * ").concat(u," + depth3 * ").concat(s," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(f,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(n.length,"-D input sampling is not yet supported"))}}function gl(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=cl();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,o=cl();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(o.texture2D,"(").concat(n,", uv);\n    }\n  ");var i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(i[0],", ").concat(i[1],", index);\n      return ").concat(o.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,i=o[0],s=o[1],u=cl();if(null!=o&&Q(n,o))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(i,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){return"\n        ".concat(gl(Tl(e,n.slice(1)),t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(_l(["b","row","col"],[1,2]),");\n        }\n      ")}var s=cl();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(s.texture2D,"(").concat(r,", uv);\n    }\n  ");var u=i[0],c=i[1],l=Math.ceil(n[2]/2),p=l*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(u,", ").concat(c,", ").concat(p,", ").concat(l,", b, row, col);\n      return ").concat(s.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=cl();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var o=e.shapeInfo.logicalShape,i=o.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],p=Math.ceil(o[i-1]/2),d=p*Math.ceil(o[i-2]/2),h="int b, int row, int col",f="b * ".concat(d," + (row / 2) * ").concat(p," + (col / 2)"),m=2;m<i-1;m++)h="int b".concat(m,", ")+h,d*=o[i-m-1],f="b".concat(m," * ").concat(d," + ")+f;return"\n    vec4 ".concat(r,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var vl="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",yl="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bl="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",xl="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function wl(e){return"offset".concat(e)}function kl(e){var t=e.name,n=Y(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Il(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Sl(e,t,n){var r=re(t),a=r.newShape,o=r.keptDims,i=t.length,s=e&&3===i&&1===t[0],u=s?t.slice(1):a,c=!e&&i>1&&!Q(t,n)&&a.length<i||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:o}}function Tl(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function _l(e,t){return t.map((function(t){return e[t]})).join(", ")}function Cl(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=a.map((function(e){return e.shapeInfo})),i={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=function(e,t,n){var r=[];if(e.forEach((function(e){var t=Y(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(Sl(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,o,i=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?gl(e,r):ml(e,r);var o=e.shapeInfo.logicalShape,i=t.logicalShape;return o.length<=i.length&&(a+=n?function(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),o="get"+a+"AtOutCoords",i=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=fl(e.shapeInfo.logicalShape,t.logicalShape),c=Il(s),l=s-i,p=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(p[e+l]," = 0;")})).join("\n");var d;d=s<2&&i>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(p[t+l])})).join(", ");var h="return outputValue;",f=1===Y(e.shapeInfo.logicalShape),m=1===Y(t.logicalShape);if(1!==i||f||m){if(f&&!m)h=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=i-2,v=i-1;u.indexOf(g)>-1&&u.indexOf(v)>-1?h="return vec4(outputValue.x);":u.indexOf(g)>-1?h="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(h="return vec4(outputValue.xx, outputValue.zz);")}}else h="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(o,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(d,");\n      ").concat(h,"\n    }\n  ")}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",o=t.texShape,i=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Q(i,o))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=Il(u),p=fl(e.shapeInfo.logicalShape,t.logicalShape),d=u-s,h=["x","y","z","w","u","v"];c=0===s?"":u<2&&p.length>=1?"coords = 0;":p.map((function(e){return"coords.".concat(h[e+d]," = 0;")})).join("\n");var f;return f=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+d])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(f,");\n    }\n  ")}(e,t)),a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=cl(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),p=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(vl,"\n    ").concat(yl,"\n    ").concat(bl,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===r[0]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    "):1===r[1]?n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Q(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);return n?"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),o=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(o,";\n      index -= b * ").concat(o,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),o=a*Math.ceil(e[e.length-2]/2),i=o,s="",u="b, r, c",c=2;c<e.length-1;c++)i*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(i,";\n      index -= b").concat(c," * ").concat(i,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(o,";\n      index -= b * ").concat(o,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),o=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){return 1===t[0]?n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    "):1===t[1]?n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    "):n?"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){return Q(e,t)?n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    "):1===e[1]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    "):1===e[0]?n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    "):n?"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(pl(["r","c","d"],e),"\n    return ivec3(r, c, d);\n  }\n");var r=ll(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(pl(["r","c","d","d2"],e),"\n      return ivec4(r, c, d, d2);\n    }\n  ");var r=ll(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=ll(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=ll(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),o=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(p+=xl),[p,l,o,i,a,s,n.userCode].join("\n")}(a,i,t),u=function(e,t){var n=Zc(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Vc(e,(function(){return e.shaderSource(n,t)})),Vc(e,(function(){return e.compileShader(n)})),Ie().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw qc(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return Ie().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:o,outShapeInfo:i,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:o,outShapeInfo:i},Nl(e,t,c))}function Nl(e,t,n){var r,a,o,i,s={},u={},c={},l=[],p=null;i=e.getUniformLocation(n,"NAN",!1),1===Ie().getNumber("WEBGL_VERSION")&&(p=e.getUniformLocation(n,"INFINITY",!1));for(var d=!1,h=0;h<t.variableNames.length;h++){var f=t.variableNames[h];s[f]=e.getUniformLocation(n,f,d),s["offset".concat(f)]=e.getUniformLocation(n,"offset".concat(f),d),t.enableShapeUniforms&&(u["".concat(f,"Shape")]=e.getUniformLocation(n,"".concat(f,"Shape"),d),c["".concat(f,"TexShape")]=e.getUniformLocation(n,"".concat(f,"TexShape"),d))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",d),o=e.getUniformLocation(n,"outShapeStrides",d),a=e.getUniformLocation(n,"outTexShape",d)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,d)})),{uniformLocations:s,customUniformLocations:l,infLoc:p,nanLoc:i,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:o,outTexShapeLocation:a}}function El(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but was executed with ").concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],o=a.shape;if(!Q(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes ".concat(r," and ").concat(o," must match"));if(!e.isUniform||!a.isUniform){var i=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Q(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape ".concat(i," and ").concat(s," must match"))}}))}function Rl(e){return Ie().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var Al=p((function e(t){l(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ec.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=cl();this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?pl(["r","c","d"],t):ll(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Ol=p((function e(t){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ec.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=cl();this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?pl(["r","c","d"],t):ll(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Ml=p((function e(t){l(this,e),this.variableNames=["A"],this.outTexUsage=Rc.DOWNLOAD;var n=cl();this.outputShape=t,this.userCode="\n      ".concat(hl,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Fl=p((function e(t){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Rc.DOWNLOAD;var n=cl();this.outputShape=t,this.userCode="\n      ".concat(hl,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),Dl=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=cl();this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":dl(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")})),Pl=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=cl();this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length);var a="",o="result";n&&(o="floor(result * 255. + 0.5)");for(var i=0;i<=1;i++)for(var s=0;s<=1;s++){var u=2*i+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(i," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(i,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":dl(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(o,";\n        }\n    ")}));function Ll(e,t,n,r,a,o){!function(e,t){var n=Ie().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] is invalid."));if(e>n||t>n)throw new Error("Requested texture size [".concat(e,"x").concat(t,"] greater than WebGL maximum on this browser / GPU [").concat(n,"x").concat(n,"]."))}(t,n);var i=function(e){return Zc(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return Vc(e,(function(){return e.bindTexture(s,i)})),Vc(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Vc(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Vc(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Vc(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===Ie().getNumber("WEBGL_VERSION")?Vc(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,o,null)})):Vc(e,(function(){return e.texStorage2D(s,1,r,t,n)})),Vc(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:i,texShape:[n,t]}}function Bl(e){return e.internalFormatFloat}function Ul(e){return e.internalFormatHalfFloat}function Vl(e){return e.downloadTextureFormat}function Wl(e){return e.internalFormatPackedFloat}function zl(e){return e.internalFormatPackedHalfFloat}var Gl=function(){return p((function e(t){l(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=Ie().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,Fc(n,t)):this.gl=Dc(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===Ie().getNumber("WEBGL_VERSION")){var o="OES_texture_half_float";if(this.textureFloatExtension=zc(this.gl,"OES_texture_float"),al(this.gl,o))this.textureHalfFloatExtension=zc(this.gl,o);else if(Ie().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),al(this.gl,a))this.colorBufferHalfFloatExtension=zc(this.gl,a);else if(Ie().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",al(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!al(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=function(e){return function(e,t){var n=Zc(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Vc(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Vc(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}(this.gl),this.indexBuffer=function(e){return function(e,t){var n=Zc(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Vc(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),Vc(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}(this.gl),this.framebuffer=function(e){return Zc(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Uc(this.gl,this.textureHalfFloatExtension)}),[{key:"debug",get:function(){return Ie().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Vc(t,(function(){return t.finish()})),Vc(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Vc(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),Vc(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Vc(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Vc(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Pc(t,n),o=s(a,2);return Ll(e,o[0],o[1],Bl(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Pc(t,n),o=s(a,2);return Ll(e,o[0],o[1],Ul(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Pc(t,n),o=s(a,2);return Ll(e,o[0],o[1],Vl(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){Vc(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===Ie().getNumber("WEBGL_VERSION")?Vc(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):Vc(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===Ie().getNumber("WEBGL_VERSION")?Vc(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):Vc(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),Vc(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,o){var i,s,u;Vc(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(i=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(i=new Float32Array(n*r*4),s=e.FLOAT,u=o.internalFormatPackedFloat),i.set(a),2===Ie().getNumber("WEBGL_VERSION")?Vc(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,i)})):Vc(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,i)})),Vc(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Bc(t,n),o=s(a,2);return Ll(e,o[0],o[1],zl(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=Bc(t,n),o=s(a,2);return Ll(e,o[0],o[1],Wl(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(Qc(this.gl,this.framebuffer),this.outputTexture=null),Vc(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=Pc(t,n),o=s(a,2),i=o[0],u=o[1],c=new Uint8Array(t*n*4);return Vc(e,(function(){return e.readPixels(0,0,i,u,r.downloadTextureFormat,e.UNSIGNED_BYTE,c)})),new Float32Array(c.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,o){return function(e,t,n,r,a,o,i,u){var c=e,l=new Float32Array(function(e,t){var n=Bc(e,t),r=s(n,2);return r[0]*r[1]*4}(o,i));return c.bindBuffer(c.PIXEL_PACK_BUFFER,t),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,l),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),l}(this.gl,e,0,0,0,a,o,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();Vc(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var o=16*t*n;return Vc(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,o,e.STREAM_READ)})),Vc(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),Vc(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(Ie().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,o=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(o,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=o}else Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return Vc(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=function(e){var t=cl();return function(e,t){var n=Zc(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Vc(e,(function(){return e.shaderSource(n,t)})),Vc(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}(n));var r=function(e){return Zc(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);return Vc(n,(function(){return n.attachShader(r,t.vertexShader)})),Vc(n,(function(){return n.attachShader(r,e)})),function(e,t){if(Vc(e,(function(){return e.linkProgram(t)})),!Ie().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r),this.debug&&Xc(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=function(e,t,n){return Vc(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Kc(e,t,"clipSpacePos",n,3,20,0)&&Kc(e,t,"uv",n,2,20,12)}(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Vc(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&Xc(this.gl,this.program),Vc(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?function(e,t,n){return Zc(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}(this.gl,e,t):function(e,t,n){return e.getUniformLocation(t,n)}(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),Vc(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),function(e,t,n,r){Vc(e,(function(){return function(e,t,n){!function(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in ".concat("[gl.TEXTURE0, gl.TEXTURE".concat(n,"]"),"."))}(e,n),Vc(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),Vc(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),Vc(e,(function(){return e.uniform1i(n,r)}))}(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=Bc(t,n),a=s(r,2),o=a[0],i=a[1];this.setOutputMatrixTextureDriver(e,o,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&Xc(this.gl,this.program),Jc(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Vc(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),Vc(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=zc(this.gl,2===Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:(e=c(u().mark((function e(t){var n=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ee((function(){return n.disposed||n.isQueryAvailable(t,Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var o=this.getQueryTimerExtensionWebGL1(),i=o.getQueryObjectEXT(e,o.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n,r=this;(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)||("setTimeoutCustom"in Ie().platform&&(n=Ie().platform.setTimeoutCustom.bind(Ie().platform)),ee((function(){return r.pollItems(),0===r.itemsToPoll.length}),(function(){return 0}),null,n))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),Yc(this.gl,e,this.framebuffer),this.debug&&Jc(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(Yc(this.gl,this.outputTexture,this.framebuffer),this.debug&&Jc(this.gl)):Qc(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;Yc(r,e,this.framebuffer),this.debug&&Jc(r),this.outputTexture=e,Vc(r,(function(){return r.viewport(0,0,t,n)})),Vc(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),Vc(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]);var e}();function jl(e){return function(t,n,r,a,o){var i=mi(t,n),s=i.length,u=de(i),c=ae(o,Y(i)),l=t.length,p=n.length,d=de(t),h=de(n),f=hi(t,i),m=hi(n,i);if(f.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=e(r[g%r.length],a[g%a.length]);else for(var v=function(){var t=ye(y,s,u),n=t.slice(-l);f.forEach((function(e){return n[e]=0}));var o=ve(n,l,d),i=t.slice(-p);m.forEach((function(e){return i[e]=0}));var g=ve(i,p,h);c[y]=e(r[o],a[g])},y=0;y<c.length;++y)v();return[c,i]}}var Hl=jl((function(e,t){return e+t}));function ql(e){return function(t,n,r){for(var a=ae(n,t.length),o=0;o<t.length;++o)a[o]=e(t[o],r);return a}}var Xl=ql((function(e){return Math.ceil(e)}));function Kl(e,t,n,r){var a=oe(n,Y(t));if(r&&"string"!==n){var o=0;e.forEach((function(e){var t=Y(e.shape);a.set(e.vals,o),o+=t}))}else{var i=0;e.forEach((function(e){for(var r="string"===n?Ic(e.vals):e.vals,o=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+i,c=0;c<e.shape[1];++c)a[u+c]=r[o++];i+=e.shape[1]}))}return a}var Yl=jl((function(e,t){return e===t?1:0})),Ql=ql((function(e){return Math.exp(e)})),Jl=ql((function(e){return Math.expm1(e)})),Zl=ql((function(e){return Math.floor(e)})),$l=jl((function(e,t){return e>t?1:0})),ep=jl((function(e,t){return e>=t?1:0})),tp=jl((function(e,t){return e<t?1:0})),np=jl((function(e,t){return e<=t?1:0})),rp=ql((function(e){return Math.log(e)})),ap=jl((function(e,t){return Math.max(e,t)})),op=jl((function(e,t){return Math.min(e,t)})),ip=jl((function(e,t){return e*t})),sp=jl((function(e,t){return e!==t?1:0}));function up(e,t){for(var n=e.slice(0,t);n.length<t;)n.push(1);for(var r=t;r<e.length;r++)n[t-1]*=e[r];return n}var cp=_u,lp=function(){function e(t,n,r,a,o,i,s,u,c,p){l(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=Bu(p),this.raggedRank=Uu(this.rowPartitionTypes)}return p(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===cp.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===cp.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case cp.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case cp.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(cp[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return dp(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;Vu(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=Lu(this.raggedRank,n,t);r[0]<0&&(r[0]=e);for(var a=1;a<=this.raggedRank;++a)r[a]<0&&(r[a]=this.getMaxWidth(a));return r}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],o=0,i=0;i<r;++i,o+=t)a.push(o);for(var s=r;s<e;++s)a.push(-1);return H(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,o=[],i=0;i<a-1;++i){var s=e[i+1]-e[i],u=Math.min(r,s),c=t[i];-1===c&&(u=0);for(var l=0;l<u;++l)o.push(c),c+=n;for(var p=0;p<s-u;++p)o.push(-1)}if(a>0&&o.length!==e[a-1])throw new Error("Invalid row split size.");return o}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,o=[];if(0===a)return[];var i=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];o.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++i<r?u+=n:u=-1);else{if(i=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}o.push(u)}if(o.length!==e.length)throw new Error("Invalid row ids.");return o}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),o=this.getRowPartitionTypeByDimension(e);switch(o){case cp.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case cp.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(cp[o]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case cp.FIRST_DIM_SIZE:return e[0];case cp.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case cp.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(cp[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=dp(t,!1),o=oe(this.valuesDType,Y(a));if(n[0]*t[0]>0){for(var i=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s)i=this.calculateOutputIndex(s-1,i,n[s],t[s]);this.setOutput(this.raggedRank,i,o,a)}return[a,o]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,o=n,i=r.slice(),s=Y(i=i.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;si((function(){var e=rs(c,l),t=cs(e,i);c=t.dataSync()}))}for(var p=0,d=0,h=0,f=0;f<=u;++f){var m=f<u?t[f]:-1;if(m!==h){if(d<h){var g=a.subarray(p*s);pp(o.subarray(d*s),g,(h-d)*s)}if(f>=u){var v=n.length;m=Math.floor(v/s)}if(m>h)if(1===this.defaultValue.length)o.subarray(h*s,m*s).fill(this.defaultValue[0]),h=m;else for(;m>h;)pp(o.slice(h*s),c,s),++h;m<0?(p=f+1,d=h):(p=f,h=(d=h)+1)}else++h}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,o=1;o<t;++o){var i=e[o];i!==r&&(r=i,a=Math.max(o-n,a),n=o)}return Math.max(t-n,a)}}])}();function pp(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function dp(e,t){var n,r=[],a=i(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o<0){if(!t)throw new Error("Dimension ".concat(o," must be >= 0"));if(o<-1)throw new Error("Dimension ".concat(o," must be >= -1"));o=-1}r.push(o)}}catch(e){a.e(e)}finally{a.f()}return r}function hp(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return me(0,r);var a=me(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var o=1;o<a.length;o++)a[o]=a[o-1]+n;return a}var fp=ql((function(e){return 1/Math.sqrt(e)})),mp=ql((function(e){return 1/(1+Math.exp(-e))}));function gp(e,t,n,r,a){var i=Oi(r,t,n),s=Y(n),u=de(r);if(i){var c=Mi(t,u);return"string"===a?e.slice(c,c+s):e.subarray(c,c+s)}for(var l=ls(r,a,"string"===a?Ic(e):e),p=ls(n,a),d=0;d<p.size;++d){var h=p.indexToLoc(d),f=h.map((function(e,n){return e+t[n]}));p.set.apply(p,[l.get.apply(l,o(f))].concat(o(h)))}return"string"===a?Sc(p.values):p.values}var vp=ql((function(e){return Math.sqrt(e)})),yp=jl((function(e,t){var n=e-t;return n*n})),bp=function(){return p((function e(t,n,r,a,o,i){l(this,e),this.separator=pr(t),this.nGramWidths=n,this.leftPad=pr(r),this.rightPad=pr(a),this.padWidth=o,this.preserveShort=i}),[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,o){for(var i=this,s=function(){var s=i.getPadWidth(o),c=Math.max(0,s-u),l=Math.max(0,s-(a-(u+1))),p=o-(c+l),d=t+(c>0?0:u-s),h=0;h+=c*i.leftPad.length;for(var f=0;f<p;++f)h+=e[d+f].length;h+=l*i.rightPad.length,h+=(c+l+p-1)*i.separator.length,n[r+u]=new Uint8Array(h);for(var m=n[r+u],g=0,v=function(e){return e.forEach((function(e){return m[g++]=e}))},y=0;y<c;++y)v(i.leftPad),v(i.separator);for(var b=0;b<p-1;++b)v(e[d+b]),v(i.separator);if(p>0){v(e[d+p-1]);for(var x=0;x<l;++x)v(i.separator),v(i.rightPad)}else{for(var w=0;w<l-1;++w)v(i.rightPad),v(i.separator);v(i.rightPad)}},u=0;u<a;++u)s()}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var o=t[0];if(0!==o)throw new Error("First split value must be 0, got ".concat(o));for(var i=1;i<a;++i){var s=t[i]>=o;if(!(s=s&&t[i]<=r))throw new Error("Invalid split value ".concat(t[i],", must be in [").concat(o,", ").concat(r,"]"));o=t[i]}if(o!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(o))}var u=a-1,c=oe("int32",a);if(0===r||0===a){for(var l=new Array(r),p=0;p<=u;++p)c[p]=0;return[l,c]}c[0]=0;for(var d=function(){var e=t[h]-t[h-1],r=0;n.nGramWidths.forEach((function(t){r+=n.getNumNGrams(e,t)})),n.preserveShort&&e>0&&0===r&&(r=1),c[h]=c[h-1]+r},h=1;h<=u;++h)d();for(var f=new Array(c[u]),m=function(r){var a=t[r],o=c[r];if(n.nGramWidths.forEach((function(i){var s=t[r+1]-t[r],u=n.getNumNGrams(s,i);n.createNGrams(e,a,f,o,u,i),o+=u})),n.preserveShort&&o===c[r]){var i=t[r+1]-t[r];if(0===i)return 1;var s=i+2*n.padWidth;n.createNGrams(e,a,f,o,1,s)}},g=0;g<u;++g)m(g);return[f,c]}}])}();function xp(e,t,n,r,a,o,i,s){return new bp(n,r,a,o,i,s).compute(e,t)}function wp(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,o=0;o<e.length+1;o++)if(o===e.length||-1!==t.indexOf(e[o])){var i=e.subarray(a,o);n&&0===i.length||r.push(i),a=o+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function kp(e,t,n){for(var r=e.length,a=[],o=0,i=0,s=new Array(r),u=0;u<r;++u){var c=a.length;wp(e[u],t,n,a);var l=a.length-c;s[u]=l,o+=l,i=Math.max(i,l)}for(var p=oe("int32",2*o),d=new Array(o),h=[r,i],f=0,m=0;m<r;++m)for(var g=0;g<s[m];++g)p[2*f]=m,p[2*f+1]=g,d[f]=a[f],++f;return[p,d,h]}function Ip(e,t){for(var n=oe("int32",e.length),r=0;r<e.length;++r)n[r]=sr(e[r]).modulo(t).getLowBitsUnsigned();return n}var Sp=jl((function(e,t){return e-t})),Tp=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};var _p=Object.freeze({__proto__:null,addImpl:Hl,bincountImpl:function(e,t,n,r,a){for(var o=Y(r),i=me(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(i[u]+=o>0?t[s]:1)}return i},bincountReduceImpl:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],o=e.shape[1],i=ls([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<o;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?i.set(1,s,c):t.size>0?i.set(i.get(s,c)+t.get(s,u),s,c):i.set(i.get(s,c)+1,s,c))}return i},castImpl:function(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=cr([0],n),o=jl((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),i=s(o,2),u=i[0];return[i[1],"bool",u]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))},ceilImpl:Xl,concatImpl:Kl,equalImpl:Yl,expImpl:Ql,expm1Impl:Jl,floorImpl:Zl,gatherNdImpl:function(e,t,n,r,a,i,s,u,c){for(var l=ls([r,i],n),p=0;p<r;p++){for(var d=[],h=0,f=0;f<a;f++){var m=e[p*a+f];h+=m*s[f],d.push(m)}if(h<0||h>=c/i)throw new Error("Invalid indices: ".concat(d," does not index into ").concat(u));for(var g=0;g<i;g++)l.values[p*i+g]=t.get.apply(t,o(t.indexToLoc(h*i+g)))}return l},gatherV2Impl:function(e,t,n){for(var r=ls(n,e.dtype),a=0;a<r.size;++a){var o=r.indexToLoc(a).slice(),i=o[0],s=o[2],u=t.locToIndex([i,s]);o[2]=t.values[u];var c=e.locToIndex(o);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r},greaterEqualImpl:ep,greaterImpl:$l,lessEqualImpl:np,lessImpl:tp,linSpaceImpl:function(e,t,n){var r=(t-e)/(n-1),a=me(n,"float32");a[0]=e;for(var o=1;o<a.length;o++)a[o]=a[o-1]+r;return a},logImpl:rp,maxImpl:function(e,t,n,r){for(var a=ae(r,Y(n)),o=0;o<a.length;++o){for(var i=o*t,s=e[i],u=0;u<t;++u){var c=e[i+u];(Number.isNaN(c)||c>s)&&(s=c)}a[o]=s}return a},maximumImpl:ap,minimumImpl:op,multiplyImpl:ip,negImpl:function(e,t,n){var r=ur(-1,n);return ip([],t,r,e,n)},notEqualImpl:sp,prodImpl:function(e,t,n,r){for(var a=xs(e,r),o=s(a,2),i=o[0],u=o[1],c=Rr(t,"int32"),l=me(Y(i),c),p=Y(u),d=0;d<l.length;++d){for(var h=d*p,f=1,m=0;m<p;++m)f*=n[h+m];l[d]=f}return{outVals:l,outShape:i,outDtype:c}},raggedGatherImpl:function(e,t,n,r,a,o,s,u){if(0===e.length)throw new Error("paramsNestedSplits must be non empty");if(0===t[0].length)throw new Error("Split tensors must not be scalars");if(function(e,t,n){e.forEach((function(e,r){if(e<0||e>=n){var a=ye(r,t.length,de(t)).join(",");throw new Error("indices[".concat(a,"] = ").concat(e," is not in [0, ").concat(n,")"))}}))}(o,s,t[0][0]-1),0===r.length)throw new Error("params.rank must be nonzero");var c=function(e,t,n,r){var a=[],o=0,i=t.length-1+n.length,s=new Array(i).fill(null).map((function(){return[0]}));!function(e,t){for(var n=0;n<e.length;++n){var r=e[n],a=n===e.length-1?t:e[n+1].length;if(0===r.length)throw new Error("Ragged splits may not be empty");if(r[0]<0)throw new Error("Ragged splits must be non-negative");if(r[r.length-1]>a)throw new Error("Ragged splits must not point past values");for(var o=1;o<r.length;++o)if(r[o-1]>r[o])throw new Error("Ragged splits must be sorted in ascending order")}}(n,r);for(var u=1,c=0;c<t.length-1;++c){u*=t[c];for(var l=t[c+1],p=1;p<u+1;++p)s[c].push(p*l)}for(var d=0;d<e.length;++d){for(var h=e[d],f=e[d]+1,m=0;m<n.length;++m){var g=n[m],v=m+t.length-1;if(v>=0)for(var y=s[v],b=y[y.length-1]-g[h],x=h;x<f;++x)s[v].push(g[x+1]+b);h=g[h],f=g[f]}f!==h&&(a.push([h,f]),o+=f-h)}return{outSplits:s,valueSlices:a,numValues:o}}(o,s,e,r[0]),l=c.outSplits,p=c.valueSlices,d=c.numValues,h=function(e){for(var t=[],n=function(){var n=oe("int32",e[r].length);t.push(n),e[r].forEach((function(e,t){return n[t]=e}))},r=0;r<e.length;++r)n();return t}(l),f=function(e,t,n,r,a){var o=t.slice();o[0]=a;var s=oe(n,Y(o)),u=e.length;return function(e,t,n,r,a,o){var s,u=up(t,2)[1],c=up(o,2)[1],l=0,p=i(n);try{for(p.s();!(s=p.n()).done;)for(var d=s.value,h=d[0];h<d[1];++h){for(var f=0;f<r;++f)a[l*c+f]=e[h*u+f];++l}}catch(e){p.e(e)}finally{p.f()}}(e,t,r,0===u?0:u/t[0],s,o),[s,o]}(n,r,a,p,d);return[h,f[0],f[1]]},raggedTensorToTensorImpl:function(e,t,n,r,a,o,i,s,u,c){return new lp(e,t,n,r,a,o,i,s,u,c).compute()},rangeImpl:hp,rsqrtImpl:fp,scatterImpl:function(e,t,n,r,a,o,i,s,u,c){var l=[r/a,a],p=e.values,d=t.values;if(0===r)return ls(n,t.dtype);var h=ls(l,t.dtype);"string"==typeof u||"number"==typeof u?h.values.fill(u):"boolean"==typeof u&&h.values.fill(+u);for(var f=0;f<o;f++){for(var m=[],g=0,v=0;v<i;v++){var y=p[f*i+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/a)throw new Error("Invalid indices: ".concat(m," does not index into ").concat(n));for(var b=0;b<a;b++)c?h.values[g*a+b]+=d[f*a+b]:h.values[g*a+b]=0===t.rank?d[0]:d[f*a+b]}return h},sigmoidImpl:mp,simpleAbsImpl:function(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t},sliceImpl:gp,sparseFillEmptyRowsImpl:function(e,t,n,r,a,o,i){var s=t[0],u=o[0],c=new Array(u),l=new Array(s),p=t[1];if(0===u){if(0!==s)throw new Error(lc(s));return[oe(n,0),[0,p],oe(a,0),c,l]}for(var d=!0,h=0,f=new Array(u).fill(0),m=0;m<s;++m){var g=e[m*p];if(g<0)throw new Error(pc(m,g));if(g>=u)throw new Error(dc(m,g,u));++f[g],d=d&&g>=h,h=g}for(var v=!0,y=0;y<u;++y){var b=0===f[y];c[y]=b,v=v&&!b,f[y]=Math.max(f[y],1),y>0&&(f[y]+=f[y-1])}if(v&&d){for(var x=e,w=r,k=0;k<s;++k)l[k]=k;return[x,[s,p],w,c,l]}for(var I=f[u-1],S=oe(n,I*p),T=oe(a,I),_=new Array(u).fill(0),C=0;C<s;++C){var N=e[C*p],E=_[N],R=(0===N?0:f[N-1])+E;_[N]++;for(var A=0;A<p;++A)S[R*p+A]=e[C*p+A];T[R]=r[C],l[C]=R}for(var O=0;O<u;++O)if(0===_[O]){var M=0===O?0:f[O-1];S[M*p+0]=O;for(var F=1;F<p;++F)S[M*p+F]=0;T[M]=i}return[S,[I,p],T,c,l]},sparseReshapeImpl:function(e,t,n,r,a){for(var o=Y(r),i=t[0],s=a.length,u=[],c=1,l=-1,p=0;p<s;++p){var d=a[p];if(-1===d){if(-1!==l)throw new Error(hc(l,p));l=p,u.push(1)}else{if(d<0)throw new Error(fc(p,d));c*=d,u.push(d)}}if(-1!==l){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var h=Math.trunc(o/c);if(c*h!==o)throw new Error(mc(r,u));u[l]=h}if(Y(u)!==o)throw new Error(gc(r,u));var f=r.length,m=[];if(f>0){m[f-1]=1;for(var g=f-2;g>=0;--g)m[g]=m[g+1]*r[g+1]}var v=[];if(s>0){v[s-1]=1;for(var y=s-2;y>=0;--y)v[y]=v[y+1]*u[y+1]}for(var b=oe(n,i*s),x=0;x<i;++x){for(var w=0,k=0;k<f;++k)w+=e[x*f+k]*m[k];for(var I=0;I<s;++I)b[x*s+I]=Math.trunc(w/v[I]),w%=v[I]}return[b,[i,s],u]},sparseSegmentReductionImpl:function(e,t,n,r,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0;if(l<0)throw new Error("segment ids must be >= 0");var p=t.slice();p[0]=l;var d=oe(n,p.reduce((function(e,t){return e*t}),1));if(0===s)return l>0&&d.fill(i),[d,p];if(l<=0)throw new Error("segment ids must be >= 0");for(var h=0,f=1,m=0,g=a[h];;){var v=0;if(f<s){if(g===(v=a[f])){++f;continue}if(g>=v)throw new Error("segment ids are not increasing")}if(g<0||g>=l)throw new Error(vc(g,l));g>m&&d.fill(i,m*c,g*c);for(var y=h;y<f;++y){var b=r[y];if(b<0||b>=u[0])throw new Error(yc(y,r[y],u[0]));for(var x=0;x<c;x++)d[g*c+x]+=e[b*c+x]}if(o)for(var w=0;w<c;w++)d[g*c+w]/=f-h;if(h=f,m=g+1,g=v,++f>s)break}return m<l&&d.fill(i,m*c,l*c),[d,p]},sqrtImpl:vp,squaredDifferenceImpl:yp,stridedSliceImpl:function(e,t,n,r){for(var a=ls(e,t.dtype),i=0;i<a.size;i++){for(var s=a.indexToLoc(i),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[c]*n[c]+r[c];a.set.apply(a,[t.get.apply(t,u)].concat(o(s)))}return a},stringNGramsImpl:xp,stringSplitImpl:kp,stringToHashBucketFastImpl:Ip,subImpl:Sp,tileImpl:function(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=ls(n,e.dtype),o=0;o<a.values.length;++o){for(var i=a.indexToLoc(o),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=i[u]%e.shape[u];var c=e.locToIndex(s);a.values[o]=e.values[c]}return a},topKImpl:function(e,t,n,r,a){for(var o=t[t.length-1],i=e.length/o,s=o,u=ae(n,i*r),c=ae("int32",i*r),l=function(){var t=p*s,n=e.subarray(t,t+s),o=new Array(n.length);n.forEach((function(e,t){return o[t]={value:e,index:t}})),r<o.length&&(function e(t,n){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.length-1;a>r;){if(a-r>600){var o=a-r+1,i=n-r+1,s=Math.log(o),u=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*u*(o-u)/o)*Math.sign(i-o/2);e(t,n,Math.max(r,Math.floor(n-i*u/o+c)),Math.min(a,Math.floor(n+(o-i)*u/o+c)))}var l=t[n],p=r,d=a;for(j(t,r,n),Tp(t[a],l)>0&&j(t,r,a);p<d;){for(j(t,p,d),p++,d--;Tp(t[p],l)<0;)p+=1;for(;Tp(t[d],l)>0;)d-=1}0===Tp(t[r],l)?j(t,r,d):j(t,d+=1,a),d<=n&&(r=d+1),n<=d&&(a=d-1)}}(o,r),o=o.slice(0,r)),a&&o.sort(Tp);for(var i=p*r,l=u.subarray(i,i+r),d=c.subarray(i,i+r),h=0;h<r;h++)l[h]=o[h].value,d[h]=o[h].index},p=0;p<i;p++)l();var d=t.slice();return d[d.length-1]=r,[ls(d,n,u),ls(d,"int32",c)]},transposeImpl:function(e,t,n,r,a){for(var o=t.length,i=Y(t),s=de(t),u=de(a),c=ae(n,Y(a)),l=0;l<i;++l){for(var p=ye(l,o,s),d=new Array(p.length),h=0;h<d.length;h++)d[h]=p[r[h]];c[ve(d,o,u)]=e[l]}return c},uniqueImpl:function(e,t,n,r){for(var a=ne(t,n)[0],o=[1,n[0],1],i=0;i<a;i++)o[0]*=n[i];o[1]=n[a];for(var s=a+1;s<n.length;s++)o[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new br(o,r,e),p=[],d=1===o[0]&&1===o[2],h=0;h<n[a];h++){var f=void 0;if(d)f=e[h].toString();else{for(var m=[],g=0;g<o[0];g++)for(var v=0;v<o[2];v++)m.push(l.get(g,h,v));f=m.join(",")}if(void 0!==u[f])c[h]=u[f];else{var y=Object.keys(u).length;u[f]=y,c[h]=y,p.push(h)}}var b=o.slice();b[1]=Object.keys(u).length;var x=new br(b,r);p.forEach((function(e,t){for(var n=0;n<o[0];n++)for(var r=0;r<o[2];r++)x.set(l.get(n,e,r),n,t,r)}));var w=n.slice();return w[a]=b[1],{outputValues:x.values,outputShape:w,indices:c}}}),Cp=_p.addImpl,Np=_p.bincountImpl,Ep=_p.bincountReduceImpl,Rp=_p.castImpl,Ap=_p.ceilImpl,Op=_p.concatImpl,Mp=_p.equalImpl,Fp=_p.expImpl,Dp=_p.expm1Impl,Pp=_p.floorImpl,Lp=_p.gatherNdImpl,Bp=_p.gatherV2Impl,Up=_p.greaterImpl,Vp=_p.greaterEqualImpl,Wp=_p.lessImpl,zp=_p.lessEqualImpl,Gp=_p.linSpaceImpl,jp=_p.logImpl,Hp=_p.maxImpl,qp=_p.maximumImpl,Xp=_p.minimumImpl,Kp=_p.multiplyImpl,Yp=_p.negImpl,Qp=_p.notEqualImpl,Jp=_p.prodImpl,Zp=_p.raggedGatherImpl,$p=_p.raggedTensorToTensorImpl,ed=_p.rangeImpl,td=_p.rsqrtImpl,nd=_p.scatterImpl,rd=_p.sigmoidImpl,ad=_p.simpleAbsImpl,od=_p.sliceImpl,id=_p.sparseFillEmptyRowsImpl,sd=_p.sparseReshapeImpl,ud=_p.sparseSegmentReductionImpl,cd=_p.sqrtImpl,ld=_p.stridedSliceImpl,pd=_p.stringNGramsImpl,dd=_p.stringSplitImpl,hd=_p.stringToHashBucketFastImpl,fd=_p.subImpl,md=_p.tileImpl,gd=_p.topKImpl,vd=_p.transposeImpl,yd=_p.uniqueImpl;function bd(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function xd(e,t){return 1===t?[e]:bd(e,t)}var wd=function(){return p((function e(t){if(l(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=Rl(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=xd("rc",this.rank),r=Il(this.rank),a=this.getOutOfBoundsCondition(n),o=this.getSetup(n),i=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(i,"));\n          }\n        }\n      ")}}),[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),o=2;o<this.rank;o++)a="".concat(e[e.length-1-o],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);return 1===this.rank?"getA(rc), (rc + 1 >= ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]," ? 0. : getA(rc + 1)), 0, 0"):"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}])}(),kd=p((function e(t,n){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length);for(var r,a,o="",i=0;i<4;i++){var s="thisRC = rc;";i%2==1&&(s+="thisRC.z += 1;"),i>1&&(s+="thisRC.y += 1;"),o+="\n        ".concat(s,"\n        ").concat(i>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(i,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(i>0?"}":"","\n      ")}this.userCode="\n      ".concat((r=n,a=this.enableShapeUniforms,"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(a?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=function(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var o=n-3;o>=0;--o)a[o]="(".concat(a[o+1]," * ").concat(r[o+1],")");return a}(r,t);return a.map((function(t,r){return"".concat("int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),"; ",r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]),";")})).join("")}(["r","c","d"],"inputShape"):ll(["r","c","d"],r),"\n      return ivec3(r, c, d);\n    }\n  ")),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":dl(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")})),Id=function(){return p((function e(t){l(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}),[{key:"acquireTexture",value:function(e,t,n){var r=Td(t,n),a=_d(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var o,i=Sd(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===Ac.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Ac.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Ac.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Ac.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Ac.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(o),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),o}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=Td(n,r),o=_d(t,a,r);o in this.freeTextures||(this.freeTextures[o]=[]);var i=Sd(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=Ie().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=i):(this.freeTextures[o].push(e),this.numFreeTextures++,this._numBytesFree+=i),this.numUsedTextures--;var u=this.usedTextures[o],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}])}();function Sd(e,t,n,r,a){var o,i=function(e,t){switch(e){case Ac.PACKED_2X2_FLOAT32:return Wl(t);case Ac.PACKED_2X2_FLOAT16:return zl(t);case Ac.UNPACKED_FLOAT32:return Bl(t);case Ac.UNPACKED_FLOAT16:return Ul(t);case Ac.PACKED_4X1_UNSIGNED_BYTE:return Vl(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var u=Bc(e[0],e[1]),c=s(u,2);o=c[0]*c[1]}else{var l=Pc(e[0],e[1]),p=s(l,2);o=p[0]*p[1]}return o*function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,i)}function Td(e,t){if(e===Rc.UPLOAD)return Ac.PACKED_2X2_FLOAT32;if(e===Rc.RENDER||null==e)return function(e){return Ie().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Ac.PACKED_2X2_FLOAT32:Ac.UNPACKED_FLOAT32:e?Ac.PACKED_2X2_FLOAT16:Ac.UNPACKED_FLOAT16}(t);if(e===Rc.DOWNLOAD||e===Rc.PIXELS)return Ac.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function _d(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var Cd=p((function e(t,n){l(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),Nd="if (isnan(x)) return x;",Ed="return x;",Rd="return abs(x);",Ad="return (x >= 0.0) ? x : (exp(x) - 1.0);",Od=Nd+"\n  return (x < 0.0) ? 0.0 : x;\n",Md=Nd+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Fd="return x;",Dd="return 1.0 / (1.0 + exp(-1.0 * x));",Pd="return x;",Ld="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Bd="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ud="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Vd="return 1.0 / (1.0 + exp(-1.0 * x));",Wd=p((function e(t,n){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),zd=p((function e(t){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length);var n=t.length,r=xd("rc",n),a=Il(n),o=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),i=r.slice(-2),s=n<=1?"rc":"vec2(".concat(i.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(o,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),Gd={},jd=Ie().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Hd=function(e){function n(e){var r,a,o;if(l(this,n),(r=f(this,n)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!Ie().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof Gl)a=e;else{var i=Dc(Ie().getNumber("WEBGL_VERSION"),e);a=new Gl(i)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=Dc(Ie().getNumber("WEBGL_VERSION"));a=new Gl(s),r.binaryCache=((o=Ie().getNumber("WEBGL_VERSION"))in Gd||(Gd[o]={}),Gd[o]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new Id(r.gpgpu),r.numMBBeforeWarning=null==Ie().global.screen?1024:Ie().global.screen.height*Ie().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new U(t(r),ii()),t(r)}return a(n,e),p(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((Ie().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||Ie().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Rc.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(Ie().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Rc.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,o=t.slice,i=t.shape,s=t.isPacked;if(null!=o){var u;u=s?new Wd(i,Fd):new Cd(i,Fd);var c=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var p,d,h=null!=this.activeTimers;return h&&(p=lr()),d="complex64"===r?tc(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=lr()-p),this.convertAndCacheOnCPU(e,d)}},{key:"read",value:(h=c(u().mark((function e(t){var n,r,a,i,s,c,l,p,d,h,f,m,g,v,y,b,x,w,k,I,S;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,s=r.slice,c=r.dtype,l=r.complexTensorInfos,p=r.isPacked,null==s){e.next=8;break}return d=p?new Wd(i,Fd):new Cd(i,Fd),h=this.runWebGLProgram(d,[{dataId:t,shape:i,dtype:c}],c),f=this.read(h.dataId),e.abrupt("return",(this.disposeIntermediateTensorInfo(h),f));case 8:if(null==a){e.next=10;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 10:if(!Ie().getBool("DEBUG")||Ie().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==Ie().getNumber("WEBGL_VERSION")){e.next=12;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 12:if(v=null,"complex64"!==c&&Ie().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),b=this.texData.get(m.dataId),v=(y=this.gpgpu).createBufferFromTexture.apply(y,[b.texture.texture].concat(o(Lc(i))))),this.pendingRead.set(t,[]),e.t0="complex64"!==c,!e.t0){e.next=19;break}return e.next=19,this.gpgpu.createAndWaitForFence();case 19:if("complex64"!==c){e.next=26;break}return e.next=22,Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]);case 22:x=e.sent,g=tc(x[0],x[1]),e.next=27;break;case 26:null==v?g=this.getValuesFromTexture(t):(w=Y(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(v,w));case 27:return null!=m&&this.disposeIntermediateTensorInfo(m),null!=v&&Vc(k=this.gpgpu.gl,(function(){return k.deleteBuffer(v)})),I=this.convertAndCacheOnCPU(t,g),S=this.pendingRead.get(t),e.abrupt("return",(this.pendingRead.delete(t),S.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&ii().removeDataId(t,this),this.pendingDeletes--),I));case 30:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,o=n.slice,i=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===i)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=o){var c;c=s?new Wd(a,Fd):new Cd(a,Fd);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:i}],i),p=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),p}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var d=this.decode(e,t.customTexShape),h=ii().makeTensorFromTensorInfo(d),f=this.texData.get(d.dataId);return Object.assign({tensorRef:h},f.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return dr(e)}));return ls(e.shape,e.dtype,n)}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return ls(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Wc(n)){if(Ie().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"));throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Y(n);if(Ie().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s,u=this.decode(e),c=this.texData.get(u.dataId),l=(s=this.gpgpu).downloadMatrixFromPackedTexture.apply(s,[c.texture.texture].concat(o(Lc(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(u),l}var p=Ie().getBool("WEBGL_PACK")&&!0===a,d=p?tl(n):n,h=p?new Fl(d):new Ml(d),f=this.runWebGLProgram(h,[{shape:d,dtype:r,dataId:e}],"float32"),m=this.texData.get(f.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture.texture,m.texShape[0],m.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(f),g}},{key:"timerAvailable",value:function(){return Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var o=K(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),i=K(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return c(u().mark((function e(){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=7;break}return e.next=3,Promise.all(o);case 3:n=e.sent,s.kernelMs=function(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}(n),s.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:i[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=8;break;case 7:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 8:return e.abrupt("return",(t.uploadWaitMs=0,t.downloadWaitMs=0,s));case 9:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:lr(),endMs:null}}},{key:"endTimer",value:function(e){return Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=lr(),e)}},{key:"getQueryTime",value:(d=c(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,o=t.usage,i=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,o,i)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jd;return Ie().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Y(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){dn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return function(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=ls(e,"int32"),o=ls([n.length,e.length],"int32"),i=0;i<n.length;i++){var s=a.indexToLoc(n[i]),u=i*e.length;o.values.set(s,u)}return o.toTensor()}(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new Wd(e.shape,t),a=this.compileAndRun(r,[e],n);return ii().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=ad(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(Ie().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Rd,e.dtype);var n=new Cd(e.shape,Rd),r=this.compileAndRun(n,[e]);return ii().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&ue(n[0])){var a=n.map((function(e){return pr(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return ii().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new zd(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new wd(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[$c(e.shape)].concat(o(el(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[$c(t)].concat(o(el(t))),i=new kd(a,n),s=[n],u=this.runWebGLProgram(i,[r],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,o=n.dtype;null!=t&&H(Y(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var i,s=tl(a);i=r?new Ol(s):new Al(s);var u=[null!=t?t:Lc(s)];return{dtype:o,shape:a,dataId:this.runWebGLProgram(i,[{shape:s,dtype:o,dataId:e}],o,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===Ec.DENSE){var c=null!=i?i:Lc(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Y(s.shape))return u.values=ae(s.dtype,0),s;var l=[],p=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Y(t.shape)<=Ie().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!=!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!rl(n.shape,t.shape)){var r=t,o=t.shape;t.shape=n.shape,t=a.packedReshape(t,o),l.push(t),n=a.texData.get(t.dataId),r.shape=o}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var d,h={shape:s.shape,texData:u,isUniform:!1},f=function(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var o=t.texData.texShape,i=Sl(e.packedInputs,t.shape,o),s=i.useSqueezeShape,u=i.uniformShape,c=i.keptDims,l="",p="",d="";if(1===u.length&&e.packedInputs){var h=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];l="".concat(h[0]>1,"_").concat(h[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var f=de(u);d="".concat(f[0]===o[1],"_").concat(f[f.length-1]===o[1])}}else p="".concat(u[0]>1,"_").concat(u[1]>1);var m=t.shape.length,g=2===u.length&&Q(t.shape,o),v=1===Y(t.shape),y=hi(t.shape,n.shape),b=!e.packedInputs&&m===n.shape.length&&Q(o,n.texData.texShape),x=e.packedInputs||u.length>2?"":"".concat(o[0]>1,"_").concat(o[1]>1);r+="".concat(m,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(v,"_").concat(y,"_").concat(g,"_").concat(l,"_").concat(p,"_").concat(d,"_").concat(x,"_").concat(a)}else{var w=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(w,"_").concat(a)}}));var a=e.userCode,o=e.constructor.name;return o+="_"+r+"_"+a+"".concat(Ie().getNumber("WEBGL_VERSION"))}(e,p,h),m=this.getAndSaveBinary(f,(function(){return Cl(a.gpgpu,e,p,h)})),g=null!=this.activeTimers;g&&(d=this.startTimer()),Ie().get("ENGINE_COMPILE_ONLY")||function(e,t,n,r,a){t.program.enableShapeUniforms||(El(t.inShapeInfos,n),El([t.outShapeInfo],[r]));var o=r.texData.texture,i=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):e.setOutputMatrixTexture(o.texture,i[0],i[1]),e.setProgram(t.webGLProgram),1===Ie().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],o=t.uniformLocations[a],i=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=Sl(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=o)if(n.isUniform)if(Y(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(o,l)}else null!=n.texData.slice&&null!=i&&e.gl.uniform1i(i,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,o,r)}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=de(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var o=t.customUniformLocations[r],i=a[r];if("float"===n.type)e.gl.uniform1fv(o,i);else if("vec2"===n.type)e.gl.uniform2fv(o,i);else if("vec3"===n.type)e.gl.uniform3fv(o,i);else if("vec4"===n.type)e.gl.uniform4fv(o,i);else if("int"===n.type)e.gl.uniform1iv(o,i);else if("ivec2"===n.type)e.gl.uniform2iv(o,i);else if("ivec3"===n.type)e.gl.uniform3iv(o,i);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(o,i)}})),e.executeProgram()}(this.gpgpu,m,p,h,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),g&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)}));var v=Ie().get("WEBGL_FLUSH_THRESHOLD");if(v>0){var y=lr();y-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!Ie().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return n=n||t[0].dtype,this.runWebGLProgram(e,t,n,r,a)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;this.disposed||(Ie().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=si((function(){if(!Ie().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=Ie().getBool("DEBUG");Ie().set("DEBUG",!1);var n=e.abs(_s(1e-8)).dataSync()[0];if(Ie().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,u=t.usage,c=t.isPacked;if(null==i){var l,p=null!=this.activeTimers;p&&(l=lr());var d=t.texShape;if(null==d&&(d=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ie().getNumber("WEBGL_MAX_TEXTURE_SIZE"),r=Ie().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");if(r===1/0&&Ie().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(r=n/2),t&&(n*=2,r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?G(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var a=re(e);e=a.newShape}var i=Y(e),u=null;e.length<=1&&i<=n?u=[1,i]:2===e.length&&e[0]<=n&&e[1]<=n?u=e:3===e.length&&e[0]*e[1]<=n&&e[2]<=n?u=[e[0]*e[1],e[2]]:3===e.length&&e[0]<=n&&e[1]*e[2]<=n?u=[e[0],e[1]*e[2]]:4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n?u=[e[0]*e[1]*e[2],e[3]]:4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n&&(u=[e[0],e[1]*e[2]*e[3]]);var c=null!=u&&Math.max.apply(Math,o(u))>r&&Math.min.apply(Math,o(u))<=(t?2:1)&&Math.min.apply(Math,o(u))>0;if(null==u||c)if(t){var l,p,d=$c(e),h=2,f=2;e.length&&(l=el(e),h=(p=s(l,2))[0],f=p[1]),u=Z(i=d*(h/2)*(f/2)).map((function(e){return 2*e}))}else u=Z(i);return u}(n,c),t.texShape=d),null!=a){var h,f,m,g=tl(n),v=d[1],y=d[0],b=a instanceof Uint8Array||a instanceof Uint8ClampedArray;!c&&b||(h=Bc(d[0],d[1]),v=(f=s(h,2))[0],y=f[1]),m=c?new Pl(g,b):new Dl(g,b);var x=b?[y,v]:d,w=this.makeTensorInfo(x,r),k=this.texData.get(w.dataId);k.usage=b?Rc.PIXELS:Rc.UPLOAD,k.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(w.dataId),v,y,a);var I=[[y,v]],S=this.runWebGLProgram(m,[w],r,I,!0),T=this.texData.get(S.dataId);t.texShape=T.texShape,t.isPacked=T.isPacked,t.usage=T.usage,Ie().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(t.texture=T.texture,t.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(w),p&&(this.uploadWaitMs+=lr()-l)}else{var _=this.acquireTexture(d,u,r,c);t.texture=_}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, most likely due to a memory leak"))}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*se(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=s(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:(i=c(u().mark((function e(){var t,n,r,a,o,i,c,l,p=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=4;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=s(r[n],2),o=a[1],t.push(this.checkCompletionAsync_(o));return e.abrupt("return",Promise.all(t));case 4:i=u().mark((function e(){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=s(l[c],2),r=n[1],a=new Promise((function(e){try{p.checkCompletion_(r),e(!0)}catch(e){throw e}})),t.push(a);case 3:case"end":return e.stop()}}),e)})),c=0,l=Object.entries(this.binaryCache);case 6:if(!(c<l.length)){e.next=11;break}return e.delegateYield(i(),"t0",8);case 8:c++,e.next=6;break;case 11:return e.abrupt("return",Promise.all(t));case 12:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"checkCompletionAsync_",value:(r=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}e.t0=this.checkCompletion_(t),e.next=7;break;case 4:return e.next=6,new Promise((function(e){return Fu((function(){return e()}))}));case 6:e.t0=this.checkCompletionAsync_(t);case 7:return e.abrupt("return",e.t0);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw qc(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=s(t[e],2)[1],r=Nl(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,o=r.customUniformLocations,i=r.infLoc,u=r.nanLoc,c=r.inShapesLocations,l=r.inTexShapesLocations,p=r.outShapeLocation,d=r.outShapeStridesLocation,h=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=o,n.infLoc=i,n.nanLoc=u,n.inShapesLocations=c,n.inTexShapesLocations=l,n.outShapeLocation=p,n.outShapeStridesLocation=d,n.outTexShapeLocation=h}}}]);var r,i,d,h}(V);Hd.nextDataId=0,Wr()&&di("webgl",(function(){return new Hd}),2);var qd="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",Xd=p((function e(t,n,r){l(this,e),this.variableNames=["A","B"],this.outputShape=mi(n,r),this.enableShapeUniforms=Rl(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),Kd="\n  result.r = isNaN.r ? NAN : result.r;\n  result.g = isNaN.g ? NAN : result.g;\n  result.b = isNaN.b ? NAN : result.b;\n  result.a = isNaN.a ? NAN : result.a;\n",Yd=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];l(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=mi(n,r);var o=this.outputShape.length;this.enableShapeUniforms=Rl(o);var i="";if(a)if(0===o||1===Y(this.outputShape))i="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(i="\n          ".concat(Il(o)," coords = getOutputCoords();\n        "),1===o)this.enableShapeUniforms?i+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":i+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var s=xd("coords",o);this.enableShapeUniforms?i+="\n            bool nextRowOutOfBounds =\n              (".concat(s[o-2]," + 1) >= outShape[").concat(o," - 2];\n            bool nextColOutOfBounds =\n              (").concat(s[o-1]," + 1) >= outShape[").concat(o," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):i+="\n            bool nextRowOutOfBounds =\n              (".concat(s[o-2]," + 1) >= ").concat(this.outputShape[o-2],";\n            bool nextColOutOfBounds =\n              (").concat(s[o-1]," + 1) >= ").concat(this.outputShape[o-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(i,"\n\n        setOutput(result);\n      }\n    ")}));function Qd(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Jd={kernelName:ot,backendName:"webgl",kernelFunc:Qd};function Zd(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,o=n.makeTensorInfo(r.shape,"complex64"),i=n.texData.get(o.dataId),s=Qd({inputs:{x:r},backend:n}),u=Qd({inputs:{x:a},backend:n});return i.complexTensorInfos={real:s,imag:u},o}var $d={kernelName:Le,backendName:"webgl",kernelFunc:Zd},eh="return (a < 0.) ? b * a : a;",th="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",nh={kernelName:it,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.alpha,i=n.makeTensorInfo([],"float32",ur(o,"float32")),s=Ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yd(th,a.shape,i.shape):new Xd(eh,a.shape,i.shape),u=n.runWebGLProgram(s,[a,i],"float32");return n.disposeIntermediateTensorInfo(i),u}},rh="return (a < 0.) ? b * a : a;",ah="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",oh={kernelName:Tt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,o=Ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yd(ah,r.shape,a.shape):new Xd(rh,r.shape,a.shape);return n.runWebGLProgram(o,[r,a],"float32")}},ih="if (isnan(x)) return x;";function sh(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var o,i=e.inputs,s=e.backend,u=i.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var p=c.texData.get(u.dataId),d=r(p.values,l);return c.makeTensorInfo(u.shape,l,d)}return o=Ie().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new Wd(u.shape,n):new Cd(u.shape,t),c.runWebGLProgram(o,[u],l)}}function uh(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,o=e.supportsComplex,i=void 0!==o&&o,u=e.cpuKernelImpl,c=e.dtype;return function(e){var r=e.inputs,o=e.backend,l=r.a,p=r.b,d=o;if(i&&"complex64"===l.dtype){var h=d.texData.get(l.dataId),f=d.texData.get(p.dataId),m=[[h.complexTensorInfos.real,f.complexTensorInfos.real],[h.complexTensorInfos.imag,f.complexTensorInfos.imag]].map((function(e){var n=s(e,2),r=n[0],a=n[1],o={dataId:r.dataId,dtype:r.dtype,shape:l.shape},i={dataId:a.dataId,dtype:a.dtype,shape:p.shape},u=new Xd(t,l.shape,p.shape);return d.runWebGLProgram(u,[o,i],Rr(r.dtype,a.dtype))})),g=s(m,2),v=g[0],y=g[1],b=Zd({inputs:{real:v,imag:y},backend:d});return d.disposeIntermediateTensorInfo(v),d.disposeIntermediateTensorInfo(y),b}var x,w=c||Rr(l.dtype,p.dtype);if(("string"===l.dtype||"string"===p.dtype||d.shouldExecuteOnCPU([l,p]))&&null!=u){var k=d.texData.get(l.dataId).values,I=d.texData.get(p.dataId).values,S="string"===l.dtype?Ic(k):k,T="string"===l.dtype?Ic(I):I,_=u(l.shape,p.shape,S,T,w),C=s(_,2),N=C[0],E=C[1],R=d.makeTensorInfo(E,w);return d.texData.get(R.dataId).values=N,R}return x=Ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new Yd(n,l.shape,p.shape,a):new Xd(t,l.shape,p.shape),d.runWebGLProgram(x,[l,p],w)}}function ch(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?Pd:Ed;if("relu"===e)return t?Bd:Od;if("elu"===e)return t?Ld:Ad;if("relu6"===e)return t?Ud:Md;if("prelu"===e)return t?ah:rh;if("leakyrelu"===e)return t?th:eh;if("sigmoid"===e)return t?Vd:Dd;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var lh=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];l(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=Rl(this.outputShape.length);var p=a?t[1]:t[2],d=Math.ceil(p/2),h=a?"i * 2, rc.y":"rc.y, i * 2",f=o?"rc.z, i * 2":"i * 2, rc.z",m=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],v="",y="";s&&(v=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),y="result = activation(result);");var b=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var x="rc.x",w="rc.x";t[0]<n[0]?x="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(w="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(v,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(d,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(d,"; i++) {\n          int batchA = ").concat(x,";\n          int batchB = ").concat(w,";\n          vec4 a = getMatrixA(batchA, ").concat(h,");\n          vec4 b = getMatrixB(batchB, ").concat(f,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(m[0]," * ").concat(g[0],");\n          result += (").concat(m[1]," * ").concat(g[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(y,"\n\n        setOutput(result);\n      }\n    ")})),ph="return areal * breal - aimag * bimag;",dh="return areal * bimag + aimag * breal;",hh=p((function e(t,n,r){l(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=mi(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),fh="return a * b;";function mh(e){var t,n=e.inputs,r=e.backend,a=n.a,o=n.b,i=Rr(a.dtype,o.dtype);if("complex64"===a.dtype){var u=r.texData.get(a.dataId),c=r.texData.get(o.dataId),l=new hh(ph,a.shape,o.shape),p=new hh(dh,a.shape,o.shape),d=[{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:a.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:c.complexTensorInfos.real.dataId,dtype:c.complexTensorInfos.real.dtype,shape:o.shape},{dataId:c.complexTensorInfos.imag.dataId,dtype:c.complexTensorInfos.imag.dtype,shape:o.shape}],h=r.runWebGLProgram(l,d,"float32"),f=r.runWebGLProgram(p,d,"float32"),m=Zd({inputs:{real:h,imag:f},backend:r});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),m}if(r.shouldExecuteOnCPU([a,o])){var g=r.texData.get(a.dataId),v=r.texData.get(o.dataId),y=Kp(a.shape,o.shape,g.values,v.values,i),b=s(y,2),x=b[0],w=b[1],k=r.makeTensorInfo(w,i);return r.texData.get(k.dataId).values=x,k}return t=Ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yd(fh,a.shape,o.shape):new Xd(fh,a.shape,o.shape),r.runWebGLProgram(t,[a,o],i)}var gh={kernelName:gt,backendName:"webgl",kernelFunc:mh};function vh(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,s=n,u=Y(a.shape),c=te(i,u),l=Y(c);H(u===l,(function(){return"The new shape (".concat(c,") has ").concat(l," elements and the old shape (").concat(a.shape,") has ").concat(u," elements. The new shape and old shape must have the same number of elements.")}));var p=s.texData.get(a.dataId);return!p.isPacked||rl(a.shape,c)||null!==p.texture&&rl(p.shape,c)?(s.incRef(a.dataId),{dataId:a.dataId,shape:c,dtype:a.dtype}):function(e,t,n){var r=[$c(e.shape)].concat(o(el(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[$c(t)].concat(o(el(t))),s=new kd(i,r),u=[r],c=n.runWebGLProgram(s,[a],e.dtype,u,!0);return{dataId:c.dataId,shape:t,dtype:c.dtype}}(a,c,s)}var yh={kernelName:Et,backendName:"webgl",kernelFunc:vh},bh=p((function e(t,n){l(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,o=t.inSize,i=t.outSize;this.outputShape=[a,i];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var p=1/n;c="sumValue += dot(values * ".concat(J(p)?p.toPrecision(2):p,", ones);")}var d="";o%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),xh=p((function e(t,n){l(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,o=t.inSize,i=t.outSize;this.outputShape=[a,i];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var p=4*Math.floor(r/4),d=r%4,h="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),f="vec4";"all"===n?(s="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===n&&(s="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var m="";o%r>0&&(m="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(m,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(p,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(h,"\n        }\n\n        int inIdx = inOffset + ").concat(p,";\n        if (").concat(1===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(2===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(h,"\n        } else if (").concat(3===d,") {\n          ").concat(f," values = ").concat(f,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(h,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function wh(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Wu(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),o=e,i=0;i<a.length;i++){var s,u,c=a[i],l=c.inSize,p=c.windowSize,d=c.outSize;s="mean"===n?0===i?new bh({windowSize:p,inSize:l,batchSize:e.shape[0],outSize:d},l):new bh({windowSize:p,inSize:l,batchSize:e.shape[0],outSize:d}):new xh({windowSize:p,inSize:l,batchSize:e.shape[0],outSize:d},n),u=o,o=r.runWebGLProgram(s,[o],t),u.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(u)}return o}var kh=p((function e(t,n){l(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var o=Il(this.rank),i=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(o," resRC = getOutputCoords();\n      setOutput(getA(").concat(i,"));\n    }\n    ")})),Ih=p((function e(t,n){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var o=Il(this.rank),i=bd("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=i[u];var c="vec2(".concat(s.slice(-2).join(),")"),p="++".concat(i[this.rank-1]," < ").concat(r[this.rank-1]),d="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(o," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(d,";\n      if(").concat(p,") {\n        result[1] = ").concat(d,";\n      }\n      --").concat(i[this.rank-1],";\n      if(++").concat(i[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(d,";\n        if(").concat(p,") {\n          result[3] = ").concat(d,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function Sh(e,t,n){var r=Ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Ih(e.shape,t):new kh(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function Th(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,o=e.shape.length,i=ne(a,e.shape),u=i,c=Is(u,o),l=null!=c,p=e;l&&(p=Sh(e,c,r),u=Ts(u.length,o)),ks("sum",u,o);var d=xs(p.shape,u),h=s(d,2),f=h[0],m=h[1],g=f;n&&(g=ws(f,i));var v=Y(m),y=vh({inputs:{x:p},attrs:{shape:[Y(e.shape)/v,v]},backend:r}),b=wh(y,Ar(e.dtype),"sum",r),x=vh({inputs:{x:b},attrs:{shape:g},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b),l&&r.disposeIntermediateTensorInfo(p),x}(t.x,r.axis,r.keepDims,n)}var _h={kernelName:Vt,backendName:"webgl",kernelFunc:Th};function Ch(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=a.perm,s=r,u=o.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=o.shape[i[l]];if(s.shouldExecuteOnCPU([o])){var p=s.texData.get(o.dataId).values,d=vd(p,o.shape,o.dtype,i,c);t=s.makeTensorInfo(c,o.dtype),s.texData.get(t.dataId).values=d}else t=Sh(o,i,s);return t}var Nh={kernelName:nn,backendName:"webgl",kernelFunc:Ch};function Eh(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,o=e.backend,i=e.bias,s=void 0===i?null:i,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,d=e.activation,h=void 0===d?null:d,f=t.shape.length,m=n.shape.length,g=r?t.shape[f-2]:t.shape[f-1],v=a?n.shape[m-1]:n.shape[m-2],y=r?t.shape[f-1]:t.shape[f-2],b=a?n.shape[m-2]:n.shape[m-1],x=t.shape.slice(0,-2),w=n.shape.slice(0,-2),k=Y(x),I=Y(w),S=mi(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);H(g===v,(function(){return"Error in matMul: inner shapes (".concat(g,") and (").concat(v,") of Tensors with shapes ").concat(t.shape," and ").concat(n.shape," and transposeA=").concat(r," and transposeB=").concat(a," must match.")}));var T,_=r?[k,g,y]:[k,y,g],C=a?[I,b,v]:[I,v,b],N=vh({inputs:{x:t},backend:o,attrs:{shape:_}}),E=vh({inputs:{x:n},backend:o,attrs:{shape:C}}),R=[N,E],A=Math.max(k,I),O=r?N.shape[1]:N.shape[2],M=null!=s,F=null!=c,D="leakyrelu"===h,P=null!=h?ch(h,!0):null;if((1===y||1===b)&&O>1e3&&!1===(M||F||D||null!=P)){var L=N,B=E;r&&(L=Ch({inputs:{x:N},backend:o,attrs:{perm:[0,2,1]}}),R.push(L)),a&&(B=Ch({inputs:{x:E},backend:o,attrs:{perm:[0,2,1]}}),R.push(B));var U=1===b,V=L;1!==b&&(V=vh({inputs:{x:L},backend:o,attrs:{shape:[A,O,1]}}),R.push(V));var W=1===b?2:1,z=B;U&&(z=vh({inputs:{x:B},backend:o,attrs:{shape:[A,1,O]}}),R.push(z));var G=mh({inputs:{a:V,b:z},backend:o});T=Th({inputs:{x:G},backend:o,attrs:{axis:W,keepDims:!0}}),R.push(G)}else{var j=Rr(t.dtype,n.dtype),q=new lh(_,C,[A,y,b],r,a,M,P,F,D),X=[N,E];if(null!=s&&X.push(s),F&&X.push(c),D){var K=o.makeTensorInfo([],"float32",ur(p,"float32"));X.push(K),R.push(K)}T=o.runWebGLProgram(q,X,j)}var Q=vh({inputs:{x:T},backend:o,attrs:{shape:S}});R.push(T);for(var J=0,Z=R;J<Z.length;J++){var $=Z[J];o.disposeIntermediateTensorInfo($)}return Q}var Rh={kernelName:cn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,i=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return Eh({a:a,b:o,transposeA:u,transposeB:c,backend:n,bias:i,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},Ah="return abs(x);",Oh={kernelName:"Abs",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var o=r.texData.get(a.dataId),i=ad(o.values);return r.makeTensorInfo(a.shape,a.dtype,i)}return t=Ie().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Wd(a.shape,Ah):new Cd(a.shape,Ah),r.runWebGLProgram(t,[a],a.dtype)}},Mh={kernelName:"Acos",backendName:"webgl",kernelFunc:sh({opSnippet:Nd+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},Fh={kernelName:"Acosh",backendName:"webgl",kernelFunc:sh({opSnippet:Nd+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},Dh="return a + b;",Ph=uh({opSnippet:Dh,packedOpSnippet:Dh,supportsComplex:!0,cpuKernelImpl:Cp}),Lh={kernelName:Ne,backendName:"webgl",kernelFunc:Ph},Bh=p((function e(t,n){l(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),Uh=p((function e(t,n){l(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),Vh={kernelName:Ee,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return Qd({inputs:{x:a[0]},backend:r});if(a.length>Ie().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(a.length/2),i=e({inputs:a.slice(0,o),backend:r}),s=e({inputs:a.slice(o),backend:r});return e({inputs:[i,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Rr(e,t)})),c=a.map((function(e){return e.shape})),l=Ie().getBool("WEBGL_PACK")?new Uh(a[0].shape,c):new Bh(a[0].shape,c);return r.runWebGLProgram(l,a,u)}},Wh={kernelName:"All",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.keepDims,u=a.shape.length,c=ne(o,a.shape),l=c,p=Is(l,u),d=a;null!=p&&(d=Ch({inputs:{x:a},backend:n,attrs:{perm:p}}),l=Ts(l.length,u)),ks("all",l,u);var h,f=xs(d.shape,l),m=s(f,2),g=m[0],v=vh({inputs:{x:d},backend:n,attrs:{shape:[-1,Y(m[1])]}}),y=wh(v,v.dtype,"all",n);return h=vh(i?{inputs:{x:y},backend:n,attrs:{shape:ws(g,c)}}:{inputs:{x:y},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),null!=p&&n.disposeIntermediateTensorInfo(d),h}},zh={kernelName:"Any",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.keepDims,u=a.shape.length,c=ne(o,a.shape),l=c,p=Is(l,u),d=a;null!=p&&(d=Ch({inputs:{x:a},backend:n,attrs:{perm:p}}),l=Ts(l.length,u)),ks("any",l,u);var h,f=xs(d.shape,l),m=s(f,2),g=m[0],v=vh({inputs:{x:d},backend:n,attrs:{shape:[-1,Y(m[1])]}}),y=wh(v,v.dtype,"any",n);return h=vh(i?{inputs:{x:y},backend:n,attrs:{shape:ws(g,c)}}:{inputs:{x:y},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),null!=p&&n.disposeIntermediateTensorInfo(d),h}},Gh=p((function e(t,n,r){l(this,e),this.variableNames=["A"];var a=t.windowSize,o=t.batchSize,i=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),jh=p((function e(t,n,r,a){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,H(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var o=t[t.length-1],i=Math.ceil(o/n);this.outputShape=t.slice(0,-1),i>1&&this.outputShape.push(i),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,p=c.length,d=Il(p),h=xd("coords",p);if(1===i){var f=Il(u=p+1);s="\n        ".concat(f," sourceLocR = ").concat(f,"(").concat(h.join(),", 0);\n        ++").concat(h[p-1],";\n        ").concat(f," sourceLocG = ").concat(f,"(").concat(h.join(),", 0);\n        ++").concat(h[p-2],";\n        ").concat(f," sourceLocA = ").concat(f,"(").concat(h.join(),", 0);\n        --").concat(h[p-1],";\n        ").concat(f," sourceLocB = ").concat(f,"(").concat(h.join(),", 0);\n        --").concat(h[p-2],";")}else u=p,s="\n        ".concat(d," sourceLocR = coords;\n        ++").concat(h[p-1],";\n        ").concat(d," sourceLocG = coords;\n        ++").concat(h[p-2],";\n        ").concat(d," sourceLocA = coords;\n        --").concat(h[p-1],";\n        ").concat(d," sourceLocB = coords;\n        --").concat(h[p-2],";");var m=["x","y","z","w","u","v"].slice(0,u),g="."+m[u-1],v=m.map((function(e){return"int "+e})),y=xd("sourceLocR",u-1).concat("inIdx.r"),b=xd("sourceLocG",u-1).concat("inIdx.g"),x=xd("sourceLocB",u-1).concat("inIdx.b"),w=xd("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",I=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),"),\n                             getBestIndicesAChannel(").concat(w.join(),")));"),S="vec4(\n            getAChannel(".concat(y.join(),"),\n            hasNextCol ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(x.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(w.join(),") : 0.)"),T=a?"":"\n      float getBestIndicesAChannel(".concat(v.join(),") {\n        return getChannel(getBestIndicesA(").concat(m.join(),"),\n                                          vec2(").concat(m.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(v.join(),") {\n        return getChannel(getA(").concat(m.join(),"),\n                               vec2(").concat(m.slice(-2).join(),"));\n      }\n      ").concat(T,"\n      void main() {\n        ").concat(d," coords = getOutputCoords();\n        bool hasNextCol = ").concat(h[p-1]," < ").concat(c[p-1]-1,";\n        bool hasNextRow = ").concat(h[p-2]," < ").concat(c[p-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(g,", sourceLocG").concat(g,",\n          sourceLocB").concat(g,", sourceLocA").concat(g,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(S,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(I,"\n          vec4 candidate = ").concat(S,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function Hh(e,t,n,r){var a=[n];if(ks("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!Ie().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var o=[],i=e.texData.get(t.dataId),u=t;null!==i&&i.isPacked&&(u=e.unpackTensor(t),o.push(u));var c=xs(u.shape,a),l=s(c,2),p=l[0],d=Y(l[1]),h=vh({inputs:{x:u},backend:e,attrs:{shape:[-1,d]}});o.push(h);var f=function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=n.shape[0],i=n.shape[1];null!=a&&(o=a.shape[0],i=a.shape[1]);var s=Wu(i),u={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},c=new Gh(u,r,null==a),l=[n];null!=a&&l.push(a);var p=t.runWebGLProgram(c,l,"int32");if(1===p.shape[1])return p;var d=e(t,n,r,p);return t.disposeIntermediateTensorInfo(p),d}(e,h,r);o.push(f);var m=vh({inputs:{x:f},backend:e,attrs:{shape:p}});return o.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),m}return function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=null!=a?a.shape:n.shape,i=Wu(o[o.length-1]),s=new jh(o,i,r,null==a),u=null==a?[n]:[n,a],c=t.runWebGLProgram(s,u,"int32");if(c.shape.length===n.shape.length){var l=e(t,n,r,c);return t.disposeIntermediateTensorInfo(c),l}return c}(e,t,r)}var qh={kernelName:Re,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=ne(r.axis,a.shape),i=Is(o,a.shape.length),s=a,u=[];null!=i&&(s=Ch({inputs:{x:a},backend:n,attrs:{perm:i}}),u.push(s),o=Ts(o.length,s.shape.length)),ks("argMax",[o[0]],s.shape.length);var c=Hh(n,s,o[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},Xh={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=ne(r.axis,a.shape),i=Is(o,a.shape.length),s=a,u=[];null!=i&&(s=Ch({inputs:{x:a},backend:n,attrs:{perm:i}}),u.push(s),o=Ts(o.length,s.shape.length)),ks("argMin",[o[0]],s.shape.length);var c=Hh(n,s,o[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},Kh={kernelName:"Asin",backendName:"webgl",kernelFunc:sh({opSnippet:Nd+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},Yh={kernelName:"Asinh",backendName:"webgl",kernelFunc:sh({opSnippet:Nd+"return log(x + sqrt(x * x + 1.0));"})},Qh={kernelName:"Atan",backendName:"webgl",kernelFunc:sh({opSnippet:Nd+"\n  return atan(x);\n"})},Jh={kernelName:"Atan2",backendName:"webgl",kernelFunc:uh({opSnippet:qd+"\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+Kd+"\n  return result;\n"})},Zh={kernelName:"Atanh",backendName:"webgl",kernelFunc:sh({opSnippet:Nd+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})},$h=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(l(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var i=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,p=t.dilationWidth,d=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.top,m=t.padInfo.left;this.outputShape=t.outShape;var g="avg"===n,v="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="0.0";if(g||(b="-1.0 / 1e-20"),r){var x=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(f,", ").concat(m,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(h,";\n                wC += ").concat(p,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(x," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?o?v:y:"wR * ".concat(h," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(w="avgValue / count");var k=4*Math.floor(i/4),I=i%4,S="\n      if (".concat(g,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(f,", ").concat(m,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(d,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(k,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(p,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(p,", d),\n              getValue(batch, xR, xC + 2 * ").concat(p,", d),\n              getValue(batch, xR, xC + 3 * ").concat(p,", d)\n            );\n\n            ").concat(S,"\n          }\n\n          int xC = xCCorner + ").concat(k,";\n          if (").concat(1===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(2===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(p,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(3===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(p,", d),\n              getValue(batch, xR, xC + 2 * ").concat(p,", d),\n              initializationValue\n            );\n\n            ").concat(S,"\n          }\n        }\n        setOutput(").concat(w,");\n      }\n    ")}})),ef=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(l(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var i=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,p=t.dilationDepth,d=t.dilationHeight,h=t.dilationWidth,f=t.effectiveFilterDepth,m=t.effectiveFilterHeight,g=t.effectiveFilterWidth,v=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;var x="avg"===n,w="0.0";if(x||(w="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(v,", ").concat(y,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(f,";\n              wD += ").concat(p,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(m,";\n                wR += ").concat(d,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(g,";\n                  wC += ").concat(h,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?o?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(m," * ").concat(g," +\n                      wR * ").concat(g," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var I="".concat(n,"(").concat(n,"(").concat(n,"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])");"avg"===n&&(I="avgValue / count");var S=4*Math.floor(i/4),T=i%4,_="\n      if (".concat(x,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(v,", ").concat(y,", ").concat(b,");\n      const float initializationValue = ").concat(w,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(w,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(f,";\n            wD += ").concat(p,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(m,";\n            wR += ").concat(d,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(h,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(h,", ch)\n              );\n\n              ").concat(_,"\n            }\n\n            int xC = xCCorner + ").concat(S,";\n            if (").concat(1===T,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(2===T,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(_,"\n            } else if (").concat(3===T,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(h,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(h,", ch),\n                initializationValue\n              );\n\n              ").concat(_,"\n            }\n          }\n          setOutput(").concat(I,");\n        }\n      }\n    ")}})),tf={kernelName:Ae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;sl(a,"avgPool");var o=r.filterSize,i=r.strides,s=r.pad,u=r.dimRoundingMode;H(es(i,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '1'")}));var c=ji(a.shape,o,i,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Q(c.inShape,c.outShape))return Qd({inputs:{x:a},backend:n});var l=new $h(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}},nf={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,i=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Hi(a.shape,o,i,[1,1,1],s,u,c),p=new ef(l,"avg",!1);return n.runWebGLProgram(p,[a],"float32")}},rf=p((function e(t){l(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,o=t.strideWidth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,p=u-1-t.padInfo.top,d=c-1-t.padInfo.left,h=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(p,", ").concat(d,");\n      const float avgMultiplier = float(").concat(h,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(i,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),af=p((function e(t){l(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,o=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,p=t.dilationWidth,d=t.effectiveFilterDepth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=d-1-t.padInfo.front,g=h-1-t.padInfo.top,v=f-1-t.padInfo.left,y=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(m,", ").concat(g,", ").concat(v,");\n      const float avgMultiplier = float(").concat(y,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(o,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(p,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),of={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Hi(o.shape,i,s,[1,1,1],u,c),p=new af(l);return n.runWebGLProgram(p,[a],o.dtype)}},sf={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=o;sl([a,o],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=ji(i.shape,s,u,1,c),p=new rf(l);return n.runWebGLProgram(p,[a],i.dtype)}},uf={kernelName:Oe,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return Eh({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},cf=p((function e(t,n,r,a,o,i){l(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],mi(t,n),mi(t,r);var s="0.0";null!=a&&(mi(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=o&&(mi(t,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(i,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),lf=p((function e(t,n,r,a,o,i){l(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],mi(t,n),mi(t,r);var s="vec4(0.0)";null!=a&&(mi(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=o&&(mi(t,o),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(i,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),pf={kernelName:et,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.mean,i=t.variance,s=t.offset,u=t.scale;H(o.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),H(null==s||o.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),H(null==u||o.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,o,i],p=null;null!=s&&(p=s.shape,l.push(s));var d=null;null!=u&&(d=u.shape,l.push(u));var h=Ie().getBool("WEBGL_PACK_NORMALIZATION")?new lf(a.shape,o.shape,i.shape,p,d,c):new cf(a.shape,o.shape,i.shape,p,d,c);return n.runWebGLProgram(h,l,l[0].dtype)}},df=p((function e(t){l(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=Il(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return hf.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),o=t.map((function(e,t){return"sourceLoc.".concat(hf[t]," = start[").concat(t,"] + coords.").concat(hf[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(o.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),hf=["x","y","z","w","u","v"],ff=p((function e(t){l(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=Il(this.rank),r=xd("coords",this.rank),a=xd("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),i="getChannel(getSource(".concat(a.join(),"), ").concat(o,")"),s="\n      result.x = ".concat(i,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(i,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(i,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(i,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function mf(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=Fi(a,r.begin,r.size),i=s(o,2),u=i[0],c=i[1];if(ki(a,u,c),0===Y(c))return n.makeTensorInfo(c,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var l=n.texData.get(a.dataId),p=od(l.values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,p)}var d=n.texData.get(a.dataId).isPacked,h=Oi(a.shape,u,c);if(d||!h){var f=Ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ff(c):new df(c),m=[u];return n.runWebGLProgram(f,[a],a.dtype,m)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),o=r.makeTensorInfo(n,e.dtype),i=r.texData.get(o.dataId);Object.assign(i,a),i.refCount=1,i.shape=n,i.dtype=e.dtype;var s=Mi(t,de(e.shape));a.slice&&(s+=a.slice.flatOffset),i.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(i.slice.origDataId)||1;return r.dataRefCount.set(i.slice.origDataId,u+1),o}(a,u,c,n)}var gf={kernelName:Lt,backendName:"webgl",kernelFunc:mf},vf={kernelName:Me,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,i=r.crops;H(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=o.reduce((function(e,t){return e*t})),u=Gu(a.shape,o,s),c=ju(u.length,o.length),l=Hu(a.shape,o,s),p=qu(i,o.length),d=Xu(l,i,o.length),h=[],f=vh({inputs:{x:a},backend:n,attrs:{shape:u}}),m=Ch({inputs:{x:f},backend:n,attrs:{perm:c}}),g=vh({inputs:{x:m},backend:n,attrs:{shape:l}}),v=mf({inputs:{x:g},backend:n,attrs:{begin:p,size:d}});return h.push(f),h.push(m),h.push(g),h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},yf={kernelName:Fe,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,i=r.size,s=n.readSync(a.dataId),u=n.readSync(o.dataId),c=Np(s,u,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}},bf={kernelName:"BroadcastArgs",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,o=n.readSync(r.dataId),i=n.readSync(a.dataId),s=mi(Array.from(o),Array.from(i));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},xf=uh({opSnippet:"return float(a != b);",cpuKernelImpl:Qp,dtype:"bool"}),wf={kernelName:vt,backendName:"webgl",kernelFunc:xf};function kf(e){var t=e.inputs,n=e.backend,r=t.input;return Qd({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var If={kernelName:"Real",backendName:"webgl",kernelFunc:kf},Sf={kernelName:De,backendName:"webgl",kernelFunc:function e(t){var n,r,a=t.inputs,o=t.backend,i=t.attrs,u=a.x,c=i.dtype;if("complex64"===c){if("complex64"===u.dtype)return Qd({inputs:{x:u},backend:o});var l=Bs(u.shape),p=e({inputs:{x:u},backend:o,attrs:{dtype:"float32"}}),d=Zd({inputs:{real:p,imag:l},backend:o});return l.dispose(),o.disposeIntermediateTensorInfo(p),d}if("complex64"===u.dtype){var h=kf({inputs:{input:u},backend:o}),f=e({inputs:{x:h},backend:o,attrs:{dtype:c}});return o.disposeIntermediateTensorInfo(h),f}if(n=u.dtype,"complex64"===(r=c)||"float32"===r&&"complex64"!==n||"int32"===r&&"float32"!==n&&"complex64"!==n||"bool"===r&&"bool"===n){var m=Qd({inputs:{x:u},backend:o});return{dataId:m.dataId,shape:m.shape,dtype:c}}if(o.shouldExecuteOnCPU([u])){var g=o.texData.get(u.dataId).values,v=Rp(g,u.shape,u.dtype,c),y=s(v,3),b=y[0],x=y[1],w=y[2];return o.makeTensorInfo(b,x,w)}if("int32"===c)return function(e,t){var n=new Cd(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(u,o);if("bool"===c){var k=o.makeTensorInfo([],"bool",ae("bool",1)),I=xf({inputs:{a:u,b:k},backend:o});return o.disposeIntermediateTensorInfo(k),I}throw new Error("Error in Cast: failed to cast ".concat(u.dtype," to ").concat(c))}},Tf="return ceil(x);",_f={kernelName:"Ceil",backendName:"webgl",kernelFunc:sh({opSnippet:Tf,packedOpSnippet:Tf,cpuKernelImpl:Ap})},Cf=p((function e(t){l(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),Nf=p((function e(t){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "})),Ef={kernelName:Pe,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=a.clipValueMin,s=a.clipValueMax;t=Ie().getBool("WEBGL_PACK_CLIP")?new Nf(o.shape):new Cf(o.shape);var u=[[i],[s]];return r.runWebGLProgram(t,[o],o.dtype,u)}},Rf=p((function e(t){l(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function Af(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var Of={kernelName:"ComplexAbs",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),o=new Rf(r.shape),i=[Af(r,a.complexTensorInfos.real),Af(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}},Mf=p((function e(t){l(this,e),this.outputShape=[],this.outputShape=Pu(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],o=1;o<n.length;o++){var i=n[o-1];a.push("else if (yC < ".concat(n[o],") setOutput(getT").concat(o,"(yR, yC-").concat(i,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),Ff=p((function e(t,n){l(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Pu(t,n);var r=this.outputShape,a=r.length,o=Il(a),i=xd("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var p=s[n],d=s.slice(-2),h=s.join(),f="if (".concat(p," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(h,"), vec2(").concat(d.join(),"));\n        }"),m=1;m<u.length;m++){var g=u[m-1];f+="\n        if (".concat(p," < ").concat(u[m],"  && ").concat(p," >= ").concat(u[m-1],") {\n          return getChannel(\n            getT").concat(m,"(").concat(Df(s,p,g),"),\n            vec2(").concat(Df(d,p,g),"));\n        }")}var v=u.length,y=u[u.length-1];f+="\n        return getChannel(\n          getT".concat(v,"(").concat(Df(s,p,y),"),\n          vec2(").concat(Df(d,p,y),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(f,"\n      }\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(i,"), 0., 0., 0.);\n\n        ").concat(i[a-1]," = ").concat(i[a-1]," + 1;\n        if (").concat(i[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(i,");\n        }\n\n        ").concat(i[a-2]," = ").concat(i[a-2]," + 1;\n        if (").concat(i[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(i,");\n        }\n\n        ").concat(i[a-1]," = ").concat(i[a-1]," - 1;\n        if (").concat(i[a-2]," < ").concat(r[a-2]," &&\n            ").concat(i[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(i,");\n        }\n        setOutput(result);\n      }\n    ")}));function Df(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function Pf(e){var t=e.inputs,n=e.backend,r=t.input;return Qd({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var Lf={kernelName:"Imag",backendName:"webgl",kernelFunc:Pf};function Bf(e){var t=e.inputs,n=e.backend,r=ne(e.attrs.axis,t[0].shape)[0];Du(t.map((function(e){return e.shape})),r);var a=Pu(t.map((function(e){return e.shape})),r);if(0===Y(a))return n.makeTensorInfo(a,t[0].dtype,[]);var o=t.filter((function(e){return Y(e.shape)>0}));return 1===o.length?Qd({inputs:{x:o[0]},backend:n}):function e(t,n,r){var a=t[0].dtype;if("complex64"===a){var o=t.map((function(e){return kf({inputs:{input:e},backend:r})})),i=t.map((function(e){return Pf({inputs:{input:e},backend:r})})),s=e(o,n,r),u=e(i,n,r),c=Zd({inputs:{real:s,imag:u},backend:r});return o.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}var l=r.shouldExecuteOnCPU(t);if("string"===a&&(l=!0),l){var p=t.map((function(e){var t=Y(e.shape.slice(n));return vh({inputs:{x:e},backend:r,attrs:{shape:[-1,t]}})})),d=p.map((function(e){return{vals:r.readSync(e.dataId),shape:e.shape}})),h=Pu(p.map((function(e){return e.shape})),1),f=1===p[0].shape[0],m=Op(d,h,a,f),g=Pu(t.map((function(e){return e.shape})),n),v=r.makeTensorInfo(g,a,m);return p.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),v}var y=Ie().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(t.length>y){for(var b=[],x=0;x<t.length;x+=y){var w=t.slice(x,x+y);b.push(e(w,n,r))}for(var k=e(b,n,r),I=0,S=b;I<S.length;I++){var T=S[I];r.disposeIntermediateTensorInfo(T)}return k}if(Ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){var _=new Ff(t.map((function(e){return e.shape})),n);return r.runWebGLProgram(_,t,a)}var C=function(e,t,n){var r=Pu(e.map((function(e){return e.shape})),t);return{tensors2D:e.map((function(e){return vh({inputs:{x:e},attrs:{shape:[-1,Y(e.shape.slice(t))]},backend:n})})),outShape:r}}(t,n,r),N=C.tensors2D,E=C.outShape,R=new Mf(N.map((function(e){return e.shape}))),A=r.runWebGLProgram(R,N,a);N.forEach((function(e){return r.disposeIntermediateTensorInfo(e)}));var O=vh({inputs:{x:A},attrs:{shape:E},backend:r});return r.disposeIntermediateTensorInfo(A),O}(o,r,n)}var Uf={kernelName:Be,backendName:"webgl",kernelFunc:Bf},Vf=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];l(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,p=t.dilationHeight,d=t.dilationWidth,h=t.filterHeight,f=t.filterWidth,m=4*Math.floor(t.inChannels/4),g=t.inChannels%4,v="channelsLast"===t.dataFormat,y=v?1:2,b=v?2:3,x=v?3:1,w="",k="";r&&(w=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):o?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var I=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(w,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(i,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(x,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(y,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(h,"; wR++) {\n          int xR = xRCorner + wR * ").concat(p,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(f,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(m,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(v,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===g,") {\n\n              if (").concat(v,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(m,") *\n                    getW(wR, wC, ").concat(m,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(m,", xR, xC) *\n                    getW(wR, wC, ").concat(m,", d2);\n              }\n\n            } else if (").concat(2===g,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(m,", d2),\n                getW(wR, wC, ").concat(m," + 1, d2)\n              );\n\n              if (").concat(v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(m,"),\n                  getX(batch, xR, xC, ").concat(m," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(m,", xR, xC),\n                  getX(batch, ").concat(m," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===g,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(m,", d2),\n                getW(wR, wC, ").concat(m," + 1, d2),\n                getW(wR, wC, ").concat(m," + 2, d2)\n              );\n\n              if (").concat(v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(m,"),\n                  getX(batch, xR, xC, ").concat(m," + 1),\n                  getX(batch, xR, xC, ").concat(m," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(m,", xR, xC),\n                  getX(batch, ").concat(m," + 1, xR, xC),\n                  getX(batch, ").concat(m," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(I,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),Wf=p((function e(t){l(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,o=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,p=t.dilationWidth,d=t.filterDepth,h=t.filterHeight,f=t.filterWidth,m=4*Math.floor(t.inChannels/4),g=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(o,", ").concat(i,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(d,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(h,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,"; wC++) {\n              int xC = xCCorner + wC * ").concat(p,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(m,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===g,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(m,") *\n                  getW(wF, wR, wC, ").concat(m,", d2);\n              } else if (").concat(2===g,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(m,"),\n                  getX(batch, xF, xR, xC, ").concat(m," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(m,", d2),\n                  getW(wF, wR, wC, ").concat(m," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===g,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(m,"),\n                  getX(batch, xF, xR, xC, ").concat(m," + 1),\n                  getX(batch, xF, xR, xC, ").concat(m," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(m,", d2),\n                  getW(wF, wR, wC, ").concat(m," + 1, d2),\n                  getW(wF, wR, wC, ").concat(m," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),zf=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];l(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Rl(this.outputShape.length);for(var i=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,p=t.filterWidth,d=p,h="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",f=0;f<p;f++)h+="\n           vec4 xTexelC".concat(2*f,";\n           int xTexelC").concat(2*f,"Ready;\n           vec4 xTexelC").concat(2*f+1,";\n           int xTexelC").concat(2*f+1,"Ready;\n           vec4 xC").concat(f,";");h+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var m=0;m<p;m++)h+="\n           xTexelC".concat(2*m," = vec4(0.0);\n           xTexelC").concat(2*m,"Ready = 0;\n           xTexelC").concat(2*m+1," = vec4(0.0);\n           xTexelC").concat(2*m+1,"Ready = 0;\n           xC").concat(m," = vec4(0.0);");h+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var g=0;g<(d+1)/2;g++){var v=2*g;if(h+="\n           xC = xCCorner + ".concat(v*u,";\n           "),1===s){if(v<p&&(i%2==1?(h+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n               "),h+=1===u&&v>0?"\n                 xC".concat(v," = vec4(xTexelC").concat(v-2,".zw, xTexelC").concat(v,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(v," = vec4(previous.zw, xTexelC").concat(v,".xy);\n                   } else {\n                     xC").concat(v," = vec4(0.0, 0.0, xTexelC").concat(v,".xy);\n                   }\n                   ")):h+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xC").concat(v," = xTexelC").concat(v,";\n                 "),v+1<p)){var y=i%2==0?G(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(h+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                     xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(v+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(v+1,"Ready = 1;\n                   }\n                   "),h+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(v+1," = vec4(previous.zw, xTexelC").concat(v+1,".xy);\n                     } else {\n                      xC").concat(v+1," = vec4(0.0, 0.0, xTexelC").concat(v+1,".xy);\n                     }\n                     "):"\n                     xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".xy);\n                     ")):h+=1===y?"\n                     xC".concat(v+1," = xTexelC").concat(v,";\n                     "):"\n                     xCOffset = xC + ".concat(y,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                       xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(v+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(v+1,"Ready = 1;\n                     }\n\n                     xC").concat(v+1," = xTexelC").concat(v+1,";\n                     ")}}else v<p&&(i%2==1?(h+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n               "),v+1<p&&(h+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(v+1," = vec4(xTexelC").concat(v+1,".xy, final.xy);\n                 "))):(h+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(v,"Ready == 0) {\n                   xTexelC").concat(v," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(v,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(v,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(v+1,"Ready == 0) {\n                   xTexelC").concat(v+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(v+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(v+1,"Ready = 1;\n                 }\n\n                 xC").concat(v," = vec4(\n                   xTexelC").concat(v,".xy, xTexelC").concat(v+1,".xy);\n               "),v+1<p&&(h+="\n                   xC".concat(v+1," = vec4(xTexelC").concat(v,".zw, xTexelC").concat(v+1,".zw);\n                 "))));v<p&&(h+="\n             wTexel = getW(r, ".concat(v,", d1, d2);\n             dotProd += xC").concat(v,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(v,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),v+1<p&&(h+="\n               wTexel = getW(r, ".concat(v+1,", d1, d2);\n               dotProd += xC").concat(v+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(v+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}h+="\n     }\n   ",h+="\n     }\n   ",h+="\n     }\n   ";var b="",x="";r&&(b=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):o?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),x="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(b,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(h,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(w,"\n         ").concat(x,"\n         setOutput(result);\n       }\n     ")})),Gf=p((function e(t,n){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=Rl(this.outputShape.length);for(var r=n.dataFormat,a=cl(),o="channelsLast"===r,i=o?1:2,s=o?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",p=0;p<=1;p++)for(var d=0;d<=1;d++)c+="\n          blockIndex = rc.z + ".concat(d,";\n          pos = rc.y + ").concat(p,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(i,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(o,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*p+d,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*p+d,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function jf(e,t){var n=e.length;return n>=3?[].concat(o(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function Hf(e){var t,n=e.x,r=e.filter,a=e.convInfo,o=e.backend,i=e.bias,s=void 0===i?null:i,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,p=void 0===l?0:l,d=e.activation,h=void 0===d?null:d,f=n.shape,m=o.texData.get(n.dataId),g=a.inChannels,v=f[0]*f[1]*f[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[];if(null!=c){var w=jf(c.shape,b);null!=w&&(c=vh({inputs:{x:c},backend:o,attrs:{shape:w}}),x.push(c))}if(null!=s){var k=jf(s.shape,b);null!=k&&(s=vh({inputs:{x:s},backend:o,attrs:{shape:k}}),x.push(s))}if((1!==v&&1!==y||!(g>1e3))&&m.isPacked&&b&&null!=m.texture&&f[2]%2!=0&&Q(m.shape.slice(-3),f.slice(-3))){var I=f[0]*f[1]*(f[2]+1),S={dataId:n.dataId,shape:[1,I,a.inChannels],dtype:n.dtype},T=m.shape;m.shape=m.shape.slice(),m.shape[m.shape.length-2]++,H(rl(m.shape,S.shape),(function(){return"packed reshape ".concat(m.shape," to ").concat(S.shape," isn't free")}));var _=vh({inputs:{x:r},backend:o,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(_);var C=Eh({a:S,b:_,backend:o,transposeA:!1,transposeB:!1,bias:s,activation:h,preluActivationWeights:c,leakyreluAlpha:p}),N=o.texData.get(C.dataId);H(N.isPacked,(function(){return"batchMatMul result is expected to be packed"})),m.shape=T,N.shape=a.outShape,(t=Qd({inputs:{x:C},backend:o})).shape=a.outShape,x.push(C)}else{var E=a.outHeight*a.outWidth,R=vh({inputs:{x:n},backend:o,attrs:{shape:b?[a.batchSize,E,a.inChannels]:[a.batchSize,a.inChannels,E]}}),A=vh({inputs:{x:r},backend:o,attrs:{shape:[1,a.inChannels,a.outChannels]}}),O=Eh({a:b?R:A,b:b?A:R,transposeA:!b,transposeB:!1,backend:o,bias:s,activation:h,preluActivationWeights:c,leakyreluAlpha:p});t=vh({inputs:{x:O},backend:o,attrs:{shape:a.outShape}}),x.push(R),x.push(A),x.push(O)}for(var M=0,F=x;M<F.length;M++){var D=F[M];o.disposeIntermediateTensorInfo(D)}return t}function qf(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,o=e.bias,i=void 0===o?null:o,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,p=e.activation,d=void 0===p?null:p,h=r.filterWidth,f=r.filterHeight,m=r.inChannels,g=r.outWidth,v=r.outHeight,y="channelsLast"===r.dataFormat,b=h*f*m,x=v*g,w=[r.batchSize,b,x],k=[];if(null!=u){var I=jf(u.shape,y);null!=I&&(u=vh({inputs:{x:u},backend:a,attrs:{shape:I}}),k.push(u))}if(null!=i){var S=jf(i.shape,y);null!=S&&(i=vh({inputs:{x:i},backend:a,attrs:{shape:S}}),k.push(i))}var T=vh({inputs:{x:n},backend:a,attrs:{shape:[1,b,Y(n.shape)/b]}});k.push(T);var _=new Gf(w,r),C=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],N=a.runWebGLProgram(_,[t],"float32",C),E=vh({inputs:{x:N},backend:a,attrs:{shape:w}});k.push(N),k.push(E);var R=null!=i,A=null!=u,O="leakyrelu"===d,M=d?ch(d,!0):null,F=new lh(y?E.shape:T.shape,y?T.shape:E.shape,y?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],!0,!1,R,M,A,O),D=y?[E,T]:[T,E];if(i&&D.push(i),A&&D.push(u),O){var P=a.makeTensorInfo([],"float32",ur(l,"float32"));D.push(P),k.push(P)}var L=a.runWebGLProgram(F,D,"float32"),B=vh({inputs:{x:L},backend:a,attrs:{shape:r.outShape}});k.push(L);for(var U=0,V=k;U<V.length;U++){var W=V[U];a.disposeIntermediateTensorInfo(W)}return B}var Xf,Kf={kernelName:Ue,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,p=a.dimRoundingMode,d=ts(c),h=qi(o.shape,i.shape,s,l,u,p,!1,d);if(1!==h.filterHeight||1!==h.filterWidth||1!==h.dilationHeight||1!==h.dilationWidth||1!==h.strideHeight||1!==h.strideWidth||"SAME"!==h.padInfo.type&&"VALID"!==h.padInfo.type)if(h.strideWidth<=2&&"channelsLast"===d&&Ie().getBool("WEBGL_EXP_CONV")){var f=new zf(h),m=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];t=r.runWebGLProgram(f,[o,i],"float32",m)}else if(Ie().getBool("WEBGL_CONV_IM2COL"))t=qf({x:o,filter:i,convInfo:h,backend:r});else{var g=new Vf(h);t=r.runWebGLProgram(g,[o,i],"float32")}else t=Hf({x:o,filter:i,convInfo:h,backend:r});var v=vh({inputs:{x:t},backend:r,attrs:{shape:h.outShape}});return r.disposeIntermediateTensorInfo(t),v}},Yf=p((function e(t){l(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,o=t.padInfo.left,i="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(o,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(i,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Qf=p((function e(t){l(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,o=t.strideWidth,i="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=i?1:2,p=i?2:3,d=i?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(d,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(p,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(i,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Jf=p((function e(t){l(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,o=t.padInfo.front,i=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(o,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(i,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Zf=p((function e(t){l(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,o=t.strideDepth,i=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,p=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(p,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(o,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(i,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),$f={kernelName:Ve,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,i=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,p=ts(u),d=qi(a.shape,l,i,1,s,c,!1,p),h=new Yf(d);return n.runWebGLProgram(h,[a,o],"float32")}},em={kernelName:We,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,i=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=ts(c),d=qi(i,o.shape,s,1,u,l,!1,p),h=new Qf(d);return n.runWebGLProgram(h,[a,o],"float32")}},tm={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,i=r.strides,s=r.pad,u=r.dilations,c=Xi(a.shape,o.shape,i,u,s),l=new Wf(c);return n.runWebGLProgram(l,[a,o],"float32")}},nm={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,i=r.strides,s=r.pad,u=r.filterShape,c=Xi(a.shape,u,i,1,s),l=new Jf(c);return n.runWebGLProgram(l,[a,o],"float32")}},rm={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,i=r.pad,s=r.strides,u=Xi(r.inputShape,o.shape,s,1,i),c=new Zf(u);return n.runWebGLProgram(c,[a,o],"float32")}},am={kernelName:"Cos",backendName:"webgl",kernelFunc:sh({opSnippet:ih+"\n  return cos(x);\n"})},om={kernelName:"Cosh",backendName:"webgl",kernelFunc:sh({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})},im=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var i=s(t,4),u=i[0],c=i[1],p=i[2],d=i[3],h=s(n,1)[0],f=s(r,2),m=f[0],g=f[1];this.outputShape=[h,m,g,d];var v="bilinear"===a?1:0,y=c-1+".0",b=p-1+".0",x=m>1?[""+(c-1)/(m-1),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],w=s(x,3),k=w[0],I=w[1],S=w[2],T=g>1?[""+(p-1)/(g-1),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],_=s(T,3),C=_[0],N=_[1],E=_[2];this.userCode="\n      const float height_ratio = float(".concat(k,");\n      const float width_ratio = float(").concat(C,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(u,") {\n          return;\n        }\n\n        float height_scale = ").concat(I,";\n        float width_scale = ").concat(N,";\n\n        float in_y = ").concat(S,";\n        if( in_y < 0.0 || in_y > ").concat(y," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n        float in_x = ").concat(E,";\n        if( in_x < 0.0 || in_x > ").concat(b," ) {\n          setOutput(float(").concat(o,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(v," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),sm={kernelName:je,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.boxes,i=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new im(a.shape,o.shape,s,u,c);return n.runWebGLProgram(l,[a,o,i],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(Xf||(Xf={}));var um=p((function e(t,n,r,a){l(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var o=this.outputShape.length,i=this.op===Xf.Prod?"1.0":"0.0",s=r?i:"getX(".concat(cm(o,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",p="";r?(c=a?"end != "+(u-1):"end != 0",p=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",p=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(Il(o)," coords = getOutputCoords();\n        int end = ").concat(lm(o,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(p,";\n          ").concat(lm(o,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(cm(o,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function cm(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function lm(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function pm(e,t,n,r,a,o){var i=t.shape.length,s=Is([r],i),u=t;null!=s&&(u=Ch({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=Ts(1,i)[0];if(c!==i-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," but got axis=").concat(r));for(var l=u.shape[c],p=Qd({inputs:{x:u},backend:n}),d=0;d<=Math.ceil(Math.log2(l))-1;d++){var h=new um(e,u.shape,!1,o),f=[[d]],m=p;p=n.runWebGLProgram(h,[p],p.dtype,f),n.disposeIntermediateTensorInfo(m)}if(a){var g=new um(e,u.shape,a,o),v=p;p=n.runWebGLProgram(g,[p],p.dtype),n.disposeIntermediateTensorInfo(v)}if(null!=s){var y=Ch({inputs:{x:p},backend:n,attrs:{perm:Ss(s)}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(u),y}return p}var dm={kernelName:ze,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.exclusive,s=r.reverse;return pm(Xf.Prod,a,n,o,i,s)}},hm={kernelName:Ge,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.exclusive,s=r.reverse;return pm(Xf.Sum,a,n,o,i,s)}},fm={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.weights,i=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=Np(u,c,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,l)}if(2===a.shape.length){var p=n.bufferSync(a),d=n.bufferSync(o),h=Ep(p,d,i,s);return n.makeTensorInfo(h.shape,o.dtype,h.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank".concat(a.shape.length,"."))}},mm=function(){return p((function e(t,n,r){l(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}),[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}])}(),gm={kernelName:He,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockSize,i=r.dataFormat,s=a.shape[0],u=("NHWC"===i?a.shape[1]:a.shape[2])*o,c=("NHWC"===i?a.shape[2]:a.shape[3])*o,l=("NHWC"===i?a.shape[3]:a.shape[1])/(o*o),p=new mm("NHWC"===i?[s,u,c,l]:[s,l,u,c],o,i);return n.runWebGLProgram(p,[a],a.dtype)}},vm=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];l(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Rl(this.outputShape.length);var i=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",p="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):o?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),p="result = activation(result);");var d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(i,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(d,"\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")})),ym=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];l(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=Rl(this.outputShape.length);for(var i=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,p=t.filterHeight,d=t.filterWidth,h=d,f="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",m=0;m<d;m++)f+="\n          vec4 xTexelC".concat(2*m,";\n          int xTexelC").concat(2*m,"Ready;\n          vec4 xTexelC").concat(2*m+1,";\n          int xTexelC").concat(2*m+1,"Ready;\n          vec4 xC").concat(m,";");f+="\n    for (int r = 0; r < ".concat(p,"; r++) {\n      ");for(var g=0;g<d;g++)f+="\n          xTexelC".concat(2*g," = vec4(0.0);\n          xTexelC").concat(2*g,"Ready = 0;\n          xTexelC").concat(2*g+1," = vec4(0.0);\n          xTexelC").concat(2*g+1,"Ready = 0;\n          xC").concat(g," = vec4(0.0);");f+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var v=0;v<(h+1)/2;v++){var y=2*v;if(f+="\n          xC = xCCorner + ".concat(y*c,";\n          "),1===u){if(y<d&&(s%2==1?(f+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n              "),f+=1===c&&y>0?"\n                xC".concat(y," = vec4(xTexelC").concat(y-2,".zw, xTexelC").concat(y,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(y," = vec4(previous.zw, xTexelC").concat(y,".xy);\n                  } else {\n                    xC").concat(y," = vec4(0.0, 0.0, xTexelC").concat(y,".xy);\n                  }\n                  ")):f+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xC").concat(y," = xTexelC").concat(y,";\n                "),y+1<d)){var b=s%2==0?G(c):c;c%2==0&&s%2==1||c%2!=0&&s%2!=1?(f+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                    xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(y+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(y+1,"Ready = 1;\n                  }\n                  "),f+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(y+1," = vec4(previous.zw, xTexelC").concat(y+1,".xy);\n                    } else {\n                     xC").concat(y+1," = vec4(0.0, 0.0, xTexelC").concat(y+1,".xy);\n                    }\n                    "):"\n                    xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".xy);\n                    ")):f+=1===b?"\n                    xC".concat(y+1," = xTexelC").concat(y,";\n                    "):"\n                    xCOffset = xC + ".concat(b,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                      xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(y+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(y+1,"Ready = 1;\n                    }\n\n                    xC").concat(y+1," = xTexelC").concat(y+1,";\n                    ")}}else y<d&&(s%2==1?(f+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n              "),y+1<d&&(f+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(y+1," = vec4(xTexelC").concat(y+1,".xy, final.xy);\n                "))):(f+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(\n                  xTexelC").concat(y,".xy, xTexelC").concat(y+1,".xy);\n              "),y+1<d&&(f+="\n                  xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n                "))));y<d&&(f+="\n            wTexel = getW(r, ".concat(y,", d1, q);\n            dotProd += xC").concat(y," * vec4(wTexel.xz, wTexel.xz);\n          "),y+1<d&&(f+="\n              wTexel = getW(r, ".concat(y+1,", d1, q);\n              dotProd += xC").concat(y+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}f+="\n    }\n  ",f+="\n      }\n    ";var x="",w="";r&&(x=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):o?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),w="result = activation(result);");var k=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(i,";\n        int q = d2 - d1 * ").concat(i,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(f,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(k,"\n        ").concat(w,"\n        setOutput(result);\n      }\n    ")})),bm={kernelName:qe,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,i=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),H(es(i,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(l,"'")}));var p,d=qi(a.shape,o.shape,i,l,s,c,!0);p=Ie().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels==1?new ym(d):new vm(d);var h=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(p,[a,o],"float32",h)}},xm=p((function e(t){l(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,o=t.padInfo.left,i=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(i," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(o,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),wm=p((function e(t){l(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,o=t.strideWidth,i=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(i,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(o,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),km={kernelName:Xe,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.dy,i=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,p=qi(a.shape,l,i,s,u,c,!0),d=new xm(p);return n.runWebGLProgram(d,[a,o],"float32")}},Im={kernelName:Ke,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.filter,i=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=qi(r.inputShape,o.shape,i,s,u,c,!0),p=new wm(l);return n.runWebGLProgram(p,[a,o],"float32")}},Sm=p((function e(t){l(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "})),Tm={kernelName:"Diag",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(o(r.shape),o(r.shape)),i=Y(r.shape),s=vh({inputs:{x:r},backend:n,attrs:{shape:[i]}}),u=new Sm(i),c=n.runWebGLProgram(u,[s],s.dtype),l=vh({inputs:{x:c},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(c),l}},_m=p((function e(t){l(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,o=t.strideHeight,i=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,p=t.dilationWidth,d=a.top,h=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(o,", ").concat(i,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(h,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(p,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")})),Cm={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=Gi(o.shape,i.shape,s,u,"NHWC",c),p=new _m(l),d=vh({inputs:{x:t=r.runWebGLProgram(p,[o,i],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),d}},Nm={kernelName:"Einsum",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=rc(e.attrs.equation,r.length),o=a.allDims,s=a.summedDims,u=a.idDims;oc(o.length,u,r);for(var c=ic(s,u),l=c.path,p=c.steps,d=p.length,h=null,f=o.length,m=[],g=0;g<d;++g){var v,y=i(p[g]);try{for(y.s();!(v=y.n()).done;){var b=v.value,x=ac(f,u[b]),w=x.permutationIndices,k=x.expandDims,I=void 0;sc(w)?I=r[b]:(I=Ch({inputs:{x:r[b]},backend:n,attrs:{perm:w}}),m.push(I));for(var S=I.shape.slice(),T=0;T<k.length;++T)S.splice(k[T],0,1);Q(I.shape,S)||(I=vh({inputs:{x:I},backend:n,attrs:{shape:S}}),m.push(I)),null===h?h=I:(h=mh({inputs:{a:I,b:h},backend:n}),m.push(h))}}catch(e){y.e(e)}finally{y.f()}g<d-1&&(l[g]>=0&&(h=Th({inputs:{x:h},backend:n,attrs:{axis:l[g]-(o.length-f),keepDims:!1}}),m.push(h)),f--)}for(var _=0,C=m;_<C.length;_++){var N=C[_];N!==h&&n.disposeIntermediateTensorInfo(N)}return h}},Em={kernelName:"Elu",backendName:"webgl",kernelFunc:sh({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},Rm={kernelName:"EluGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,o=Ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Yd("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new Xd("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(o,[r,a],r.dtype)}},Am={kernelName:"Equal",backendName:"webgl",kernelFunc:uh({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:Mp})},Om={kernelName:"Erf",backendName:"webgl",kernelFunc:sh({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(Yu,";\n  float a1 = ").concat(Qu,";\n  float a2 = ").concat(Ju,";\n  float a3 = ").concat(Zu,";\n  float a4 = ").concat($u,";\n  float a5 = ").concat(ec,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")})},Mm=sh({opSnippet:ih+"\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:Fp,dtype:"float32"}),Fm={kernelName:"Exp",backendName:"webgl",kernelFunc:Mm};function Dm(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,o=t.input,i=o.shape.length,s=o.shape.slice(),u=a;return a<0&&(H(-(i+1)<=a,(function(){return"Axis must be in the interval [".concat(-(i+1),", ").concat(i,"]")})),u=i+a+1),s.splice(u,0,1),vh({inputs:{x:o},backend:r,attrs:{shape:s}})}var Pm={kernelName:Qe,backendName:"webgl",kernelFunc:Dm},Lm="return exp(x) - 1.0;",Bm={kernelName:"Expm1",backendName:"webgl",kernelFunc:sh({opSnippet:Lm,packedOpSnippet:Lm,cpuKernelImpl:Dp})},Um=p((function e(t,n,r){l(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var o,i=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)o="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));o="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(i,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(o,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function Vm(e,t,n){var r=n.texData.get(e.dataId),a=Y(e.shape),o=e.shape[e.shape.length-1],i=vh({inputs:{x:e},backend:n,attrs:{shape:[a/o,o]}}),s=i.shape,u=new Um("real",s,t),c=new Um("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],p=n.runWebGLProgram(u,l,"float32"),d=n.runWebGLProgram(c,l,"float32"),h=Zd({inputs:{real:p,imag:d},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d);var f=vh({inputs:{x:h},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(h),f}var Wm={kernelName:"FFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return Vm(t.input,!1,n)}},zm=p((function e(t,n){l(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function Gm(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,o=n.dtype;if("string"===(o=o||ce(a))){var i=oe(o,Y(r));return i.fill(a),t.makeTensorInfo(r,o,i)}var s=new zm(r,a),u=[[a]];return t.runWebGLProgram(s,[],o,u)}var jm,Hm={kernelName:Je,backendName:"webgl",kernelFunc:Gm},qm=p((function e(t){l(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),Xm={kernelName:Ze,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,o=new qm(r.shape);return a.runWebGLProgram(o,[r],r.dtype)}},Km="return floor(x);",Ym={kernelName:"Floor",backendName:"webgl",kernelFunc:sh({opSnippet:Km,packedOpSnippet:Km,cpuKernelImpl:Pp})},Qm=uh({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),Jm={kernelName:$e,backendName:"webgl",kernelFunc:Qm},Zm=p((function e(t){l(this,e),this.variableNames=["A"];var n=cl(),r=s(t,2),a=r[0],o=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(o,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),$m=p((function e(t){l(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=cl(),r=s(t,2),a=r[0],o=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(o,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),eg={kernelName:sn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,o=r.numChannels,i="undefined"!=typeof HTMLVideoElement&&a instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&a instanceof HTMLImageElement,c=i?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=s(c,2),p=l[0],d=l[1],h=[d,p],f=[d,p,o];if(u||i){var m=Ie().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=jm&&m===tg||(tg=m,jm=document.createElement("canvas").getContext("2d",{willReadFrequently:tg})),jm.canvas.width=p,jm.canvas.height=d,jm.drawImage(a,0,0,p,d),a=jm.canvas}var g=n.makeTensorInfo(h,"int32");n.texData.get(g.dataId).usage=Rc.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(g.dataId),a);var v=Ie().getBool("WEBGL_PACK")?new $m(f):new Zm(f),y=n.runWebGLProgram(v,[g],"int32");return n.disposeData(g.dataId),y}},tg=Ie().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU"),ng={kernelName:ln,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,p=a.dataFormat,d=a.dilations,h=a.dimRoundingMode,f=a.activation,m=a.leakyreluAlpha,g=ts(p),v=qi(o.shape,i.shape,c,d,l,h,!1,g),y=[],b=null!=s,x=null!=u,w="leakyrelu"===f,k=function(){var e=[o,i],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=vh({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,p)),x&&e.push(t(u,p)),w){var n=r.makeTensorInfo([],"float32",ur(m,"float32"));e.push(n),y.push(n)}return e};if(1!==v.filterHeight||1!==v.filterWidth||1!==v.dilationHeight||1!==v.dilationWidth||1!==v.strideHeight||1!==v.strideWidth||"SAME"!==v.padInfo.type&&"VALID"!==v.padInfo.type)if(v.strideWidth<=2&&"channelsLast"===g&&Ie().getBool("WEBGL_EXP_CONV")){var I=f?ch(f,!0):null,S=new zf(v,b,I,x,w),T=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],_=k();t=r.runWebGLProgram(S,_,"float32",T)}else if(Ie().getBool("WEBGL_CONV_IM2COL"))t=qf({x:o,filter:i,convInfo:v,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});else{var C=f?ch(f,!1):null,N=new Vf(v,b,C,x,w),E=k();t=r.runWebGLProgram(N,E,"float32")}else t=Hf({x:o,filter:i,convInfo:v,backend:r,bias:s,activation:f,preluActivationWeights:u,leakyreluAlpha:m});var R=vh({inputs:{x:t},backend:r,attrs:{shape:v.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),R}},rg={kernelName:pn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.filter,i=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,p=r.dimRoundingMode,d=r.activation,h=r.leakyreluAlpha,f=[],m=l;null==m&&(m=[1,1]),H(es(u,m),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ".concat(u," and dilations '").concat(m,"'")}));var g,v=qi(a.shape,o.shape,u,m,c,p,!0),y=Ie().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels==1,b=d?ch(d,y):null,x=[a,o],w=null!=i,k=null!=s,I="leakyrelu"===d;if(w&&x.push(i),k&&x.push(s),I){var S=n.makeTensorInfo([],"float32",ur(h,"float32"));x.push(S),f.push(S)}g=y?new ym(v,w,b,k,I):new vm(v,w,b,k,I);var T=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],_=n.runWebGLProgram(g,x,"float32",T);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),_}},ag=p((function e(t,n,r,a){l(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;for(var o=Il(r.length),i="\n    int index;",s=0;s<this.sliceDim;s++)i+="\n          index = round(getIndices(coords[0], ".concat(s,"));\n          out_of_bounds = out_of_bounds || index < 0;\n          out_of_bounds = out_of_bounds || index >= ").concat(this.paramsShape[s],";\n          flattenIndex += index * ").concat(this.strides[s],";");this.userCode="\n         void main() {\n          ".concat(o," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n\n          ").concat(i,"\n\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")})),og={kernelName:nt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,o=a.shape,i=o[o.length-1],u=Y(r.shape),c=bi(r,a),l=s(c,4),p=l[0],d=l[1],h=l[2],f=l[3],m=vh({inputs:{x:a},backend:n,attrs:{shape:[d,i]}}),g=vh({inputs:{x:r},backend:n,attrs:{shape:[Y(r.shape)/h,h]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var v=n.readSync(a.dataId),y=n.bufferSync(r),b=Lp(v,y,r.dtype,d,i,h,f,r.shape,u);return n.makeTensorInfo(p,r.dtype,b.values)}var x=new ag(i,f,[d,h],r.shape),w=n.runWebGLProgram(x,[g,m],g.dtype),k=vh({inputs:{x:w},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(w),k}},ig=p((function e(t,n){l(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=Il(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function sg(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.indices,i=r.axis,s=r.batchDims,u=ne(i,a.shape)[0];if(Ie().get("DEBUG"))for(var c=n.readSync(o.dataId),l=a.shape[u],p=function(){var e=c[d];H(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p();var h=wc(a,o,u,s),f=Y(o.shape),m=[],g=vh({inputs:{x:a},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),v=vh({inputs:{x:o},backend:n,attrs:{shape:[h.batchSize,f/h.batchSize]}});m.push(g),m.push(v);var y=[h.batchSize,h.outerSize,f/h.batchSize,h.sliceSize];if(n.shouldExecuteOnCPU([a,o])||"string"===a.dtype){var b=n.bufferSync(v),x=n.bufferSync(g),w=Bp(x,b,y);return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h.outputShape,w.dtype,w.values)}var k=new ig(g.shape,y),I=n.runWebGLProgram(k,[g,v],g.dtype);m.push(I);var S=vh({inputs:{x:I},backend:n,attrs:{shape:h.outputShape}});return m.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),S}var ug={kernelName:tt,backendName:"webgl",kernelFunc:sg},cg=uh({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:Up,dtype:"bool"}),lg={kernelName:rt,backendName:"webgl",kernelFunc:cg},pg={kernelName:at,backendName:"webgl",kernelFunc:uh({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:Vp})},dg={kernelName:"IFFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return Vm(t.input,!0,n)}},hg={kernelName:"IsFinite",backendName:"webgl",kernelFunc:sh({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},fg={kernelName:"IsInf",backendName:"webgl",kernelFunc:sh({opSnippet:"return float(isinf(x));",dtype:"bool"})},mg={kernelName:"IsNan",backendName:"webgl",kernelFunc:sh({opSnippet:"return float(isnan(x));",dtype:"bool"})},gg={kernelName:"Less",backendName:"webgl",kernelFunc:uh({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:Wp,dtype:"bool"})},vg=uh({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:zp,dtype:"bool"}),yg={kernelName:st,backendName:"webgl",kernelFunc:vg},bg={kernelName:"LinSpace",backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.num,i=Gp(r,a,o);return t.makeTensorInfo([i.length],"float32",i)}},xg={kernelName:"Log",backendName:"webgl",kernelFunc:sh({opSnippet:ih+"\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:jp})},wg={kernelName:"Log1p",backendName:"webgl",kernelFunc:sh({opSnippet:ih+"\n  return log(1.0 + x);\n"})},kg={kernelName:ut,backendName:"webgl",kernelFunc:uh({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"})},Ig={kernelName:ct,backendName:"webgl",kernelFunc:sh({opSnippet:"return float(!(x >= 1.0));"})},Sg={kernelName:lt,backendName:"webgl",kernelFunc:uh({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})},Tg=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["x"],this.outputShape=[];var i,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");i=.5===o?"inversesqrt(".concat(c,")"):1===o?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(o,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(i,";\n        setOutput(val);\n      }\n    ")})),_g=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var i,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");i=.5===o?"inversesqrt(".concat(c,")"):1===o?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(o,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(i,";\n        setOutput(result);\n      }\n    ")})),Cg={kernelName:"LRN",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.depthRadius,i=r.bias,s=r.alpha,u=r.beta,c=Ie().getBool("WEBGL_PACK_NORMALIZATION")?new _g(a.shape,o,i,s,u):new Tg(a.shape,o,i,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},Ng=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(o,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(o,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),Eg={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.y,i=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,p=new Ng(a.shape,s,u,c,l);return n.runWebGLProgram(p,[a,o,i],a.dtype)}};function Rg(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reductionIndices,i=r.keepDims,u=a.shape.length,c=ne(o,a.shape),l=c,p=Is(l,u),d=null!=p,h=n.shouldExecuteOnCPU([a]),f=a;if(d){if(h){for(var m=n.texData.get(f.dataId).values,g=new Array(u),v=0;v<g.length;v++)g[v]=a.shape[p[v]];var y=vd(m,a.shape,a.dtype,p,g);f=n.makeTensorInfo(g,a.dtype),n.texData.get(f.dataId).values=y}else f=Sh(a,p,n);l=Ts(l.length,u)}ks("max",l,u);var b,x=xs(f.shape,l),w=s(x,2),k=w[0],I=w[1],S=k;if(i&&(S=ws(k,c)),h){var T=n.texData.get(f.dataId).values,_=Hp(T,Y(I),S,a.dtype);b=n.makeTensorInfo(S,a.dtype),n.texData.get(b.dataId).values=_}else b=function(e,t,n,r){var a=Y(t),o=vh({inputs:{x:e},attrs:{shape:[Y(e.shape)/a,a]},backend:r}),i=wh(o,e.dtype,"max",r),s=vh({inputs:{x:i},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),s}(f,I,S,n);return d&&n.disposeIntermediateTensorInfo(f),b}var Ag={kernelName:"Max",backendName:"webgl",kernelFunc:Rg},Og={kernelName:pt,backendName:"webgl",kernelFunc:uh({opSnippet:qd+"\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+Kd+"\n  return result;\n",cpuKernelImpl:qp})},Mg={kernelName:dt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;sl(a,"maxPool");var o=r.filterSize,i=r.strides,s=r.pad,u=r.dimRoundingMode;H(es(i,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '1'")}));var c=ji(a.shape,o,i,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Q(c.inShape,c.outShape))return Qd({inputs:{x:a},backend:n});var l=new $h(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}},Fg={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.filterSize,i=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Hi(a.shape,o,i,[1,1,1],s,c,u),p=new ef(l,"max",!1);return n.runWebGLProgram(p,[a],a.dtype)}},Dg=p((function e(t){l(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,o=t.effectiveFilterHeight,i=t.effectiveFilterWidth,s=o-1-t.padInfo.top,u=i-1-t.padInfo.left,c=o*i-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(o,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(i,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(i," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Pg=p((function e(t){l(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,o=t.dilationDepth,i=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=u-1-t.padInfo.front,h=c-1-t.padInfo.top,f=p-1-t.padInfo.left,m=u*c*p-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(d,", ").concat(h,", ").concat(f,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(o,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(i,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(m," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(p," +\n                  wR * ").concat(p," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Lg={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Hi(o.shape,i,s,[1,1,1],u,c),p=new ef(l,"max",!0),d=n.runWebGLProgram(p,[o],o.dtype),h=new Pg(l),f=n.runWebGLProgram(h,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),f}},Bg={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,o=t.input,i=o;sl([o,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,p=ji(i.shape,s,u,1,c,l),d=new $h(p,"max",!0),h=n.runWebGLProgram(d,[i],i.dtype),f=new Dg(p),m=n.runWebGLProgram(f,[a,h],i.dtype);return n.disposeIntermediateTensorInfo(h),m}},Ug={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.filterSize,i=n.strides,u=n.pad,c=n.includeBatchInIndex,l=r;H(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var p=[1,1];H(es(i,p),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides ".concat(i," and dilations '").concat(p,"'")}));var d=ji(a.shape,o,i,p,u),h=function(e,t,n,r){var a=new $h(n,"max",!1),o=r.runWebGLProgram(a,[e],"float32");return a=new $h(n,"max",!0,!0,t),[o,r.runWebGLProgram(a,[e],"float32")]}(a,c,d,l),f=s(h,2);return[f[0],f[1]]}},Vg={kernelName:ht,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=n.keepDims,i=n.axis,u=r,c=a.shape.length,l=ne(i,a.shape),p=l,d=Is(p,c),h=null!=d,f=u.shouldExecuteOnCPU([a]),m=[],g=a;if(h){if(f){for(var v=u.texData.get(g.dataId).values,y=new Array(c),b=0;b<y.length;b++)y[b]=a.shape[d[b]];var x=vd(v,a.shape,a.dtype,d,y);g=u.makeTensorInfo(y,a.dtype),u.texData.get(g.dataId).values=x}else g=Sh(a,d,u);m.push(g),p=Ts(p.length,c)}ks("sum",p,c);var w=xs(g.shape,p),k=s(w,2),I=k[0],S=k[1],T=I;o&&(T=ws(I,l));for(var _=function(e,t,n,r){var a=Y(t),o=vh({inputs:{x:e},attrs:{shape:[Y(e.shape)/a,a]},backend:r}),i=wh(o,"float32","mean",r),s=vh({inputs:{x:i},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),s}(g,S,T,u),C=0,N=m;C<N.length;C++){var E=N[C];u.disposeIntermediateTensorInfo(E)}return _}},Wg={kernelName:"Min",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.keepDims,u=a.shape.length,c=ne(o,a.shape),l=c,p=Is(l,u),d=a;null!=p&&(d=Ch({inputs:{x:a},backend:n,attrs:{perm:p}}),l=Ts(l.length,a.shape.length)),ks("min",l,u);var h,f=xs(d.shape,l),m=s(f,2),g=m[0],v=vh({inputs:{x:d},backend:n,attrs:{shape:[-1,Y(m[1])]}}),y=wh(v,v.dtype,"min",n);return h=vh(i?{inputs:{x:y},backend:n,attrs:{shape:ws(g,c)}}:{inputs:{x:y},backend:n,attrs:{shape:g}}),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),null!=p&&n.disposeIntermediateTensorInfo(d),h}},zg=uh({opSnippet:qd+"\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  bvec4 isNaNA = isnan(a);\n  bvec4 isNaNB = isnan(b);\n  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);\n  "+Kd+"\n  return result;\n",cpuKernelImpl:Xp}),Gg={kernelName:ft,backendName:"webgl",kernelFunc:zg},jg=p((function e(t,n,r){l(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,o=Il(a),i=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(o," start = ").concat(o,"(").concat(i,");\n      ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(o," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),Hg=p((function e(t,n,r){l(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,o=Il(a),i=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=xd("rc",a),c=xd("source",a),p="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h="reflect"===r?0:1,f="";if(1===a){var m="\n        ".concat(o," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(h,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(h,";\n        }\n        source -= start;\n      ");f="\n        ".concat(o," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(p,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ")}else{var g="\n        ".concat(o," source = rc;\n        ").concat(o," lt = ").concat(o,"(lessThan(source, start));\n        ").concat(o," gte = ").concat(o,"(greaterThanEqual(source, end));\n        ").concat(o," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(h,") +\n                gte * ((end - 1) * 2 - source + ").concat(h,");\n        source -= start;\n      ");f="\n        ".concat(o," rc = outputLoc;\n        ").concat(g,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(p,") {\n          ").concat(g,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(g,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(p,") {\n            ").concat(g,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(o," start = ").concat(o,"(").concat(i,");\n      const ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(f,"\n        setOutput(result);\n      }\n    ")})),qg={kernelName:mt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,i=r.mode,s=Ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hg(a.shape,o,i):new jg(a.shape,o,i);return n.runWebGLProgram(s,[a],a.dtype)}},Xg={kernelName:"Mod",backendName:"webgl",kernelFunc:uh({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  bvec4 isNaN = equal(b, vec4(0.0));\n  "+Kd+"\n  return result;\n"})},Kg=p((function e(t,n,r){l(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),Yg=uh({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),Qg={kernelName:Ye,backendName:"webgl",kernelFunc:Yg},Jg="return a - b;",Zg=uh({opSnippet:Jg,packedOpSnippet:Jg,supportsComplex:!0,cpuKernelImpl:fd}),$g={kernelName:"Sub",backendName:"webgl",kernelFunc:Zg};function ev(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=ne([r.dim],a.shape),i=Rg({inputs:{x:a},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),s=ws(i.shape,o),u=vh({inputs:{x:i},backend:n,attrs:{shape:s}}),c=Zg({inputs:{a:a,b:u},backend:n}),l=Mm({inputs:{x:c},backend:n}),p=Th({inputs:{x:l},backend:n,attrs:{axis:o,keepDims:!1}}),d=vh({inputs:{x:p},backend:n,attrs:{shape:s}}),h=Yg({inputs:{a:l,b:d},backend:n});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),h}var tv={kernelName:Gt,backendName:"webgl",kernelFunc:ev},nv={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,o=r.numSamples,i=r.seed,s=r.normalized,u=s?a:ev({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],p=new Kg(c,l,o),d=[[i]],h=n.runWebGLProgram(p,[u],"int32",d);return s||n.disposeIntermediateTensorInfo(u),h}},rv={kernelName:"Neg",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var o=r.texData.get(a.dataId),i=Yp(o.values,a.shape,a.dtype),u=s(i,2),c=u[0],l=u[1];return r.makeTensorInfo(l,a.dtype,c)}return t=Ie().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Wd(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new Cd(a.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[a],a.dtype)}},av=bu,ov={kernelName:yt,backendName:"webgl",kernelFunc:function(e){dn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,i=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(o.dataId),p=av(c,l,i,s,u).selectedIndices;return n.makeTensorInfo([p.length],"int32",new Int32Array(p))}},iv=xu,sv={kernelName:bt,backendName:"webgl",kernelFunc:function(e){dn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,i=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),p=n.readSync(o.dataId),d=iv(l,p,i,s,u,c),h=d.selectedIndices,f=d.validOutputs;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}},uv=wu,cv={kernelName:xt,backendName:"webgl",kernelFunc:function(e){dn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,o=t.scores,i=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),p=n.readSync(o.dataId),d=uv(l,p,i,s,u,c),h=d.selectedIndices,f=d.selectedScores;return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([f.length],"float32",new Float32Array(f))]}},lv=p((function e(t,n,r,a){l(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),pv={kernelName:kt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,s=r.depth,u=r.onValue,c=r.offValue,l=Y(a.shape),p=new lv(l,s,u,c),d=vh({inputs:{x:a},backend:n,attrs:{shape:[l]}}),h=n.runWebGLProgram(p,[d],i);n.disposeIntermediateTensorInfo(d);var f=vh({inputs:{x:h},backend:n,attrs:{shape:[].concat(o(a.shape),[s])}});return n.disposeIntermediateTensorInfo(h),f}};function dv(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=kf({inputs:{input:r},backend:n}),o=dv({inputs:{x:a},backend:n}),i=Pf({inputs:{input:r},backend:n}),s=dv({inputs:{x:i},backend:n}),u=Zd({inputs:{real:o,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(s),u}return Gm({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var hv={kernelName:an,backendName:"webgl",kernelFunc:dv},fv={kernelName:wt,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var o=kf({inputs:{input:a},backend:r}),i=e({inputs:{x:o},backend:r}),s=Pf({inputs:{input:a},backend:r}),u=dv({inputs:{x:s},backend:r}),c=Zd({inputs:{real:i,imag:u},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return Gm({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}},mv={kernelName:It,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Dm({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,o=t[0].dtype;t.forEach((function(e){q(a,e.shape,"All tensors passed to stack must have matching shapes"),H(o===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],s=Bf({inputs:t.map((function(e){var t=Dm({inputs:{input:e},backend:n,attrs:{dim:r}});return i.push(t),t})),backend:n,attrs:{axis:r}});return i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},gv=p((function e(t,n,r){l(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,o=Il(a),i=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(o," start = ").concat(o,"(").concat(i,");\n      ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(o," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(i,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),vv=p((function e(t,n,r){l(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,o=Il(a),i=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=xd("rc",a),c=xd("source",a),p="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),d=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),h=["".concat(o," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(p,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(p,") {")],f=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",g=0,v=1===a?2:4;g<v;g++)m+="\n        ".concat(h[g],"\n        if (").concat(f,") {\n          result[").concat(g,"] = float(value);\n        } else {\n          ").concat(o," source = rc - start;\n          result[").concat(g,"] = getChannel(getX(").concat(c.join(),"), ").concat(d,");\n        }\n      ");m+=1===a?"} ":"}}",this.userCode="\n      const ".concat(o," start = ").concat(o,"(").concat(i,");\n      const ").concat(o," end = ").concat(o,"(").concat(s,");\n\n      void main() {\n        ").concat(o," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(m,"\n        setOutput(result);\n      }\n    ")})),yv=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.paddings,i=r.constantValue;if(0===Y(a.shape))return Gm({backend:n,attrs:{shape:o.map((function(e,t){return e[0]+a.shape[t]+e[1]})),value:i,dtype:a.dtype}});var s=Ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vv(a.shape,o,i):new gv(a.shape,o,i),u=[[i]];return n.runWebGLProgram(s,[a],a.dtype,u)},bv={kernelName:St,backendName:"webgl",kernelFunc:yv},xv={kernelName:"Pow",backendName:"webgl",kernelFunc:uh({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  bvec4 isNaN1 = lessThan(a, vec4(0.0));\n  bvec4 isNaN2 = lessThan(floor(b), b);\n  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);\n  "+Kd+"\n  return result;\n"})},wv={kernelName:_t,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=a.axis,u=a.keepDims,c=o.shape.length,l=[],p=ne(i,o.shape),d=p,h=Is(d,c),f=o;if(null!=h&&(f=Ch({inputs:{x:o},backend:r,attrs:{perm:h}}),d=Ts(d.length,c),l.push(f)),ks("prod",d,c),r.shouldExecuteOnCPU([f])){var m=r.texData.get(f.dataId).values,g=Jp(f.shape,f.dtype,m,d),v=g.outVals,y=g.outShape,b=g.outDtype;t=r.makeTensorInfo(y,b,v)}else{var x=xs(f.shape,d),w=s(x,2),k=w[0],I=Y(w[1]),S=vh({inputs:{x:f},backend:r,attrs:{shape:[-1,I]}}),T=wh(S,Ar(o.dtype),"prod",r);t=vh({inputs:{x:T},backend:r,attrs:{shape:k}}),l.push(S),l.push(T)}if(u){l.push(t);var _=ws(t.shape,p);t=vh({inputs:{x:t},backend:r,attrs:{shape:_}})}return l.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}},kv={kernelName:"RaggedGather",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.paramsNestedSplits,o=t.paramsDenseValues,i=t.indices,u=r.outputRaggedRank,c=a.map((function(e){return n.readSync(e.dataId)})),l=a.map((function(e){return e.shape})),p=n.readSync(o.dataId),d=n.readSync(i.dataId),h=Zp(c,l,p,o.shape,o.dtype,d,i.shape,u),f=s(h,3),m=f[0],g=f[1],v=f[2],y=m.map((function(e){return n.makeTensorInfo([e.length],"int32",e)})),b=n.makeTensorInfo(v,o.dtype,g);return y.concat([b])}},Iv={kernelName:"RaggedTensorToTensor",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,o=t.values,i=t.defaultValue,u=t.rowPartitionTensors,c=r.rowPartitionTypes,l=n.readSync(a.dataId),p=n.readSync(o.dataId),d=n.readSync(i.dataId),h=u.map((function(e){return n.readSync(e.dataId)})),f=u.map((function(e){return e.shape})),m=$p(l,a.shape,p,o.shape,o.dtype,d,i.shape,h,f,c),g=s(m,2),v=g[0],y=g[1];return n.makeTensorInfo(v,o.dtype,y)}},Sv=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.step,i=n.dtype,s=ed(r,a,o,i);return t.makeTensorInfo([s.length],i,s)},Tv={kernelName:Ct,backendName:"webgl",kernelFunc:Sv},_v={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:sh({opSnippet:"return 1.0 / x;"})},Cv=sh({opSnippet:Nd+"\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Nv={kernelName:Nt,backendName:"webgl",kernelFunc:Cv},Ev=sh({opSnippet:Nd+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Rv={kernelName:Ot,backendName:"webgl",kernelFunc:Ev},Av=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["A"],this.outputShape=[];var i=s(t,4),u=i[0],c=i[1],p=i[2],d=i[3];this.outputShape=[u,n,r,d];var h,f=[a&&n>1?c-1:c,a&&r>1?p-1:p],m=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=o?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(p,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),Ov=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=s(t,4),u=i[0],c=i[1],p=i[2],d=i[3];this.outputShape=[u,n,r,d];var h,f=[a&&n>1?c-1:c,a&&r>1?p-1:p],m=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=o?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],",\n          ").concat(f[1]/m[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(p,".0,\n                                     ").concat(p,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(d-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")})),Mv={kernelName:At,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,i=r.halfPixelCenters,u=r.size,c=s(u,2),l=c[0],p=c[1],d=Ie().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Ov(a.shape,l,p,o,i):new Av(a.shape,l,p,o,i);return n.runWebGLProgram(d,[a],"float32")}},Fv=p((function e(t,n,r){l(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=s(n,3),o=a[1],i=a[2],u=s(t,3),c=u[1],p=u[2],d=[r&&c>1?o-1:o,r&&p>1?i-1:i],h=[r&&c>1?c-1:c,r&&p>1?p-1:p],f=d[0]/h[0],m=d[1]/h[1],g=1/f,v=1/m,y=2*Math.ceil(g)+2,b=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(m,");\n\n        const float invHeightScale = float(").concat(g,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(p,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(o-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(i-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")})),Dv={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,i=r.alignCorners,s=new Fv(o.shape,a.shape,i);return n.runWebGLProgram(s,[o],o.dtype)}},Pv=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["A"],this.outputShape=[];var i=s(t,4),u=i[0],c=i[1],p=i[2],d=i[3];this.outputShape=[u,n,r,d];var h,f=[a&&n>1?c-1:c,a&&r>1?p-1:p],m=[a&&n>1?n-1:n,a&&r>1?r-1:r],g=a?"0.5":"0.0";h=o?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],");\n      const vec2 inputShapeRC = vec2(").concat(c,".0, ").concat(p,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(g,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),Lv=p((function e(t,n,r,a,o){l(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=s(t,4),u=i[0],c=i[1],p=i[2],d=i[3];this.outputShape=[u,n,r,d];var h,f=[a&&n>1?c-1:c,a&&r>1?p-1:p],m=[a&&n>1?n-1:n,a&&r>1?r-1:r],g=a?"0.5":"0.0";h=o?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(f[0]/m[0],",\n          ").concat(f[1]/m[1],",\n          ").concat(f[1]/m[1],");\n      const vec3 inputShapeRC = vec3(").concat(c,".0, ").concat(p,".0,\n                                     ").concat(p,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(g,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(d-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")})),Bv={kernelName:Rt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=r.alignCorners,i=r.halfPixelCenters,u=r.size,c=s(u,2),l=c[0],p=c[1],d=Ie().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Lv(a.shape,l,p,o,i):new Pv(a.shape,l,p,o,i);return n.runWebGLProgram(d,[a],a.dtype)}},Uv=p((function e(t,n,r){l(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=s(n,3),o=a[1],i=a[2],u=s(t,3),c=u[1],p=u[2],d=[r&&c>1?o-1:o,r&&p>1?i-1:i],h=[r&&c>1?c-1:c,r&&p>1?p-1:p],f=d[0]/h[0],m=d[1]/h[1],g=1/f,v=1/m,y=2*Math.ceil(g)+2,b=2*Math.ceil(v)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(f,");\n        const float widthScale = float(").concat(m,");\n\n        const float invHeightScale = float(").concat(g,");\n        const float invWidthScale = float(").concat(v,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(c,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(p,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(d[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(d[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")})),Vv={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,o=t.dy,i=r.alignCorners,s=new Uv(o.shape,a.shape,i);return n.runWebGLProgram(s,[o],o.dtype)}},Wv=p((function e(t,n){l(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),o=Il(r);this.userCode="\n      void main() {\n        ".concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),zv=p((function e(t,n){l(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=xd("rc",r),o="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),i="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=Il(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)}));return"getChannel(getX(".concat(r.join(","),"), vec2(").concat(r.slice(-2).join(","),"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(o,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(o,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(i,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(o,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")})),Gv={kernelName:Mt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.dims,i=a.shape.length,s=ne(o,a.shape);if(0===i)return Qd({inputs:{x:a},backend:n});var u=Ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zv(a.shape,s):new Wv(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},jv=p((function e(t,n){l(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var o;o="number"==typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(o,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),Hv={kernelName:un,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,o=n.radians,i=n.fillValue,u=n.center,c=r,l=new jv(a.shape,i),p=zu(u,a.shape[1],a.shape[2]),d=s(p,2),h=[[d[0],d[1],Math.sin(o),Math.cos(o)]];return c.runWebGLProgram(l,[a],a.dtype,h)}},qv=sh({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),Xv={kernelName:Ft,backendName:"webgl",kernelFunc:qv},Kv={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:sh({opSnippet:"return inversesqrt(x);",cpuKernelImpl:td})},Yv=p((function e(t,n,r,a,o,i){l(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;var s=Il(o.length),u=Il(i.length),c="";1===r?c="i":2===r&&(c="i, j");var p="getIndices(".concat(c,")"),d="";1===a?d="i":2===a&&(d="i, coords[1]");var h="getUpdates(".concat(d,")"),f=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(o,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(p,");\n              flattenedIndex += index * ").concat(f,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(h,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")})),Qv={kernelName:Dt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,o=t.updates,i=r.shape,s=wi(0,a,i),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,p=s.strides,d=s.outputSize,h=[d/l,l];if(0===d)return n.makeTensorInfo(i,a.dtype);var f=vh({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),m=vh({inputs:{x:o},backend:n,attrs:{shape:[c,l]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0])),v=new Yv(c,u,f.shape.length,m.shape.length,p,h),y=n.runWebGLProgram(v,[m,f,g],m.dtype),b=vh({inputs:{x:y},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(g),b}},Jv=p((function e(t,n,r,a){l(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var o="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),i=2===Ie().getNumber("WEBGL_VERSION")?"while (left < right) {":o,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(i,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")})),Zv={kernelName:"SearchSorted",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,o=t.values,i=r.side,s=new Jv(a.shape[0],a.shape[1],o.shape[1],i),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,o],"int32",u)}},$v=p((function e(t,n,r){var a,o;if(l(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)o="resRC",a="resRC";else{for(var i=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(i[c])),c<t&&s.push("".concat(i[c]));a=s.join(),o=u.join()}var p=Il(r);this.userCode="\n      void main() {\n        ".concat(p," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(o,"));\n        } else {\n          setOutput(getB(").concat(o,"));\n        }\n      }\n    ")})),ey={kernelName:Pt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e,i=new $v(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(i,[r,a,o],Rr(a.dtype,o.dtype))}},ty={kernelName:"Selu",backendName:"webgl",kernelFunc:sh({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = ".concat(Ku,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")})},ny=sh({opSnippet:ih+"\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:rd}),ry={kernelName:Bt,backendName:"webgl",kernelFunc:ny},ay={kernelName:"Sign",backendName:"webgl",kernelFunc:sh({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},oy={kernelName:"Sin",backendName:"webgl",kernelFunc:sh({opSnippet:ih+"\n  return sin(x);\n"})},iy={kernelName:"Sinh",backendName:"webgl",kernelFunc:sh({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},sy={kernelName:"Softplus",backendName:"webgl",kernelFunc:sh({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},uy={kernelName:Wt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,s=r.paddings;H(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var u=i.reduce((function(e,t){return e*t})),c=[[0,0]];c.push.apply(c,o(s));for(var l=1+i.length;l<a.shape.length;++l)c.push([0,0]);var p=[],d=yv({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),h=Gu(d.shape,i,u,!1),f=ju(h.length,i.length,!1),m=Hu(d.shape,i,u,!1),g=vh({inputs:{x:d},backend:n,attrs:{shape:h}}),v=Ch({inputs:{x:g},backend:n,attrs:{perm:f}}),y=vh({inputs:{x:v},backend:n,attrs:{shape:m}});return p.push(d),p.push(g),p.push(v),p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),y}},cy={kernelName:jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,o=t.denseShape,i=t.defaultValue;if(1!==o.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(o.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==i.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(i.shape));var u=n.readSync(r.dataId),c=n.readSync(a.dataId),l=n.readSync(o.dataId),p=n.readSync(i.dataId)[0],d=id(u,r.shape,r.dtype,c,a.dtype,l,p),h=s(d,5),f=h[0],m=h[1],g=h[2],v=h[3],y=h[4];return[n.makeTensorInfo(m,r.dtype,f),n.makeTensorInfo([m[0]],a.dtype,g),n.makeTensorInfo([v.length],"bool",new Uint8Array(v.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}},ly={kernelName:Ht,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,o=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==o.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(o.shape));var i=Array.from(n.readSync(a.dataId)),u=n.readSync(r.dataId),c=Array.from(n.readSync(o.dataId)),l=sd(u,r.shape,r.dtype,i,c),p=s(l,3),d=p[0],h=p[1],f=p[2];return[n.makeTensorInfo(h,r.dtype,d),n.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}},py={kernelName:qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(o.shape));var i=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=ud(i,r.shape,r.dtype,u,c,!0),p=s(l,2),d=p[0],h=p[1];return n.makeTensorInfo(h,r.dtype,d)}},dy={kernelName:Xt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,o=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==o.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(o.shape));var i=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(o.dataId),l=ud(i,r.shape,r.dtype,u,c),p=s(l,2),d=p[0],h=p[1];return n.makeTensorInfo(h,r.dtype,d)}},hy={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,o=t.sparseValues,i=t.defaultValue,s=r.outputShape,u=wi(0,a,s),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,d=u.strides,h=u.outputSize;if("string"===o.dtype){var f=n.bufferSync(a),m=n.bufferSync(o),g=dr(n.readSync(i.dataId)[0]),v=nd(f,m,s,h,p,l,c,d,g,!1);return n.makeTensorInfo(s,v.dtype,v.values)}var y=new Yv(l,c,a.shape.length,o.shape.length,d,[h,1],!1),b=n.runWebGLProgram(y,[o,a,i],o.dtype),x=vh({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),x}},fy={kernelName:zt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,s=ne(r.axis,a.shape)[0],u=cc(a,i,s),c=a.shape.length,l=new Array(c).fill(0),p=a.shape.slice();return u.map((function(e){var t=o(p);t[s]=e;var r=mf({inputs:{x:a},backend:n,attrs:{begin:l,size:t}});return l[s]+=e,r}))}},my="return sqrt(x);",gy=sh({opSnippet:my,packedOpSnippet:my,cpuKernelImpl:cd}),vy={kernelName:Ut,backendName:"webgl",kernelFunc:gy},yy={kernelName:"Square",backendName:"webgl",kernelFunc:sh({opSnippet:"return x * x;"})},by="return (a - b) * (a - b);",xy=uh({opSnippet:by,packedOpSnippet:by}),wy={kernelName:Kt,backendName:"webgl",kernelFunc:xy},ky={kernelName:on,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=Nd+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),i=new Cd(a.shape,o);return r.runWebGLProgram(i,[a],a.dtype)}},Iy=p((function e(t,n,r){l(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,o=Il(r.length),i=Il(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(o," begin = ").concat(o,"(").concat(t,");\n      ").concat(o," strides = ").concat(o,"(").concat(n,");\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")})),Sy={kernelName:Yt,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,o=n.x,i=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,h=a.shrinkAxisMask,f=Di(o.shape,i,s,u,c,l,p,d,h),m=f.finalShapeSparse,g=f.finalShape,v=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,w=f.end,k=f.strides;if(v)t=vh({inputs:{x:o},backend:r,attrs:{shape:g}});else if(y||b){H(o.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(o.shape.length)}));var I=Ii(x,w,k),S=mf({inputs:{x:o},backend:r,attrs:{begin:x,size:I}});t=vh({inputs:{x:S},backend:r,attrs:{shape:g}}),r.disposeIntermediateTensorInfo(S)}else if(r.shouldExecuteOnCPU([o])){var T=r.readSync(o.dataId),_=ls(o.shape,o.dtype,T),C=ld(m,_,k,x);t=r.makeTensorInfo(g,o.dtype,C.values)}else{var N=new Iy(x,k,m);t=r.runWebGLProgram(N,[o],o.dtype)}var E=vh({inputs:{x:t},backend:r,attrs:{shape:g}});return r.disposeIntermediateTensorInfo(t),E}},Ty={kernelName:Qt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,o=r.nGramWidths,i=r.leftPad,u=r.rightPad,c=r.padWidth,l=r.preserveShortSequences,p=t.data,d=t.dataSplits,h=n.readSync(p.dataId),f=n.readSync(d.dataId),m=pd(h,f,a,o,i,u,c,l),g=s(m,2),v=g[0],y=g[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(d.shape,"int32",y)]}},_y={kernelName:Jt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,o=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==o.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(o.shape));var i=n.readSync(a.dataId),u=n.readSync(o.dataId)[0],c=dd(i,u,r),l=s(c,3),p=l[0],d=l[1],h=l[2],f=d.length;return[n.makeTensorInfo([f,2],"int32",p),n.makeTensorInfo([f],"string",d),n.makeTensorInfo([2],"int32",new Int32Array(h))]}},Cy={kernelName:Zt,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var o=n.readSync(a.dataId),i=hd(o,r);return n.makeTensorInfo(a.shape,"int32",i)}},Ny={kernelName:"Tan",backendName:"webgl",kernelFunc:sh({opSnippet:"return tan(x);"})},Ey={kernelName:"Tanh",backendName:"webgl",kernelFunc:sh({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})},Ry=p((function e(t,n){l(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var o=Il(this.rank),i=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(o," resRC = getOutputCoords();\n        setOutput(getA(").concat(i,"));\n      }\n    ")}));function Ay(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.reps;if("string"===a.dtype||a.shape.length>5){var i=n.readSync(a.dataId),s="string"===a.dtype?i.map((function(e){return dr(e)})):i,u=ls(a.shape,a.dtype,s),c=md(u,o);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new Ry(a.shape,o);return n.runWebGLProgram(l,[a],a.dtype)}var Oy={kernelName:$t,backendName:"webgl",kernelFunc:Ay},My=p((function e(t){l(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),Fy=p((function e(t){l(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function Dy(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function Py(e){for(var t=1;t<e;)t*=2;return t}for(var Ly,By,Uy,Vy={kernelName:en,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,i=r.sorted,u=Ie().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),c=Ie().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),l=a.shape,p=l[l.length-1];if(n.shouldExecuteOnCPU([a])||p<u||o>c){var d=n.readSync(a.dataId),h=gd(d,l,a.dtype,o,i),f=s(h,2),m=f[0],g=f[1];return[n.makeTensorInfo(m.shape,m.dtype,m.values),n.makeTensorInfo(g.shape,g.dtype,g.values)]}if(0===o)return l[l.length-1]=0,[n.makeTensorInfo(l,a.dtype,[]),n.makeTensorInfo(l,"int32",[])];if(1===p)return[a,Gm({attrs:{shape:l,dtype:"int32",value:0},backend:n})];var v=n.texData.get(a.dataId),y=null!==v&&v.isPacked,b=y?n.unpackTensor(a):a,x=Y(l)/p,w=vh({inputs:{x:b},attrs:{shape:[x,p]},backend:n});y&&Dy(n,b);for(var k=Py(o),I=Py(p),S=null,T=function(){return null===S?[w,w]:[w,S]},_=function(e,t,r){var a=T(),o=new My(r),i=[[p],[null===S?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=S;S=n.runWebGLProgram(o,a,"int32",i),Dy(n,s)},C=1;C<k;C*=2)for(var N=2*C,E=C;E>=1;E/=2)_(N,E,[x,I]);for(var R=I;R>k;R/=2){var A=T(),O=new Fy([x,R/2]),M=[[p],[null===S?1:0],[k]],F=S;S=n.runWebGLProgram(O,A,"int32",M),Dy(n,F);for(var D=k/2,P=2*D,L=D;L>=1;L/=2)_(P,L,S.shape)}var B=S;S=mf({inputs:{x:S},backend:n,attrs:{begin:0,size:[x,o]}}),Dy(n,B);var U=sg({inputs:{x:w,indices:S},backend:n,attrs:{axis:1,batchDims:1}});Dy(n,w);var V=l.slice(0,-1);V.push(o),B=S,S=vh({inputs:{x:S},attrs:{shape:V},backend:n}),Dy(n,B);var W=U;return U=vh({inputs:{x:U},attrs:{shape:V},backend:n}),Dy(n,W),[U,S]}},Wy=p((function e(t,n,r,a,o,i){l(this,e),this.variableNames=["Image","Transforms"],this.outputShape=i;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(o,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(o,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")})),zy={kernelName:tn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,o=t.transforms,i=r.interpolation,u=r.fillMode,c=r.fillValue,l=r.outputShape,p=s(a.shape,4),d=p[0],h=p[1],f=p[2],m=p[3],g=s(null!=l?l:[h,f],2),v=g[0],y=g[1],b=new Wy(h,f,i,u,c,[d,v,y,m]);return n.runWebGLProgram(b,[a,o],"float32")}},Gy={kernelName:"Unique",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,o=t.x;sl(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var i=r.readSync(o.dataId),s=yd(i,a,o.shape,o.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,o.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}},jy={kernelName:rn,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var i=a,s=i.shape.length,u=a.shape[o],c=new Array(s-1),l=0,p=0;p<s;p++)p!==o&&(c[l++]=i.shape[p]);var d=[],h=new Array(s).fill(0),f=i.shape.slice();f[o]=1;for(var m=new Array(u),g=0;g<m.length;g++){h[o]=g;var v=mf({inputs:{x:i},backend:n,attrs:{begin:h,size:f}}),y=vh({inputs:{x:v},backend:n,attrs:{shape:c}});m[g]=y,d.push(v)}return d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}},Hy=p((function e(t,n){l(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,o=t.inSize,i=t.numSegments,s=i*Math.ceil(o/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,p="\n        sumValue += dot(values, segFilter);\n    ",d="";o%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return initializationValue;\n        }\n      "));var h="";o%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(o,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        ".concat(d,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(h,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(i,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(i,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(p,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(p,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(p,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(p,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),qy=0,Xy=[Rh,Oh,Mh,Fh,Lh,Vh,Wh,zh,qh,Xh,Kh,Yh,Qh,Jh,Zh,tf,nf,of,sf,uf,pf,vf,yf,bf,Sf,_f,Ef,$d,Of,Uf,Kf,$f,em,tm,nm,rm,am,om,sm,dm,hm,fm,gm,bm,km,Im,Tm,Cm,Nm,Em,Rm,Am,Om,Fm,Pm,Bm,Wm,Hm,Xm,Ym,Jm,eg,ng,rg,og,ug,lg,pg,Jd,dg,Lf,hg,fg,mg,nh,gg,yg,bg,xg,wg,kg,Ig,Sg,Cg,Eg,Ag,Og,Mg,Fg,Lg,Bg,Ug,Vg,Wg,Gg,qg,Xg,nv,gh,rv,ov,sv,cv,wf,pv,fv,mv,bv,xv,oh,wv,kv,Iv,Tv,If,Qg,_v,Nv,Rv,yh,Mv,Dv,Bv,Vv,Gv,Hv,Xv,Kv,Qv,Zv,ey,ty,ry,ay,oy,iy,gf,tv,sy,uy,cy,ly,py,dy,hy,fy,vy,yy,wy,ky,Sy,Ty,_y,Cy,$g,_h,Ny,Ey,Oy,Vy,zy,Nh,Gy,jy,{kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=t.segmentIds,i=r.numSegments,s=a.shape.length,u=[],c=0,l=Is([c],s),p=a;null!=l&&(p=Ch({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(p),c=Ts(1,s)[0]);var d=xc(p.shape,c,i),h=Y([p.shape[c]]),f=vh({inputs:{x:p},backend:n,attrs:{shape:[-1,h]}});u.push(f);var m=vh({inputs:{x:function e(t,r,a,o,i){var s=t.shape[0],c=t.shape[1],l=bc(c,i),p=new Hy({windowSize:l,inSize:c,batchSize:s,numSegments:i},r),d=n.compileAndRun(p,[t,a],o);if(u.push(d),d.shape[1]===i)return d;var h=Sv({backend:n,attrs:{start:0,stop:i,step:1,dtype:"float32"}}),f=Ay({inputs:{x:h},backend:n,attrs:{reps:[c/l]}});return u.push(h),u.push(f),e(d,r,f,o,i)}(f,"unsortedSegmentSum",o,Ar(a.dtype),i)},backend:n,attrs:{shape:d}}),g=m;if(null!=l){u.push(m);var v=Ss(l);g=Ch({inputs:{x:g},backend:n,attrs:{perm:v}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},hv];qy<Xy.length;qy++){yn(Xy[qy])}!function(e){e[e.float32=0]="float32",e[e.int32=1]="int32",e[e.bool=2]="bool",e[e.string=3]="string",e[e.complex64=4]="complex64"}(Ly||(Ly={})),function(e){e[e.linear=0]="linear",e[e.relu=1]="relu",e[e.relu6=2]="relu6",e[e.prelu=3]="prelu",e[e.leakyrelu=4]="leakyrelu",e[e.sigmoid=5]="sigmoid",e[e.elu=6]="elu"}(By||(By={}));var Ky={kernelName:cn,backendName:"wasm",setupFunc:function(e){Uy=e.wasm.cwrap(cn,null,["number","array","number","number","array","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,s=t.bias,u=t.preluActivationWeights;if("float32"!==a.dtype||"float32"!==i.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var c=r.transposeA,l=r.transposeB,p=r.activation,d=r.leakyreluAlpha,h=n.dataIdMap.get(a.dataId).id,f=n.dataIdMap.get(i.dataId).id,m=0;if(null!=s){var g=n.dataIdMap.get(s.dataId);if(1!==g.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank ".concat(g.shape.length,"."));m=g.id}var v=null==u?0:n.dataIdMap.get(u.dataId).id,y=By[p];if(null==y)throw new Error("".concat(p," activation not yet supported for FusedConv2D in the wasm backend."));var b=c?a.shape[2]:a.shape[1],x=l?i.shape[1]:i.shape[2],w=mi(a.shape.slice(0,-2),i.shape.slice(0,-2)),k=n.makeOutput([].concat(o(w),[b,x]),a.dtype),I=n.dataIdMap.get(k.dataId).id,S=new Uint8Array(new Int32Array(a.shape).buffer),T=new Uint8Array(new Int32Array(i.shape).buffer);return Uy(h,S,a.shape.length,f,T,i.shape.length,c,l,y,m,v,d||0,I),k}};function Yy(e,t){var n;return{kernelName:e,backendName:"wasm",setupFunc:function(t){n=t.wasm.cwrap(e,null,["number","number","number"])},kernelFunc:function(e){var r=e.backend,a=e.inputs.x,o=r.dataIdMap.get(a.dataId).id,i=r.makeOutput(a.shape,t||a.dtype),s=r.dataIdMap.get(i.dataId).id;return 0===Y(i.shape)||n(o,Ly[a.dtype],s),i}}}var Qy=Yy("Abs");function Jy(e,t,n){var r;return{kernelName:e,backendName:"wasm",setupFunc:function(t){r=t.wasm.cwrap(e,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var t=e.backend,a=e.inputs,o=a.a,i=a.b,s=t.dataIdMap.get(o.dataId).id,u=t.dataIdMap.get(i.dataId).id,c=null!=n?n:o.dtype,l=mi(o.shape,i.shape),p=t.makeOutput(l,c);if(0===Y(l))return p;var d=new Uint8Array(new Int32Array(o.shape).buffer),h=new Uint8Array(new Int32Array(i.shape).buffer),f=t.dataIdMap.get(p.dataId).id;return r(s,d,o.shape.length,u,h,i.shape.length,Ly[o.dtype],f),p}}}var Zy,$y=Jy(Ne),eb={kernelName:Ee,backendName:"wasm",setupFunc:function(e){Zy=e.wasm.cwrap(Ee,null,["array","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=n.makeOutput(t[0].shape,t[0].dtype);if(0===Y(r.shape))return r;var a=t.map((function(e){return n.dataIdMap.get(e.dataId).id})),o=new Uint8Array(new Int32Array(a).buffer),i=n.dataIdMap.get(r.dataId).id;return Zy(o,a.length,Ly[r.dtype],i),r}};function tb(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype),a=n.typedArrayFromHeap(t);return n.typedArrayFromHeap(r).set(a),r}var nb,rb={kernelName:ot,backendName:"wasm",kernelFunc:tb};function ab(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=function(e,t){for(var n=[],r=[],a=0;a<e.length;++a)1!==e[a]&&n.push(e[a]),1!==e[t[a]]&&r.push(t[a]);for(var o=0;o<r.length;++o){for(var i=-1,s=0;s<r.length;++s)r[s]>=o&&(-1===i||r[i]>r[s])&&(i=s);r[i]=o}return[n,r]}(t.x.shape,r.perm),o=s(a,2),i=o[0],u=o[1],c=!0,l=0;l<u.length;l++)u[l]!==l&&(c=!1);var p=function(e,t){for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];return n}(t.x.shape,r.perm),d={dataId:t.x.dataId,shape:i,dtype:t.x.dtype};if(c){var h=tb({inputs:t,backend:n});return h.shape=p,h}var f=n.makeOutput(p,d.dtype),m=n.dataIdMap.get(d.dataId).id,g=n.dataIdMap.get(f.dataId).id,v=new Uint8Array(new Int32Array(u).buffer),y=new Uint8Array(new Int32Array(d.shape).buffer);return nb(m,y,d.shape.length,Ly[d.dtype],g,v,u.length),f}var ob,ib={kernelName:nn,backendName:"wasm",kernelFunc:ab,setupFunc:function(e){nb=e.wasm.cwrap(nn,null,["number","array","number","number","number","array","number"])}};function sb(e,t,n){var r=e.shape,a=e.shape.length,o=ne(t,r),i=o,s=Is(i,a),u=null,c=!1;if(null!=s){for(var l=new Array(a),p=0;p<l.length;p++)l[p]=r[s[p]];i=Ts(i.length,a),u=ab({inputs:{x:e},attrs:{perm:s},backend:n});var d=n.dataIdMap.get(e.dataId).id;n.dataIdMap.get(u.dataId).id!==d&&(c=!0)}return{transposed:u,originalAxes:o,axes:i,inputWasTransposed:c}}var ub,cb,lb,pb={kernelName:"All",backendName:"wasm",setupFunc:function(e){ob=e.wasm.cwrap("All",null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=i,l=sb(i,a,t),p=l.transposed,d=l.axes,h=l.originalAxes,f=l.inputWasTransposed;f&&(c=p,u=t.dataIdMap.get(p.dataId).id),ks("all",d,c.shape.length);var m=xs(c.shape,d),g=s(m,2),v=g[0],y=Y(g[1]),b=t.makeOutput(v,i.dtype);if(0!==Y(c.shape)){var x=t.dataIdMap.get(b.dataId).id;ob(u,y,x)}if(f&&t.disposeData(p.dataId),o){var w=ws(b.shape,h);b.shape=w}return b}},db={kernelName:"Any",backendName:"wasm",setupFunc:function(e){ub=e.wasm.cwrap("Any",null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=i,l=sb(i,a,t),p=l.transposed,d=l.axes,h=l.originalAxes,f=l.inputWasTransposed;f&&(c=p,u=t.dataIdMap.get(p.dataId).id),ks("any",d,c.shape.length);var m=xs(c.shape,d),g=s(m,2),v=g[0],y=Y(g[1]),b=t.makeOutput(v,i.dtype);if(0!==Y(c.shape)){var x=t.dataIdMap.get(b.dataId).id;ub(u,y,x)}if(f&&t.disposeData(p.dataId),o){var w=ws(b.shape,h);b.shape=w}return b}},hb={kernelName:Re,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.axis,a=n.x,o=t.dataIdMap.get(a.dataId).id,i=o,s=a,u=sb(a,r,t),c=u.transposed,l=u.axes,p=u.inputWasTransposed;if(p){var d=t.dataIdMap.get(c.dataId).id;d!==o&&(s=c,i=d)}var h=s.shape.slice(0,-1),f=t.makeOutput(h,"int32"),m=t.dataIdMap.get(f.dataId).id,g=Y(f.shape),v=s.shape[l[0]];return cb(i,Ly[s.dtype],g,v,m),p&&t.disposeData(c.dataId),f},setupFunc:function(e){cb=e.wasm.cwrap(Re,null,["number","number","number","number","number"])}},fb={kernelName:Ae,backendName:"wasm",setupFunc:function(e){lb=e.wasm.cwrap(Ae,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=r.dataIdMap.get(a.dataId).id,i=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=ji(a.shape,i,s,1,u,c),p=l.filterHeight,d=l.filterWidth,h=l.padInfo.top,f=l.padInfo.right,m=l.padInfo.bottom,g=l.padInfo.left,v=l.strideHeight,y=l.strideWidth,b=l.inChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));if(1!==l.dilationWidth||1!==l.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got [".concat(l.dilationHeight,", ").concat(l.dilationWidth,"]."));var x=r.makeOutput(l.outShape,"float32"),w=r.dataIdMap.get(x.dataId).id;return lb(o,a.shape[0],a.shape[1],a.shape[2],p,d,h,f,m,g,v,y,b,w),x}};function mb(e){var t=e.inputs,n=e.attrs,r=t.x,a=n.shape,o=Y(r.shape),i=te(a,o);return H(o===Y(i),(function(){return"new shape: ".concat(i,", old shape: ").concat(r.shape,". New shape and old shape must have the same number of elements.")})),e.backend.incRef(r.dataId),{dataId:r.dataId,shape:i,dtype:r.dtype}}var gb,vb={kernelName:Et,backendName:"wasm",kernelFunc:mb},yb={kernelName:Oe,backendName:"wasm",setupFunc:function(e){gb=e.wasm.cwrap(Oe,null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,o=t.b,i=r.transposeA,s=r.transposeB;if("float32"!==a.dtype||"float32"!==o.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var u=a.shape.length,c=o.shape.length,l=i?a.shape[u-2]:a.shape[u-1],p=s?o.shape[c-1]:o.shape[c-2],d=i?a.shape[u-1]:a.shape[u-2],h=s?o.shape[c-2]:o.shape[c-1],f=a.shape.slice(0,-2),m=o.shape.slice(0,-2),g=Y(f),v=Y(m),y=mi(a.shape.slice(0,-2),o.shape.slice(0,-2)).concat([d,h]);H(l===p,(function(){return"Error in matMul: inner shapes (".concat(l,") and (").concat(p,") of Tensors with shapes ").concat(a.shape," and ").concat(o.shape," and transposeA=").concat(i," and transposeB=").concat(s," must match.")}));var b=s?[v,h,p]:[v,p,h],x=mb({inputs:{x:a},backend:n,attrs:{shape:i?[g,l,d]:[g,d,l]}}),w=mb({inputs:{x:o},backend:n,attrs:{shape:b}}),k=n.dataIdMap.get(x.dataId).id,I=n.dataIdMap.get(w.dataId).id,S=i?x.shape[2]:x.shape[1],T=s?w.shape[1]:w.shape[2],_=Math.max(g,v),C=n.makeOutput([_,S,T],x.dtype),N=n.dataIdMap.get(C.dataId).id,E=new Uint8Array(new Int32Array(x.shape).buffer),R=new Uint8Array(new Int32Array(w.shape).buffer);return gb(k,E,x.shape.length,I,R,w.shape.length,i,s,N),n.disposeData(x.dataId),n.disposeData(w.dataId),C.shape=y,C}};function bb(e){var t=e.inputs.x,n=e.attrs,r=n.begin,a=n.size,o=e.backend,i=Fi(t,r,a),u=s(i,2),c=u[0],l=u[1],p=Oi(t.shape,c,l),d=o.readSync(t.dataId),h=o.makeOutput(l,t.dtype),f=de(t.shape),m=o.dataIdMap.get(h.dataId);if(p){var g=Mi(c,f);return"string"===t.dtype?m.stringBytes=d.slice(g,g+Y(l)):o.typedArrayFromHeap(h).set(d.subarray(g,g+Y(l))),h}if("string"===t.dtype){var v=gp(d,c,l,t.shape,t.dtype);return m.stringBytes=v,h}var y=o.typedArrayFromHeap(h),b=t.shape.length;if(2===b)!function(e,t,n,r,a){for(var o=0,i=r[0],s=r[1],u=i+a[0],c=i;c<u;c++){var l=c*t+s;n.set(e.subarray(l,l+a[1]),o),o+=a[1]}}(d,f[0],y,c,l);else if(3===b)!function(e,t,n,r,a,o){for(var i=0,s=a[0],u=a[1],c=a[2],l=s+o[0],p=u+o[1],d=s;d<l;d++)for(var h=u;h<p;h++){var f=d*t+h*n+c;r.set(e.subarray(f,f+o[2]),i),i+=o[2]}}(d,f[0],f[1],y,c,l);else if(4===b)!function(e,t,n,r,a,o,i){for(var s=0,u=o[0],c=o[1],l=o[2],p=u+i[0],d=c+i[1],h=l+i[2],f=o[3],m=u;m<p;m++)for(var g=c;g<d;g++)for(var v=l;v<h;v++){var y=m*t+g*n+v*r+f;a.set(e.subarray(y,y+i[3]),s),s+=i[3]}}(d,f[0],f[1],f[2],y,c,l);else{var x=gp(d,c,l,t.shape,t.dtype);y.set(x)}return h}var xb={kernelName:Lt,backendName:"wasm",kernelFunc:bb},wb={kernelName:Me,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.blockShape,i=r.crops,s=o.reduce((function(e,t){return e*t})),u=Gu(a.shape,o,s),c=ju(u.length,o.length),l=Hu(a.shape,o,s),p=qu(i,o.length),d=Xu(l,i,o.length),h=mb({inputs:{x:a},backend:n,attrs:{shape:u}}),f=ab({inputs:{x:h},backend:n,attrs:{perm:c}}),m=bb({inputs:{x:mb({inputs:{x:f},backend:n,attrs:{shape:l}})},backend:n,attrs:{begin:p,size:d}});return n.disposeData(h.dataId),n.disposeData(f.dataId),n.disposeData(h.dataId),m}};function kb(e){var t=e.inputs.x,n=e.attrs.dtype,r=e.backend,a=r.makeOutput(t.shape,n),o=r.typedArrayFromHeap(t);return r.typedArrayFromHeap(a).set(o),a}var Ib,Sb={kernelName:De,backendName:"wasm",kernelFunc:kb},Tb=Yy("Ceil"),_b={kernelName:Pe,backendName:"wasm",setupFunc:function(e){Ib=e.wasm.cwrap(Pe,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.clipValueMin,i=r.clipValueMax,s=n.dataIdMap.get(a.dataId).id,u=n.makeOutput(a.shape,a.dtype),c=n.dataIdMap.get(u.dataId).id;return Ib(s,o,i,c),u}};function Cb(e){var t=e.inputs,n=e.backend,r=ne(e.attrs.axis,t[0].shape)[0];Du(t.map((function(e){return e.shape})),r);var a=Pu(t.map((function(e){return e.shape})),r),o=t.filter((function(e){return Y(e.shape)>0}));if(1===o.length)return tb({inputs:{x:o[0]},backend:n});var i=n.makeOutput(a,t[0].dtype);if(0===Y(a))return i;if("string"===o[0].dtype){var s=o.map((function(e){var t=Y(e.shape.slice(r));return mb({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),u=s.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}}));a=Pu(s.map((function(e){return e.shape})),1);var c=1===s[0].shape[0],l=Kl(u,a,t[0].dtype,c),p=Pu(o.map((function(e){return e.shape})),r);return i.shape=p,n.dataIdMap.get(i.dataId).stringBytes=Sc(l),s.forEach((function(e){return n.disposeData(e.dataId)})),i}for(var d=Y(o[0].shape.slice(0,r)),h=0,f=o.map((function(e){var t=Y(e.shape.slice(r));return h+=t,t})),m=o.map((function(e){return n.typedArrayFromHeap(e)})),g=n.typedArrayFromHeap(i),v=0;v<d;v++)for(var y=v*h,b=0;b<m.length;b++){var x=f[b],w=v*x,k=m[b].subarray(w,w+x);g.set(k,y),y+=x}return i}var Nb,Eb,Rb,Ab,Ob={kernelName:Be,backendName:"wasm",kernelFunc:Cb},Mb={kernelName:Ue,backendName:"wasm",setupFunc:function(e){Nb=e.wasm.cwrap(Ue,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,i=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(o.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,d=ts(n.dataFormat),h=qi(a.shape,o.shape,u,c,l,p,!1,d),f=h.filterHeight,m=h.filterWidth,g=h.padInfo.top,v=h.padInfo.right,y=h.padInfo.bottom,b=h.padInfo.left,x=h.dilationHeight,w=h.dilationWidth,k=h.strideHeight,I=h.strideWidth,S=h.inChannels,T=h.outChannels,_="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var C=r.makeOutput(h.outShape,"float32"),N=r.dataIdMap.get(C.dataId).id;return Nb(i,a.shape[0],a.shape[1],a.shape[2],s,f,m,g,v,y,b,_,x,w,k,I,S,T,N),C}},Fb={kernelName:We,backendName:"wasm",setupFunc:function(e){Eb=e.wasm.cwrap(We,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.dy,o=n.filter,i=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,p=r.inputShape,d=ts(c),h=qi(p,o.shape,i,1,u,l,!1,d),f=h.batchSize,m=h.filterHeight,g=h.filterWidth,v=h.inChannels,y=h.inHeight,b=h.inWidth,x=h.outChannels,w=h.outHeight,k=h.outWidth,I=h.strideHeight,S=h.strideWidth,T=m-1-h.padInfo.top,_=g-1-h.padInfo.left,C="channelsLast"===h.dataFormat,N=de(h.inShape),E=de(a.shape),R=de(o.shape),A=s(R,3),O=A[0],M=A[1],F=A[2],D=N[0],P=C?N[1]:N[2],L=C?N[2]:1,B=C?1:N[1],U=E[0],V=C?E[1]:E[2],W=C?E[2]:1,z=C?1:E[1],G=t.makeOutput(h.inShape,"float32"),j=t.dataIdMap.get(G.dataId).id,H=t.dataIdMap.get(a.dataId).id,q=t.dataIdMap.get(o.dataId).id;return Eb(H,q,f,m,g,y,b,v,w,k,x,I,S,T,_,O,M,F,D,P,L,B,U,V,W,z,j),G}},Db=Yy("Cos"),Pb=Yy("Cosh");!function(e){e[e.bilinear=0]="bilinear",e[e.nearest=1]="nearest"}(Rb||(Rb={}));var Lb,Bb,Ub,Vb,Wb={kernelName:je,backendName:"wasm",setupFunc:function(e){Ab=e.wasm.cwrap(je,null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,o=a.method,i=a.extrapolationValue,u=a.cropSize,c=r.image,l=r.boxes,p=r.boxInd,d=l.shape[0],h=s(u,2),f=h[0],m=h[1],g=[d,f,m,c.shape[3]],v=n.dataIdMap.get(c.dataId);"float32"!==c.dtype&&(t=kb({backend:n,inputs:{x:c},attrs:{dtype:"float32"}}),v=n.dataIdMap.get(t.dataId));var y=v.id,b=n.dataIdMap.get(l.dataId).id,x=n.dataIdMap.get(p.dataId).id,w=n.makeOutput(g,"float32"),k=n.dataIdMap.get(w.dataId).id,I=new Uint8Array(new Int32Array(c.shape).buffer);return Ab(y,b,x,d,I,f,m,Rb[o],i,k),null!=t&&n.disposeData(t.dataId),w}},zb={kernelName:ze,backendName:"wasm",setupFunc:function(e){Lb=e.wasm.cwrap(ze,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.exclusive,s=r.reverse,u=a.shape.length;H("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumprod does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Is([o],u),l=a;null!==c&&(l=ab({inputs:{x:a},attrs:{perm:c},backend:n}));var p=Ts(1,u)[0];ks("cumprod",[p],u);var d=n.makeOutput(l.shape,l.dtype),h=l.shape[p],f=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(d.dataId).id;Lb(f,i?1:0,s?1:0,h,m,Ly[a.dtype]);var g=d;return null!==c&&(g=ab({inputs:{x:d},attrs:{perm:Ss(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(d.dataId)),g}},Gb={kernelName:Ge,backendName:"wasm",setupFunc:function(e){Bb=e.wasm.cwrap(Ge,null,["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.axis,i=r.exclusive,s=r.reverse,u=a.shape.length;H("float32"===a.dtype||"int32"===a.dtype,(function(){return"cumsum does not support ".concat(a.dtype," tensors in the WASM backend")}));var c=Is([o],u),l=a;null!==c&&(l=ab({inputs:{x:a},attrs:{perm:c},backend:n}));var p=Ts(1,u)[0];ks("cumsum",[p],u);var d=n.makeOutput(l.shape,l.dtype),h=l.shape[p],f=n.dataIdMap.get(l.dataId).id,m=n.dataIdMap.get(d.dataId).id;Bb(f,i?1:0,s?1:0,h,m,Ly[a.dtype]);var g=d;return null!==c&&(g=ab({inputs:{x:d},attrs:{perm:Ss(c)},backend:n}),n.disposeData(l.dataId),n.disposeData(d.dataId)),g}},jb={kernelName:He,backendName:"wasm",setupFunc:function(e){Ub=e.wasm.cwrap(He,null,["number","number","number","array","number","array","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=r.blockSize,i=r.dataFormat,s=a.shape[0],u=("NHWC"===i?a.shape[1]:a.shape[2])*o,c=("NHWC"===i?a.shape[2]:a.shape[3])*o,l=("NHWC"===i?a.shape[3]:a.shape[1])/(o*o),p="NHWC"===i?[s,u,c,l]:[s,l,u,c],d=t.makeOutput(p,"float32"),h=t.dataIdMap.get(a.dataId).id,f=new Uint8Array(new Int32Array(de(a.shape)).buffer),m=new Uint8Array(new Int32Array(p).buffer),g=new Uint8Array(new Int32Array(de(p)).buffer),v=t.dataIdMap.get(d.dataId).id;return Ub(h,o,"NHWC"===i?1:0,f,a.shape.length-1,m,g,p.length,v),d}},Hb={kernelName:qe,backendName:"wasm",setupFunc:function(e){Vb=e.wasm.cwrap(qe,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,i=r.dataIdMap.get(a.dataId).id,s=r.dataIdMap.get(o.dataId).id,u=n.strides,c=n.dilations,l=n.pad,p=n.dimRoundingMode,d=null==c?[1,1]:c,h=qi(a.shape,o.shape,u,d,l,p,!0),f=h.filterHeight,m=h.filterWidth,g=h.padInfo.top,v=h.padInfo.right,y=h.padInfo.bottom,b=h.padInfo.left,x=h.dilationHeight,w=h.dilationWidth,k=h.strideHeight,I=h.strideWidth,S=h.inChannels,T=h.outChannels,_="SAME"===h.padInfo.type?1:0;if("channelsLast"!==h.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'".concat(h.dataFormat,"'. Please use 'channelsLast'."));var C=r.makeOutput(h.outShape,"float32"),N=r.dataIdMap.get(C.dataId).id;return Vb(i,a.shape[0],a.shape[1],a.shape[2],s,f,m,g,v,y,b,_,x,w,k,I,S,T,N),C}},qb=Yy("Elu"),Xb=Jy("Equal",0,"bool"),Kb=Yy("Exp","float32");function Yb(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.input,o=n.dim,i=a.shape.length,s=a.shape.slice(),u=o;return o<0&&(H(-(i+1)<=o,(function(){return"Axis must be in the interval [".concat(-(i+1),", ").concat(i,"]")})),u=i+o+1),s.splice(u,0,1),mb({inputs:{x:a},backend:r,attrs:{shape:s}})}var Qb={kernelName:Qe,backendName:"wasm",kernelFunc:Yb};function Jb(e){var t=e.attrs,n=t.shape,r=t.value,a=t.dtype,o=e.backend,i=o.makeOutput(n,a);return o.typedArrayFromHeap(i).fill(r),i}var Zb,$b,ex,tx,nx,rx,ax,ox,ix,sx,ux,cx,lx,px={kernelName:Je,backendName:"wasm",kernelFunc:Jb},dx={kernelName:Ze,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n.makeOutput(r.shape,r.dtype),o=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,u=s(r.shape,4),c=u[0],l=u[1],p=u[2],d=u[3];return Zb(o,c,l,p,d,i),a},setupFunc:function(e){Zb=e.wasm.cwrap(Ze,null,["number","number","number","number","number","number"])}},hx=Yy("Floor"),fx=Jy($e),mx={kernelName:et,backendName:"wasm",setupFunc:function(e){$b=e.wasm.cwrap(et,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.varianceEpsilon,a=n.x,o=n.mean,i=n.variance,s=n.offset,u=n.scale,c=t.dataIdMap.get(a.dataId).id,l=t.dataIdMap.get(o.dataId).id,p=t.dataIdMap.get(i.dataId).id,d=null!=s?t.dataIdMap.get(s.dataId).id:0,h=null!=u?t.dataIdMap.get(u.dataId).id:0,f=t.makeOutput(a.shape,a.dtype);if(0===Y(a.shape))return f;var m=t.dataIdMap.get(f.dataId).id;return $b(c,l,p,d,h,r,m),f}},gx={kernelName:ln,backendName:"wasm",setupFunc:function(e){ex=e.wasm.cwrap(ln,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,i=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,d=n.dimRoundingMode,h=n.activation,f=n.leakyreluAlpha,m=qi(a.shape,o.shape,u,l,c,d),g=By[h];if(null==g)throw new Error("".concat(h," activation not yet supported for FusedConv2D in the wasm backend."));var v=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(o.dataId).id,b=m.outChannels,x=0;if(null!=i){var w=r.dataIdMap.get(i.dataId);if(1!==w.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank ".concat(w.shape.length,"."));if(w.shape[0]!==b)throw new Error("FusedConv2D bias shape (".concat(w.shape,") does not match the number of output channels (").concat(b,")"));x=w.id}var k=m.filterHeight,I=m.filterWidth,S=m.padInfo.top,T=m.padInfo.right,_=m.padInfo.bottom,C=m.padInfo.left,N=m.dilationHeight,E=m.dilationWidth,R=m.strideHeight,A=m.strideWidth,O=m.inChannels,M="SAME"===m.padInfo.type?1:0,F=m.batchSize,D=m.inHeight,P=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var L=r.makeOutput(m.outShape,"float32"),B=r.dataIdMap.get(L.dataId).id,U=null==s?0:r.dataIdMap.get(s.dataId).id;return ex(v,F,D,P,y,k,I,x,S,T,_,C,M,N,E,R,A,O,b,g,U,f||0,B),L}},vx={kernelName:pn,backendName:"wasm",setupFunc:function(e){tx=e.wasm.cwrap(pn,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=t.filter,i=t.bias,s=t.preluActivationWeights,u=n.strides,c=n.pad,l=n.dilations,p=n.dataFormat,d=n.dimRoundingMode,h=n.activation,f=n.leakyreluAlpha,m=qi(a.shape,o.shape,u,l,c,d,!0),g=By[h];if(null==g)throw new Error("".concat(h," activation not yet supported for FusedDepthwiseConv2D in the wasm backend."));var v=r.dataIdMap.get(a.dataId).id,y=r.dataIdMap.get(o.dataId).id,b=m.outChannels,x=0;if(null!=i){var w=r.dataIdMap.get(i.dataId);if(1!==w.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank ".concat(w.shape.length,"."));if(w.shape[0]!==b)throw new Error("FusedDepthwiseConv2D bias shape (".concat(w.shape,") does not match the number of output channels (").concat(b,")"));x=w.id}var k=m.filterHeight,I=m.filterWidth,S=m.padInfo.top,T=m.padInfo.right,_=m.padInfo.bottom,C=m.padInfo.left,N=m.dilationHeight,E=m.dilationWidth,R=m.strideHeight,A=m.strideWidth,O=m.inChannels,M="SAME"===m.padInfo.type?1:0,F=m.batchSize,D=m.inHeight,P=m.inWidth;if("NHWC"!==p)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'".concat(p,"'. Please use 'NHWC'."));var L=r.makeOutput(m.outShape,"float32"),B=r.dataIdMap.get(L.dataId).id,U=null==s?0:r.dataIdMap.get(s.dataId).id;return tx(v,F,D,P,y,k,I,x,S,T,_,C,M,N,E,R,A,O,b,g,U,f||0,B),L}},yx={kernelName:nt,backendName:"wasm",setupFunc:function(e){nx=e.wasm.cwrap(nt,null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.params,a=n.indices,o=bi(r,a),i=s(o,4),u=i[0],c=i[1],l=i[2],p=i[3],d=t.makeOutput(u,r.dtype);if(0===c)return d;var h=a.shape,f=h[h.length-1],m=t.dataIdMap.get(r.dataId).id,g=t.dataIdMap.get(a.dataId).id,v=new Uint8Array(new Int32Array(p).buffer),y=t.dataIdMap.get(d.dataId).id;return nx(m,Ly[r.dtype],g,c,f,l,v,y),d}},bx={kernelName:tt,backendName:"wasm",setupFunc:function(e){rx=e.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(e){for(var t=e.backend,n=e.inputs,r=e.attrs,a=n.x,o=n.indices,i=r.axis,s=r.batchDims,u=ne(i,a.shape)[0],c=t.readSync(o.dataId),l=a.shape[u],p=function(){var e=c[d];H(e<=l-1&&e>=0,(function(){return"GatherV2: the index value ".concat(e," is not in [0, ").concat(l-1,"]")}))},d=0;d<c.length;++d)p();var h=wc(a,o,u,s),f=mb({inputs:{x:a},attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]},backend:t}),m=Y(o.shape),g=mb({inputs:{x:o},attrs:{shape:[h.batchSize,m/h.batchSize]},backend:t}),v=[h.batchSize,h.outerSize,m/h.batchSize,h.sliceSize],y=t.makeOutput(v,a.dtype);if(0===Y(a.shape))return y;var b=f.shape.length-1,x=t.dataIdMap.get(f.dataId).id,w=t.dataIdMap.get(g.dataId).id,k=t.dataIdMap.get(y.dataId).id,I=new Uint8Array(new Int32Array(de(f.shape)).buffer),S=new Uint8Array(new Int32Array(de(v)).buffer);return rx(x,Ly[a.dtype],I,b,w,h.batchSize,S,k),t.disposeData(f.dataId),t.disposeData(g.dataId),y.shape=h.outputShape,y}},xx=Jy(rt,0,"bool"),kx=Jy(at,0,"bool"),Ix={kernelName:it,backendName:"wasm",setupFunc:function(e){ax=e.wasm.cwrap(it,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.inputs.x,n=e.attrs.alpha,r=e.backend,a=r.dataIdMap.get(t.dataId).id,o=r.makeOutput(t.shape,"float32");if(0!==Y(t.shape)){var i=r.dataIdMap.get(o.dataId).id;ax(a,Ly[t.dtype],n,i)}return o}},Sx=Jy("Less",0,"bool"),Tx=Jy(st,0,"bool"),_x=Yy("Log"),Cx=Jy(ut,0,"bool"),Nx=Yy(ct),Ex=Jy(lt,0,"bool"),Rx=Jy("LogicalXor",0,"bool"),Ax={kernelName:"Max",backendName:"wasm",setupFunc:function(e){ox=e.wasm.cwrap("Max",null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.reductionIndices,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=i,l=sb(i,a,t),p=l.transposed,d=l.axes,h=l.originalAxes,f=l.inputWasTransposed;f&&(c=p,u=t.dataIdMap.get(p.dataId).id),ks("max",d,c.shape.length);var m=xs(c.shape,d),g=s(m,2),v=g[0],y=Y(g[1]),b=t.makeOutput(v,i.dtype);if(0!==Y(c.shape)){var x=t.dataIdMap.get(b.dataId).id;ox(u,Ly[i.dtype],y,x)}if(f&&t.disposeData(p.dataId),o){var w=ws(b.shape,h);b.shape=w}return b}},Ox=Jy(pt),Mx={kernelName:dt,backendName:"wasm",setupFunc:function(e){ix=e.wasm.cwrap(dt,null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,o=r.dataIdMap.get(a.dataId).id;H("float32"===a.dtype,(function(){return"Error in MaxPool: only float32 input is supported. Got ".concat(a.dtype,".")}));var i=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode,l=ji(a.shape,i,s,1,u,c),p=l.filterHeight,d=l.filterWidth,h=l.padInfo.top,f=l.padInfo.right,m=l.padInfo.bottom,g=l.padInfo.left,v=l.dilationHeight,y=l.dilationWidth,b=l.strideHeight,x=l.strideWidth,w=l.inChannels,k=l.outChannels;if("channelsLast"!==l.dataFormat)throw new Error("wasm backend does not support dataFormat:'".concat(l.dataFormat,"'. Please use 'channelsLast'."));var I=r.makeOutput(l.outShape,"float32"),S=r.dataIdMap.get(I.dataId).id;return ix(o,a.shape[0],a.shape[1],a.shape[2],p,d,h,f,m,g,v,y,b,x,w,k,S),I}},Fx={kernelName:ht,backendName:"wasm",setupFunc:function(e){sx=e.wasm.cwrap(ht,null,["number, number, number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=u,l=i,p=sb(i,a,t),d=p.transposed,h=p.axes,f=p.originalAxes,m=p.inputWasTransposed,g=h;if(m){var v=t.dataIdMap.get(d.dataId).id;v!==u&&(l=d,c=v,g=Ts(g.length,l.shape.length))}ks("mean",g,l.shape.length);var y=xs(l.shape,g),b=s(y,2),x=b[0],w=Y(b[1]),k=l;"float32"!==l.dtype&&(k=kb({backend:t,inputs:{x:l},attrs:{dtype:"float32"}}),c=t.dataIdMap.get(k.dataId).id);var I=t.makeOutput(x,"float32");if(0!==Y(l.shape)){var S=t.dataIdMap.get(I.dataId).id;sx(c,w,S)}if(m&&t.disposeData(d.dataId),o){var T=ws(I.shape,f);I.shape=T}return"float32"!==l.dtype&&t.disposeData(k.dataId),I}},Dx={kernelName:"Min",backendName:"wasm",setupFunc:function(e){ux=e.wasm.cwrap("Min",null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=u,l=i,p=sb(i,a,t),d=p.transposed,h=p.axes,f=p.originalAxes,m=p.inputWasTransposed;if(m){var g=t.dataIdMap.get(d.dataId).id;g!==u&&(l=d,c=g)}ks("min",h,l.shape.length);var v=xs(l.shape,h),y=s(v,2),b=y[0],x=Y(y[1]),w=t.makeOutput(b,l.dtype);if(0!==Y(l.shape)){var k=t.dataIdMap.get(w.dataId).id;ux(c,Ly[i.dtype],x,k)}if(m&&t.disposeData(d.dataId),o){var I=ws(w.shape,f);w.shape=I}return w}},Px=Jy(ft);!function(e){e[e.reflect=0]="reflect",e[e.symmetric=1]="symmetric"}(cx||(cx={}));var Lx,Bx={kernelName:mt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,o=r.mode,i=a.map((function(e,n){return e[0]+t.shape[n]+e[1]})),s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(i,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),d=a.map((function(e){return e[1]})),h=new Uint8Array(new Int32Array(p).buffer),f=new Uint8Array(new Int32Array(d).buffer);return lx(s,l,t.shape.length,Ly[t.dtype],h,f,cx[o],c),u},setupFunc:function(e){lx=e.wasm.cwrap(mt,null,["number","array","number","number","array","array","number","number"])}},Ux=Jy(gt),Vx=Yy("Neg");function Wx(e,t){var n=new Int32Array(e.wasm.HEAPU8.buffer,t,4),r=n[0],a=n[1],o=n[2],i=n[3];return e.wasm._free(t),{pSelectedIndices:r,selectedSize:a,pSelectedScores:o,pValidOutputs:i}}var zx,Gx,jx,Hx,qx,Xx,Kx,Yx,Qx,Jx,Zx,$x,ew,tw,nw,rw,aw,ow={kernelName:yt,backendName:"wasm",setupFunc:function(e){Lx=e.wasm.cwrap(yt,"number",["number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,i=r.scoreThreshold,s=n.boxes,u=n.scores,c=t.dataIdMap.get(s.dataId).id,l=t.dataIdMap.get(u.dataId).id,p=Wx(t,Lx(c,l,o,a,i)),d=p.pSelectedIndices,h=p.selectedSize,f=p.pSelectedScores,m=p.pValidOutputs;return t.wasm._free(f),t.wasm._free(m),t.makeOutput([h],"int32",d)}},iw={kernelName:bt,backendName:"wasm",setupFunc:function(e){zx=e.wasm.cwrap(bt,"number",["number","number","number","number","number","bool"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,i=r.scoreThreshold,s=r.padToMaxOutputSize,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,d=Wx(t,zx(l,p,o,a,i,s)),h=d.pSelectedIndices,f=d.selectedSize,m=d.pSelectedScores,g=d.pValidOutputs;return t.wasm._free(m),[t.makeOutput([f],"int32",h),t.makeOutput([],"int32",g)]}},sw={kernelName:xt,backendName:"wasm",setupFunc:function(e){Gx=e.wasm.cwrap(xt,"number",["number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.iouThreshold,o=r.maxOutputSize,i=r.scoreThreshold,s=r.softNmsSigma,u=n.boxes,c=n.scores,l=t.dataIdMap.get(u.dataId).id,p=t.dataIdMap.get(c.dataId).id,d=Wx(t,Gx(l,p,o,a,i,s)),h=d.pSelectedIndices,f=d.selectedSize,m=d.pSelectedScores,g=d.pValidOutputs;return t.wasm._free(g),[t.makeOutput([f],"int32",h),t.makeOutput([f],"float32",m)]}},uw=Jy(vt,0,"bool"),cw={kernelName:kt,backendName:"wasm",setupFunc:function(e){jx=e.wasm.cwrap(kt,null,["number","number","number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,s=r.depth,u=r.onValue,c=r.offValue,l=n.makeOutput([].concat(o(a.shape),[s]),i),p=n.dataIdMap.get(l.dataId).id,d=n.dataIdMap.get(a.dataId).id;return jx(d,s,u,c,p),l}},lw={kernelName:wt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(1),r}},pw={kernelName:It,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Yb({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,o=t[0].dtype;t.forEach((function(e){q(a,e.shape,"All tensors passed to stack must have matching shapes"),H(o===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=[],s=Cb({inputs:t.map((function(e){var t=Yb({inputs:{input:e},backend:n,attrs:{dim:r}});return i.push(t),t})),backend:n,attrs:{axis:r}});return i.forEach((function(e){return n.disposeData(e.dataId)})),s}},dw={kernelName:St,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=e.attrs,a=r.paddings,o=r.constantValue,i=a.map((function(e,n){return e[0]+t.shape[n]+e[1]}));if(0===Y(t.shape))return Jb({backend:n,attrs:{shape:i,value:o,dtype:t.dtype}});var s=n.dataIdMap.get(t.dataId).id,u=n.makeOutput(i,t.dtype),c=n.dataIdMap.get(u.dataId).id,l=new Uint8Array(new Int32Array(t.shape).buffer),p=a.map((function(e){return e[0]})),d=a.map((function(e){return e[1]})),h=new Uint8Array(new Int32Array(p).buffer),f=new Uint8Array(new Int32Array(d).buffer);return Hx(s,l,t.shape.length,Ly[t.dtype],h,f,o,c),u},setupFunc:function(e){Hx=e.wasm.cwrap(St,null,["number","array","number","number","array","array","number","number"])}},hw=Jy("Pow"),fw={kernelName:Tt,backendName:"wasm",setupFunc:function(e){qx=e.wasm.cwrap(Tt,null,["number","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,o=n.dataIdMap.get(r.dataId).id,i=n.dataIdMap.get(a.dataId).id,s=o,u=r,c=u;"float32"!==u.dtype&&(c=kb({backend:n,inputs:{x:r},attrs:{dtype:"float32"}}),s=n.dataIdMap.get(c.dataId).id);var l=n.makeOutput(r.shape,"float32"),p=n.dataIdMap.get(l.dataId).id;return qx(s,i,p),"float32"!==u.dtype&&n.disposeData(c.dataId),l}},mw={kernelName:_t,backendName:"wasm",setupFunc:function(e){Xx=e.wasm.cwrap(_t,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=u,l=i,p=sb(i,a,t),d=p.transposed,h=p.axes,f=p.originalAxes,m=p.inputWasTransposed,g=h;if(m){var v=t.dataIdMap.get(d.dataId).id;v!==u&&(l=d,c=v,g=Ts(g.length,l.shape.length))}ks("prod",g,l.shape.length);var y=xs(l.shape,g),b=s(y,2),x=b[0],w=Y(b[1]),k=t.makeOutput(x,l.dtype);if(0!==Y(l.shape)){var I=t.dataIdMap.get(k.dataId).id;Xx(c,w,Ly[k.dtype],I)}if(m&&t.disposeData(d.dataId),o){var S=ws(k.shape,f);k.shape=S}return k}},gw={kernelName:Ct,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,o=n.step,i=n.dtype,s=hp(r,a,o,i),u=t.makeOutput([s.length],i);return t.typedArrayFromHeap(u).set(s),u}},vw=Jy(Ye),yw=Yy(Nt),bw=Yy(Ot),xw={kernelName:At,backendName:"wasm",setupFunc:function(e){Kx=e.wasm.cwrap(At,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,o=r.images,i=a.alignCorners,u=a.halfPixelCenters,c=a.size,l=s(c,2),p=l[0],d=l[1],h=s(o.shape,4),f=h[0],m=h[1],g=h[2],v=h[3],y=[f,p,d,v],b=n.dataIdMap.get(o.dataId);"float32"!==b.dtype&&(t=kb({backend:n,inputs:{x:o},attrs:{dtype:"float32"}}),b=n.dataIdMap.get(t.dataId));var x=b.id,w=n.makeOutput(y,"float32");if(0===Y(o.shape))return w;var k=n.dataIdMap.get(w.dataId).id;return Kx(x,f,m,g,v,p,d,i?1:0,u?1:0,k),null!=t&&n.disposeData(t.dataId),w}},ww={kernelName:Rt,backendName:"wasm",setupFunc:function(e){Yx=e.wasm.cwrap(Rt,null,["number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.images,o=r.alignCorners,i=r.halfPixelCenters,u=r.size,c=s(u,2),l=c[0],p=c[1],d=s(a.shape,4),h=d[0],f=d[1],m=d[2],g=d[3],v=[h,l,p,g],y=t.makeOutput(v,"float32");if(0===Y(a.shape))return y;var b,x=t.dataIdMap.get(a.dataId);"float32"!==x.dtype&&(b=kb({backend:t,inputs:{x:a},attrs:{dtype:"float32"}}),x=t.dataIdMap.get(b.dataId));var w=x.id,k=t.dataIdMap.get(y.dataId).id;return Yx(w,h,f,m,g,l,p,o?1:0,i?1:0,k),null!=b&&t.disposeData(b.dataId),y}},kw={kernelName:Mt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=ne(r.dims,a.shape);if(0===a.shape.length)return tb({inputs:{x:a},backend:n});var i=n.makeOutput(a.shape,a.dtype),s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(i.dataId).id,c=new Uint8Array(new Int32Array(o).buffer),l=new Uint8Array(new Int32Array(a.shape).buffer);Qx(s,c,o.length,l,a.shape.length,u);var p=mb({inputs:{x:i},attrs:{shape:a.shape},backend:n});return n.disposeData(i.dataId),p},setupFunc:function(e){Qx=e.wasm.cwrap(Mt,null,["number","array","number","array","number","number"])}},Iw={kernelName:un,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=r.radians,u=r.fillValue,c=r.center,l=n.makeOutput(a.shape,a.dtype),p=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(l.dataId).id,h=s(a.shape,4),f=h[0],m=h[1],g=h[2],v=h[3],y=zu(c,m,g),b=s(y,2),x=b[0],w=b[1],k="number"==typeof u?[u,u,u,0===u?0:255]:[].concat(o(u),[255]),I=new Uint8Array(new Int32Array(k).buffer);return Jx(p,f,m,g,v,i,x,w,I,k.length,d),l},setupFunc:function(e){Jx=e.wasm.cwrap(un,null,["number","number","number","number","number","number","number","number","array","number","number"])}},Sw=Yy(Ft),Tw=Yy("Rsqrt"),_w={kernelName:Dt,backendName:"wasm",setupFunc:function(e){Zx=e.wasm.cwrap(Dt,null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.indices,o=n.updates,i=r.shape,s=t.makeOutput(i,o.dtype);if(0===Y(i))return s;var u=wi(0,a,i),c=u.sliceRank,l=u.numUpdates,p=u.sliceSize,d=u.strides,h=u.outputSize,f=t.dataIdMap.get(a.dataId).id,m=t.dataIdMap.get(o.dataId).id,g=new Uint8Array(new Int32Array(d).buffer),v=t.dataIdMap.get(s.dataId).id;return Zx(f,m,Ly[o.dtype],c,l,p,g,h,v),s}},Cw={kernelName:Pt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,o=t.e,i=n.dataIdMap.get(r.dataId).id,s=n.dataIdMap.get(a.dataId).id,u=n.dataIdMap.get(o.dataId).id,c=n.makeOutput(a.shape,a.dtype),l=n.dataIdMap.get(c.dataId).id,p=r.shape.length,d=a.shape.length,h=0===p||p>1||1===d?1:Y(a.shape.slice(1));return $x(i,s,u,h,l),c},setupFunc:function(e){$x=e.wasm.cwrap("SelectV2",null,["number","number","number","number","number"])}},Nw={kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(e){ew=e.wasm.cwrap(Bt,null,["number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.x,r=t.dataIdMap.get(n.dataId).id,a=t.makeOutput(n.shape,n.dtype),o=t.dataIdMap.get(a.dataId).id;return 0===Y(a.shape)||ew(r,o),a}},Ew=Yy("Sin"),Rw={kernelName:Gt,backendName:"wasm",setupFunc:function(e){tw=e.wasm.cwrap(Gt,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs.logits,r=e.attrs.dim,a=t.dataIdMap.get(n.dataId).id,o=t.makeOutput(n.shape,n.dtype),i=t.dataIdMap.get(o.dataId).id,s=n.shape[r],u=Y(n.shape)/s;return 0===Y(o.shape)||tw(a,i,s,u),o}},Aw={kernelName:Wt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,s=r.paddings,u=Y(i),c=[[0,0]];c.push.apply(c,o(s));for(var l=1+i.length;l<a.shape.length;++l)c.push([0,0]);var p=dw.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:c,constantValue:0}}),d=Gu(p.shape,i,u,!1),h=ju(d.length,i.length,!1),f=Hu(p.shape,i,u,!1),m=mb({inputs:{x:p},backend:n,attrs:{shape:d}}),g=ab({inputs:{x:m},backend:n,attrs:{perm:h}}),v=mb({inputs:{x:g},backend:n,attrs:{shape:f}});return n.disposeData(p.dataId),n.disposeData(m.dataId),n.disposeData(g.dataId),v}},Ow={kernelName:jt,backendName:"wasm",setupFunc:function(e){nw=e.wasm.cwrap("SparseFillEmptyRows","number",["number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=r.indices,o=r.values,i=r.denseShape,s=r.defaultValue,u=a.shape[0],c=a.shape[1],l=n.readSync(i.dataId)[0],p=[u+l,c],d=n.dataIdMap.get(a.dataId).id,h=n.dataIdMap.get(o.dataId).id,f=n.dataIdMap.get(s.dataId).id,m=n.makeOutput(p,a.dtype),g=n.dataIdMap.get(m.dataId).id,v=n.makeOutput(p.slice(0,1),o.dtype),y=n.dataIdMap.get(v.dataId).id,b=n.makeOutput([l],"bool"),x=n.dataIdMap.get(b.dataId).id,w=n.makeOutput([u],a.dtype),k=n.dataIdMap.get(w.dataId).id,I=n.makeOutput([4],"int32"),S=n.dataIdMap.get(I.dataId).id,T=nw(d,h,Ly[o.dtype],u,l,c,f,g,y,x,k,S),_=n.readSync(I.dataId);switch(_[0]){case 1:t=lc(_[1]);break;case 2:t=pc(_[1],_[2]);break;case 3:t=dc(_[1],_[2],_[3]);break;default:t=""}if(n.disposeData(I.dataId),t)throw n.disposeData(m.dataId),n.disposeData(v.dataId),n.disposeData(b.dataId),n.disposeData(w.dataId),new Error(t);var C=m,N=v;return T!==p[0]&&(C=bb({inputs:{x:m},attrs:{begin:0,size:[T,c]},backend:n}),N=bb({inputs:{x:v},attrs:{begin:0,size:T},backend:n}),n.disposeData(m.dataId),n.disposeData(v.dataId)),[C,N,b,w]}},Mw={kernelName:Ht,backendName:"wasm",setupFunc:function(e){rw=e.wasm.cwrap(Ht,null,["number","number","number","number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=n.inputIndices,a=n.inputShape,o=n.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==o.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(o.shape));var i=t.dataIdMap.get(r.dataId).id,s=t.dataIdMap.get(a.dataId).id,u=t.dataIdMap.get(o.dataId).id,c=r.shape[0],l=Y(o.shape),p=t.makeOutput([c,l],r.dtype),d=t.dataIdMap.get(p.dataId).id,h=t.makeOutput([l],o.dtype),f=t.dataIdMap.get(h.dataId).id,m=t.makeOutput([3],"int32"),g=t.dataIdMap.get(m.dataId).id;rw(i,s,u,c,d,f,g);var v,y=t.readSync(m.dataId);switch(y[0]){case 0:v=hc(y[1],y[2]);break;case 1:v=fc(y[1],y[2]);break;case 2:v="reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero";break;case 3:v=mc(Array.from(t.readSync(a.dataId)),Array.from(t.readSync(h.dataId)));break;case 4:v=gc(Array.from(t.readSync(a.dataId)),Array.from(t.readSync(h.dataId)));break;default:v=""}if(t.disposeData(m.dataId),v)throw t.disposeData(p.dataId),t.disposeData(h.dataId),new Error(v);return[p,h]}};function Fw(e){aw=e.wasm.cwrap("SparseSegmentReduction",null,["number","number","number","number","number","number","number","number","number"])}function Dw(e,t){var n=e.backend,r=e.inputs,a=r.data,o=r.indices,i=r.segmentIds,s=o.shape[0],u=n.readSync(i.dataId,s-1,s)[0],c=s>0?u+1:0;if(c<0)throw new Error("segment ids must be >= 0");var l=a.shape.slice();l[0]=c;var p=n.dataIdMap.get(a.dataId).id,d=n.dataIdMap.get(o.dataId).id,h=n.dataIdMap.get(i.dataId).id,f=n.makeOutput(l,a.dtype),m=n.dataIdMap.get(f.dataId).id,g=n.makeOutput([4],"int32"),v=n.dataIdMap.get(g.dataId).id;aw(p,Ly[a.dtype],a.shape[0],d,h,m,v,t,0);var y,b=n.readSync(g.dataId);switch(b[0]){case 0:y="segment ids must be >= 0";break;case 1:y="segment ids are not increasing";break;case 2:y=vc(b[1],b[2]);break;case 3:y=yc(b[1],b[2],b[3]);break;default:y=""}if(n.disposeData(g.dataId),y)throw n.disposeData(f.dataId),new Error(y);return f}for(var Pw,Lw,Bw,Uw,Vw,Ww,zw={kernelName:qt,backendName:"wasm",setupFunc:Fw,kernelFunc:function(e){return Dw(e,!0)}},Gw={kernelName:Xt,backendName:"wasm",setupFunc:Fw,kernelFunc:function(e){return Dw(e,!1)}},jw={kernelName:zt,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.numOrSizeSplits,s=ne(n.axis,a.shape)[0],u=cc(a,i,s),c=new Array(a.shape.length).fill(0),l=a.shape.slice();return u.map((function(e){var t=o(l);t[s]=e;var n=bb({inputs:{x:a},attrs:{begin:c,size:t},backend:r});return c[s]+=e,n}))}},Hw=Yy(Ut),qw=Yy("Square"),Xw=Jy(Kt),Kw={kernelName:on,backendName:"wasm",setupFunc:function(e){Pw=e.wasm.cwrap(on,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs.alpha,a=n.x,o=t.dataIdMap.get(a.dataId).id,i=t.makeOutput(a.shape,a.dtype),s=t.dataIdMap.get(i.dataId).id;return Pw(o,r,Ly[a.dtype],s),i}},Yw={kernelName:Yt,backendName:"wasm",setupFunc:function(e){Lw=e.wasm.cwrap(Yt,null,["number","array","number","array","array","array","array","array","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,o=r.x,i=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,p=a.ellipsisMask,d=a.newAxisMask,h=a.shrinkAxisMask,f=Di(o.shape,i,s,u,c,l,p,d,h),m=f.finalShapeSparse,g=f.finalShape,v=f.isIdentity,y=f.sliceDim0,b=f.isSimpleSlice,x=f.begin,w=f.end,k=f.strides;if(v)t=mb({inputs:{x:o},backend:n,attrs:{shape:g}});else if(y||b){H(o.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(o.shape.length)}));var I=Ii(x,w,k),S=bb({inputs:{x:o},backend:n,attrs:{begin:x,size:I}});t=mb({inputs:{x:S},backend:n,attrs:{shape:g}}),n.disposeData(S.dataId)}else{var T=n.makeOutput(m,"float32"),_=n.dataIdMap.get(o.dataId).id,C=new Uint8Array(new Int32Array(de(o.shape)).buffer),N=new Uint8Array(new Int32Array(x).buffer),E=new Uint8Array(new Int32Array(w).buffer),R=new Uint8Array(new Int32Array(k).buffer),A=new Uint8Array(new Int32Array(m).buffer),O=new Uint8Array(new Int32Array(de(m)).buffer),M=n.dataIdMap.get(T.dataId).id;Lw(_,C,o.shape.length,N,E,R,A,O,m.length,M),t=mb({inputs:{x:T},backend:n,attrs:{shape:g}}),n.disposeData(T.dataId)}return t}},Qw={kernelName:Qt,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.data,o=n.dataSplits,i=r.separator,u=r.nGramWidths,c=r.leftPad,l=r.rightPad,p=r.padWidth,d=r.preserveShortSequences,h=xp(t.readSync(a.dataId),t.readSync(o.dataId),i,u,c,l,p,d),f=s(h,2),m=f[0],g=f[1],v=t.makeOutput([m.length],"string");t.dataIdMap.get(v.dataId).stringBytes=m;var y=t.makeOutput(o.shape,"int32");return t.typedArrayFromHeap(y).set(g),[v,y]}},Jw={kernelName:Jt,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,o=n.delimiter,i=r.skipEmpty,u=kp(t.readSync(a.dataId),t.readSync(o.dataId)[0],i),c=s(u,3),l=c[0],p=c[1],d=c[2],h=p.length,f=t.makeOutput([h,2],"int32");t.typedArrayFromHeap(f).set(l);var m=t.makeOutput([h],"string");t.dataIdMap.get(m.dataId).stringBytes=p;var g=t.makeOutput([2],"int32");return t.typedArrayFromHeap(g).set(d),[f,m,g]}},Zw={kernelName:Zt,backendName:"wasm",kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=n.input,o=r.numBuckets,i=Ip(t.readSync(a.dataId),o),s=t.makeOutput(a.shape,"int32");return t.typedArrayFromHeap(s).set(i),s}},$w=Jy("Sub"),ek={kernelName:Vt,backendName:"wasm",setupFunc:function(e){Bw=e.wasm.cwrap(Vt,null,["number","number","number","number"])},kernelFunc:function(e){var t=e.backend,n=e.inputs,r=e.attrs,a=r.axis,o=r.keepDims,i=n.x,u=t.dataIdMap.get(i.dataId).id,c=u,l=i,p=sb(i,a,t),d=p.transposed,h=p.axes,f=p.originalAxes,m=p.inputWasTransposed,g=h;if(m){var v=t.dataIdMap.get(d.dataId).id;v!==u&&(l=d,c=v,g=Ts(g.length,l.shape.length))}ks("sum",g,l.shape.length);var y=xs(l.shape,g),b=s(y,2),x=b[0],w=Y(b[1]),k=t.makeOutput(x,l.dtype);if(0!==Y(l.shape)){var I=t.dataIdMap.get(k.dataId).id;Bw(c,w,Ly[k.dtype],I)}if(m&&t.disposeData(d.dataId),o){var S=ws(k.shape,f);k.shape=S}return k}},tk=Yy("Tan"),nk=Yy("Tanh"),rk=0,ak=[Ky,Qy,$y,eb,pb,db,hb,fb,yb,wb,Sb,Tb,_b,Ob,Mb,Fb,Db,Pb,Wb,zb,Gb,jb,Hb,qb,Xb,Kb,Qb,px,dx,hx,fx,mx,gx,vx,yx,bx,xx,kx,rb,Ix,Sx,Tx,_x,Cx,Nx,Ex,Rx,Ax,Ox,Mx,Fx,Dx,Px,Bx,Ux,Vx,ow,iw,sw,uw,cw,lw,pw,dw,hw,fw,mw,gw,vw,yw,bw,vb,xw,ww,kw,Iw,Sw,Tw,_w,Cw,Nw,Ew,xb,Rw,Aw,Ow,Mw,zw,Gw,jw,Hw,qw,Xw,Kw,Yw,Qw,Jw,Zw,$w,ek,tk,nk,{kernelName:$t,backendName:"wasm",setupFunc:function(e){Uw=e.wasm.cwrap($t,null,["number","array","number","array","number","number"])},kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=n.dataIdMap.get(a.dataId).id,i=r.reps,s=new Array(a.shape.length),u=0;u<s.length;u++)s[u]=a.shape[u]*i[u];var c=new Uint8Array(new Int32Array(a.shape).buffer),l=new Uint8Array(new Int32Array(s).buffer),p=n.makeOutput(s,a.dtype),d=n.dataIdMap.get(p.dataId).id;return Uw(o,c,a.shape.length,l,s.length,Ly[p.dtype],d),p}},{kernelName:en,backendName:"wasm",setupFunc:function(e){Vw=e.wasm.cwrap(en,null,["number","array","number","number","number","bool","number","number"])},kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,o=r.k,i=r.sorted,s=n.dataIdMap.get(a.dataId).id,u=new Uint8Array(new Int32Array(a.shape).buffer),c=a.shape.slice();c[c.length-1]=o;var l=n.makeOutput(c,a.dtype),p=n.dataIdMap.get(l.dataId).id,d=n.makeOutput(c,"int32"),h=n.dataIdMap.get(d.dataId).id;return Vw(s,u,a.shape.length,Ly[a.dtype],o,i,p,h),[l,d]}},{kernelName:tn,backendName:"wasm",setupFunc:function(e){Ww=e.wasm.cwrap(tn,null,["number","number","bool","number","number","number","number","number","number","array","number","array","number","number","number","number","number"])},kernelFunc:function(e){var t,n=e.backend,r=e.inputs,a=e.attrs,o=r.image,i=r.transforms,u=a.interpolation,c=a.fillMode,l=a.fillValue,p=a.outputShape,d=s(o.shape,4),h=d[0],f=d[1],m=d[2],g=d[3],v=s(null!=p?p:[f,m],2),y=v[0],b=v[1],x=[h,y,b,g],w=new Uint8Array(new Int32Array(de(o.shape)).buffer),k=new Uint8Array(new Int32Array(de(x)).buffer),I=n.makeOutput(x,o.dtype),S=n.dataIdMap.get(I.dataId).id,T=n.dataIdMap.get(o.dataId).id,_=n.dataIdMap.get(i.dataId).id,C="nearest"===u?1:2;switch(c){case"constant":default:t=1;break;case"reflect":t=2;break;case"wrap":t=3;break;case"nearest":t=4}return Ww(T,_,i.shape[0]>1,h,y,b,g,m,f,w,o.shape.length-1,k,x.length-1,C,t,l,S),I}},ib,{kernelName:rn,backendName:"wasm",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,o=r.axis;o<0&&(o+=a.shape.length);for(var i=a.shape[o],s=a.shape.length,u=new Array(s-1),c=0,l=0;l<s;l++)l!==o&&(u[c++]=a.shape[l]);var p=new Array(i),d=new Array(s).fill(0),h=a.shape.slice();h[o]=1;for(var f=0;f<p.length;f++)d[o]=f,p[f]=bb({inputs:{x:a},attrs:{begin:d,size:h},backend:n});return p.map((function(e){return{dataId:e.dataId,dtype:e.dtype,shape:u}}))}},{kernelName:an,backendName:"wasm",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=n.makeOutput(t.shape,t.dtype);return n.typedArrayFromHeap(r).fill(0),r}}];rk<ak.length;rk++){yn(ak[rk])}var ok=Ie();ok.registerFlag("WASM_HAS_SIMD_SUPPORT",c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11])));case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})))),ok.registerFlag("WASM_HAS_MULTITHREAD_SUPPORT",c(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!ok.get("IS_NODE")){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,e.abrupt("return",((new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))));case 6:return e.prev=6,e.t0=e.catch(2),e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,null,[[2,6]])}))));var ik={exports:{}};function sk(e,t){for(var n=0,r=e.length-1;r>=0;r--){var a=e[r];"."===a?e.splice(r,1):".."===a?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var uk=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ck=function(e){return uk.exec(e).slice(1)};function lk(){for(var e="",t=!1,n=arguments.length-1;n>=-1&&!t;n--){var r=n>=0?arguments[n]:"/";if("string"!=typeof r)throw new TypeError("Arguments to path.resolve must be strings");r&&(e=r+"/"+e,t="/"===r.charAt(0))}return(t?"/":"")+(e=sk(bk(e.split("/"),(function(e){return!!e})),!t).join("/"))||"."}function pk(e){var t=dk(e),n="/"===wk(e,-1);return(e=sk(bk(e.split("/"),(function(e){return!!e})),!t).join("/"))||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e}function dk(e){return"/"===e.charAt(0)}function hk(){return pk(bk(Array.prototype.slice.call(arguments,0),(function(e,t){if("string"!=typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))}function fk(e,t){function n(e){for(var t=0;t<e.length&&""===e[t];t++);for(var n=e.length-1;n>=0&&""===e[n];n--);return t>n?[]:e.slice(t,n-t+1)}e=lk(e).substr(1),t=lk(t).substr(1);for(var r=n(e.split("/")),a=n(t.split("/")),o=Math.min(r.length,a.length),i=o,s=0;s<o;s++)if(r[s]!==a[s]){i=s;break}var u=[];for(s=i;s<r.length;s++)u.push("..");return(u=u.concat(a.slice(i))).join("/")}function mk(e){var t=ck(e),n=t[0],r=t[1];return n||r?(r&&(r=r.substr(0,r.length-1)),n+r):"."}function gk(e,t){var n=ck(e)[2];return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n}function vk(e){return ck(e)[3]}var yk={extname:vk,basename:gk,dirname:mk,sep:"/",delimiter:":",relative:fk,join:hk,isAbsolute:dk,normalize:pk,resolve:lk};function bk(e,t){if(e.filter)return e.filter(t);for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}var xk,wk="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)},kk=kn(Object.freeze({__proto__:null,basename:gk,default:yk,delimiter:":",dirname:mk,extname:vk,isAbsolute:dk,join:hk,normalize:pk,relative:fk,resolve:lk,sep:"/"})),Ik=kn(Object.freeze({__proto__:null,default:{}})),Sk=kn(Object.freeze({__proto__:null,default:{}}));function Tk(){if(void 0===xk){var e=new ArrayBuffer(2),t=new Uint8Array(e),n=new Uint16Array(e);if(t[0]=1,t[1]=2,258===n[0])xk="BE";else{if(513!==n[0])throw new Error("unable to figure out endianess");xk="LE"}}return xk}function _k(){return void 0!==r.location?r.location.hostname:""}function Ck(){return[]}function Nk(){return 0}function Ek(){return Number.MAX_VALUE}function Rk(){return Number.MAX_VALUE}function Ak(){return[]}function Ok(){return"Browser"}function Mk(){return void 0!==r.navigator?r.navigator.appVersion:""}function Fk(){return{}}function Dk(){return{}}function Pk(){return"javascript"}function Lk(){return"browser"}function Bk(){return"/tmp"}var Uk=Bk;function Vk(){return"$HOME"}var Wk={homedir:Vk,EOL:"\n",arch:Pk,platform:Lk,tmpdir:Uk,tmpDir:Bk,networkInterfaces:Fk,getNetworkInterfaces:Dk,release:Mk,type:Ok,cpus:Ak,totalmem:Rk,freemem:Ek,uptime:Nk,loadavg:Ck,hostname:_k,endianness:Tk},zk=kn(Object.freeze({__proto__:null,EOL:"\n",arch:Pk,cpus:Ak,default:Wk,endianness:Tk,freemem:Ek,getNetworkInterfaces:Dk,homedir:Vk,hostname:_k,loadavg:Ck,networkInterfaces:Fk,platform:Lk,release:Mk,tmpDir:Bk,tmpdir:Uk,totalmem:Rk,type:Ok,uptime:Nk}));!function(e,t){var n,r=(n=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/projects/Yztob-Projects/Yztob.AiSports/reduce-tfjs",function(e){function t(){return A.buffer!=D&&H(A.buffer),L}function r(){return A.buffer!=D&&H(A.buffer),U}function a(){return A.buffer!=D&&H(A.buffer),V}function o(){return A.buffer!=D&&H(A.buffer),W}var s,u,c,l=void 0!==(e=e||{})?e:{};l.ready=new Promise((function(e,t){s=e,u=t})),void 0!==B&&B.listeners&&(c={uncaughtException:B.listeners("uncaughtException"),unhandledRejection:B.listeners("unhandledRejection")});var p,h,f,m=Object.assign({},l),g=function(e,t){throw t},v="object"==("undefined"==typeof window?"undefined":d(window)),y="function"==typeof importScripts,b="object"==d(B)&&"object"==d(B.versions)&&"string"==typeof B.versions.node,x=l.ENVIRONMENT_IS_PTHREAD||!1,w="";function k(e){return l.locateFile?l.locateFile(e,w):w+e}if(b){var I,S,T;w=y?kk.dirname(w)+"/":"/projects/Yztob-Projects/Yztob.AiSports/reduce-tfjs/",I=Ik,S=kk,p=function(e,t){return e=S.normalize(e),I.readFileSync(e,t?void 0:"utf8")},f=function(e){var t=p(e,!0);return t.buffer||(t=new Uint8Array(t)),t},h=function(e,t,n){e=S.normalize(e),I.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},B.argv.length>1&&B.argv[1].replace(/\\/g,"/"),B.argv.slice(2),B.on("uncaughtException",(function(e){if(!(e instanceof se))throw e})),B.on("unhandledRejection",(function(e){throw e})),g=function(e,t){if(J())throw B.exitCode=e,t;var n;(n=t)instanceof se||R("exiting due to exception: "+n),B.exit(e)},l.inspect=function(){return"[Emscripten Module object]"};try{T=require("worker_threads")}catch(e){throw console.error('The "worker_threads" module is not supported in this node.js build - perhaps a newer version is needed?'),e}xn.Worker=T.Worker}else(v||y)&&(y?w=self.location.href:"undefined"!=typeof document&&document.currentScript&&(w=document.currentScript.src),void 0!==n&&n&&(w=n),w=0!==w.indexOf("blob:")?w.substr(0,w.replace(/[?#].*/,"").lastIndexOf("/")+1):"",b||(p=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},y&&(f=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),h=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)}));b&&"undefined"==typeof performance&&(xn.performance=Sk.performance);var _=console.log.bind(console),C=console.warn.bind(console);b&&(_=function(e){return I.writeSync(1,e+"\n")},C=function(e){return I.writeSync(2,e+"\n")});var N,E=l.print||_,R=l.printErr||C;Object.assign(l,m),m=null,l.arguments&&l.arguments,l.thisProgram&&l.thisProgram,l.quit&&(g=l.quit),l.wasmBinary&&(N=l.wasmBinary);var A,O,M=l.noExitRuntime||!0;"object"!=("undefined"==typeof WXWebAssembly?"undefined":d(WXWebAssembly))&&te("no native wasm support detected");var F,D,P,L,U,V,W,z=!1,G="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function j(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&G)return G.decode(e.buffer instanceof SharedArrayBuffer?e.slice(t,a):e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function H(e){D=e,l.HEAP8=P=new Int8Array(e),l.HEAP16=new Int16Array(e),l.HEAP32=U=new Int32Array(e),l.HEAPU8=L=new Uint8Array(e),l.HEAPU16=new Uint16Array(e),l.HEAPU32=V=new Uint32Array(e),l.HEAPF32=new Float32Array(e),l.HEAPF64=W=new Float64Array(e)}x&&(D=l.buffer);var q,X=l.INITIAL_MEMORY||16777216;if(x)A=l.wasmMemory,D=l.buffer;else if(l.wasmMemory)A=l.wasmMemory;else if(!((A=new WebAssembly.Memory({initial:X/65536,maximum:32768,shared:!0})).buffer instanceof SharedArrayBuffer))throw R("requested a shared WebAssembly.Memory but the returned buffer is not a SharedArrayBuffer, indicating that while the browser has SharedArrayBuffer it does not have WebAssembly threads support - you may need to set a flag"),b&&console.log("(on node you may need: --experimental-wasm-threads --experimental-wasm-bulk-memory and also use a recent version)"),Error("bad memory");A&&(D=A.buffer),X=D.byteLength,H(D);var K=[],Y=[],Q=[];function J(){return M}function Z(){x||he(Y)}var $=0,ee=null;function te(e){x?postMessage({cmd:"onAbort",arg:e}):l.onAbort&&l.onAbort(e),R(e="Aborted("+e+")"),z=!0,F=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw u(t),t}var ne;function re(e){return e.startsWith("data:application/octet-stream;base64,")}function ae(e){return e.startsWith("file://")}function oe(e){try{if(e==ne&&N)return new Uint8Array(N);if(f)return f(e);throw"both async and sync fetching of the wasm failed"}catch(e){te(e)}}re(ne="tfjs-backend-wasm-threaded-simd.wasm")||(ne=k(ne));var ie={};function se(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function ue(e){var t=de.pthreads[e];t||te(void 0),de.returnWorkerToPool(t)}function ce(e){var t=de.getNewWorker();if(!t)return 6;de.runningWorkers.push(t),de.pthreads[e.pthread_ptr]=t,t.pthread_ptr=e.pthread_ptr;var n={cmd:"run",start_routine:e.startRoutine,arg:e.arg,pthread_ptr:e.pthread_ptr};return t.runPthread=function(){n.time=performance.now(),t.postMessage(n,e.transferList)},t.loaded&&(t.runPthread(),delete t.runPthread),0}function le(e){if(x)return xe(1,1,e);F=e,J()||(de.terminateAllThreads(),l.onExit&&l.onExit(e),z=!0),g(e,new se(e))}var pe=function(e,t){if(F=e,!t&&x)throw fe(e),"unwind";le(e)},de={unusedWorkers:[],runningWorkers:[],tlsInitFunctions:[],pthreads:{},init:function(){x?de.initWorker():de.initMainThread()},initMainThread:function(){for(var e=8;e--;)de.allocateUnusedWorker()},initWorker:function(){M=!1},setExitStatus:function(e){F=e},terminateAllThreads:function(){for(var e=0,t=Object.values(de.pthreads);e<t.length;e++){var n=t[e];de.returnWorkerToPool(n)}var r,a=i(de.unusedWorkers);try{for(a.s();!(r=a.n()).done;){(n=r.value).terminate()}}catch(e){a.e(e)}finally{a.f()}de.unusedWorkers=[]},returnWorkerToPool:function(e){var t=e.pthread_ptr;delete de.pthreads[t],de.unusedWorkers.push(e),de.runningWorkers.splice(de.runningWorkers.indexOf(e),1),e.pthread_ptr=0,Ue(t)},receiveObjectTransfer:function(e){},threadInitTLS:function(){de.tlsInitFunctions.forEach((function(e){return e()}))},loadWasmModuleToWorker:function(e,t){e.onmessage=function(n){var r,a=n.data,o=a.cmd;if(e.pthread_ptr&&(de.currentProxiedOperationCallerThread=e.pthread_ptr),a.targetThread&&a.targetThread!=Oe()){var i=de.pthreads[a.targetThread];return i?i.postMessage(a,a.transferList):R('Internal error! Worker sent a message "'+o+'" to target pthread '+a.targetThread+", but that thread no longer exists!"),void(de.currentProxiedOperationCallerThread=void 0)}"processProxyingQueue"===o?be(a.queue):"spawnThread"===o?ce(a):"cleanupThread"===o?ue(a.thread):"killThread"===o?function(e){var t=de.pthreads[e];delete de.pthreads[e],t.terminate(),Ue(e),de.runningWorkers.splice(de.runningWorkers.indexOf(t),1),t.pthread_ptr=0}(a.thread):"cancelThread"===o?(r=a.thread,de.pthreads[r].postMessage({cmd:"cancel"})):"loaded"===o?(e.loaded=!0,t&&t(e),e.runPthread&&(e.runPthread(),delete e.runPthread)):"print"===o?E("Thread "+a.threadId+": "+a.text):"printErr"===o?R("Thread "+a.threadId+": "+a.text):"alert"===o?alert("Thread "+a.threadId+": "+a.text):"setimmediate"===a.target?e.postMessage(a):"onAbort"===o?l.onAbort&&l.onAbort(a.arg):o&&R("worker sent an unknown command "+o),de.currentProxiedOperationCallerThread=void 0},e.onerror=function(e){throw R("worker sent an error! "+e.filename+":"+e.lineno+": "+e.message),e},b&&(e.on("message",(function(t){e.onmessage({data:t})})),e.on("error",(function(t){e.onerror(t)})),e.on("detachedExit",(function(){}))),e.postMessage({cmd:"load",urlOrBlob:l.mainScriptUrlOrBlob||n,wasmMemory:A,wasmModule:O})},allocateUnusedWorker:function(){var e=k("tfjs-backend-wasm-threaded-simd.worker.js");de.unusedWorkers.push(new Worker(e))},getNewWorker:function(){return 0==de.unusedWorkers.length&&(de.allocateUnusedWorker(),de.loadWasmModuleToWorker(de.unusedWorkers[0])),de.unusedWorkers.pop()}};function he(e){for(;e.length>0;)e.shift()(l)}function fe(e){if(x)return xe(2,0,e);try{pe(e)}catch(e){!function(e){if(e instanceof se||"unwind"==e)return F;g(1,e)}(e)}}l.PThread=de,l.establishStackSpace=function(){var e=Oe(),t=r()[e+44>>2],n=r()[e+48>>2];We(t,t-n),Ge(t)};var me,ge=[];function ve(e,t,n,r){return x?xe(3,1,e,t,n,r):ye(e,t,n,r)}function ye(e,t,n,r){if("undefined"==typeof SharedArrayBuffer)return R("Current environment does not support SharedArrayBuffer, pthreads are not available!"),6;var a=[];if(x&&0===a.length)return ve(e,t,n,r);var o={startRoutine:n,pthread_ptr:e,arg:r,transferList:a};return x?(o.cmd="spawnThread",postMessage(o,a),0):ce(o)}function be(e){Atomics.store(r(),e>>2,1),Oe()&&Be(e),Atomics.compareExchange(r(),e>>2,1,0)}function xe(e,t){var n=arguments.length-2,r=arguments;return function(e){var t=ze(),n=e();return Ge(t),n}((function(){for(var a=n,i=je(8*a),s=i>>3,u=0;u<n;u++){var c=r[2+u];o()[s+u]=c}return Fe(e,a,i,t)}))}l.invokeEntryPoint=function(e,t){var n,r,a=((r=ge[n=e])||(n>=ge.length&&(ge.length=n+1),ge[n]=r=q.get(n)),r)(t);J()?de.setExitStatus(a):Ve(a)},l.executeNotifiedProxyingQueue=be,me=b?function(){var e=B.hrtime();return 1e3*e[0]+e[1]/1e6}:x?function(){return performance.now()-l.__performance_now_clock_drift}:function(){return performance.now()};var we=[];function ke(e){try{return A.grow(e-D.byteLength+65535>>>16),H(A.buffer),1}catch(e){}}function Ie(e){return x?xe(4,1,e):52}function Se(e,t,n,r,a){return x?xe(5,1,e,t,n,r,a):70}var Te=[null,[],[]];function _e(e,t){var n=Te[e];0===t||10===t?((1===e?E:R)(j(n,0)),n.length=0):n.push(t)}function Ce(e,n,r,o){if(x)return xe(6,1,e,n,r,o);for(var i=0,s=0;s<r;s++){var u=a()[n>>2],c=a()[n+4>>2];n+=8;for(var l=0;l<c;l++)_e(e,t()[u+l]);i+=c}return a()[o>>2]=i,0}function Ne(e){return l["_"+e]}function Ee(e,n,r,a,o){var i={string:function(e){var n=0;if(null!=e&&0!==e){var r=1+(e.length<<2);!function(e,n,r){!function(e,t,n,r){if(!(r>0))return 0;for(var a=n+r-1,o=0;o<e.length;++o){var i=e.charCodeAt(o);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),i<=127){if(n>=a)break;t[n++]=i}else if(i<=2047){if(n+1>=a)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=a)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=a)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}t[n]=0}(e,t(),n,r)}(e,n=je(r),r)}return n},array:function(e){var t=je(e.length);return function(e,t){(A.buffer!=D&&H(A.buffer),P).set(e,t)}(e,t),t}};var s=Ne(e),u=[],c=0;if(a)for(var l=0;l<a.length;l++){var p=i[r[l]];p?(0===c&&(c=ze()),u[l]=p(a[l])):u[l]=a[l]}var d=s.apply(null,u);return function(e){return 0!==c&&Ge(c),function(e){return"string"===n?(r=e)?j(t(),r,void 0):"":"boolean"===n?Boolean(e):e;var r}(e)}(d)}de.init();var Re=[null,le,fe,ve,Ie,Se,Ce],Ae={__emscripten_init_main_thread_js:function(e){Me(e,!y,1,!v),de.threadInitTLS()},__emscripten_thread_cleanup:function(e){x?postMessage({cmd:"cleanupThread",thread:e}):ue(e)},__pthread_create_js:ye,_emscripten_default_pthread_stack_size:function(){return 2097152},_emscripten_get_now_is_monotonic:function(){return!0},_emscripten_notify_task_queue:function(e,t,n,r){if(e==t)setTimeout((function(){return be(r)}));else if(x)postMessage({targetThread:e,cmd:"processProxyingQueue",queue:r});else{var a=de.pthreads[e];if(!a)return;a.postMessage({cmd:"processProxyingQueue",queue:r})}return 1},_emscripten_set_offscreencanvas_size:function(e,t,n){return-1},abort:function(){te("")},emscripten_check_blocking_allowed:function(){b||y||function e(t){e.shown||(e.shown={}),e.shown[t]||(e.shown[t]=1,b&&(t="warning: "+t),R(t))}("Blocking on the main thread is very dangerous, see https://emscripten.org/docs/porting/pthreads.html#blocking-on-the-main-browser-thread")},emscripten_date_now:function(){return Date.now()},emscripten_get_heap_max:function(){return 2147483648},emscripten_get_now:me,emscripten_memcpy_big:function(e,n,r){t().copyWithin(e,n,n+r)},emscripten_num_logical_cores:function(){return b?zk.cpus().length:navigator.hardwareConcurrency},emscripten_receive_on_main_thread_js:function(e,t,n){we.length=t;for(var r=n>>3,a=0;a<t;a++)we[a]=o()[r+a];return(e<0?ie[-e-1]:Re[e]).apply(null,we)},emscripten_resize_heap:function(e){var n=t().length;if((e>>>=0)<=n)return!1;var r,a=2147483648;if(e>a)return!1;for(var o=1;o<=4;o*=2){var i=n*(1+.2/o);if(i=Math.min(i,e+100663296),ke(Math.min(a,(r=Math.max(e,i))+(65536-r%65536)%65536)))return!0}return!1},emscripten_unwind_to_js_event_loop:function(){throw"unwind"},exit:pe,fd_close:Ie,fd_seek:Se,fd_write:Ce,memory:A||l.wasmMemory};!function(){var e={env:Ae,wasi_snapshot_preview1:Ae};function t(e,t){var n,r,a=e.exports;if(l.asm=a,n=l.asm._emscripten_tls_init,de.tlsInitFunctions.push(n),q=l.asm.__indirect_function_table,r=l.asm.__wasm_call_ctors,Y.unshift(r),O=t,!x){var o=de.unusedWorkers.length;de.unusedWorkers.forEach((function(e){de.loadWasmModuleToWorker(e,(function(){--o||function(e){if($--,l.monitorRunDependencies&&l.monitorRunDependencies($),0==$&&ee){var t=ee;ee=null,t()}}()}))}))}}function n(e){t(e.instance,e.module)}function r(t){return function(){if(!N&&(v||y)){if("function"==typeof fetch&&!ae(ne))return fetch(ne,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+ne+"'";return e.arrayBuffer()})).catch((function(){return oe(ne)}));if(h)return new Promise((function(e,t){h(ne,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return oe(ne)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){R("failed to asynchronously prepare wasm: "+e),te(e)}))}if(x||($++,l.monitorRunDependencies&&l.monitorRunDependencies($)),l.instantiateWasm)try{return l.instantiateWasm(e,t)}catch(e){R("Module.instantiateWasm callback failed with error: "+e),u(e)}(N||"function"!=typeof WebAssembly.instantiateStreaming||re(ne)||ae(ne)||b||"function"!=typeof fetch?r(n):fetch(ne,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return R("wasm streaming compile failed: "+e),R("falling back to ArrayBuffer instantiation"),r(n)}))}))).catch(u)}(),l.___wasm_call_ctors=function(){return(l.___wasm_call_ctors=l.asm.__wasm_call_ctors).apply(null,arguments)},l._init=function(){return(l._init=l.asm.init).apply(null,arguments)},l._init_with_threads_count=function(){return(l._init_with_threads_count=l.asm.init_with_threads_count).apply(null,arguments)},l._get_threads_count=function(){return(l._get_threads_count=l.asm.get_threads_count).apply(null,arguments)},l._register_tensor=function(){return(l._register_tensor=l.asm.register_tensor).apply(null,arguments)},l._dispose_data=function(){return(l._dispose_data=l.asm.dispose_data).apply(null,arguments)},l._dispose=function(){return(l._dispose=l.asm.dispose).apply(null,arguments)},l._Abs=function(){return(l._Abs=l.asm.Abs).apply(null,arguments)},l._Add=function(){return(l._Add=l.asm.Add).apply(null,arguments)},l._AddN=function(){return(l._AddN=l.asm.AddN).apply(null,arguments)},l._All=function(){return(l._All=l.asm.All).apply(null,arguments)},l._Any=function(){return(l._Any=l.asm.Any).apply(null,arguments)},l._ArgMax=function(){return(l._ArgMax=l.asm.ArgMax).apply(null,arguments)},l._AvgPool=function(){return(l._AvgPool=l.asm.AvgPool).apply(null,arguments)},l._BatchMatMul=function(){return(l._BatchMatMul=l.asm.BatchMatMul).apply(null,arguments)},l._Ceil=function(){return(l._Ceil=l.asm.Ceil).apply(null,arguments)},l._ClipByValue=function(){return(l._ClipByValue=l.asm.ClipByValue).apply(null,arguments)},l._Conv2D=function(){return(l._Conv2D=l.asm.Conv2D).apply(null,arguments)},l._Conv2DBackpropInput=function(){return(l._Conv2DBackpropInput=l.asm.Conv2DBackpropInput).apply(null,arguments)},l._Cos=function(){return(l._Cos=l.asm.Cos).apply(null,arguments)},l._Cosh=function(){return(l._Cosh=l.asm.Cosh).apply(null,arguments)},l._CropAndResize=function(){return(l._CropAndResize=l.asm.CropAndResize).apply(null,arguments)},l._Cumprod=function(){return(l._Cumprod=l.asm.Cumprod).apply(null,arguments)},l._Cumsum=function(){return(l._Cumsum=l.asm.Cumsum).apply(null,arguments)},l._DepthToSpace=function(){return(l._DepthToSpace=l.asm.DepthToSpace).apply(null,arguments)},l._DepthwiseConv2dNative=function(){return(l._DepthwiseConv2dNative=l.asm.DepthwiseConv2dNative).apply(null,arguments)},l._Elu=function(){return(l._Elu=l.asm.Elu).apply(null,arguments)},l._Equal=function(){return(l._Equal=l.asm.Equal).apply(null,arguments)},l._Exp=function(){return(l._Exp=l.asm.Exp).apply(null,arguments)},l._FlipLeftRight=function(){return(l._FlipLeftRight=l.asm.FlipLeftRight).apply(null,arguments)},l._Floor=function(){return(l._Floor=l.asm.Floor).apply(null,arguments)},l._FloorDiv=function(){return(l._FloorDiv=l.asm.FloorDiv).apply(null,arguments)},l._FusedBatchNorm=function(){return(l._FusedBatchNorm=l.asm.FusedBatchNorm).apply(null,arguments)},l._FusedConv2D=function(){return(l._FusedConv2D=l.asm.FusedConv2D).apply(null,arguments)},l._FusedDepthwiseConv2D=function(){return(l._FusedDepthwiseConv2D=l.asm.FusedDepthwiseConv2D).apply(null,arguments)},l._Gather=function(){return(l._Gather=l.asm.Gather).apply(null,arguments)},l._GatherNd=function(){return(l._GatherNd=l.asm.GatherNd).apply(null,arguments)},l._Greater=function(){return(l._Greater=l.asm.Greater).apply(null,arguments)},l._GreaterEqual=function(){return(l._GreaterEqual=l.asm.GreaterEqual).apply(null,arguments)},l._LeakyRelu=function(){return(l._LeakyRelu=l.asm.LeakyRelu).apply(null,arguments)},l._Less=function(){return(l._Less=l.asm.Less).apply(null,arguments)},l._LessEqual=function(){return(l._LessEqual=l.asm.LessEqual).apply(null,arguments)},l._Log=function(){return(l._Log=l.asm.Log).apply(null,arguments)},l._LogicalAnd=function(){return(l._LogicalAnd=l.asm.LogicalAnd).apply(null,arguments)},l._LogicalNot=function(){return(l._LogicalNot=l.asm.LogicalNot).apply(null,arguments)},l._LogicalOr=function(){return(l._LogicalOr=l.asm.LogicalOr).apply(null,arguments)},l._LogicalXor=function(){return(l._LogicalXor=l.asm.LogicalXor).apply(null,arguments)},l._Max=function(){return(l._Max=l.asm.Max).apply(null,arguments)},l._MaxPool=function(){return(l._MaxPool=l.asm.MaxPool).apply(null,arguments)},l._Maximum=function(){return(l._Maximum=l.asm.Maximum).apply(null,arguments)},l._Mean=function(){return(l._Mean=l.asm.Mean).apply(null,arguments)},l._Min=function(){return(l._Min=l.asm.Min).apply(null,arguments)},l._Minimum=function(){return(l._Minimum=l.asm.Minimum).apply(null,arguments)},l._MirrorPad=function(){return(l._MirrorPad=l.asm.MirrorPad).apply(null,arguments)},l._Multiply=function(){return(l._Multiply=l.asm.Multiply).apply(null,arguments)},l._Neg=function(){return(l._Neg=l.asm.Neg).apply(null,arguments)},l._NonMaxSuppressionV3=function(){return(l._NonMaxSuppressionV3=l.asm.NonMaxSuppressionV3).apply(null,arguments)},l._NonMaxSuppressionV4=function(){return(l._NonMaxSuppressionV4=l.asm.NonMaxSuppressionV4).apply(null,arguments)},l._NonMaxSuppressionV5=function(){return(l._NonMaxSuppressionV5=l.asm.NonMaxSuppressionV5).apply(null,arguments)},l._NotEqual=function(){return(l._NotEqual=l.asm.NotEqual).apply(null,arguments)},l._OneHot=function(){return(l._OneHot=l.asm.OneHot).apply(null,arguments)},l._PadV2=function(){return(l._PadV2=l.asm.PadV2).apply(null,arguments)},l._Pow=function(){return(l._Pow=l.asm.Pow).apply(null,arguments)},l._Prelu=function(){return(l._Prelu=l.asm.Prelu).apply(null,arguments)},l._Prod=function(){return(l._Prod=l.asm.Prod).apply(null,arguments)},l._RealDiv=function(){return(l._RealDiv=l.asm.RealDiv).apply(null,arguments)},l._Relu=function(){return(l._Relu=l.asm.Relu).apply(null,arguments)},l._Relu6=function(){return(l._Relu6=l.asm.Relu6).apply(null,arguments)},l._ResizeBilinear=function(){return(l._ResizeBilinear=l.asm.ResizeBilinear).apply(null,arguments)},l._ResizeNearestNeighbor=function(){return(l._ResizeNearestNeighbor=l.asm.ResizeNearestNeighbor).apply(null,arguments)},l._Reverse=function(){return(l._Reverse=l.asm.Reverse).apply(null,arguments)},l._RotateWithOffset=function(){return(l._RotateWithOffset=l.asm.RotateWithOffset).apply(null,arguments)},l._Round=function(){return(l._Round=l.asm.Round).apply(null,arguments)},l._Rsqrt=function(){return(l._Rsqrt=l.asm.Rsqrt).apply(null,arguments)},l._ScatterNd=function(){return(l._ScatterNd=l.asm.ScatterNd).apply(null,arguments)},l._SelectV2=function(){return(l._SelectV2=l.asm.SelectV2).apply(null,arguments)},l._Sigmoid=function(){return(l._Sigmoid=l.asm.Sigmoid).apply(null,arguments)},l._Sin=function(){return(l._Sin=l.asm.Sin).apply(null,arguments)},l._Softmax=function(){return(l._Softmax=l.asm.Softmax).apply(null,arguments)},l._SparseFillEmptyRows=function(){return(l._SparseFillEmptyRows=l.asm.SparseFillEmptyRows).apply(null,arguments)},l._SparseReshape=function(){return(l._SparseReshape=l.asm.SparseReshape).apply(null,arguments)},l._SparseSegmentReduction=function(){return(l._SparseSegmentReduction=l.asm.SparseSegmentReduction).apply(null,arguments)},l._Sqrt=function(){return(l._Sqrt=l.asm.Sqrt).apply(null,arguments)},l._Square=function(){return(l._Square=l.asm.Square).apply(null,arguments)},l._SquaredDifference=function(){return(l._SquaredDifference=l.asm.SquaredDifference).apply(null,arguments)},l._Step=function(){return(l._Step=l.asm.Step).apply(null,arguments)},l._StridedSlice=function(){return(l._StridedSlice=l.asm.StridedSlice).apply(null,arguments)},l._Sub=function(){return(l._Sub=l.asm.Sub).apply(null,arguments)},l._Sum=function(){return(l._Sum=l.asm.Sum).apply(null,arguments)},l._Tan=function(){return(l._Tan=l.asm.Tan).apply(null,arguments)},l._Tanh=function(){return(l._Tanh=l.asm.Tanh).apply(null,arguments)},l._Tile=function(){return(l._Tile=l.asm.Tile).apply(null,arguments)},l._TopK=function(){return(l._TopK=l.asm.TopK).apply(null,arguments)},l._Transform=function(){return(l._Transform=l.asm.Transform).apply(null,arguments)},l._Transpose=function(){return(l._Transpose=l.asm.Transpose).apply(null,arguments)},l.__FusedMatMul=function(){return(l.__FusedMatMul=l.asm._FusedMatMul).apply(null,arguments)},l._malloc=function(){return(l._malloc=l.asm.malloc).apply(null,arguments)},l._free=function(){return(l._free=l.asm.free).apply(null,arguments)},l.__emscripten_tls_init=function(){return(l.__emscripten_tls_init=l.asm._emscripten_tls_init).apply(null,arguments)};var Oe=l._pthread_self=function(){return(Oe=l._pthread_self=l.asm.pthread_self).apply(null,arguments)};l.___errno_location=function(){return(l.___errno_location=l.asm.__errno_location).apply(null,arguments)};var Me=l.__emscripten_thread_init=function(){return(Me=l.__emscripten_thread_init=l.asm._emscripten_thread_init).apply(null,arguments)};l.__emscripten_thread_crashed=function(){return(l.__emscripten_thread_crashed=l.asm._emscripten_thread_crashed).apply(null,arguments)},l._emscripten_main_thread_process_queued_calls=function(){return(l._emscripten_main_thread_process_queued_calls=l.asm.emscripten_main_thread_process_queued_calls).apply(null,arguments)},l._emscripten_main_browser_thread_id=function(){return(l._emscripten_main_browser_thread_id=l.asm.emscripten_main_browser_thread_id).apply(null,arguments)};var Fe=l._emscripten_run_in_main_runtime_thread_js=function(){return(Fe=l._emscripten_run_in_main_runtime_thread_js=l.asm.emscripten_run_in_main_runtime_thread_js).apply(null,arguments)};l._emscripten_dispatch_to_thread_=function(){return(l._emscripten_dispatch_to_thread_=l.asm.emscripten_dispatch_to_thread_).apply(null,arguments)};var De,Pe,Le,Be=l.__emscripten_proxy_execute_task_queue=function(){return(Be=l.__emscripten_proxy_execute_task_queue=l.asm._emscripten_proxy_execute_task_queue).apply(null,arguments)},Ue=l.__emscripten_thread_free_data=function(){return(Ue=l.__emscripten_thread_free_data=l.asm._emscripten_thread_free_data).apply(null,arguments)},Ve=l.__emscripten_thread_exit=function(){return(Ve=l.__emscripten_thread_exit=l.asm._emscripten_thread_exit).apply(null,arguments)},We=l._emscripten_stack_set_limits=function(){return(We=l._emscripten_stack_set_limits=l.asm.emscripten_stack_set_limits).apply(null,arguments)},ze=l.stackSave=function(){return(ze=l.stackSave=l.asm.stackSave).apply(null,arguments)},Ge=l.stackRestore=function(){return(Ge=l.stackRestore=l.asm.stackRestore).apply(null,arguments)},je=l.stackAlloc=function(){return(je=l.stackAlloc=l.asm.stackAlloc).apply(null,arguments)};function He(e){if(!($>0)){if(x)return s(l),Z(),void postMessage({cmd:"loaded"});!function(){if(l.preRun)for("function"==typeof l.preRun&&(l.preRun=[l.preRun]);l.preRun.length;)e=l.preRun.shift(),K.unshift(e);var e;he(K)}(),$>0||(l.setStatus?(l.setStatus("Running..."),setTimeout((function(){setTimeout((function(){l.setStatus("")}),1),t()}),1)):t())}function t(){De||(De=!0,l.calledRun=!0,z||(Z(),s(l),l.onRuntimeInitialized&&l.onRuntimeInitialized(),function(){if(!x){if(l.postRun)for("function"==typeof l.postRun&&(l.postRun=[l.postRun]);l.postRun.length;)e=l.postRun.shift(),Q.unshift(e);var e;he(Q)}}()))}}if(l.dynCall_iijjiiii=function(){return(l.dynCall_iijjiiii=l.asm.dynCall_iijjiiii).apply(null,arguments)},l.dynCall_jiji=function(){return(l.dynCall_jiji=l.asm.dynCall_jiji).apply(null,arguments)},l.keepRuntimeAlive=J,l.wasmMemory=A,l.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?Ne(e):function(){return Ee(e,t,n,arguments)}},l.ExitStatus=se,l.PThread=de,ee=function e(){De||He(),De||(ee=e)},l.preInit)for("function"==typeof l.preInit&&(l.preInit=[l.preInit]);l.preInit.length>0;)l.preInit.pop()();if(He(),c&&(Pe={uncaughtException:B.listeners("uncaughtException").filter((function(e){return!c.uncaughtException.indexOf(e)>-1})),unhandledRejection:B.listeners("unhandledRejection").filter((function(e){return!c.unhandledRejection.indexOf(e)>-1}))}),"undefined"!=typeof WasmBackendModule)Le=WasmBackendModule;else{if(void 0===e)throw new Error("Could not find wasm module in post.js");Le=e}if(Pe){var qe=Le._dispose;Le._dispose=function(){qe(),Pe.uncaughtException.forEach((function(e){B.removeListener("uncaughtException",e)})),Pe.unhandledRejection.forEach((function(e){B.removeListener("unhandledRejection",e)}))}}return e.ready});e.exports=r}(ik);var Gk=ik.exports,jk=wn(Gk),Hk=n({__proto__:null,default:jk},[Gk]),qk='"use strict";var Module={};var ENVIRONMENT_IS_NODE=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(ENVIRONMENT_IS_NODE){var nodeWorkerThreads=require("worker_threads");var parentPort=nodeWorkerThreads.parentPort;parentPort.on("message",data=>onmessage({data:data}));var fs=require("fs");Object.assign(global,{self:global,require:require,Module:Module,location:{href:__filename},Worker:nodeWorkerThreads.Worker,importScripts:function(f){(0,eval)(fs.readFileSync(f,"utf8"))},postMessage:function(msg){parentPort.postMessage(msg)},performance:global.performance||{now:function(){return Date.now()}}})}var initializedJS=false;var pendingNotifiedProxyingQueues=[];function threadPrintErr(){var text=Array.prototype.slice.call(arguments).join(" ");if(ENVIRONMENT_IS_NODE){fs.writeSync(2,text+"\n");return}console.error(text)}function threadAlert(){var text=Array.prototype.slice.call(arguments).join(" ");postMessage({cmd:"alert",text:text,threadId:Module["_pthread_self"]()})}var err=threadPrintErr;self.alert=threadAlert;Module["instantiateWasm"]=(info,receiveInstance)=>{var instance=new WebAssembly.Instance(Module["wasmModule"],info);receiveInstance(instance);Module["wasmModule"]=null;return instance.exports};self.onunhandledrejection=e=>{throw e.reason??e};self.onmessage=e=>{try{if(e.data.cmd==="load"){Module["wasmModule"]=e.data.wasmModule;Module["wasmMemory"]=e.data.wasmMemory;Module["buffer"]=Module["wasmMemory"].buffer;Module["ENVIRONMENT_IS_PTHREAD"]=true;if(typeof e.data.urlOrBlob=="string"){importScripts(e.data.urlOrBlob)}else{var objectUrl=URL.createObjectURL(e.data.urlOrBlob);importScripts(objectUrl);URL.revokeObjectURL(objectUrl)}WasmBackendModuleThreadedSimd(Module).then(function(instance){Module=instance})}else if(e.data.cmd==="run"){Module["__performance_now_clock_drift"]=performance.now()-e.data.time;Module["__emscripten_thread_init"](e.data.pthread_ptr,0,0,1);Module["establishStackSpace"]();Module["PThread"].receiveObjectTransfer(e.data);Module["PThread"].threadInitTLS();if(!initializedJS){pendingNotifiedProxyingQueues.forEach(queue=>{Module["executeNotifiedProxyingQueue"](queue)});pendingNotifiedProxyingQueues=[];initializedJS=true}try{Module["invokeEntryPoint"](e.data.start_routine,e.data.arg)}catch(ex){if(ex!="unwind"){if(ex instanceof Module["ExitStatus"]){if(Module["keepRuntimeAlive"]()){}else{Module["__emscripten_thread_exit"](ex.status)}}else{throw ex}}}}else if(e.data.cmd==="cancel"){if(Module["_pthread_self"]()){Module["__emscripten_thread_exit"](-1)}}else if(e.data.target==="setimmediate"){}else if(e.data.cmd==="processProxyingQueue"){if(initializedJS){Module["executeNotifiedProxyingQueue"](e.data.queue)}else{pendingNotifiedProxyingQueues.push(e.data.queue)}}else if(e.data.cmd){err("worker.js received unknown command "+e.data.cmd);err(e.data)}}catch(ex){if(Module["__emscripten_thread_crashed"]){Module["__emscripten_thread_crashed"]()}throw ex}};',Xk={exports:{}};!function(e,t){var n,r=(n=(n="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0)||"/projects/Yztob-Projects/Yztob.AiSports/reduce-tfjs",function(e){var t,r,a,o=void 0!==(e=e||{})?e:{};o.ready=new Promise((function(e,n){t=e,r=n})),void 0!==B&&B.listeners&&(a={uncaughtException:B.listeners("uncaughtException"),unhandledRejection:B.listeners("unhandledRejection")});var i,s,u,c,l,p=Object.assign({},o),h="object"==("undefined"==typeof window?"undefined":d(window)),f="function"==typeof importScripts,m="object"==d(B)&&"object"==d(B.versions)&&"string"==typeof B.versions.node,g="";m?(g=f?kk.dirname(g)+"/":"/projects/Yztob-Projects/Yztob.AiSports/reduce-tfjs/",c=Ik,l=kk,i=function(e,t){return e=l.normalize(e),c.readFileSync(e,t?void 0:"utf8")},u=function(e){var t=i(e,!0);return t.buffer||(t=new Uint8Array(t)),t},s=function(e,t,n){e=l.normalize(e),c.readFile(e,(function(e,r){e?n(e):t(r.buffer)}))},B.argv.length>1&&B.argv[1].replace(/\\/g,"/"),B.argv.slice(2),B.on("uncaughtException",(function(e){if(!(e instanceof W))throw e})),B.on("unhandledRejection",(function(e){throw e})),o.inspect=function(){return"[Emscripten Module object]"}):(h||f)&&(f?g=self.location.href:"undefined"!=typeof document&&document.currentScript&&(g=document.currentScript.src),n&&(g=n),g=0!==g.indexOf("blob:")?g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1):"",i=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(u=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),s=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){200==r.status||0==r.status&&r.response?t(r.response):n()},r.onerror=n,r.send(null)});var v,y,b=o.print||console.log.bind(console),x=o.printErr||console.warn.bind(console);Object.assign(o,p),p=null,o.arguments&&o.arguments,o.thisProgram&&o.thisProgram,o.quit&&o.quit,o.wasmBinary&&(v=o.wasmBinary),o.noExitRuntime,"object"!=("undefined"==typeof WXWebAssembly?"undefined":d(WXWebAssembly))&&F("no native wasm support detected");var w,k,I,S,T=!1,_="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function C(e,t,n){for(var r=t+n,a=t;e[a]&&!(a>=r);)++a;if(a-t>16&&e.buffer&&_)return _.decode(e.subarray(t,a));for(var o="";t<a;){var i=e[t++];if(128&i){var s=63&e[t++];if(192!=(224&i)){var u=63&e[t++];if((i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(i);else{var c=i-65536;o+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else o+=String.fromCharCode((31&i)<<6|s)}else o+=String.fromCharCode(i)}return o}function N(e){w=e,o.HEAP8=k=new Int8Array(e),o.HEAP16=new Int16Array(e),o.HEAP32=new Int32Array(e),o.HEAPU8=I=new Uint8Array(e),o.HEAPU16=new Uint16Array(e),o.HEAPU32=S=new Uint32Array(e),o.HEAPF32=new Float32Array(e),o.HEAPF64=new Float64Array(e)}o.INITIAL_MEMORY;var E=[],R=[],A=[],O=0,M=null;function F(e){o.onAbort&&o.onAbort(e),x(e="Aborted("+e+")"),T=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw r(t),t}var D,P;function L(e){return e.startsWith("data:application/octet-stream;base64,")}function U(e){return e.startsWith("file://")}function V(e){try{if(e==D&&v)return new Uint8Array(v);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}catch(e){F(e)}}function W(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function z(e){for(;e.length>0;)e.shift()(o)}function G(e){try{return y.grow(e-w.byteLength+65535>>>16),N(y.buffer),1}catch(e){}}L(D="tfjs-backend-wasm.wasm")||(P=D,D=o.locateFile?o.locateFile(P,g):g+P);var j=[null,[],[]];function H(e,t){var n=j[e];0===t||10===t?((1===e?b:x)(C(n,0)),n.length=0):n.push(t)}function q(e){return o["_"+e]}function X(e,t,n,r,a){var o={string:function(e){var t=0;if(null!=e&&0!==e){var n=1+(e.length<<2);!function(e,t,n){!function(e,t,n,r){if(!(r>0))return 0;for(var a=n+r-1,o=0;o<e.length;++o){var i=e.charCodeAt(o);if(i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++o)),i<=127){if(n>=a)break;t[n++]=i}else if(i<=2047){if(n+1>=a)break;t[n++]=192|i>>6,t[n++]=128|63&i}else if(i<=65535){if(n+2>=a)break;t[n++]=224|i>>12,t[n++]=128|i>>6&63,t[n++]=128|63&i}else{if(n+3>=a)break;t[n++]=240|i>>18,t[n++]=128|i>>12&63,t[n++]=128|i>>6&63,t[n++]=128|63&i}}t[n]=0}(e,I,t,n)}(e,t=ee(n),n)}return t},array:function(e){var t=ee(e.length);return function(e,t){k.set(e,t)}(e,t),t}};var i=q(e),s=[],u=0;if(r)for(var c=0;c<r.length;c++){var l=o[n[c]];l?(0===u&&(u=Z()),s[c]=l(r[c])):s[c]=r[c]}var p=i.apply(null,s);return function(e){return 0!==u&&$(u),function(e){return"string"===t?(n=e)?C(I,n,void 0):"":"boolean"===t?Boolean(e):e;var n}(e)}(p)}var K={abort:function(){F("")},emscripten_get_heap_max:function(){return 2147483648},emscripten_memcpy_big:function(e,t,n){I.copyWithin(e,t,t+n)},emscripten_resize_heap:function(e){var t,n=I.length,r=2147483648;if((e>>>=0)>r)return!1;for(var a=1;a<=4;a*=2){var o=n*(1+.2/a);if(o=Math.min(o,e+100663296),G(Math.min(r,(t=Math.max(e,o))+(65536-t%65536)%65536)))return!0}return!1},fd_close:function(e){return 52},fd_seek:function(e,t,n,r,a){return 70},fd_write:function(e,t,n,r){for(var a=0,o=0;o<n;o++){var i=S[t>>2],s=S[t+4>>2];t+=8;for(var u=0;u<s;u++)H(e,I[i+u]);a+=s}return S[r>>2]=a,0}};!function(){var e={env:K,wasi_snapshot_preview1:K};function t(e,t){var n,r=e.exports;o.asm=r,N((y=o.asm.memory).buffer),o.asm.__indirect_function_table,n=o.asm.__wasm_call_ctors,R.unshift(n),function(e){if(O--,o.monitorRunDependencies&&o.monitorRunDependencies(O),0==O&&M){var t=M;M=null,t()}}()}function n(e){t(e.instance)}function a(t){return function(){if(!v&&(h||f)){if("function"==typeof fetch&&!U(D))return fetch(D,{credentials:"same-origin"}).then((function(e){if(!e.ok)throw"failed to load wasm binary file at '"+D+"'";return e.arrayBuffer()})).catch((function(){return V(D)}));if(s)return new Promise((function(e,t){s(D,(function(t){e(new Uint8Array(t))}),t)}))}return Promise.resolve().then((function(){return V(D)}))}().then((function(t){return WebAssembly.instantiate(t,e)})).then((function(e){return e})).then(t,(function(e){x("failed to asynchronously prepare wasm: "+e),F(e)}))}if(O++,o.monitorRunDependencies&&o.monitorRunDependencies(O),o.instantiateWasm)try{return o.instantiateWasm(e,t)}catch(e){x("Module.instantiateWasm callback failed with error: "+e),r(e)}(v||"function"!=typeof WebAssembly.instantiateStreaming||L(D)||U(D)||m||"function"!=typeof fetch?a(n):fetch(D,{credentials:"same-origin"}).then((function(t){return WebAssembly.instantiateStreaming(t,e).then(n,(function(e){return x("wasm streaming compile failed: "+e),x("falling back to ArrayBuffer instantiation"),a(n)}))}))).catch(r)}(),o.___wasm_call_ctors=function(){return(o.___wasm_call_ctors=o.asm.__wasm_call_ctors).apply(null,arguments)},o._init=function(){return(o._init=o.asm.init).apply(null,arguments)},o._init_with_threads_count=function(){return(o._init_with_threads_count=o.asm.init_with_threads_count).apply(null,arguments)},o._get_threads_count=function(){return(o._get_threads_count=o.asm.get_threads_count).apply(null,arguments)},o._register_tensor=function(){return(o._register_tensor=o.asm.register_tensor).apply(null,arguments)},o._dispose_data=function(){return(o._dispose_data=o.asm.dispose_data).apply(null,arguments)},o._dispose=function(){return(o._dispose=o.asm.dispose).apply(null,arguments)},o._Abs=function(){return(o._Abs=o.asm.Abs).apply(null,arguments)},o._Add=function(){return(o._Add=o.asm.Add).apply(null,arguments)},o._AddN=function(){return(o._AddN=o.asm.AddN).apply(null,arguments)},o._All=function(){return(o._All=o.asm.All).apply(null,arguments)},o._Any=function(){return(o._Any=o.asm.Any).apply(null,arguments)},o._ArgMax=function(){return(o._ArgMax=o.asm.ArgMax).apply(null,arguments)},o._AvgPool=function(){return(o._AvgPool=o.asm.AvgPool).apply(null,arguments)},o._BatchMatMul=function(){return(o._BatchMatMul=o.asm.BatchMatMul).apply(null,arguments)},o._Ceil=function(){return(o._Ceil=o.asm.Ceil).apply(null,arguments)},o._ClipByValue=function(){return(o._ClipByValue=o.asm.ClipByValue).apply(null,arguments)},o._Conv2D=function(){return(o._Conv2D=o.asm.Conv2D).apply(null,arguments)},o._Conv2DBackpropInput=function(){return(o._Conv2DBackpropInput=o.asm.Conv2DBackpropInput).apply(null,arguments)},o._Cos=function(){return(o._Cos=o.asm.Cos).apply(null,arguments)},o._Cosh=function(){return(o._Cosh=o.asm.Cosh).apply(null,arguments)},o._CropAndResize=function(){return(o._CropAndResize=o.asm.CropAndResize).apply(null,arguments)},o._Cumprod=function(){return(o._Cumprod=o.asm.Cumprod).apply(null,arguments)},o._Cumsum=function(){return(o._Cumsum=o.asm.Cumsum).apply(null,arguments)},o._DepthToSpace=function(){return(o._DepthToSpace=o.asm.DepthToSpace).apply(null,arguments)},o._DepthwiseConv2dNative=function(){return(o._DepthwiseConv2dNative=o.asm.DepthwiseConv2dNative).apply(null,arguments)},o._Elu=function(){return(o._Elu=o.asm.Elu).apply(null,arguments)},o._Equal=function(){return(o._Equal=o.asm.Equal).apply(null,arguments)},o._Exp=function(){return(o._Exp=o.asm.Exp).apply(null,arguments)},o._FlipLeftRight=function(){return(o._FlipLeftRight=o.asm.FlipLeftRight).apply(null,arguments)},o._Floor=function(){return(o._Floor=o.asm.Floor).apply(null,arguments)},o._FloorDiv=function(){return(o._FloorDiv=o.asm.FloorDiv).apply(null,arguments)},o._FusedBatchNorm=function(){return(o._FusedBatchNorm=o.asm.FusedBatchNorm).apply(null,arguments)},o._FusedConv2D=function(){return(o._FusedConv2D=o.asm.FusedConv2D).apply(null,arguments)},o._FusedDepthwiseConv2D=function(){return(o._FusedDepthwiseConv2D=o.asm.FusedDepthwiseConv2D).apply(null,arguments)},o._Gather=function(){return(o._Gather=o.asm.Gather).apply(null,arguments)},o._GatherNd=function(){return(o._GatherNd=o.asm.GatherNd).apply(null,arguments)},o._Greater=function(){return(o._Greater=o.asm.Greater).apply(null,arguments)},o._GreaterEqual=function(){return(o._GreaterEqual=o.asm.GreaterEqual).apply(null,arguments)},o._LeakyRelu=function(){return(o._LeakyRelu=o.asm.LeakyRelu).apply(null,arguments)},o._Less=function(){return(o._Less=o.asm.Less).apply(null,arguments)},o._LessEqual=function(){return(o._LessEqual=o.asm.LessEqual).apply(null,arguments)},o._Log=function(){return(o._Log=o.asm.Log).apply(null,arguments)},o._LogicalAnd=function(){return(o._LogicalAnd=o.asm.LogicalAnd).apply(null,arguments)},o._LogicalNot=function(){return(o._LogicalNot=o.asm.LogicalNot).apply(null,arguments)},o._LogicalOr=function(){return(o._LogicalOr=o.asm.LogicalOr).apply(null,arguments)},o._LogicalXor=function(){return(o._LogicalXor=o.asm.LogicalXor).apply(null,arguments)},o._Max=function(){return(o._Max=o.asm.Max).apply(null,arguments)},o._MaxPool=function(){return(o._MaxPool=o.asm.MaxPool).apply(null,arguments)},o._Maximum=function(){return(o._Maximum=o.asm.Maximum).apply(null,arguments)},o._Mean=function(){return(o._Mean=o.asm.Mean).apply(null,arguments)},o._Min=function(){return(o._Min=o.asm.Min).apply(null,arguments)},o._Minimum=function(){return(o._Minimum=o.asm.Minimum).apply(null,arguments)},o._MirrorPad=function(){return(o._MirrorPad=o.asm.MirrorPad).apply(null,arguments)},o._Multiply=function(){return(o._Multiply=o.asm.Multiply).apply(null,arguments)},o._Neg=function(){return(o._Neg=o.asm.Neg).apply(null,arguments)},o._NonMaxSuppressionV3=function(){return(o._NonMaxSuppressionV3=o.asm.NonMaxSuppressionV3).apply(null,arguments)},o._NonMaxSuppressionV4=function(){return(o._NonMaxSuppressionV4=o.asm.NonMaxSuppressionV4).apply(null,arguments)},o._NonMaxSuppressionV5=function(){return(o._NonMaxSuppressionV5=o.asm.NonMaxSuppressionV5).apply(null,arguments)},o._NotEqual=function(){return(o._NotEqual=o.asm.NotEqual).apply(null,arguments)},o._OneHot=function(){return(o._OneHot=o.asm.OneHot).apply(null,arguments)},o._PadV2=function(){return(o._PadV2=o.asm.PadV2).apply(null,arguments)},o._Pow=function(){return(o._Pow=o.asm.Pow).apply(null,arguments)},o._Prelu=function(){return(o._Prelu=o.asm.Prelu).apply(null,arguments)},o._Prod=function(){return(o._Prod=o.asm.Prod).apply(null,arguments)},o._RealDiv=function(){return(o._RealDiv=o.asm.RealDiv).apply(null,arguments)},o._Relu=function(){return(o._Relu=o.asm.Relu).apply(null,arguments)},o._Relu6=function(){return(o._Relu6=o.asm.Relu6).apply(null,arguments)},o._ResizeBilinear=function(){return(o._ResizeBilinear=o.asm.ResizeBilinear).apply(null,arguments)},o._ResizeNearestNeighbor=function(){return(o._ResizeNearestNeighbor=o.asm.ResizeNearestNeighbor).apply(null,arguments)},o._Reverse=function(){return(o._Reverse=o.asm.Reverse).apply(null,arguments)},o._RotateWithOffset=function(){return(o._RotateWithOffset=o.asm.RotateWithOffset).apply(null,arguments)},o._Round=function(){return(o._Round=o.asm.Round).apply(null,arguments)},o._Rsqrt=function(){return(o._Rsqrt=o.asm.Rsqrt).apply(null,arguments)},o._ScatterNd=function(){return(o._ScatterNd=o.asm.ScatterNd).apply(null,arguments)},o._SelectV2=function(){return(o._SelectV2=o.asm.SelectV2).apply(null,arguments)},o._Sigmoid=function(){return(o._Sigmoid=o.asm.Sigmoid).apply(null,arguments)},o._Sin=function(){return(o._Sin=o.asm.Sin).apply(null,arguments)},o._Softmax=function(){return(o._Softmax=o.asm.Softmax).apply(null,arguments)},o._SparseFillEmptyRows=function(){return(o._SparseFillEmptyRows=o.asm.SparseFillEmptyRows).apply(null,arguments)},o._SparseReshape=function(){return(o._SparseReshape=o.asm.SparseReshape).apply(null,arguments)},o._SparseSegmentReduction=function(){return(o._SparseSegmentReduction=o.asm.SparseSegmentReduction).apply(null,arguments)},o._Sqrt=function(){return(o._Sqrt=o.asm.Sqrt).apply(null,arguments)},o._Square=function(){return(o._Square=o.asm.Square).apply(null,arguments)},o._SquaredDifference=function(){return(o._SquaredDifference=o.asm.SquaredDifference).apply(null,arguments)},o._Step=function(){return(o._Step=o.asm.Step).apply(null,arguments)},o._StridedSlice=function(){return(o._StridedSlice=o.asm.StridedSlice).apply(null,arguments)},o._Sub=function(){return(o._Sub=o.asm.Sub).apply(null,arguments)},o._Sum=function(){return(o._Sum=o.asm.Sum).apply(null,arguments)},o._Tan=function(){return(o._Tan=o.asm.Tan).apply(null,arguments)},o._Tanh=function(){return(o._Tanh=o.asm.Tanh).apply(null,arguments)},o._Tile=function(){return(o._Tile=o.asm.Tile).apply(null,arguments)},o._TopK=function(){return(o._TopK=o.asm.TopK).apply(null,arguments)},o._Transform=function(){return(o._Transform=o.asm.Transform).apply(null,arguments)},o._Transpose=function(){return(o._Transpose=o.asm.Transpose).apply(null,arguments)},o.__FusedMatMul=function(){return(o.__FusedMatMul=o.asm._FusedMatMul).apply(null,arguments)},o._malloc=function(){return(o._malloc=o.asm.malloc).apply(null,arguments)},o._free=function(){return(o._free=o.asm.free).apply(null,arguments)},o.___errno_location=function(){return(o.___errno_location=o.asm.__errno_location).apply(null,arguments)};var Y,Q,J,Z=o.stackSave=function(){return(Z=o.stackSave=o.asm.stackSave).apply(null,arguments)},$=o.stackRestore=function(){return($=o.stackRestore=o.asm.stackRestore).apply(null,arguments)},ee=o.stackAlloc=function(){return(ee=o.stackAlloc=o.asm.stackAlloc).apply(null,arguments)};function te(e){function n(){Y||(Y=!0,o.calledRun=!0,T||(z(R),t(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),function(){if(o.postRun)for("function"==typeof o.postRun&&(o.postRun=[o.postRun]);o.postRun.length;)e=o.postRun.shift(),A.unshift(e);var e;z(A)}()))}O>0||(function(){if(o.preRun)for("function"==typeof o.preRun&&(o.preRun=[o.preRun]);o.preRun.length;)e=o.preRun.shift(),E.unshift(e);var e;z(E)}(),O>0||(o.setStatus?(o.setStatus("Running..."),setTimeout((function(){setTimeout((function(){o.setStatus("")}),1),n()}),1)):n()))}if(o.dynCall_iijjiiii=function(){return(o.dynCall_iijjiiii=o.asm.dynCall_iijjiiii).apply(null,arguments)},o.dynCall_jiji=function(){return(o.dynCall_jiji=o.asm.dynCall_jiji).apply(null,arguments)},o.cwrap=function(e,t,n,r){var a=(n=n||[]).every((function(e){return"number"===e||"boolean"===e}));return"string"!==t&&a&&!r?q(e):function(){return X(e,t,n,arguments)}},M=function e(){Y||te(),Y||(M=e)},o.preInit)for("function"==typeof o.preInit&&(o.preInit=[o.preInit]);o.preInit.length>0;)o.preInit.pop()();if(te(),a&&(Q={uncaughtException:B.listeners("uncaughtException").filter((function(e){return!a.uncaughtException.indexOf(e)>-1})),unhandledRejection:B.listeners("unhandledRejection").filter((function(e){return!a.unhandledRejection.indexOf(e)>-1}))}),void 0!==e)J=e;else{if("undefined"==typeof WasmBackendModuleThreadedSimd)throw new Error("Could not find wasm module in post.js");J=WasmBackendModuleThreadedSimd}if(Q){var ne=J._dispose;J._dispose=function(){ne(),Q.uncaughtException.forEach((function(e){B.removeListener("uncaughtException",e)})),Q.unhandledRejection.forEach((function(e){B.removeListener("unhandledRejection",e)}))}}return e.ready});e.exports=r}(Xk);var Kk=Xk.exports,Yk=wn(Kk),Qk=jk||Hk,Jk=Yk||n({__proto__:null,default:Yk},[Kk]),Zk=function(e){function n(e){var r;return l(this,n),(r=f(this,n)).wasm=e,r.dataIdNextNumber=1,r.wasm.tfjs.initWithThreadsCount(uI),r.wasm.tfjs.getThreadsCount(),r.dataIdMap=new U(t(r),ii()),r}return a(n,e),p(n,[{key:"write",value:function(e,t,n){var r={id:this.dataIdNextNumber++};return this.move(r,e,t,n,1),r}},{key:"numDataIds",value:function(){return this.dataIdMap.numDataIds()}},{key:"time",value:(o=c(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=lr(),t(),e.abrupt("return",{kernelMs:lr()-n});case 3:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"move",value:function(e,t,n,r,a){var o=this.dataIdNextNumber++;if("string"!==r){var i=Y(n),s=i*se(r),u=this.wasm._malloc(s);this.dataIdMap.set(e,{id:o,memoryOffset:u,shape:n,dtype:r,refCount:a}),this.wasm.tfjs.registerTensor(o,i,u),null!=t&&this.wasm.HEAPU8.set(new Uint8Array(t.buffer,t.byteOffset,s),u)}else{var c=t;this.dataIdMap.set(e,{id:o,stringBytes:c,shape:n,dtype:r,memoryOffset:null,refCount:a})}}},{key:"read",value:(r=c(u().mark((function e(t){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"readSync",value:function(e,t,n){var r=this.dataIdMap.get(e),a=r.memoryOffset,o=r.dtype,i=r.shape,s=r.stringBytes;if("string"===o)return null!=t&&0!==t||!(null==n||n>=s.length)?s.slice(t,n):s;t=t||0,n=n||Y(i);var u=se(o);return function(e,t){switch(t){case"float32":return new Float32Array(e);case"int32":return new Int32Array(e);case"bool":return new Uint8Array(e);default:throw new Error("Unknown dtype ".concat(t))}}(this.wasm.HEAPU8.slice(a+t*u,a+n*u).buffer,o)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.dataIdMap.has(e)){var n=this.dataIdMap.get(e);if(n.refCount--,!t&&n.refCount>0)return!1;this.wasm._free(n.memoryOffset),this.wasm.tfjs.disposeData(n.id),this.dataIdMap.delete(e)}return!0}},{key:"refCount",value:function(e){return this.dataIdMap.has(e)?this.dataIdMap.get(e).refCount:0}},{key:"incRef",value:function(e){var t=this.dataIdMap.get(e);null!=t&&t.refCount++}},{key:"floatPrecision",value:function(){return 32}},{key:"getMemoryOffset",value:function(e){return this.dataIdMap.get(e).memoryOffset}},{key:"dispose",value:function(){this.wasm.tfjs.dispose(),"PThread"in this.wasm&&this.wasm.PThread.terminateAllThreads(),this.wasm=null}},{key:"memory",value:function(){return{unreliable:!1}}},{key:"makeOutput",value:function(e,t,n){var r;if(null==n)r=this.write(null,e,t);else{var a=this.dataIdNextNumber++;r={id:a},this.dataIdMap.set(r,{id:a,memoryOffset:n,shape:e,dtype:t,refCount:1});var o=Y(e);this.wasm.tfjs.registerTensor(a,o,n)}return{dataId:r,shape:e,dtype:t}}},{key:"typedArrayFromHeap",value:function(e){var t=e.shape,n=e.dtype,r=e.dataId,a=this.wasm.HEAPU8.buffer,o=this.dataIdMap.get(r).memoryOffset,i=Y(t);switch(n){case"float32":return new Float32Array(a,o,i);case"int32":return new Int32Array(a,o,i);case"bool":return new Uint8Array(a,o,i);default:throw new Error("Unknown dtype ".concat(n))}}}]);var r,o}(V);function $k(e,t,n){var r="tfjs-backend-wasm.wasm";return e&&t?r="tfjs-backend-wasm-threaded-simd.wasm":e&&(r="tfjs-backend-wasm-simd.wasm"),null!=oI&&null!=oI[r]?oI[r]:n+r}function eI(){return tI.apply(this,arguments)}function tI(){return(tI=c(u().mark((function e(){var t,n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([Ie().getAsync("WASM_HAS_SIMD_SUPPORT"),Ie().getAsync("WASM_HAS_MULTITHREAD_SUPPORT")]);case 2:return t=e.sent,n=s(t,2),r=n[0],a=n[1],e.abrupt("return",new Promise((function(e,t){var n,o={};o.locateFile=function(e,t){if(e.endsWith(".worker.js")){var n=qk.replace(/\n/g,"\\n"),o=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(o)}return e.endsWith(".wasm")?$k(r,a,null!=aI?aI:t):t+e},sI&&(o.instantiateWasm=(n=$k(r,a,null!=aI?aI:""),function(e,t){return WXWebAssembly.instantiate(n,e).then((function(e){t(e.instance,e.module)})),{}}));var i,s=!1;o.onAbort=function(){s||iI||(iI=!0,t({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))},a&&r&&null==rI?(o.mainScriptUrlOrBlob=new Blob(["var WasmBackendModuleThreadedSimd = "+Qk.toString()],{type:"text/javascript"}),i=Qk(o)):i=Jk(o),i.then((function(t){s=!0,iI=!1,t.tfjs={init:t.cwrap("init",null,[]),initWithThreadsCount:t.cwrap("init_with_threads_count",null,["number"]),getThreadsCount:t.cwrap("get_threads_count","number",[]),registerTensor:t.cwrap("register_tensor",null,["number","number","number"]),disposeData:t.cwrap("dispose_data",null,["number"]),dispose:t.cwrap("dispose",null,[])},e({wasm:t})})).catch(t)})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var nI=["tfjs-backend-wasm.wasm","tfjs-backend-wasm-simd.wasm","tfjs-backend-wasm-threaded-simd.wasm"],rI=null,aI=null,oI={},iI=!1,sI=!1,uI=-1;di("wasm",c(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,eI();case 2:return t=e.sent,n=t.wasm,e.abrupt("return",new Zk(n));case 5:case"end":return e.stop()}}),e)}))),2);function cI(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e);return t<0?void 0:t}function lI(e){if(e>=0&&e<64)return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]}var pI=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");if((e=(e="".concat(e)).replace(/[ \t\n\f\r]/g,"")).length%4==0&&(e=e.replace(/==?$/,"")),e.length%4==1||/[^+/0-9A-Za-z]/.test(e))return null;for(var t="",n=0,r=0,a=0;a<e.length;a++)n<<=6,n|=cI(e[a]),24===(r+=6)&&(t+=String.fromCharCode((16711680&n)>>16),t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n),n=r=0);return 12===r?(n>>=4,t+=String.fromCharCode(n)):18===r&&(n>>=2,t+=String.fromCharCode((65280&n)>>8),t+=String.fromCharCode(255&n)),t},dI=function(e){if(0===arguments.length)throw new TypeError("1 argument required, but only 0 present.");var t;for(e="".concat(e),t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return null;var n="";for(t=0;t<e.length;t+=3){var r=[void 0,void 0,void 0,void 0];r[0]=e.charCodeAt(t)>>2,r[1]=(3&e.charCodeAt(t))<<4,e.length>t+1&&(r[1]|=e.charCodeAt(t+1)>>4,r[2]=(15&e.charCodeAt(t+1))<<2),e.length>t+2&&(r[2]|=e.charCodeAt(t+2)>>6,r[3]=63&e.charCodeAt(t+2));for(var a=0;a<r.length;a++)void 0===r[a]?n+="=":n+=lI(r[a])}return n},hI=["utf8","utf-8","unicode-1-1-utf-8"],fI=function(e){if(hI.indexOf(e)<0&&void 0!==e&&null!=e)throw new RangeError("Invalid encoding type. Only utf-8 is supported");this.encoding="utf-8",this.encode=function(e){if("string"!=typeof e)throw new TypeError("passed argument must be of tye string");for(var t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length),r=t.split(""),a=0;a<r.length;a++)n[a]=r[a].charCodeAt(0);return n}},mI=function(e){if(hI.indexOf(e)<0&&void 0!==e&&null!=e)throw new RangeError("Invalid encoding type. Only utf-8 is supported");this.encoding="utf-8",this.decode=function(e,t){if(void 0===e)return"";var n=void 0!==t&&n in t&&t.stream;if("boolean"!=typeof n)throw new TypeError("stream option must be boolean");if(ArrayBuffer.isView(e)){for(var r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a=new Array(r.length),o=0;o<r.length;o++)a[o]=String.fromCharCode(r[o]);return decodeURIComponent(escape(a.join("")))}throw new TypeError("passed argument must be an array buffer view")}},gI=null,vI=function(){return p((function e(t){l(this,e),gI=t}),[{key:"fetch",value:function(e,t){return gI(e,t)}},{key:"now",value:function(){return Date.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return new fI(t).encode(e)}},{key:"decode",value:function(e,t){return new mI(t).decode(e)}}])}(),yI="wechat-webgl";function bI(e){var t=global.reduceTfjs.saber;if(e){if(yI,!Br.findBackend("wechat-webgl")){var n=e.getContext("webgl",{alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0});t.writeConsoleLog("Start initialize ve1"),Fc(1,n),Te.set("WEBGL_VERSION",1);try{di(yI,(function(){var e=new Gl(n);return new Hd(e)}),2),vn("webgl").forEach((function(e){yn(Object.assign({},e,{backendName:yI}))}))}catch(e){throw new Error("Failed to register ve1: ".concat(e.message))}}}else t.writeConsoleError("ve1 initialization failed, canvas is null.")}!function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(iI)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPaths()` before you call `tf.setBackend()` or `tf.ready()`");if("string"==typeof e)aI=e;else{oI=e;var n=nI.filter((function(e){return null==oI[e]}));if(n.length>0)throw new Error("There were no entries found for the following binaries: ".concat(n.join(","),". Please either call setWasmPaths with a map providing a path for each binary, or with a string indicating the directory where all the binaries can be found."))}sI=t}({"tfjs-backend-wasm.wasm":"/mini-tfjs/wasms/tfjs-backend-wasm.wasm.br","tfjs-backend-wasm-simd.wasm":"/mini-tfjs/wasms/tfjs-backend-wasm-simd.wasm.br","tfjs-backend-wasm-threaded-simd.wasm":"/mini-tfjs/wasms/tfjs-backend-wasm-threaded-simd.wasm.br"},!0),Te.set("WASM_HAS_SIMD_SUPPORT",!0),Te.global.btoa=dI,Te.global.atob=pI;var xI,wI,kI,II,SI={WECHAT_WEBGL_BACKEND_NAME:yI,setupWechatPlatform:(wI=c(u().mark((function e(t){var n,r,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=global.reduceTfjs.saber,r=t.backendName||yI,pi()===r){e.next=13;break}if("wechat"!=Te.platformName&&(a=new vI(t.fetchFunc),Te.setPlatform("wechat",a)),bI(t.canvas),"wasm"!=r){e.next=10;break}return e.next=7,li(r);case 7:n.writeConsoleDebug("ve1 enhanced mode"),e.next=13;break;case 10:return e.next=12,li(r);case 12:n.writeConsoleDebug("ve1 normal mode");case 13:case"end":return e.stop()}}),e)}))),function(e){return wI.apply(this,arguments)}),getBackend:function(){return pi()},changeBackend:(xI=c(u().mark((function e(t){var n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=t||yI,pi()!=t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,li(t);case 4:n=global.reduceTfjs.saber,"wasm"==t?n.writeConsoleDebug("ve1 enhanced mode"):n.writeConsoleDebug("ve1 normal mode");case 6:case"end":return e.stop()}}),e)}))),function(e){return xI.apply(this,arguments)})};Ie().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(kI||(kI={})),function(e){var t;(t=e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(II||(II={}));var TI={};function _I(e){return TI[e]}function CI(e,t,n,r,a){var o=t.inputParams[e];if(o&&void 0!==o.inputIndexStart){var i=o.inputIndexStart,s=0===o.inputIndexEnd?void 0:void 0===o.inputIndexEnd?i+1:o.inputIndexEnd;if("tensor"===o.type)return NI(t.inputNames[o.inputIndexStart],n,r,a);if("tensors"===o.type)return t.inputNames.slice(i,s).map((function(e){return NI(e,n,r,a)}));var u=NI(t.inputNames.slice(i)[0],n,r,a),c=u.dataSync();return"number"===o.type?c[0]:fe(u.shape,c)}var l=t.attrParams[e];return l&&l.value}function NI(e,t,n,r){var a=AI(e),o=s(a,2),i=o[0],u=o[1];if(null!=r){var c=r.getHashTableHandleByName(i);if(null!=c)return c}var l=n.currentContextIds.find((function(e){return!!t[RI(i,e)]}));return void 0!==l?t[RI(i,l)][u]:void 0}function EI(e,t){var n=AI(e),r=s(n,3),a=r[0],o=r[1],i=r[2];return[RI(a,t&&t.currentContextId),o,i]}function RI(e,t){return t?"".concat(e,"-").concat(t):e}function AI(e){var t=e.split(":");if(1===t.length)return[e,0,void 0];var n=t[0],r=3===t.length?t[1]:void 0;return[n,Number(t[t.length-1]),r]}function OI(e,t,n){var r=CI("pad",e,t,n);if("explicit"===r){r=CI("explicitPaddings",e,t,n);for(var a=[[0,0],[0,0],[0,0],[0,0]],o=0;o<4;o++)a[o][0]=r[2*o],a[o][1]=r[2*o+1];return a}return r}function MI(e){return e.kept?e:as(e)}var FI=Object.freeze({__proto__:null,json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),DI=Object.freeze({__proto__:null,json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"clipValueMin",type:"number"},{start:2,name:"clipValueMax",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"IsNan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),PI=Object.freeze({__proto__:null,json:[{tfOpName:"EmptyTensorList",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"maxNumElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"tensor"}]},{tfOpName:"StatelessIf",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"If",category:"control",inputs:[{start:0,name:"cond",type:"tensor"},{start:1,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"then_branch",name:"thenBranch",type:"func"},{tfName:"else_branch",name:"elseBranch",type:"func"}]},{tfOpName:"StatelessWhile",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"While",category:"control",inputs:[{start:0,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"cond",name:"cond",type:"func"},{tfName:"body",name:"body",type:"func"}]},{tfOpName:"TensorListScatter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListScatterV2",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"},{start:3,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGather",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"indices",type:"number[]"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListGetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListSetItem",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListReserve",category:"control",inputs:[{start:0,name:"elementShape",type:"shape"},{start:1,name:"numElements",type:"number"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListFromTensor",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListStack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"},{tfName:"num_elements",name:"numElements",type:"dtype"}]},{tfOpName:"TensorListSplit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"},{start:1,name:"elementShape",type:"shape"},{start:2,name:"lengths",type:"number[]"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcat",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListConcatV2",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}],attrs:[{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPopBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"elementShape",type:"shape"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListPushBack",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"tensor",type:"tensor"}],attrs:[{tfName:"element_dtype",name:"elementDType",type:"dtype"}]},{tfOpName:"TensorListLength",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"}]},{tfOpName:"TensorListResize",category:"control",inputs:[{start:0,name:"tensorListId",type:"tensor"},{start:1,name:"size",type:"number"}]}]}),LI=Object.freeze({__proto__:null,json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[],notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"Dilation2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"rates",name:"dilations",type:"number[]"},{tfName:"padding",name:"pad",type:"string"}]}]}),BI=Object.freeze({__proto__:null,json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomStandardNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),UI=Object.freeze({__proto__:null,json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV4",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"T_threshold",name:"threshold",type:"dtype",notSupported:!0},{tfName:"pad_to_max_output_size",name:"padToMaxOutputSize",type:"bool"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),VI=Object.freeze({__proto__:null,json:[{tfOpName:"LowerBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]},{tfOpName:"UpperBound",category:"evaluation",inputs:[{start:0,name:"sortedSequence",type:"tensor"},{start:1,name:"values",type:"tensor"}]},{tfOpName:"Unique",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"UniqueV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]}]}),WI=Object.freeze({__proto__:null,json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),zI=Object.freeze({__proto__:null,json:[{tfOpName:"HashTable",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"HashTableV2",category:"hash_table",inputs:[],attrs:[{tfName:"shared_name",name:"sharedName",type:"string"},{tfName:"use_node_name_sharing",name:"useNodeNameSharing",type:"bool"},{tfName:"key_dtype",name:"keyDType",type:"dtype"},{tfName:"value_dtype",name:"valueDType",type:"dtype"}]},{tfOpName:"LookupTableImport",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableImportV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"values",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFind",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableFindV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"},{start:1,name:"keys",type:"tensor"},{start:2,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"Tin",name:"tIn",type:"dtype",notSupported:!0},{tfName:"Tout",name:"tOut",type:"dtype",notSupported:!0}]},{tfOpName:"LookupTableSize",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]},{tfOpName:"LookupTableSizeV2",category:"hash_table",inputs:[{start:0,name:"tableHandle",type:"tensor"}]}]}),GI=Object.freeze({__proto__:null,json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"half_pixel_centers",name:"halfPixelCenters",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]},{tfOpName:"ImageProjectiveTransformV3",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"transforms",type:"tensor"},{start:2,name:"outputShape",type:"number[]"},{start:3,name:"fillValue",type:"number"}],attrs:[{tfName:"interpolation",name:"interpolation",type:"string"},{tfName:"fill_mode",name:"fillMode",type:"string"}]}]}),jI=Object.freeze({__proto__:null,json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),HI=Object.freeze({__proto__:null,json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"leakyrelu_alpha",name:"leakyreluAlpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Einsum",category:"matrices",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"equation",name:"equation",type:"string"},{tfName:"N",name:"n",type:"number",defaultValue:2},{tfName:"T",name:"dtype",type:"dtype"}]}]}),qI=Object.freeze({__proto__:null,json:[{tfOpName:"EuclideanNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",defaultValue:!1}]},{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),XI=Object.freeze({__proto__:null,json:[{tfOpName:"Bincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}]},{tfOpName:"DenseBincount",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"size",type:"number"},{start:2,name:"weights",type:"tensor"}],attrs:[{tfName:"binary_output",name:"binaryOutput",type:"bool"}]},{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Cumprod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]},{tfOpName:"Cumsum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}],attrs:[{tfName:"exclusive",name:"exclusive",type:"bool"},{tfName:"reverse",name:"reverse",type:"bool"}]}]}),KI=Object.freeze({__proto__:null,json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}],attrs:[{tfName:"batch_dims",name:"batchDims",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool[]"}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),YI=Object.freeze({__proto__:null,json:[{tfOpName:"SparseFillEmptyRows",category:"sparse",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"denseShape",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}]},{tfOpName:"SparseReshape",category:"sparse",inputs:[{start:0,name:"inputIndices",type:"tensor"},{start:1,name:"inputShape",type:"tensor"},{start:2,name:"newShape",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SparseSegmentMean",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]},{tfOpName:"SparseSegmentSum",category:"sparse",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"segmentIds",type:"tensor"}]}]}),QI=Object.freeze({__proto__:null,json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),JI=Object.freeze({__proto__:null,json:[{tfOpName:"StringNGrams",category:"string",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"dataSplits",type:"tensor"}],attrs:[{tfName:"separator",name:"separator",type:"string"},{tfName:"ngram_widths",name:"nGramWidths",type:"number[]"},{tfName:"left_pad",name:"leftPad",type:"string"},{tfName:"right_pad",name:"rightPad",type:"string"},{tfName:"pad_width",name:"padWidth",type:"number"},{tfName:"preserve_short_sequences",name:"preserveShortSequences",type:"bool"}],outputs:["ngrams","ngrams_splits"]},{tfOpName:"StringSplit",category:"string",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"delimiter",type:"tensor"}],attrs:[{tfName:"skip_empty",name:"skipEmpty",type:"bool"}],outputs:["indices","values","shape"]},{tfOpName:"StringToHashBucketFast",category:"string",inputs:[{start:0,name:"input",type:"tensor"}],attrs:[{tfName:"num_buckets",name:"numBuckets",type:"number"}]}]}),ZI=Object.freeze({__proto__:null,json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"MirrorPad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"mode",name:"mode",type:"string"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]},{tfOpName:"BroadcastTo",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}],attrs:[]},{tfOpName:"BroadcastArgs",category:"transformation",inputs:[{start:0,name:"s0",type:"tensor"},{start:1,name:"s1",type:"tensor"}],attrs:[]}]}),$I=function(){return p((function e(){var t;l(this,e);var n=(t=[]).concat.apply(t,o([FI,DI,PI,LI,BI,UI,VI,WI,zI,GI,jI,HI,qI,XI,KI,YI,QI,JI,ZI].map((function(e){return e.json}))));this.opMappers=n.reduce((function(e,t){return e[t.tfOpName]=t,e}),{})}),[{key:"transformGraph",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.node,a=[],o=[],i=[],u=r.reduce((function(e,n){return e[n.name]=t.mapNode(n),n.op.startsWith("Placeholder")?a.push(e[n.name]):"Const"===n.op?o.push(e[n.name]):null!=n.input&&0!==n.input.length||i.push(e[n.name]),e}),{}),c=[],l=[],p={},d={};null!=n&&(p=this.mapSignatureEntries(n.inputs),d=this.mapSignatureEntries(n.outputs));var h=Object.keys(u);h.forEach((function(e){var t=u[e];t.inputNames.forEach((function(e,n){var r=EI(e),a=s(r,3),o=a[0],i=a[2],c=u[o];if(null!=c.outputs){var l=c.outputs.indexOf(i);if(-1!==l){var p="".concat(o,":").concat(l);t.inputNames[n]=p}}t.inputs.push(c),c.children.push(t)}))})),0===Object.keys(d).length?h.forEach((function(e){var t=u[e];0===t.children.length&&l.push(t)})):Object.keys(d).forEach((function(e){var t=EI(e),n=s(t,1)[0],r=u[n];null!=r&&(r.signatureKey=d[e],l.push(r))})),Object.keys(p).length>0?Object.keys(p).forEach((function(e){var t=EI(e),n=s(t,1)[0],r=u[n];r&&(r.signatureKey=p[e],c.push(r))})):c=a;var f={};null!=e.library&&null!=e.library.function&&(f=e.library.function.reduce((function(e,n){return e[n.signature.name]=t.mapFunction(n),e}),{}));var m={nodes:u,inputs:c,outputs:l,weights:o,placeholders:a,signature:n,functions:f};return i.length>0&&(m.initNodes=i),m}},{key:"mapSignatureEntries",value:function(e){return Object.keys(e||{}).reduce((function(t,n){return t[e[n].name]=n,t}),{})}},{key:"mapNode",value:function(e){var t=_I(e.op)||this.opMappers[e.op]||{};null==e.attr&&(e.attr={});var n={name:e.name,op:e.op,category:t.category,inputNames:(e.input||[]).map((function(e){return e.startsWith("^")?e.slice(1):e})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:e.attr,outputs:t.outputs};return null!=t.inputs&&(n.inputParams=t.inputs.reduce((function(e,t){return e[t.name]={type:t.type,inputIndexStart:t.start,inputIndexEnd:t.end},e}),{})),null!=t.attrs&&(n.attrParams=t.attrs.reduce((function(t,n){var r,a=n.type;switch(n.type){case"string":void 0===(r=tS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=tS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"string[]":void 0===(r=pS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=pS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number":void 0===(r=rS(e.attr,n.tfName,n.defaultValue||0))&&n.tfDeprecatedName&&(r=rS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"number[]":void 0===(r=lS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=lS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool":void 0===(r=nS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=nS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"bool[]":void 0===(r=hS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=hS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape":void 0===(r=cS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=cS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"shape[]":void 0===(r=dS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=dS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype":void 0===(r=iS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=iS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"dtype[]":void 0===(r=sS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=sS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"func":void 0===(r=oS(e.attr,n.tfName,n.defaultValue))&&n.tfDeprecatedName&&(r=oS(e.attr,n.tfDeprecatedName,n.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: ".concat(n.type," for op: ").concat(e.op))}return t[n.name]={value:r,type:a},t}),{})),n}},{key:"mapFunction",value:function(e){var t=this,n=e.nodeDef,r=[],a={};null!=n&&(a=n.reduce((function(e,n){return e[n.name]=t.mapNode(n),"Const"===n.op&&r.push(e[n.name]),e}),{}));var o=[],i=[];e.signature.inputArg.forEach((function(e){var t=EI(e.name),n=s(t,1)[0],r={name:n,op:"Placeholder",inputs:[],inputNames:[],category:"graph",inputParams:{},attrParams:{dtype:{value:aS(e.type),type:"dtype"}},children:[]};r.signatureKey=e.name,o.push(r),a[n]=r})),Object.keys(a).forEach((function(e){var t=a[e];t.inputNames.forEach((function(e,n){var r=EI(e),o=s(r,3),i=o[0],u=o[2],c=a[i];if(null!=c.outputs){var l=c.outputs.indexOf(u);if(-1!==l){var p="".concat(i,":").concat(l);t.inputNames[n]=p}}t.inputs.push(c),c.children.push(t)}))}));var u=e.ret;e.signature.outputArg.forEach((function(e){var t=EI(u[e.name]),n=s(t,2),r=n[0],o=n[1],c=a[r];null!=c&&(c.defaultOutput=o,i.push(c))}));var c=this.mapArgsToSignature(e);return{nodes:a,inputs:o,outputs:i,weights:r,placeholders:[],signature:c}}},{key:"mapArgsToSignature",value:function(e){var t=this;return{methodName:e.signature.name,inputs:e.signature.inputArg.reduce((function(e,n){return e[n.name]=t.mapArgToTensorInfo(n),e}),{}),outputs:e.signature.outputArg.reduce((function(n,r){return n[r.name]=t.mapArgToTensorInfo(r,e.ret),n}),{})}}},{key:"mapArgToTensorInfo",value:function(e,t){var n=e.name;return null!=t&&(n=t[n]),{name:n,dtype:e.type}}}],[{key:"Instance",get:function(){return this._instance||(this._instance=new this)}}])}();function eS(e,t){var n=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var t=Ie().global;if(void 0!==t.atob)return t.atob(e);if(void 0!==na)return new na(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return t?n:n.toLowerCase()}function tS(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return null!=a?eS(a.s,r):n}function nS(e,t,n){var r=e[t];return r?r.b:n}function rS(e,t,n){var r=e[t]||{},a=null!=r.i?r.i:null!=r.f?r.f:n;return"number"==typeof a?a:parseInt(a,10)}function aS(e){switch("string"==typeof e&&(e=kI[e]),e){case kI.DT_FLOAT:case kI.DT_HALF:return"float32";case kI.DT_INT32:case kI.DT_INT64:case kI.DT_INT8:case kI.DT_UINT8:return"int32";case kI.DT_BOOL:return"bool";case kI.DT_DOUBLE:return"float32";case kI.DT_STRING:return"string";default:return null}}function oS(e,t,n){var r=e[t];return r&&r.func?r.func.name:n}function iS(e,t,n){var r=e[t];return r&&r.type?aS(r.type):n}function sS(e,t,n){var r=e[t];return r&&r.list&&r.list.type?r.list.type.map((function(e){return aS(e)})):n}function uS(e){if(!e.unknownRank)return null!=e.dim?e.dim.map((function(e){return"number"==typeof e.size?e.size:parseInt(e.size,10)})):[]}function cS(e,t,n){var r=e[t];return r&&r.shape?uS(r.shape):n}function lS(e,t,n){var r=e[t];return r?((r.list.f&&r.list.f.length?r.list.f:r.list.i)||[]).map((function(e){return"number"==typeof e?e:parseInt(e,10)})):n}function pS(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t];return a&&a.list&&a.list.s?a.list.s.map((function(e){return eS(e,r)})):n}function dS(e,t,n){var r=e[t];return r&&r.list&&r.list.shape?r.list.shape.map((function(e){return uS(e)})):n}function hS(e,t,n){var r=e[t];return r&&r.list&&r.list.b?r.list.b:n}var fS=function(){return p((function e(t,n,r){var a=this;l(this,e),this.node=t,this.tensorMap=n,this.context=r,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(e){return a.getInput(e)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(e,t){return e[t]=a.getAttr(t),e}),{}))}),[{key:"getInput",value:function(e){return NI(e,this.tensorMap,this.context)}},{key:"getAttr",value:function(e,t){var n=this.node.rawAttrs[e];if(null!=n.tensor)return NI(e,this.tensorMap,this.context);if(null!=n.i||null!=n.f)return rS(this.node.rawAttrs,e,t);if(null!=n.s)return tS(this.node.rawAttrs,e,t);if(null!=n.b)return nS(this.node.rawAttrs,e,t);if(null!=n.shape)return cS(this.node.rawAttrs,e,t);if(null!=n.type)return iS(this.node.rawAttrs,e,t);if(null!=n.list){if(null!=n.list.i||null!=n.list.f)return lS(this.node.rawAttrs,e,t);if(null!=n.list.s)return pS(this.node.rawAttrs,e,t);if(null!=n.list.shape)return dS(this.node.rawAttrs,e,t);if(null!=n.list.b)return hS(this.node.rawAttrs,e,t);if(null!=n.list.type)return sS(this.node.rawAttrs,e,t)}return t}}])}(),mS={conv2d:su,depthwiseConv2d:lu},gS={resizeBilinear:Ou},vS=Object.freeze({__proto__:null,add:Bi,argMax:zi,cast:oi,concat:os,depthwiseConv2d:ms,div:Vi,expandDims:As,floorDiv:Ui,fused:mS,gatherND:tu,image:gS,mul:Wi,reshape:rs,scalar:_s,sigmoid:is,sqrt:Cs,squaredDifference:Ks,squeeze:Ys,stack:Qs,sub:Ls,unstack:eu});function yS(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if("number"!=typeof e&&"number"!=typeof t){H(e.length===t.length,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}));for(var r=0;r<e.length;r++){var a=e[r],o=t[r];H(a<0||o<0||a===o,(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}}}function bS(e){return"number"!=typeof e&&!e.some((function(e){return e<0}))}function xS(e,t,n){var r=wS(e,n),a=!bS(r);if(a&&0===t.length)throw new Error("Tried to calculate elements of an empty list with non-fully-defined elementShape: ".concat(r));if(a&&t.forEach((function(e){r=wS(e.shape,r)})),!bS(r))throw new Error("Non-fully-defined elementShape: ".concat(r));return r}function wS(e,t){if("number"==typeof e)return t;if("number"==typeof t)return e;if(e.length!==t.length)throw new Error("Incompatible ranks during merge: ".concat(e," vs. ").concat(t));for(var n=[],r=0;r<e.length;++r){var a=e[r],o=t[r];if(a>=0&&o>=0&&a!==o)throw new Error("Incompatible shape during merge: ".concat(e," vs. ").concat(t));n[r]=a>=0?a:o}return n}var kS=function(){return p((function e(t,n,r,a,o,i,s){l(this,e),this.name=t,this.dtype=n,this.maxSize=r,this.elementShape=a,this.identicalElementShapes=o,this.dynamicSize=i,this.clearAfterRead=s,this.tensors=[],this.closed_=!1,this.idTensor=_s(0),ci(this.idTensor)}),[{key:"id",get:function(){return this.idTensor.id}},{key:"closed",get:function(){return this.closed_}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.tensor.id)||t.tensor.dispose()})),this.tensors=[],this.closed_=!0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"read",value:function(e){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||e>=this.size())throw new Error("Tried to read from index ".concat(e,", but array size is: ").concat(this.size()));var t=this.tensors[e];if(t.cleared)throw new Error("TensorArray ".concat(this.name,": Could not read index ").concat(e," twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?)."));return this.clearAfterRead&&(t.cleared=!0),t.read=!0,t.tensor}},{key:"readMany",value:function(e){var t=this;return e.map((function(e){return t.read(e)}))}},{key:"write",value:function(e,t){if(this.closed_)throw new Error("TensorArray ".concat(this.name," has already been closed."));if(e<0||!this.dynamicSize&&e>=this.maxSize)throw new Error("Tried to write to index ".concat(e,", but array is not resizeable and size is: ").concat(this.maxSize));var n=this.tensors[e]||{};if(t.dtype!==this.dtype)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,",\n          because the value dtype is ").concat(t.dtype,", but TensorArray dtype is ").concat(this.dtype,"."));if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=t.shape),yS(this.elementShape,t.shape,"TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,".")),n.read)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been read."));if(n.written)throw new Error("TensorArray ".concat(this.name,": Could not write to TensorArray index ").concat(e,", because it has already been written."));n.tensor=t,ci(t),n.written=!0,this.tensors[e]=n}},{key:"writeMany",value:function(e,t){var n=this;if(e.length!==t.length)throw new Error("TensorArray ".concat(this.name,": could not write multiple tensors,because the index size: ").concat(e.length," is not the same as tensors size: ").concat(t.length,"."));e.forEach((function(e,r){return n.write(e,t[r])}))}},{key:"gather",value:function(e,t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but gather requested dtype ").concat(t));if(e)e=e.slice(0,this.size());else{e=[];for(var n=0;n<this.size();n++)e.push(n)}if(0===e.length)return Xa([],[0].concat(this.elementShape));var r=this.readMany(e);return yS(this.elementShape,r[0].shape,"TensorArray shape mismatch: "),Qs(r,0)}},{key:"concat",value:function(e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but concat requested dtype ").concat(e));if(0===this.size())return Xa([],[0].concat(this.elementShape));for(var t=[],n=0;n<this.size();n++)t.push(n);var r=this.readMany(t);return yS(this.elementShape,r[0].shape,"TensorArray shape mismatch: tensor array shape (".concat(this.elementShape,") vs first tensor shape (").concat(r[0].shape,")")),os(r,0)}},{key:"scatter",value:function(e,t){if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));if(e.length!==t.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(e.length," vs. ").concat(t.shape[0]));var n=Math.max.apply(Math,o(e));if(!this.dynamicSize&&n>=this.maxSize)throw new Error("Max index must be < array size (".concat(n,"  vs. ").concat(this.maxSize,")"));this.writeMany(e,eu(t,0))}},{key:"split",value:function(e,t){var n=this;if(t.dtype!==this.dtype)throw new Error("TensorArray dtype is ".concat(this.dtype," but tensor has dtype ").concat(t.dtype));var r=0,a=e.map((function(e){return r+=e}));if(r!==t.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(t.shape));if(!this.dynamicSize&&e.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths (".concat(this.maxSize," vs. ").concat(e.length,"), and the TensorArray is not marked as dynamically resizeable"));var o=0===r?0:t.size/r,i=[];si((function(){t=rs(t,[1,r,o]);for(var s=0;s<e.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,e[s],o];i[s]=rs(ss(t,u,c),n.elementShape)}return i}));for(var s=[],u=0;u<e.length;u++)s[u]=u;this.writeMany(s,i)}}])}(),IS=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1;l(this,e),this.tensors=t,this.elementShape=n,this.elementDtype=r,null!=t&&t.forEach((function(e){if(r!==e.dtype)throw new Error("Invalid data types; op elements ".concat(r,", but list elements ").concat(e.dtype));yS(n,e.shape,"TensorList shape mismatch: "),ci(e)})),this.idTensor=_s(0),this.maxNumElements=a,ci(this.idTensor)}return p(e,[{key:"id",get:function(){return this.idTensor.id}},{key:"copy",value:function(){return new e(o(this.tensors),this.elementShape,this.elementDtype)}},{key:"clearAndClose",value:function(e){this.tensors.forEach((function(t){null!=e&&e.has(t.id)||t.dispose()})),this.tensors.length=0,this.idTensor.dispose()}},{key:"size",value:function(){return this.tensors.length}},{key:"stack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(-1!==r&&this.tensors.length!==r)throw new Error("Operation expected a list with ".concat(r," elements but got a list with ").concat(this.tensors.length," elements."));yS(e,this.elementShape,"TensorList shape mismatch: ");var a=xS(this.elementShape,this.tensors,e);return si((function(){var e=n.tensors.map((function(e){return rs(e,a)}));return Qs(e,0)}))}},{key:"popBack",value:function(e,t){if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));if(0===this.size())throw new Error("Trying to pop from an empty list.");var n=xS(this.elementShape,this.tensors,e),r=this.tensors.pop();return r.kept=!1,yS(r.shape,e,"TensorList shape mismatch: "),rs(r,n)}},{key:"pushBack",value:function(e){if(e.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(this.elementDtype));if(yS(e.shape,this.elementShape,"TensorList shape mismatch: "),this.maxNumElements===this.size())throw new Error("Trying to push element into a full list.");ci(e),this.tensors.push(e)}},{key:"resize",value:function(t){if(t<0)throw new Error("TensorListResize expects size to be non-negative. Got: ".concat(t));if(-1!==this.maxNumElements&&t>this.maxNumElements)throw new Error("TensorListResize input size ".concat(t," is greater maxNumElement ").concat(this.maxNumElements,"."));var n=new e([],this.elementShape,this.elementDtype,this.maxNumElements);n.tensors.length=t;for(var r=0;r<Math.min(this.tensors.length,t);++r)n.tensors[r]=this.tensors[r];return n}},{key:"getItem",value:function(e,t,n){if(n!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(n,", but list elements ").concat(this.elementDtype));if(e<0||e>this.tensors.length)throw new Error("Trying to access element ".concat(e," in a list with ").concat(this.tensors.length," elements."));if(null==this.tensors[e])throw new Error("element at index ".concat(e," is null."));yS(this.tensors[e].shape,t,"TensorList shape mismatch: ");var r=xS(this.elementShape,this.tensors,t);return rs(this.tensors[e],r)}},{key:"setItem",value:function(e,t){if(t.dtype!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t.dtype,", but list elements ").concat(this.elementDtype));if(e<0||-1!==this.maxNumElements&&e>=this.maxNumElements)throw new Error("Trying to set element ".concat(e," in a list with max ").concat(this.maxNumElements," elements."));yS(this.elementShape,t.shape,"TensorList shape mismatch: "),ci(t),null!=this.tensors[e]&&(this.tensors[e].kept=!1),this.tensors[e]=t}},{key:"gather",value:function(e,t,n){var r=this;if(t!==this.elementDtype)throw new Error("Invalid data types; op elements ".concat(t,", but list elements ").concat(this.elementDtype));yS(this.elementShape,n,"TensorList shape mismatch: "),e=e.slice(0,this.size());var a=xS(this.elementShape,this.tensors,n);return 0===e.length?Xa([],[0].concat(a)):si((function(){var t=e.map((function(e){return rs(r.tensors[e],a)}));return Qs(t,0)}))}},{key:"concat",value:function(e,t){var n=this;if(e&&e!==this.elementDtype)throw new Error("TensorList dtype is ".concat(this.elementDtype," but concat requested dtype ").concat(e));yS(this.elementShape,t,"TensorList shape mismatch: ");var r=xS(this.elementShape,this.tensors,t);return 0===this.size()?Xa([],[0].concat(r)):si((function(){var e=n.tensors.map((function(e){return rs(e,r)}));return os(e,0)}))}}])}(),SS=function(){var e=c(u().mark((function e(t,n,r){var a,i,s,c,l,p,d,h,f,m,g,v,y,b,x,w,k,I,S,T,_,C,N,E,R,A,O,M,F,D,P,L,B,U,V,W,z,G,j,H,q,X,K,Y,Q,J,Z,$,ee,te,ne,re,ae,oe,ie,se,ue,ce,le,pe,de,he,fe,me,ge,ve,ye,be,xe,we,ke,Ie,Se,Te,_e,Ce,Ne,Ee,Re,Ae,Oe,Me,Fe,De,Pe,Le,Be,Ue,Ve,We,ze;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="If"===e.t0||"StatelessIf"===e.t0?3:"While"===e.t0||"StatelessWhile"===e.t0?12:"LoopCond"===e.t0?30:"Switch"===e.t0?31:"Merge"===e.t0?42:"Enter"===e.t0?46:"Exit"===e.t0?48:"NextIteration"===e.t0?50:"TensorArrayV3"===e.t0?52:"TensorArrayWriteV3"===e.t0?54:"TensorArrayReadV3"===e.t0?56:"TensorArrayGatherV3"===e.t0?58:"TensorArrayScatterV3"===e.t0?60:"TensorArrayConcatV3"===e.t0?62:"TensorArraySplitV3"===e.t0?64:"TensorArraySizeV3"===e.t0?66:"TensorArrayCloseV3"===e.t0?68:"TensorListSetItem"===e.t0?70:"TensorListGetItem"===e.t0?72:"TensorListScatterV2"===e.t0||"TensorListScatter"===e.t0?74:"TensorListReserve"===e.t0||"EmptyTensorList"===e.t0?76:"TensorListGather"===e.t0?80:"TensorListStack"===e.t0?82:"TensorListFromTensor"===e.t0?84:"TensorListConcat"===e.t0||"TensorListConcatV2"===e.t0?86:"TensorListPushBack"===e.t0?88:"TensorListPopBack"===e.t0?90:"TensorListSplit"===e.t0?92:"TensorListLength"===e.t0?94:"TensorListResize"===e.t0?96:98;break;case 3:return a=CI("thenBranch",t,n,r),i=CI("elseBranch",t,n,r),s=CI("cond",t,n,r),c=CI("args",t,n,r),e.next=6,s.data();case 6:if(!e.sent[0]){e.next=10;break}e.t1=r.functionMap[a].executeFunctionAsync(c,r.tensorArrayMap,r.tensorListMap),e.next=11;break;case 10:e.t1=r.functionMap[i].executeFunctionAsync(c,r.tensorArrayMap,r.tensorListMap);case 11:return e.abrupt("return",e.t1);case 12:return l=CI("body",t,n,r),p=CI("cond",t,n,r),d=CI("args",t,n,r),e.next=17,r.functionMap[p].executeFunctionAsync(d,r.tensorArrayMap,r.tensorListMap);case 17:return h=e.sent,f=d.map((function(e){return e.id})),e.next=21,h[0].data();case 21:m=e.sent,h.forEach((function(e){e.kept||-1!==f.indexOf(e.id)||e.dispose()})),g=d,v=u().mark((function e(){var t,n,a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=g,e.next=3,r.functionMap[l].executeFunctionAsync(g,r.tensorArrayMap,r.tensorListMap);case 3:return g=e.sent,n=g.map((function(e){return e.id})),t.forEach((function(e){e.kept||-1!==f.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()})),e.next=8,r.functionMap[p].executeFunctionAsync(g,r.tensorArrayMap,r.tensorListMap);case 8:return a=e.sent,e.next=11,a[0].data();case 11:m=e.sent,a.forEach((function(e){e.kept||-1!==f.indexOf(e.id)||-1!==n.indexOf(e.id)||e.dispose()}));case 13:case"end":return e.stop()}}),e)}));case 25:if(!m[0]){e.next=29;break}return e.delegateYield(v(),"t2",27);case 27:e.next=25;break;case 29:return e.abrupt("return",g);case 30:return e.abrupt("return",[MI(CI("pred",t,n,r))]);case 31:return y=CI("pred",t,n,r),(b=CI("data",t,n,r)).kept||(b=MI(b)),e.next=36,y.data();case 36:if(!e.sent[0]){e.next=40;break}e.t3=[void 0,b],e.next=41;break;case 40:e.t3=[b,void 0];case 41:return e.abrupt("return",e.t3);case 42:if(!(x=t.inputNames.find((function(e){return void 0!==NI(e,n,r)})))){e.next=45;break}return e.abrupt("return",[MI(NI(x,n,r))]);case 45:return e.abrupt("return");case 46:return w=CI("frameName",t,n,r),k=CI("tensor",t,n,r),e.abrupt("return",(r.enterFrame(w),[MI(k)]));case 48:return I=CI("tensor",t,n,r),e.abrupt("return",(r.exitFrame(),[MI(I)]));case 50:return S=CI("tensor",t,n,r),e.abrupt("return",(r.nextIteration(),[MI(S)]));case 52:return T=CI("size",t,n,r),_=CI("dtype",t,n,r),C=CI("elementShape",t,n,r),N=CI("dynamicSize",t,n,r),E=CI("clearAfterRead",t,n,r),R=CI("identicalElementShapes",t,n,r),A=CI("name",t,n,r),O=new kS(A,_,T,C,R,N,E),e.abrupt("return",(r.addTensorArray(O),[O.idTensor,_s(1)]));case 54:return M=CI("tensorArrayId",t,n,r),F=CI("index",t,n,r),D=CI("tensor",t,n,r),P=r.getTensorArray(M.id),e.abrupt("return",(P.write(F,D),[P.idTensor]));case 56:return L=CI("tensorArrayId",t,n,r),B=CI("index",t,n,r),e.abrupt("return",[r.getTensorArray(L.id).read(B)]);case 58:return U=CI("tensorArrayId",t,n,r),V=CI("indices",t,n,r),W=CI("dtype",t,n,r),e.abrupt("return",[r.getTensorArray(U.id).gather(V,W)]);case 60:return z=CI("tensorArrayId",t,n,r),G=CI("indices",t,n,r),j=CI("tensor",t,n,r),H=r.getTensorArray(z.id),e.abrupt("return",(H.scatter(G,j),[H.idTensor]));case 62:return q=CI("tensorArrayId",t,n,r),X=r.getTensorArray(q.id),K=CI("dtype",t,n,r),e.abrupt("return",[X.concat(K)]);case 64:return Y=CI("tensorArrayId",t,n,r),Q=CI("tensor",t,n,r),J=CI("lengths",t,n,r),Z=r.getTensorArray(Y.id),e.abrupt("return",(Z.split(J,Q),[Z.idTensor]));case 66:return $=CI("tensorArrayId",t,n,r),e.abrupt("return",[_s(r.getTensorArray($.id).size(),"int32")]);case 68:return ee=CI("tensorArrayId",t,n,r),te=r.getTensorArray(ee.id),e.abrupt("return",(te.clearAndClose(),[te.idTensor]));case 70:return ne=CI("tensorListId",t,n,r),re=CI("index",t,n,r),ae=CI("tensor",t,n,r),oe=r.getTensorList(ne.id),e.abrupt("return",(oe.setItem(re,ae),[oe.idTensor]));case 72:return ie=CI("tensorListId",t,n,r),se=CI("index",t,n,r),ue=CI("elementShape",t,n,r),ce=CI("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ie.id).getItem(se,ue,ce)]);case 74:return le=CI("indices",t,n,r),pe=function(e,t,n,r){if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: ".concat(t.length," vs. ").concat(e.shape[0]));var a=Math.max.apply(Math,o(t));if(null!=r&&-1!==r&&a>=r)throw new Error("Max index must be < array size (".concat(a,"  vs. ").concat(r,")"));var i=new IS([],n,e.dtype,r),s=eu(e,0);return t.forEach((function(e,t){i.setItem(e,s[t])})),i}(CI("tensor",t,n,r),le,CI("elementShape",t,n,r),CI("numElements",t,n,r)),e.abrupt("return",(r.addTensorList(pe),[pe.idTensor]));case 76:return de=CI("elementShape",t,n,r),he=CI("elementDType",t,n,r),fe="TensorListReserve"===t.op?"numElements":"maxNumElements",me=CI(fe,t,n,r),ge=function(e,t,n,r){return new IS([],e,t,r)}(de,he,0,"TensorListReserve"===t.op?-1:me),e.abrupt("return",(r.addTensorList(ge),[ge.idTensor]));case 80:return ve=CI("tensorListId",t,n,r),ye=CI("indices",t,n,r),be=CI("elementShape",t,n,r),xe=CI("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(ve.id).gather(ye,xe,be)]);case 82:return we=CI("tensorListId",t,n,r),ke=CI("elementShape",t,n,r),Ie=CI("elementDType",t,n,r),Se=CI("numElements",t,n,r),e.abrupt("return",[r.getTensorList(we.id).stack(ke,Ie,Se)]);case 84:return Te=function(e,t,n){var r=e.dtype;if(e.shape.length<1)throw new Error("Tensor must be at least a vector, but saw shape: ".concat(e.shape));if(e.dtype!==n)throw new Error("Invalid data types; op elements ".concat(e.dtype,", but list elements ").concat(n));yS(e.shape.slice(1),t,"TensorList shape mismatch: ");var a=eu(e);return new IS(a,t,r)}(CI("tensor",t,n,r),CI("elementShape",t,n,r),CI("elementDType",t,n,r)),e.abrupt("return",(r.addTensorList(Te),[Te.idTensor]));case 86:return _e=CI("tensorListId",t,n,r),Ce=r.getTensorList(_e.id),Ne=CI("dtype",t,n,r),Ee=CI("elementShape",t,n,r),e.abrupt("return",[Ce.concat(Ne,Ee)]);case 88:return Re=CI("tensorListId",t,n,r),Ae=CI("tensor",t,n,r),Oe=r.getTensorList(Re.id),e.abrupt("return",(Oe.pushBack(Ae),[Oe.idTensor]));case 90:return Me=CI("tensorListId",t,n,r),Fe=CI("elementShape",t,n,r),De=CI("elementDType",t,n,r),e.abrupt("return",[r.getTensorList(Me.id).popBack(Fe,De)]);case 92:return Pe=CI("tensor",t,n,r),Le=CI("elementShape",t,n,r),Be=function(e,t,n){var r=0,a=t.map((function(e){return r+=e}));if(r!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        ".concat(r,", and tensor's shape is: ").concat(e.shape));for(var o=wS(e.shape.slice(1),n),i=0===r?0:e.size/r,s=si((function(){var n=[];e=rs(e,[1,r,i]);for(var s=0;s<t.length;++s){var u=[0,0===s?0:a[s-1],0],c=[1,t[s],i];n[s]=rs(ss(e,u,c),o)}return e.dispose(),n})),u=new IS([],n,e.dtype,t.length),c=0;c<s.length;c++)u.setItem(c,s[c]);return u}(Pe,CI("lengths",t,n,r),Le),e.abrupt("return",(r.addTensorList(Be),[Be.idTensor]));case 94:return Ue=CI("tensorListId",t,n,r),e.abrupt("return",[_s(r.getTensorList(Ue.id).size(),"int32")]);case 96:return Ve=CI("tensorListId",t,n,r),We=CI("size",t,n,r),ze=r.getTensorList(Ve.id).resize(We),e.abrupt("return",(r.addTensorList(ze),[ze.idTensor]));case 98:throw TypeError("Node type ".concat(t.op," is not implemented"));case 99:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function TS(e,t,n){var r=CI("fusedOps",e,t,n),a=s(r,2),o=a[0],i=a[1],u="biasadd"===o,c=!u,l="prelu"===i,p="fusedbatchnorm"===o,d=CI("numArgs",e,t,n);if(u){if(l&&2!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!l&&u&&1!==d)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(p)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported");var h=CI("strides",e,t,n),f=OI(e,t,n),m=CI("dataFormat",e,t,n).toUpperCase(),g=CI("dilations",e,t,n),v=CI("args",e,t,n),y=s(v,2),b=y[0],x=y[1];return c&&(x=b,b=void 0),{stride:h,pad:f,dataFormat:m,dilations:g,biasArg:b,preluArg:x,activationFunc:i,leakyreluAlpha:CI("leakyreluAlpha",e,t,n)}}function _S(e,t,n){return{boxes:CI("boxes",e,t,n),scores:CI("scores",e,t,n),maxOutputSize:CI("maxOutputSize",e,t,n),iouThreshold:CI("iouThreshold",e,t,n),scoreThreshold:CI("scoreThreshold",e,t,n),softNmsSigma:CI("softNmsSigma",e,t,n)}}var CS=function(){return p((function e(t,n){l(this,e),this.keyDType=t,this.valueDType=n,this.handle=_s(0),this.tensorMap=new Map,ci(this.handle)}),[{key:"id",get:function(){return this.handle.id}},{key:"clearAndClose",value:function(){this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),this.handle.dispose()}},{key:"size",value:function(){return this.tensorMap.size}},{key:"tensorSize",value:function(){return _s(this.size(),"int32")}},{key:"import",value:(t=c(u().mark((function e(t,n){var r,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",(this.tensorMap.forEach((function(e){return e.dispose()})),this.tensorMap.clear(),si((function(){var e=eu(n),t=r.length,o=e.length;H(t===o,(function(){return"The number of elements doesn't match, keys has ".concat(t," elements, the values has ").concat(o," elements.")}));for(var i=0;i<t;i++){var s=r[i],u=e[i];ci(u),a.tensorMap.set(s,u)}return a.handle}))));case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"find",value:(e=c(u().mark((function e(t,n){var r,a=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.checkKeyAndValueTensor(t,n),e.next=3,t.data();case 3:return r=e.sent,e.abrupt("return",si((function(){for(var e=[],t=0;t<r.length;t++){var o=r[t],i=a.findWithDefault(o,n);e.push(i)}return Qs(e)})));case 5:case"end":return e.stop()}}),e,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"findWithDefault",value:function(e,t){var n=this.tensorMap.get(e);return null!=n?n:t}},{key:"checkKeyAndValueTensor",value:function(e,t){if(e.dtype!==this.keyDType)throw new Error("Expect key dtype ".concat(this.keyDType,", but got ").concat(e.dtype));if(t.dtype!==this.valueDType)throw new Error("Expect value dtype ".concat(this.valueDType,", but got ").concat(t.dtype))}}]);var e,t}();function NS(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:si,i=function(e,t,n){switch(e.category){case"arithmetic":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"BiasAdd":case"AddV2":case"Add":return[r.add(CI("a",e,t,n),CI("b",e,t,n))];case"AddN":return[r.addN(CI("tensors",e,t,n))];case"FloorMod":case"Mod":return[r.mod(CI("a",e,t,n),CI("b",e,t,n))];case"Mul":return[r.mul(CI("a",e,t,n),CI("b",e,t,n))];case"RealDiv":case"Div":return[r.div(CI("a",e,t,n),CI("b",e,t,n))];case"DivNoNan":return[r.divNoNan(CI("a",e,t,n),CI("b",e,t,n))];case"FloorDiv":return[r.floorDiv(CI("a",e,t,n),CI("b",e,t,n))];case"Sub":return[r.sub(CI("a",e,t,n),CI("b",e,t,n))];case"Minimum":return[r.minimum(CI("a",e,t,n),CI("b",e,t,n))];case"Maximum":return[r.maximum(CI("a",e,t,n),CI("b",e,t,n))];case"Pow":return[r.pow(CI("a",e,t,n),CI("b",e,t,n))];case"SquaredDifference":return[r.squaredDifference(CI("a",e,t,n),CI("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"basic_math":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Abs":case"ComplexAbs":return[r.abs(CI("x",e,t,n))];case"Acos":return[r.acos(CI("x",e,t,n))];case"Acosh":return[r.acosh(CI("x",e,t,n))];case"Asin":return[r.asin(CI("x",e,t,n))];case"Asinh":return[r.asinh(CI("x",e,t,n))];case"Atan":return[r.atan(CI("x",e,t,n))];case"Atan2":return[r.atan2(CI("x",e,t,n),CI("y",e,t,n))];case"Atanh":return[r.atanh(CI("x",e,t,n))];case"Ceil":return[r.ceil(CI("x",e,t,n))];case"Complex":return[r.complex(CI("real",e,t,n),CI("imag",e,t,n))];case"Cos":return[r.cos(CI("x",e,t,n))];case"Cosh":return[r.cosh(CI("x",e,t,n))];case"Elu":return[r.elu(CI("x",e,t,n))];case"Erf":return[r.erf(CI("x",e,t,n))];case"Exp":return[r.exp(CI("x",e,t,n))];case"Expm1":return[r.expm1(CI("x",e,t,n))];case"Floor":return[r.floor(CI("x",e,t,n))];case"Log":return[r.log(CI("x",e,t,n))];case"Log1p":return[r.log1p(CI("x",e,t,n))];case"Imag":return[r.imag(CI("x",e,t,n))];case"Neg":return[r.neg(CI("x",e,t,n))];case"Reciprocal":return[r.reciprocal(CI("x",e,t,n))];case"Real":return[r.real(CI("x",e,t,n))];case"Relu":return[r.relu(CI("x",e,t,n))];case"Round":return[r.round(CI("x",e,t,n))];case"Selu":return[r.selu(CI("x",e,t,n))];case"Sigmoid":return[r.sigmoid(CI("x",e,t,n))];case"Sin":return[r.sin(CI("x",e,t,n))];case"Sign":return[r.sign(CI("x",e,t,n))];case"Sinh":return[r.sinh(CI("x",e,t,n))];case"Softplus":return[r.softplus(CI("x",e,t,n))];case"Sqrt":return[r.sqrt(CI("x",e,t,n))];case"Square":return[r.square(CI("x",e,t,n))];case"Tanh":return[r.tanh(CI("x",e,t,n))];case"Tan":return[r.tan(CI("x",e,t,n))];case"ClipByValue":return[r.clipByValue(CI("x",e,t,n),CI("clipValueMin",e,t,n),CI("clipValueMax",e,t,n))];case"Relu6":return[r.relu6(CI("x",e,t,n))];case"Rsqrt":return[r.rsqrt(NI(e.inputNames[0],t,n))];case"Prod":return[r.prod(CI("x",e,t,n),CI("axes",e,t,n))];case"LeakyRelu":return[r.leakyRelu(CI("x",e,t,n),CI("alpha",e,t,n))];case"Prelu":return[r.prelu(CI("x",e,t,n),CI("alpha",e,t,n))];case"IsNan":return[r.isNaN(NI(e.inputNames[0],t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"control":return SS(e,t,n);case"convolution":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Conv1D":var a=CI("stride",e,t,n),o=CI("pad",e,t,n),i=CI("dataFormat",e,t,n).toUpperCase(),s=CI("dilation",e,t,n);return[r.conv1d(CI("x",e,t,n),CI("filter",e,t,n),a,o,i,s)];case"Conv2D":var u=CI("strides",e,t,n),c=OI(e,t,n),l=CI("dataFormat",e,t,n).toUpperCase(),p=CI("dilations",e,t,n);return[r.conv2d(CI("x",e,t,n),CI("filter",e,t,n),[u[1],u[2]],c,l,[p[1],p[2]])];case"_FusedConv2D":var d=TS(e,t,n),h=d.stride,f=d.pad,m=d.dataFormat,g=d.dilations,v=d.biasArg,y=d.preluArg,b=d.activationFunc,x=d.leakyreluAlpha;return[r.fused.conv2d({x:CI("x",e,t,n),filter:CI("filter",e,t,n),strides:[h[1],h[2]],pad:f,dataFormat:m,dilations:[g[1],g[2]],bias:v,activation:b,preluActivationWeights:y,leakyreluAlpha:x})];case"FusedDepthwiseConv2dNative":var w=TS(e,t,n),k=w.stride,I=w.pad,S=w.dataFormat,T=w.dilations,_=w.biasArg,C=w.preluArg,N=w.activationFunc,E=w.leakyreluAlpha;return[r.fused.depthwiseConv2d({x:CI("x",e,t,n),filter:CI("filter",e,t,n),strides:[k[1],k[2]],pad:I,dataFormat:S,dilations:[T[1],T[2]],bias:_,activation:N,preluActivationWeights:C,leakyreluAlpha:E})];case"Conv2DBackpropInput":case"Conv2dTranspose":var R=CI("outputShape",e,t,n),A=CI("strides",e,t,n),O=OI(e,t,n);return[r.conv2dTranspose(CI("x",e,t,n),CI("filter",e,t,n),R,[A[1],A[2]],O)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":var M=CI("strides",e,t,n),F=OI(e,t,n),D=CI("dilations",e,t,n),P=CI("dataFormat",e,t,n).toUpperCase();return[r.depthwiseConv2d(CI("input",e,t,n),CI("filter",e,t,n),[M[1],M[2]],F,P,[D[1],D[2]])];case"Conv3D":var L=CI("strides",e,t,n),B=CI("pad",e,t,n),U=CI("dataFormat",e,t,n).toUpperCase(),V=CI("dilations",e,t,n);return[r.conv3d(CI("x",e,t,n),CI("filter",e,t,n),[L[1],L[2],L[3]],B,U,[V[1],V[2],V[3]])];case"AvgPool":var W=CI("strides",e,t,n),z=CI("pad",e,t,n),G=CI("kernelSize",e,t,n);return[r.avgPool(CI("x",e,t,n),[G[1],G[2]],[W[1],W[2]],z)];case"MaxPool":var j=CI("strides",e,t,n),H=CI("pad",e,t,n),q=CI("kernelSize",e,t,n);return[r.maxPool(CI("x",e,t,n),[q[1],q[2]],[j[1],j[2]],H)];case"MaxPoolWithArgmax":var X=CI("strides",e,t,n),K=CI("pad",e,t,n),Y=CI("kernelSize",e,t,n),Q=CI("includeBatchInIndex",e,t,n),J=r.maxPoolWithArgmax(CI("x",e,t,n),[Y[1],Y[2]],[X[1],X[2]],K,Q),Z=J.result,$=J.indexes;return[Z,$];case"AvgPool3D":var ee=CI("strides",e,t,n),te=CI("pad",e,t,n),ne=CI("kernelSize",e,t,n);return[r.avgPool3d(CI("x",e,t,n),[ne[1],ne[2],ne[3]],[ee[1],ee[2],ee[3]],te)];case"MaxPool3D":var re=CI("strides",e,t,n),ae=CI("pad",e,t,n),oe=CI("kernelSize",e,t,n);return[r.maxPool3d(CI("x",e,t,n),[oe[1],oe[2],oe[3]],[re[1],re[2],re[3]],ae)];case"Dilation2D":var ie=CI("strides",e,t,n),se=CI("pad",e,t,n),ue=CI("dilations",e,t,n),ce=ie[1],le=ie[2],pe=ue[1],de=ue[2];return[r.dilation2d(CI("x",e,t,n),CI("filter",e,t,n),[ce,le],se,[pe,de],"NHWC")];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"creation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Fill":var a=CI("shape",e,t,n),o=CI("dtype",e,t,n),i=CI("value",e,t,n);return[r.fill(a,i,o)];case"LinSpace":var s=CI("start",e,t,n),u=CI("stop",e,t,n),c=CI("num",e,t,n);return[r.linspace(s,u,c)];case"Multinomial":var l=CI("logits",e,t,n),p=CI("numSamples",e,t,n),d=CI("seed",e,t,n);return[r.multinomial(l,p,d)];case"OneHot":var h=CI("indices",e,t,n),f=CI("depth",e,t,n),m=CI("onValue",e,t,n),g=CI("offValue",e,t,n),v=CI("dtype",e,t,n);return[r.oneHot(h,f,m,g,v)];case"Ones":return[r.ones(CI("shape",e,t,n),CI("dtype",e,t,n))];case"OnesLike":return[r.onesLike(CI("x",e,t,n))];case"RandomStandardNormal":return[r.randomStandardNormal(CI("shape",e,t,n),CI("dtype",e,t,n),CI("seed",e,t,n))];case"RandomUniform":return[r.randomUniform(CI("shape",e,t,n),CI("minval",e,t,n),CI("maxval",e,t,n),CI("dtype",e,t,n))];case"Range":var y=CI("start",e,t,n),b=CI("stop",e,t,n),x=CI("step",e,t,n);return[r.range(y,b,x,CI("dtype",e,t,n))];case"TruncatedNormal":var w=CI("shape",e,t,n),k=CI("mean",e,t,n),I=CI("stdDev",e,t,n),S=CI("seed",e,t,n);return[r.truncatedNormal(w,k,I,CI("dtype",e,t,n),S)];case"Zeros":return[r.zeros(CI("shape",e,t,n),CI("dtype",e,t,n))];case"ZerosLike":return[r.zerosLike(CI("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"dynamic":return(p=c(u().mark((function e(t,n,r,a){var o,i,s,c,l,p,d,h,f,m,g,v,y,b,x,w,k,I,S,T,_,C,N,E,R,A=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=A.length>4&&void 0!==A[4]?A[4]:vS,e.t0=t.op,e.next="NonMaxSuppressionV5"===e.t0?4:"NonMaxSuppressionV4"===e.t0?15:"NonMaxSuppressionV3"===e.t0||"NonMaxSuppressionV2"===e.t0?26:"Where"===e.t0?31:"ListDiff"===e.t0?37:38;break;case 4:return i=_S(t,n,r),s=i.boxes,c=i.scores,l=i.maxOutputSize,p=i.iouThreshold,d=i.scoreThreshold,h=i.softNmsSigma,e.next=13,o.image.nonMaxSuppressionWithScoreAsync(s,c,l,p,d,h);case 13:return f=e.sent,e.abrupt("return",[f.selectedIndices,f.selectedScores]);case 15:return m=_S(t,n,r),g=m.boxes,v=m.scores,y=m.maxOutputSize,b=m.iouThreshold,x=m.scoreThreshold,w=CI("padToMaxOutputSize",t,n,r),e.next=24,o.image.nonMaxSuppressionPaddedAsync(g,v,y,b,x,w);case 24:return k=e.sent,e.abrupt("return",[k.selectedIndices,k.validOutputs]);case 26:return I=_S(t,n,r),S=I.boxes,T=I.scores,_=I.maxOutputSize,C=I.iouThreshold,N=I.scoreThreshold,e.next=29,o.image.nonMaxSuppressionAsync(S,T,_,C,N);case 29:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 31:return E=o.cast(CI("condition",t,n,r),"bool"),e.next=34,o.whereAsync(E);case 34:return e.t2=e.sent,R=[e.t2],e.abrupt("return",(E.dispose(),R));case 37:return e.abrupt("return",o.setdiff1dAsync(CI("x",t,n,r),CI("y",t,n,r)));case 38:throw TypeError("Node type ".concat(t.op," is not implemented"));case 39:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return p.apply(this,arguments)})(e,t,n);case"evaluation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"LowerBound":var a=CI("sortedSequence",e,t,n),o=CI("values",e,t,n);return[r.lowerBound(a,o)];case"TopKV2":var i=CI("x",e,t,n),s=CI("k",e,t,n),u=CI("sorted",e,t,n),c=r.topk(i,s,u);return[c.values,c.indices];case"UpperBound":var l=CI("sortedSequence",e,t,n),p=CI("values",e,t,n);return[r.upperBound(l,p)];case"Unique":var d=CI("x",e,t,n),h=r.unique(d);return[h.values,h.indices];case"UniqueV2":var f=CI("x",e,t,n),m=CI("axis",e,t,n),g=r.unique(f,m);return[g.values,g.indices];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"image":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"ResizeBilinear":var a=CI("images",e,t,n),o=CI("size",e,t,n),i=CI("alignCorners",e,t,n),s=CI("halfPixelCenters",e,t,n);return[r.image.resizeBilinear(a,[o[0],o[1]],i,s)];case"ResizeNearestNeighbor":var u=CI("images",e,t,n),c=CI("size",e,t,n),l=CI("alignCorners",e,t,n),p=CI("halfPixelCenters",e,t,n);return[r.image.resizeNearestNeighbor(u,[c[0],c[1]],l,p)];case"CropAndResize":var d=CI("image",e,t,n),h=CI("boxes",e,t,n),f=CI("boxInd",e,t,n),m=CI("cropSize",e,t,n),g=CI("method",e,t,n),v=CI("extrapolationValue",e,t,n);return[r.image.cropAndResize(d,h,f,m,g,v)];case"ImageProjectiveTransformV3":var y=CI("images",e,t,n),b=CI("transforms",e,t,n),x=CI("outputShape",e,t,n),w=CI("fillValue",e,t,n),k=CI("interpolation",e,t,n),I=CI("fillMode",e,t,n);return[r.image.transform(y,b,k.toLowerCase(),I.toLowerCase(),w,x)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"graph":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Const":return t[e.name];case"PlaceholderWithDefault":var a=CI("default",e,t,n);return[NI(e.name,t,n)||a];case"Placeholder":return[NI(e.name,t,n)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":case"Snapshot":return[MI(CI("x",e,t,n))];case"IdentityN":return CI("x",e,t,n).map((function(e){return MI(e)}));case"Shape":return[r.tensor1d(CI("x",e,t,n).shape,"int32")];case"ShapeN":return CI("x",e,t,n).map((function(e){return r.tensor1d(e.shape)}));case"Size":return[r.scalar(CI("x",e,t,n).size,"int32")];case"Rank":return[r.scalar(CI("x",e,t,n).rank,"int32")];case"NoOp":return[r.scalar(1)];case"Print":var o=CI("x",e,t,n),i=CI("data",e,t,n),s=CI("message",e,t,n),u=CI("summarize",e,t,n);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(s);for(var c=0;c<i.length;c++)console.log(Array.prototype.slice.call(i[c].dataSync()).slice(0,u));return[o];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"logical":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Equal":return[r.equal(CI("a",e,t,n),CI("b",e,t,n))];case"NotEqual":return[r.notEqual(CI("a",e,t,n),CI("b",e,t,n))];case"Greater":return[r.greater(CI("a",e,t,n),CI("b",e,t,n))];case"GreaterEqual":return[r.greaterEqual(CI("a",e,t,n),CI("b",e,t,n))];case"Less":return[r.less(CI("a",e,t,n),CI("b",e,t,n))];case"LessEqual":return[r.lessEqual(CI("a",e,t,n),CI("b",e,t,n))];case"LogicalAnd":return[r.logicalAnd(CI("a",e,t,n),CI("b",e,t,n))];case"LogicalNot":return[r.logicalNot(CI("a",e,t,n))];case"LogicalOr":return[r.logicalOr(CI("a",e,t,n),CI("b",e,t,n))];case"Select":case"SelectV2":return[r.where(CI("condition",e,t,n),CI("a",e,t,n),CI("b",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"matrices":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[r.matMul(CI("a",e,t,n),CI("b",e,t,n),CI("transposeA",e,t,n),CI("transposeB",e,t,n))];case"Einsum":return[r.einsum.apply(r,[CI("equation",e,t,n)].concat(o(CI("tensors",e,t,n))))];case"Transpose":return[r.transpose(CI("x",e,t,n),CI("perm",e,t,n))];case"_FusedMatMul":var a=CI("fusedOps",e,t,n),i=s(a,2),u=i[0],c=i[1],l="biasadd"===u,p="prelu"===c,d=CI("numArgs",e,t,n),h=CI("leakyreluAlpha",e,t,n);if(l){if(p&&2!==d)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!p&&1!==d)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var f=CI("args",e,t,n),m=s(f,2),g=m[0],v=m[1];return[r.fused.matMul({a:CI("a",e,t,n),b:CI("b",e,t,n),transposeA:CI("transposeA",e,t,n),transposeB:CI("transposeB",e,t,n),bias:g,activation:c,preluActivationWeights:v,leakyreluAlpha:h})];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"normalization":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"EuclideanNorm":return[r.euclideanNorm(CI("x",e,t,n),CI("axis",e,t,n),CI("keepDims",e,t,n))];case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[r.batchNorm(CI("x",e,t,n),CI("mean",e,t,n),CI("variance",e,t,n),CI("offset",e,t,n),CI("scale",e,t,n),CI("epsilon",e,t,n))];case"LRN":return[r.localResponseNormalization(CI("x",e,t,n),CI("radius",e,t,n),CI("bias",e,t,n),CI("alpha",e,t,n),CI("beta",e,t,n))];case"Softmax":return[r.softmax(CI("x",e,t,n))];case"LogSoftmax":return[r.logSoftmax(CI("x",e,t,n))];case"SparseToDense":return[r.sparseToDense(CI("sparseIndices",e,t,n),CI("outputShape",e,t,n),CI("sparseValues",e,t,n),CI("defaultValue",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"reduction":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Max":var a=CI("axis",e,t,n),o=CI("keepDims",e,t,n);return[r.max(CI("x",e,t,n),a,o)];case"Mean":var i=CI("axis",e,t,n),s=CI("keepDims",e,t,n);return[r.mean(CI("x",e,t,n),i,s)];case"Min":var u=CI("axis",e,t,n),c=CI("keepDims",e,t,n);return[r.min(CI("x",e,t,n),u,c)];case"Sum":var l=CI("axis",e,t,n),p=CI("keepDims",e,t,n);return[r.sum(CI("x",e,t,n),l,p)];case"All":var d=CI("axis",e,t,n),h=CI("keepDims",e,t,n);return[r.all(CI("x",e,t,n),d,h)];case"Any":var f=CI("axis",e,t,n),m=CI("keepDims",e,t,n);return[r.any(CI("x",e,t,n),f,m)];case"ArgMax":var g=CI("axis",e,t,n);return[r.argMax(CI("x",e,t,n),g)];case"ArgMin":var v=CI("axis",e,t,n);return[r.argMin(CI("x",e,t,n),v)];case"Prod":var y=CI("axis",e,t,n),b=CI("keepDims",e,t,n);return[r.prod(CI("x",e,t,n),y,b)];case"Cumprod":var x=CI("axis",e,t,n),w=CI("exclusive",e,t,n),k=CI("reverse",e,t,n);return[r.cumprod(CI("x",e,t,n),x,w,k)];case"Cumsum":var I=CI("axis",e,t,n),S=CI("exclusive",e,t,n),T=CI("reverse",e,t,n);return[r.cumsum(CI("x",e,t,n),I,S,T)];case"Bincount":var _=CI("x",e,t,n),C=CI("weights",e,t,n),N=CI("size",e,t,n);return[r.bincount(_,C,N)];case"DenseBincount":var E=CI("x",e,t,n),R=CI("weights",e,t,n),A=CI("size",e,t,n),O=CI("binaryOutput",e,t,n);return[r.denseBincount(E,R,A,O)];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"slice_join":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"ConcatV2":case"Concat":var a=CI("n",e,t,n),o=CI("axis",e,t,n),i=CI("tensors",e,t,n);return i=i.slice(0,a),[r.concat(i,o)];case"Gather":var s=CI("x",e,t,n),u=CI("indices",e,t,n);return[r.gather(s,r.cast(u,"int32"),0)];case"GatherV2":var c=CI("axis",e,t,n),l=CI("batchDims",e,t,n),p=CI("x",e,t,n),d=CI("indices",e,t,n);return[r.gather(p,r.cast(d,"int32"),c,l)];case"Reverse":for(var h=CI("dims",e,t,n),f=[],m=0;m<h.length;m++)h[m]&&f.push(m);var g=CI("x",e,t,n);return[r.reverse(g,f)];case"ReverseV2":var v=CI("axis",e,t,n),y=CI("x",e,t,n);return[r.reverse(y,v)];case"Slice":var b=CI("begin",e,t,n),x=CI("size",e,t,n);return[r.slice(CI("x",e,t,n),b,x)];case"StridedSlice":var w=CI("begin",e,t,n),k=CI("end",e,t,n),I=CI("strides",e,t,n),S=CI("beginMask",e,t,n),T=CI("endMask",e,t,n),_=CI("ellipsisMask",e,t,n),C=CI("newAxisMask",e,t,n),N=CI("shrinkAxisMask",e,t,n),E=CI("x",e,t,n);return[r.stridedSlice(E,w,k,I,S,T,_,C,N)];case"Pack":return si((function(){var a=CI("axis",e,t,n),o=CI("tensors",e,t,n),i=o[0].shape,s=r.squeeze(o[0]).shape,u=o.map((function(e){var t=Q(e.shape,i);if(!t&&!Q(r.squeeze(e).shape,s))throw new Error("the input tensors shape does not match");return t?e:r.reshape(e,i)}));return[r.stack(u,a)]}));case"Unpack":var R=CI("axis",e,t,n),A=CI("tensor",e,t,n);return r.unstack(A,R);case"Tile":var O=CI("reps",e,t,n);return[r.tile(CI("x",e,t,n),O)];case"Split":case"SplitV":var M=CI("axis",e,t,n),F=CI("numOrSizeSplits",e,t,n),D=CI("x",e,t,n);return r.split(D,F,M);case"ScatterNd":var P=CI("indices",e,t,n),L=CI("values",e,t,n),B=CI("shape",e,t,n);return[r.scatterND(P,L,B)];case"GatherNd":var U=CI("x",e,t,n),V=CI("indices",e,t,n);return[r.gatherND(U,V)];case"SparseToDense":var W=CI("sparseIndices",e,t,n),z=CI("outputShape",e,t,n),G=CI("sparseValues",e,t,n),j=CI("defaultValue",e,t,n);return[r.sparseToDense(W,G,z,G.dtype===j.dtype?j:r.cast(j,G.dtype))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"sparse":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"SparseFillEmptyRows":var a=r.sparse.sparseFillEmptyRows(CI("indices",e,t,n),CI("values",e,t,n),CI("denseShape",e,t,n),CI("defaultValue",e,t,n)),o=a.outputIndices,i=a.outputValues,s=a.emptyRowIndicator,u=a.reverseIndexMap;return[o,i,s,u];case"SparseReshape":var c=r.sparse.sparseReshape(CI("inputIndices",e,t,n),CI("inputShape",e,t,n),CI("newShape",e,t,n)),l=c.outputIndices,p=c.outputShape;return[l,p];case"SparseSegmentMean":return[r.sparse.sparseSegmentMean(CI("data",e,t,n),CI("indices",e,t,n),CI("segmentIds",e,t,n))];case"SparseSegmentSum":return[r.sparse.sparseSegmentSum(CI("data",e,t,n),CI("indices",e,t,n),CI("segmentIds",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"spectral":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"FFT":return[r.fft(CI("x",e,t,n))];case"IFFT":return[r.ifft(CI("x",e,t,n))];case"RFFT":return[r.rfft(CI("x",e,t,n))];case"IRFFT":return[r.irfft(CI("x",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"string":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"StringNGrams":var a=r.string.stringNGrams(CI("data",e,t,n),CI("dataSplits",e,t,n),CI("separator",e,t,n),CI("nGramWidths",e,t,n),CI("leftPad",e,t,n),CI("rightPad",e,t,n),CI("padWidth",e,t,n),CI("preserveShortSequences",e,t,n)),o=a.nGrams,i=a.nGramsSplits;return[o,i];case"StringSplit":var s=r.string.stringSplit(CI("input",e,t,n),CI("delimiter",e,t,n),CI("skipEmpty",e,t,n)),u=s.indices,c=s.values,l=s.shape;return[u,c,l];case"StringToHashBucketFast":return[r.string.stringToHashBucketFast(CI("input",e,t,n),CI("numBuckets",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"transformation":return a((function(){return function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:vS;switch(e.op){case"Cast":return[r.cast(CI("x",e,t,n),CI("dtype",e,t,n))];case"ExpandDims":var a=CI("axis",e,t,n);return[r.expandDims(CI("x",e,t,n),a)];case"Squeeze":var o=CI("axis",e,t,n);return[r.squeeze(CI("x",e,t,n),o)];case"Reshape":return[r.reshape(CI("x",e,t,n),CI("shape",e,t,n))];case"MirrorPad":return[r.mirrorPad(CI("x",e,t,n),CI("padding",e,t,n),CI("mode",e,t,n))];case"PadV2":case"Pad":return[r.pad(CI("x",e,t,n),CI("padding",e,t,n),CI("constantValue",e,t,n))];case"SpaceToBatchND":var i=CI("blockShape",e,t,n),s=CI("paddings",e,t,n);return[r.spaceToBatchND(CI("x",e,t,n),i,s)];case"BatchToSpaceND":var u=CI("blockShape",e,t,n),c=CI("crops",e,t,n);return[r.batchToSpaceND(CI("x",e,t,n),u,c)];case"DepthToSpace":var l=CI("blockSize",e,t,n),p=CI("dataFormat",e,t,n).toUpperCase();return[r.depthToSpace(CI("x",e,t,n),l,p)];case"BroadcastTo":return[r.broadcastTo(CI("x",e,t,n),CI("shape",e,t,n))];case"BroadcastArgs":return[r.broadcastArgs(CI("s0",e,t,n),CI("s1",e,t,n))];default:throw TypeError("Node type ".concat(e.op," is not implemented"))}}(e,t,n)}));case"hash_table":return(l=c(u().mark((function e(t,n,r,a){var o,i,s,c,l,p,d,h,f,m,g,v;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.op,e.next="HashTable"===e.t0||"HashTableV2"===e.t0?3:"LookupTableImport"===e.t0||"LookupTableImportV2"===e.t0?5:"LookupTableFind"===e.t0||"LookupTableFindV2"===e.t0?10:"LookupTableSize"===e.t0||"LookupTableSizeV2"===e.t0?15:17;break;case 3:return o=CI("keyDType",t,n,r),i=CI("valueDType",t,n,r),s=new CS(o,i),e.abrupt("return",(a.addHashTable(t.name,s),[s.handle]));case 5:return c=CI("tableHandle",t,n,r,a),l=CI("keys",t,n,r),p=CI("values",t,n,r),d=a.getHashTableById(c.id),e.next=8,d.import(l,p);case 8:return e.t1=e.sent,e.abrupt("return",[e.t1]);case 10:return h=CI("tableHandle",t,n,r,a),f=CI("keys",t,n,r),m=CI("defaultValue",t,n,r),g=a.getHashTableById(h.id),e.next=13,g.find(f,m);case 13:return e.t2=e.sent,e.abrupt("return",[e.t2]);case 15:return v=CI("tableHandle",t,n,r,a),e.abrupt("return",[a.getHashTableById(v.id).tensorSize()]);case 17:throw TypeError("Node type ".concat(t.op," is not implemented"));case 18:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return l.apply(this,arguments)})(e,t,n,r);case"custom":var i=_I(e.op);if(i&&i.customExecutor)return i.customExecutor(new fS(e,t,n));throw TypeError("Custom op ".concat(e.op," is not registered."));default:throw TypeError("Unknown op '".concat(e.op,"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()"))}var l,p}(e,t,n);return be(i)?i.then((function(e){return[].concat(e)})):[].concat(i)}var ES=function(){return p((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};l(this,e),this.weightMap=t,this.tensorArrayMap=n,this.tensorListMap=r,this.functionMap=a,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}),[{key:"newFrame",value:function(e,t){return{id:e,frameName:t,iterationId:0}}},{key:"currentContext",get:function(){return this.contexts},set:function(e){this.contexts!==e&&(this.contexts=e,this.generateCurrentContextIds())}},{key:"currentContextId",get:function(){return this._currentContextIds[0]}},{key:"currentContextIds",get:function(){return this._currentContextIds}},{key:"generateCurrentContextIds",value:function(){for(var e=[],t=0;t<this.contexts.length-1;t++){var n=this.contexts.slice(0,this.contexts.length-t);e.push(this.contextIdforContexts(n))}e.push(""),this._currentContextIds=e}},{key:"contextIdforContexts",value:function(e){return e?e.map((function(e){return 0===e.id&&0===e.iterationId?"":"".concat(e.frameName,"-").concat(e.iterationId)})).join("/"):""}},{key:"enterFrame",value:function(e){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,e)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))}},{key:"exitFrame",value:function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()}},{key:"nextIteration",value:function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var e=Object.assign({},this.contexts[this.contexts.length-1]);e.iterationId+=1,e.id=this.lastId,this.contexts.splice(-1,1,e),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))}},{key:"getWeight",value:function(e){return this.weightMap[e]}},{key:"addTensorArray",value:function(e){this.tensorArrayMap[e.id]=e}},{key:"getTensorArray",value:function(e){return this.tensorArrayMap[e]}},{key:"addTensorList",value:function(e){this.tensorListMap[e.id]=e}},{key:"getTensorList",value:function(e){return this.tensorListMap[e]}},{key:"dispose",value:function(e){for(var t in this.tensorArrayMap)this.tensorArrayMap[t].clearAndClose(e);for(var n in this.tensorListMap)this.tensorListMap[n].clearAndClose(e)}}])}();function RS(e,t,n,r){var a=new Set,i=[],s=null,u=null,c=new Set,l=Object.keys(e).map((function(e){return AI(e)[0]})),p=[];null!=r&&(p=r.map((function(e){return AI(e.name)[0]})));for(var d=o(t);d.length>0;){var h=d.pop();(FS(h)||DS(h)||PS(h))&&null==s&&(u=(s=h).children.map((function(e){return e.name})).filter((function(e){return a.has(e)}))),a.add(h.name),null==n[h.name]&&-1===l.indexOf(h.name)&&-1===p.indexOf(h.name)&&(0!==h.inputs.length?h.inputs.forEach((function(e){c.has(e.name)||(c.add(e.name),d.push(e))})):i.push(h.name))}return{inputs:e,outputs:t,usedNodes:a,missingInputs:i,dynamicNode:s,syncInputs:u}}var AS=["Switch","Merge","Enter","Exit","NextIteration","StatelessIf","StatelessWhile","if","While"],OS=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"],MS=["HashTable","HashTableV2","LookupTableImport","LookupTableImportV2","LookupTableFind","LookupTableFindV2","LookupTableSize","LookupTableSizeV2"];function FS(e){return AS.indexOf(e.op)>=0}function DS(e){return OS.indexOf(e.op)>=0}function PS(e){return MS.indexOf(e.op)>=0}var LS=function(){return p((function e(t,n){var r=this;l(this,e),this.graph=t,this.parent=n,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._functions={},this._functionExecutorMap={},this.intermediateTensors={},this.keepTensorForDebug=!1,this._outputs=t.outputs,this._inputs=t.inputs,this._initNodes=t.initNodes,this._signature=t.signature,this._functions=t.functions,null!=t.functions&&Object.keys(t.functions).forEach((function(n){r._functionExecutorMap[n]=new e(t.functions[n],r)}))}),[{key:"weightIds",get:function(){return this.parent?this.parent.weightIds:this._weightIds}},{key:"functionExecutorMap",get:function(){return this.parent?this.parent.functionExecutorMap:this._functionExecutorMap}},{key:"weightMap",get:function(){return this.parent?this.parent.weightMap:this._weightMap},set:function(e){var t,n=Object.keys(e).map((function(t){return e[t].map((function(e){return e.id}))}));this._weightIds=(t=[]).concat.apply(t,o(n)),this._weightMap=e}},{key:"resourceManager",set:function(e){this._resourceManager=e}},{key:"inputs",get:function(){return this._inputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"outputs",get:function(){return this._outputs.map((function(e){return{name:e.name,shape:e.attrParams.shape?e.attrParams.shape.value:void 0,dtype:e.attrParams.dtype?e.attrParams.dtype.value:void 0}}))}},{key:"inputNodes",get:function(){return this._inputs.map((function(e){return e.signatureKey||e.name}))}},{key:"outputNodes",get:function(){return this._outputs.map((function(e){var t=e.signatureKey||e.name;return e.defaultOutput?"".concat(t,":").concat(e.defaultOutput):t}))}},{key:"functions",get:function(){var e=this;return Object.keys(this._functions).reduce((function(t,n){return t[n]=e._functions[n].signature,t}),{})}},{key:"getCompilationKey",value:function(e,t){var n=e.map((function(e){return e.name})).sort(),r=t.map((function(e){return e.name})).sort();return n.join(this.SEPERATOR)+"--"+r.join(this.SEPERATOR)}},{key:"compile",value:function(e,t){var n=RS(e,t,this.weightMap,this._initNodes),r=n.missingInputs,a=n.dynamicNode,o=n.syncInputs;if(null!=a)throw new Error("This execution contains the node '".concat(a.name,"', which has the dynamic op '").concat(a.op,"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs [").concat(o,"]"));if(r.length>0){var i=t.map((function(e){return e.name})),s=Object.keys(e);throw new Error("Cannot compute the outputs [".concat(i,"] from the provided inputs [").concat(s,"]. Missing the following inputs: [").concat(r,"]"))}return function(e,t,n){var r=n.usedNodes,a=n.inputs,o=[],i=Object.keys(a).map((function(e){return AI(e)[0]})).map((function(t){return e.nodes[t]})),s=e.initNodes;i.forEach((function(e){r.has(e.name)&&o.push(e)})),e.weights.forEach((function(e){r.has(e.name)&&o.push(e)})),null!=s&&s.forEach((function(e){r.has(e.name)&&o.push(e)}));for(var u=new Set,c=[];o.length>0;){var l=o.pop();u.add(l.name),t[l.name]||c.push(l),l.children.forEach((function(e){!u.has(e.name)&&r.has(e.name)&&e.inputs.every((function(e){return u.has(e.name)}))&&o.push(e)}))}return c}(this.graph,this.weightMap,n)}},{key:"execute",value:function(e,t){var n=this;e=this.mapInputs(e);var r=Object.keys(e).sort();this.checkInputs(e),this.checkInputShapeAndType(e),t=this.mapOutputs(t),this.checkOutputs(t);var a=r.map((function(e){return n.graph.nodes[AI(e)[0]]})),o=t.map((function(e){return AI(e)[0]})),i=o.map((function(e){return n.graph.nodes[e]}));this.resetIntermediateTensors(),0===i.length&&(i=this._outputs);var u=this.getCompilationKey(a,i),c=this.compiledMap.get(u);null==c&&(c=this.compile(e,i),this.compiledMap.set(u,c));var l={},p={};return si((function(){var r=new ES(n.weightMap,l,p,n.functionExecutorMap),a=Object.assign({},n.weightMap);Object.keys(e).forEach((function(t){var n=AI(t),r=s(n,2),o=r[0],i=[];i[r[1]]=e[t],a[o]=i}));for(var i=n.getFrozenTensorIds(a),u={},d=0;d<c.length;d++){var h=c[d];if(!a[h.name]){var f=NS(h,a,r,n._resourceManager);if(be(f))throw new Error("The execution of the op '".concat(h.op,"' returned a promise. Please use model.executeAsync() instead."));a[h.name]=f,n.checkTensorForDisposal(h.name,h,a,r,i,o,u)}}return null==n.parent&&r.dispose(i),t.map((function(e){return NI(e,a,r)}))}))}},{key:"getFrozenTensorIds",value:function(e){var t=[].concat.apply([],Object.keys(e).map((function(t){return e[t]})).map((function(e){return e.map((function(e){return e.id}))})));return new Set(t)}},{key:"checkTensorForDisposal",value:function(e,t,n,r,a,o,i){var u=this;"control"!==t.category&&-1===o.indexOf(e)&&(n[e].forEach((function(e){null!=e&&(i[e.id]=(i[e.id]||0)+t.children.length)})),t.inputs.forEach((function(e){if("control"!==e.category){var o=function(e,t,n){return t[RI(e,n.currentContextId)]}(e.name,n,r);null!=o&&o.forEach((function(e){if(e&&!e.kept&&!a.has(e.id)){var n=i[e.id];if(1===n){if(u.keepTensorForDebug){var o=EI(t.name,r),c=s(o,2),l=c[0],p=c[1];u.intermediateTensors[l]||(u.intermediateTensors[l]=[]),u.intermediateTensors[l][p]=e}else e.dispose();delete i[e.id]}else null!=n&&i[e.id]--}}))}})))}},{key:"executeAsync",value:(r=c(u().mark((function e(t,n){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeAsync(t,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"disposeIntermediateTensors",value:function(){var e=this;this.intermediateTensors&&(Object.keys(this.intermediateTensors).forEach((function(t){return e.intermediateTensors[t].forEach((function(e){return e.dispose()}))})),this.disposeTensorsMap())}},{key:"disposeTensorsMap",value:function(){var e=this;this.tensorsMap&&Object.keys(this.tensorsMap).forEach((function(t){e.tensorsMap[t].forEach((function(t){!t||t.kept||t.isDisposed||e.keepIds.has(t.id)||t.dispose()}))}))}},{key:"getIntermediateTensors",value:function(){return this.tensorsMap}},{key:"resetIntermediateTensors",value:function(){for(var e in this.intermediateTensors)this.intermediateTensors[e].forEach((function(e){return e.dispose()})),delete this.intermediateTensors[e]}},{key:"_executeAsync",value:(n=c(u().mark((function e(t,n){var r,a,i,s,c,l,p,d=this,h=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=h.length>2&&void 0!==h[2]&&h[2],a=h.length>3&&void 0!==h[3]?h[3]:{},i=h.length>4&&void 0!==h[4]?h[4]:{},r||(t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),n=this.mapOutputs(n),this.checkOutputs(n));try{this.keepTensorForDebug=Ie().getBool("KEEP_INTERMEDIATE_TENSORS")}catch(e){console.warn(e.message)}return this.resetIntermediateTensors(),s=new ES(this.weightMap,a,i,this.functionExecutorMap),e.next=9,this.executeWithControlFlow(t,s,n,r);case 9:return this.tensorsMap=e.sent,c=n.map((function(e){return NI(e,d.tensorsMap,s)})),l=c.map((function(e){return e.id})),p=Object.keys(t).map((function(e){return t[e].id})),e.abrupt("return",(this.keepIds=new Set([].concat(o(l),o(p),o(this.weightIds))),this.keepTensorForDebug||this.disposeTensorsMap(),null==this.parent&&s.dispose(this.keepIds),c));case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"executeFunctionAsync",value:(t=c(u().mark((function e(t,n,r){var a,o=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.reduce((function(e,t,n){return e[o.inputs[n].name]=t,e}),{}),e.abrupt("return",this._executeAsync(a,this.outputNodes,!0,n,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"executeWithControlFlow",value:(e=c(u().mark((function e(t,n,r,a){var i,c,l,p,d,h,f,m,g,v,y,b,x,w,k,I,S,T=this;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.keys(t),c=i.map((function(e){return T.graph.nodes[AI(e)[0]]})),l=r.map((function(e){return AI(e)[0]})),0===(p=l.map((function(e){return T.graph.nodes[e]}))).length&&(p=this._outputs),d=RS(t,p,this.weightMap,this._initNodes),h=d.usedNodes,f=d.missingInputs,m=d.dynamicNode,g=d.syncInputs,v=[].concat(o(c),o(this.graph.weights),o(this._initNodes||[])).map((function(e){return{node:e,contexts:n.currentContext}})),y=Object.assign({},this.weightMap),Object.keys(t).forEach((function(e){var n=AI(e),r=s(n,2),a=r[0],o=[];o[r[1]]=t[e],y[a]=o})),b={},x=this.getFrozenTensorIds(y),w={};case 6:if(!(v.length>0)){e.next=12;break}return k=this.processStack(c,v,n,y,w,x,l,b,h),e.next=10,Promise.all(k);case 10:e.next=6;break;case 12:if(null!=m||a||console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),!((I=p.filter((function(e){return!FS(e)&&!NI(e.name,y,n)})).map((function(e){return e.name}))).length>0)){e.next=17;break}throw S="",null!=m&&(S="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs [".concat(g,"]")),new Error("Cannot compute the outputs [".concat(I,"] from the provided inputs [").concat(i,"]. Consider providing the following inputs: [").concat(f,"]. ").concat(S));case 17:return e.abrupt("return",y);case 18:case"end":return e.stop()}}),e,this)}))),function(t,n,r,a){return e.apply(this,arguments)})},{key:"processStack",value:function(e,t,n,r,a,o,i,u,c){for(var l=this,p=[],d=function(){var e,d,h=t.pop();n.currentContext=h.contexts;var f="";if("Enter"===h.node.op&&CI("isConstant",h.node,r,n)&&(e=EI(h.node.name,n),d=s(e,1),f=d[0]),null==r[h.node.name]){var m,g,v=NS(h.node,r,n,l._resourceManager);f||(m=EI(h.node.name,n),g=s(m,1),f=g[0]);var y=n.currentContext;be(v)?p.push(v.then((function(e){return r[f]=e,n.currentContext=y,l.checkTensorForDisposal(f,h.node,r,n,o,i,u),l.processChildNodes(h.node,t,n,r,a,c),e}))):(r[f]=v,l.checkTensorForDisposal(f,h.node,r,n,o,i,u),l.processChildNodes(h.node,t,n,r,a,c))}else l.processChildNodes(h.node,t,n,r,a,c)};t.length>0;)d();return p}},{key:"processChildNodes",value:function(e,t,n,r,a,o){e.children.forEach((function(e){var i=EI(e.name,n),u=s(i,1)[0];!a[u]&&o.has(e.name)&&("Merge"===e.op?e.inputNames.some((function(e){return!!NI(e,r,n)}))&&(a[u]=!0,t.push({contexts:n.currentContext,node:e})):e.inputNames.every((function(e){return!!NI(e,r,n)}))&&(a[u]=!0,t.push({contexts:n.currentContext,node:e})))}))}},{key:"dispose",value:function(){var e=this;Object.keys(this.weightMap).forEach((function(t){return e.weightMap[t].forEach((function(e){return e.dispose()}))}))}},{key:"checkInputShapeAndType",value:function(e){var t=this;Object.keys(e).forEach((function(n){var r=e[n],a=AI(n),o=s(a,1)[0],i=t.graph.nodes[o];if(i.attrParams.shape&&i.attrParams.shape.value){var u=i.attrParams.shape.value;H(u.length===r.shape.length&&r.shape.every((function(e,t){return-1===u[t]||u[t]===e})),(function(){return"The shape of dict['".concat(i.name,"'] provided in model.execute(dict) must be [").concat(u,"], but was [").concat(r.shape,"]")}))}i.attrParams.dtype&&i.attrParams.dtype.value&&H(r.dtype===i.attrParams.dtype.value,(function(){return"The dtype of dict['".concat(i.name,"'] provided in model.execute(dict) must be ").concat(i.attrParams.dtype.value,", but was ").concat(r.dtype)}))}))}},{key:"mapInputs",value:function(e){var t={};for(var n in e)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[n]?t[this._signature.inputs[n].name]=e[n]:t[n]=e[n];return t}},{key:"checkInputs",value:function(e){var t=this,n=Object.keys(e).filter((function(e){var n=AI(e),r=s(n,1)[0];return null==t.graph.nodes[r]}));if(n.length>0)throw new Error("The dict provided in model.execute(dict) has keys: [".concat(n,"] that are not part of graph"))}},{key:"mapOutputs",value:function(e){var t=this;return e.map((function(e){return null!=t._signature&&null!=t._signature.outputs&&null!=t._signature.outputs[e]?t._signature.outputs[e].name:e}),{})}},{key:"checkOutputs",value:function(e){var t=this;e.forEach((function(e){var n=AI(e),r=s(n,1)[0];if(!t.graph.nodes[r])throw new Error("The output '".concat(e,"' is not found in the graph"))}))}}]);var e,t,n,r}(),BS=function(){return p((function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l(this,e),this.hashTableNameToHandle=t,this.hashTableMap=n}),[{key:"addHashTable",value:function(e,t){this.hashTableNameToHandle[e]=t.handle,this.hashTableMap[t.id]=t}},{key:"getHashTableHandleByName",value:function(e){return this.hashTableNameToHandle[e]}},{key:"getHashTableById",value:function(e){return this.hashTableMap[e]}},{key:"dispose",value:function(){for(var e in this.hashTableMap)this.hashTableMap[e].clearAndClose(),delete this.hashTableMap[e];for(var t in this.hashTableNameToHandle)this.hashTableNameToHandle[t].dispose(),delete this.hashTableNameToHandle[t]}}])}(),US="?tfjs-format=file",VS="model.json",WS=function(){return p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ai;l(this,e),this.modelUrl=t,this.loadOptions=n,this.version="n/a",this.io=r,null==n&&(this.loadOptions={}),this.resourceManager=new BS}),[{key:"modelVersion",get:function(){return this.version}},{key:"inputNodes",get:function(){return this.executor.inputNodes}},{key:"outputNodes",get:function(){return this.executor.outputNodes}},{key:"inputs",get:function(){return this.executor.inputs}},{key:"outputs",get:function(){return this.executor.outputs}},{key:"weights",get:function(){return this.executor.weightMap}},{key:"metadata",get:function(){return this.artifacts.userDefinedMetadata}},{key:"modelSignature",get:function(){return this.signature}},{key:"modelStructuredOutputKeys",get:function(){return this.structuredOutputKeys}},{key:"findIOHandler",value:function(){var e=this.modelUrl;if(null!=e.load)this.handler=e;else if(null!=this.loadOptions.requestInit)this.handler=this.io.browserHTTPRequest(e,this.loadOptions);else{var t=this.io.getLoadHandlers(e,this.loadOptions);if(0===t.length)t.push(this.io.browserHTTPRequest(e,this.loadOptions));else if(t.length>1)throw new Error("Found more than one (".concat(t.length,") load handlers for URL '").concat([e],"'"));this.handler=t[0]}}},{key:"load",value:function(){var e=this;if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");var t=this.handler.load();return be(t)?t.then((function(t){return e.loadSync(t)})):this.loadSync(t)}},{key:"loadSync",value:function(e){this.artifacts=e;var t=this.artifacts.modelTopology,n=this.artifacts.signature;if(null!=this.artifacts.userDefinedMetadata){var r=this.artifacts.userDefinedMetadata;null!=r.signature&&(n=r.signature),null!=r.structuredOutputKeys&&(this.structuredOutputKeys=r.structuredOutputKeys)}this.signature=n,this.version="".concat(t.versions.producer,".").concat(t.versions.minConsumer);var a=this.io.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs);if(this.executor=new LS($I.Instance.transformGraph(t,this.signature)),this.executor.weightMap=this.convertTensorMapToTensorsMap(a),this.executor.resourceManager=this.resourceManager,null!=e.modelInitializer&&null!=e.modelInitializer.node){var o=$I.Instance.transformGraph(e.modelInitializer);this.initializer=new LS(o),this.initializer.weightMap=this.executor.weightMap,this.initializer.resourceManager=this.resourceManager,this.initializer.executeAsync({},[])}return!0}},{key:"save",value:(t=c(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=7;break}if(0!==(r=this.io.getSaveHandlers(t)).length){e.next=4;break}throw new Error("Cannot find any save handlers for URL '".concat(t,"'"));case 4:if(!(r.length>1)){e.next=6;break}throw new Error("Found more than one (".concat(r.length,") save handlers for URL '").concat(t,"'"));case 6:t=r[0];case 7:if(null!=t.save){e.next=9;break}throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 9:return e.abrupt("return",t.save(this.artifacts));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"predict",value:function(e,t){var n=this,r=this.execute(e,this.outputNodes);if(this.structuredOutputKeys){var a={};return(r instanceof kr?[r]:r).forEach((function(e,t){return a[n.structuredOutputKeys[t]]=e})),a}return r}},{key:"normalizeInputs",value:function(e){if(!(e instanceof kr||Array.isArray(e)))return e;if((e=Array.isArray(e)?e:[e]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has ".concat(this.inputNodes.length," placeholders, while there are ").concat(e.length," input tensors."));return this.inputNodes.reduce((function(t,n,r){return t[n]=e[r],t}),{})}},{key:"normalizeOutputs",value:function(e){return e=e||this.outputNodes,Array.isArray(e)?e:[e]}},{key:"execute",value:function(e,t){e=this.normalizeInputs(e),t=this.normalizeOutputs(t);var n=this.executor.execute(e,t);return n.length>1?n:n[0]}},{key:"executeAsync",value:(e=c(u().mark((function e(t,n){var r;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.normalizeInputs(t),n=this.normalizeOutputs(n),e.next=3,this.executor.executeAsync(t,n);case 3:return r=e.sent,e.abrupt("return",r.length>1?r:r[0]);case 5:case"end":return e.stop()}}),e,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"getIntermediateTensors",value:function(){return this.executor.getIntermediateTensors()}},{key:"disposeIntermediateTensors",value:function(){this.executor.disposeIntermediateTensors()}},{key:"convertTensorMapToTensorsMap",value:function(e){return Object.keys(e).reduce((function(t,n){return t[n]=[e[n]],t}),{})}},{key:"dispose",value:function(){this.executor.dispose(),this.initializer&&this.initializer.dispose(),this.resourceManager.dispose()}}]);var e,t}();function zS(e){return GS.apply(this,arguments)}function GS(){return(GS=c(u().mark((function e(t){var n,r,a,o=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2&&void 0!==o[2]?o[2]:ai,null!=t){e.next=4;break}throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");case 4:return null==n&&(n={}),n.fromTFHub&&"string"==typeof t&&(t=function(e){return e.endsWith("/")||(e+="/"),"".concat(e).concat(VS).concat(US)}(t)),a=new WS(t,n,r),e.next=8,a.load();case 8:return e.abrupt("return",a);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var jS={};(function(){var e;function t(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var n="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},r=function(e){e=["object"==("undefined"==typeof globalThis?"undefined":d(globalThis))&&globalThis,e,"object"==("undefined"==typeof window?"undefined":d(window))&&window,"object"==("undefined"==typeof self?"undefined":d(self))&&self,"object"==d(xn)&&xn];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function a(e,t){if(t)e:{var a=r;e=e.split(".");for(var o=0;o<e.length-1;o++){var i=e[o];if(!(i in a))break e;a=a[i]}(t=t(o=a[e=e[e.length-1]]))!=o&&null!=t&&n(a,e,{configurable:!0,writable:!0,value:t})}}function o(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function i(e){var n="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return n?n.call(e):{next:t(e)}}function s(e){if(!(e instanceof Array)){e=i(e);for(var t,n=[];!(t=e.next()).done;)n.push(t.value);e=n}return e}a("Symbol",(function(e){function t(e,t){this.g=e,n(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.g};var r="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",a=0;return function e(n){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(r+(n||"")+"_"+a++,n)}})),a("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var a="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),i=0;i<a.length;i++){var s=r[a[i]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&n(s.prototype,e,{configurable:!0,writable:!0,value:function(){return o(t(this))}})}return e}));var u,c="function"==typeof Object.create?Object.create:function(e){function t(){}return t.prototype=e,new t};if("function"==typeof Object.setPrototypeOf)u=Object.setPrototypeOf;else{var l;e:{var p={};try{p.__proto__={a:!0},l=p.a;break e}catch(e){}l=!1}u=l?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var h=u;function f(e,t){if(e.prototype=c(t.prototype),e.prototype.constructor=e,h)h(e,t);else for(var n in t)if("prototype"!=n)if(Object.defineProperties){var r=Object.getOwnPropertyDescriptor(t,n);r&&Object.defineProperty(e,n,r)}else e[n]=t[n];e.ea=t.prototype}function m(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function g(e){if(e.l)throw new TypeError("Generator is already running");e.l=!0}function v(e,t){e.j={U:t,V:!0},e.g=e.m||e.s}function y(e,t,n){return e.g=n,{value:t}}function b(e){this.g=new m,this.h=e}function x(e,t,n,r){try{var a=t.call(e.g.i,n);if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");if(!a.done)return e.g.l=!1,a;var o=a.value}catch(t){return e.g.i=null,v(e.g,t),w(e)}return e.g.i=null,r.call(e.g,o),w(e)}function w(e){for(;e.g.g;)try{var t=e.h(e.g);if(t)return e.g.l=!1,{value:t.value,done:!1}}catch(t){e.g.h=void 0,v(e.g,t)}if(e.g.l=!1,e.g.j){if(t=e.g.j,e.g.j=null,t.V)throw t.U;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function k(e){this.next=function(t){return g(e.g),e.g.i?t=x(e,e.g.i.next,t,e.g.o):(e.g.o(t),t=w(e)),t},this.throw=function(t){return g(e.g),e.g.i?t=x(e,e.g.i.throw,t,e.g.o):(v(e.g,t),t=w(e)),t},this.return=function(t){return function(e,t){g(e.g);var n=e.g.i;return n?x(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),w(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function I(e){return function(e){function t(t){return e.next(t)}function n(t){return e.throw(t)}return new Promise((function(r,a){!function e(o){o.done?r(o.value):Promise.resolve(o.value).then(t,n).then(e,a)}(e.next())}))}(new k(new b(e)))}m.prototype.o=function(e){this.h=e},m.prototype.return=function(e){this.j={return:e},this.g=this.s},a("Promise",(function(e){function t(e){this.h=0,this.i=void 0,this.g=[],this.o=!1;var t=this.j();try{e(t.resolve,t.reject)}catch(e){t.reject(e)}}function n(){this.g=null}function a(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.h=function(e){if(null==this.g){this.g=[];var t=this;this.i((function(){t.l()}))}this.g.push(e)};var o=r.setTimeout;n.prototype.i=function(e){o(e,0)},n.prototype.l=function(){for(;this.g&&this.g.length;){var e=this.g;this.g=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(e){this.j(e)}}}this.g=null},n.prototype.j=function(e){this.i((function(){throw e}))},t.prototype.j=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.C),reject:e(this.l)}},t.prototype.C=function(e){if(e===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.F(e);else{e:switch(d(e)){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.v(e):this.m(e)}},t.prototype.v=function(e){var t=void 0;try{t=e.then}catch(e){return void this.l(e)}"function"==typeof t?this.G(t,e):this.m(e)},t.prototype.l=function(e){this.s(2,e)},t.prototype.m=function(e){this.s(1,e)},t.prototype.s=function(e,t){if(0!=this.h)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.h);this.h=e,this.i=t,2===this.h&&this.D(),this.A()},t.prototype.D=function(){var e=this;o((function(){if(e.B()){var t=r.console;void 0!==t&&t.error(e.i)}}),1)},t.prototype.B=function(){if(this.o)return!1;var e=r.CustomEvent,t=r.Event,n=r.dispatchEvent;return void 0===n||("function"==typeof e?e=new e("unhandledrejection",{cancelable:!0}):"function"==typeof t?e=new t("unhandledrejection",{cancelable:!0}):(e=r.document.createEvent("CustomEvent")).initCustomEvent("unhandledrejection",!1,!0,e),e.promise=this,e.reason=this.i,n(e))},t.prototype.A=function(){if(null!=this.g){for(var e=0;e<this.g.length;++e)s.h(this.g[e]);this.g=null}};var s=new n;return t.prototype.F=function(e){var t=this.j();e.J(t.resolve,t.reject)},t.prototype.G=function(e,t){var n=this.j();try{e.call(t,n.resolve,n.reject)}catch(e){n.reject(e)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{a(e(t))}catch(e){o(e)}}:t}var a,o,i=new t((function(e,t){a=e,o=t}));return this.J(r(e,a),r(n,o)),i},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.J=function(e,t){function n(){switch(r.h){case 1:e(r.i);break;case 2:t(r.i);break;default:throw Error("Unexpected state: "+r.h)}}var r=this;null==this.g?s.h(n):this.g.push(n),this.o=!0},t.resolve=a,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var r=i(e),o=r.next();!o.done;o=r.next())a(o.value).J(t,n)}))},t.all=function(e){var n=i(e),r=n.next();return r.done?a([]):new t((function(e,t){function o(t){return function(n){i[t]=n,0==--s&&e(i)}}var i=[],s=0;do{i.push(void 0),s++,a(r.value).J(o(i.length-1),t),r=n.next()}while(!r.done)}))},t}));var S="function"==typeof Object.assign?Object.assign:function(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(r)for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e};a("Object.assign",(function(e){return e||S})),a("Object.is",(function(e){return e||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}})),a("Array.prototype.includes",(function(e){return e||function(e,t){var n=this;n instanceof String&&(n=String(n));var r=n.length;for(0>(t=t||0)&&(t=Math.max(t+r,0));t<r;t++){var a=n[t];if(a===e||Object.is(a,e))return!0}return!1}})),a("String.prototype.includes",(function(e){return e||function(e,t){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(e instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(e,t||0)}})),a("Array.prototype.keys",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,a={next:function(){if(!r&&n<e.length){var a=n++;return{value:t(a,e[a]),done:!1}}return r=!0,{done:!0,value:void 0}}};return a[Symbol.iterator]=function(){return a},a}(this,(function(e){return e}))}}));var T=this||self;function _(e,t){e=e.split(".");var n,r=T;e[0]in r||void 0===r.execScript||r.execScript("var "+e[0]);for(;e.length&&(n=e.shift());)e.length||void 0===t?r=r[n]&&r[n]!==Object.prototype[n]?r[n]:r[n]={}:r[n]=t}function C(e){!function(e){T.setTimeout((function(){throw e}),0)}(e)}function N(e,t){C(Error("Invalid wire type: "+e+" (at position "+t+")"))}function E(){C(Error("Failed to read varint, encoding is invalid."))}function R(e,t){return t=String.fromCharCode.apply(null,t),null==e?t:e+t}var A,O,M="undefined"!=typeof TextDecoder,F="undefined"!=typeof TextEncoder;function D(e){if(F)e=(O||(O=new TextEncoder)).encode(e);else{var t=void 0;t=void 0!==t&&t;for(var n=0,r=new Uint8Array(3*e.length),a=0;a<e.length;a++){var o=e.charCodeAt(a);if(128>o)r[n++]=o;else{if(2048>o)r[n++]=o>>6|192;else{if(55296<=o&&57343>=o){if(56319>=o&&a<e.length){var i=e.charCodeAt(++a);if(56320<=i&&57343>=i){o=1024*(o-55296)+i-56320+65536,r[n++]=o>>18|240,r[n++]=o>>12&63|128,r[n++]=o>>6&63|128,r[n++]=63&o|128;continue}a--}if(t)throw Error("Found an unpaired surrogate");o=65533}r[n++]=o>>12|224,r[n++]=o>>6&63|128}r[n++]=63&o|128}}e=r.subarray(0,n)}return e}var P={},L=null;function B(e){var t;void 0===t&&(t=0),V(),t=P[t];for(var n=Array(Math.floor(e.length/3)),r=t[64]||"",a=0,o=0;a<e.length-2;a+=3){var i=e[a],s=e[a+1],u=e[a+2],c=t[i>>2];i=t[(3&i)<<4|s>>4],s=t[(15&s)<<2|u>>6],u=t[63&u],n[o++]=c+i+s+u}switch(c=0,u=r,e.length-a){case 2:u=t[(15&(c=e[a+1]))<<2]||r;case 1:e=e[a],n[o]=t[e>>2]+t[(3&e)<<4|c>>4]+u+r}return n.join("")}function U(e){var t=e.length,n=3*t/4;n%3?n=Math.floor(n):-1!="=.".indexOf(e[t-1])&&(n=-1!="=.".indexOf(e[t-2])?n-2:n-1);var r=new Uint8Array(n),a=0;return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),a=L[n];if(null!=a)return a;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}V();for(var r=0;;){var a=n(-1),o=n(0),i=n(64),s=n(64);if(64===s&&-1===a)break;t(a<<2|o>>4),64!=i&&(t(o<<4&240|i>>2),64!=s&&t(i<<6&192|s))}}(e,(function(e){r[a++]=e})),r.subarray(0,a)}function V(){if(!L){L={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++){var r=e.concat(t[n].split(""));P[n]=r;for(var a=0;a<r.length;a++){var o=r[a];void 0===L[o]&&(L[o]=a)}}}}var W,z="function"==typeof Uint8Array;function G(e){if(this.g=e,null!==e&&0===e.length)throw Error("ByteString should be constructed with non-empty values")}G.prototype.toJSON=function(){if(null==this.g)var e="";else e=this.g,e=this.g=null==e||"string"==typeof e?e:z&&e instanceof Uint8Array?B(e):null;return e};var j="function"==typeof Uint8Array.prototype.slice;function H(e,t,n){return t===n?W||(W=new Uint8Array(0)):j?e.slice(t,n):new Uint8Array(e.subarray(t,n))}var q=0;function X(e,t){t=void 0!==(t=void 0===t?{}:t).u&&t.u,this.h=null,this.g=this.i=this.l=0,this.j=!1,this.u=t,e&&K(this,e)}function K(e,t){e.h=function(e){if(e.constructor===Uint8Array)return e;if(e.constructor===ArrayBuffer)return new Uint8Array(e);if(e.constructor===Array)return new Uint8Array(e);if(e.constructor===String)return U(e);if(e.constructor===G){if(null==e.g)var t=W||(W=new Uint8Array(0));else{t=Uint8Array;var n=e.g;n=null==n||z&&null!=n&&n instanceof Uint8Array?n:"string"==typeof n?U(n):null,t=new t(e=e.g=n)}return t}if(e instanceof Uint8Array)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}(t),e.l=0,e.i=e.h.length,e.g=e.l}function Y(e){e.g>e.i&&(e.j=!0,C(Error("Tried to read past the end of the data "+e.g+" > "+e.i)))}function Q(e){var t=e.h,n=t[e.g],r=127&n;return 128>n?(e.g+=1,Y(e),r):(r|=(127&(n=t[e.g+1]))<<7,128>n?(e.g+=2,Y(e),r):(r|=(127&(n=t[e.g+2]))<<14,128>n?(e.g+=3,Y(e),r):(r|=(127&(n=t[e.g+3]))<<21,128>n?(e.g+=4,Y(e),r):(r|=(15&(n=t[e.g+4]))<<28,128>n?(e.g+=5,Y(e),r>>>0):(e.g+=5,128<=t[e.g++]&&128<=t[e.g++]&&128<=t[e.g++]&&128<=t[e.g++]&&128<=t[e.g++]?(e.j=!0,E(),r):(Y(e),r))))))}X.prototype.reset=function(){this.g=this.l};var J=[];function Z(){this.g=new Uint8Array(64),this.h=0}function $(e,t){if(!(e.h+1<e.g.length)){var n=e.g;e.g=new Uint8Array(Math.ceil(1+2*e.g.length)),e.g.set(n)}e.g[e.h++]=t}function ee(e,t){for(;127<t;)$(e,127&t|128),t>>>=7;$(e,t)}function te(e){var t={},n=void 0!==t.N&&t.N;this.m={u:void 0!==t.u&&t.u},this.N=n,t=this.m,J.length?(n=J.pop(),t&&(n.u=t.u),e&&K(n,e),e=n):e=new X(e,t),this.g=e,this.l=this.g.g,this.h=this.i=-1,this.j=!1}function ne(e){var t=e.g;if((t=t.g==t.i)||(t=e.j)||(t=(t=e.g).j||0>t.g||t.g>t.i),t)return!1;e.l=e.g.g;var n=Q(e.g);return t=n>>>3,0<=(n&=7)&&5>=n?(e.i=t,e.h=n,!0):(e.j=!0,N(n,e.l),!1)}function re(e){switch(e.h){case 0:if(0!=e.h)re(e);else e:{for(var t=(e=e.g).g,n=0;10>n;n++){if(!(128&e.h[t])){e.g=t+1,Y(e);break e}t++}e.j=!0,E()}break;case 1:(e=e.g).g+=8,Y(e);break;case 2:2!=e.h?re(e):(t=Q(e.g),(e=e.g).g+=t,Y(e));break;case 5:(e=e.g).g+=4,Y(e);break;case 3:for(t=e.i;;){if(!ne(e)){e.j=!0,C(Error("Unmatched start-group tag: stream EOF"));break}if(4==e.h){e.i!=t&&(e.j=!0,C(Error("Unmatched end-group tag")));break}re(e)}break;default:e.j=!0,N(e.h,e.l)}}function ae(e,t,n){e.N||(e=H(e.g.h,n,e.g.g),(n=t.m)?n.push(e):t.m=[e])}Z.prototype.length=function(){return this.h},Z.prototype.end=function(){var e=this.g,t=this.h;return this.h=0,H(e,0,t)},te.prototype.reset=function(){this.g.reset(),this.h=this.i=-1};var oe=[];function ie(){this.h=[],this.i=0,this.g=new Z}function se(e,t){0!==t.length&&(e.h.push(t),e.i+=t.length)}function ue(e,t,n){ee(e.g,8*t+2),ee(e.g,n.length),se(e,e.g.end()),se(e,n)}var ce,le="function"==typeof Symbol&&"symbol"==d(Symbol())?Symbol(void 0):void 0;function pe(e,t){Object.isFrozen(e)||(le?e[le]|=t:void 0!==e.g?e.g|=t:Object.defineProperties(e,{g:{value:t,configurable:!0,writable:!0,enumerable:!1}}))}function de(e){return e?null==(t=le?e[le]:e.g)?0:t:0;var t}function he(e){return Array.isArray(e)?(pe(e,1),e):e}function fe(e){if(!Array.isArray(e))throw Error("cannot mark non-array as immutable");pe(e,2)}function me(e){return null!==e&&"object"==d(e)&&e.constructor===Object}function ge(e){switch(d(e)){case"number":return isFinite(e)?e:String(e);case"object":return z&&null!=e&&e instanceof Uint8Array?B(e):e;default:return e}}function ve(e,t){if(null!=e)return Array.isArray(e)||me(e)?ye(e,t):t(e)}function ye(e,t){if(Array.isArray(e)){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=ve(e[r],t);return 1&de(e)&&he(n),n}for(r in n={},e)n[r]=ve(e[r],t);return n}function be(e,t,n){var r=ce;if(ce=null,e||(e=r),r=this.constructor.ca,e||(e=r?[r]:[]),this.j=(r?0:-1)-(this.constructor.aa||0),this.i=null,this.g=e,e=(r=this.g.length)-1,r&&me(r=this.g[e])?(this.l=e-this.j,this.h=r):void 0!==t&&-1<t?(this.l=Math.max(t,e+1-this.j),this.h=null):this.l=Number.MAX_VALUE,n)for(t=0;t<n.length;t++)(e=n[t])<this.l?(e+=this.j,(r=this.g[e])?he(r):this.g[e]=ke):(Ie(this),(r=this.h[e])?he(r):this.h[e]=ke)}var xe,we,ke=Object.freeze(he([]));function Ie(e){var t=e.l+e.j;e.g[t]||(e.h=e.g[t]={})}function Se(e,t,n){return-1===t?null:void 0!==n&&n||t>=e.l?e.h?e.h[t]:void 0:e.g[t+e.j]}function Te(e,t,n){n=void 0===n||n;var r=void 0!==r&&r,a=Se(e,t,r);return null==a&&(a=ke),a===ke?Ce(e,t,a=he([]),r):n&&Array.isArray(a)&&2&de(a)&&Ce(e,t,a=a.slice(),r),a}function _e(e,t,n){return null==(e=null==(e=Se(e,t))?e:+e)?void 0===n?0:n:e}function Ce(e,t,n,r){void 0!==r&&r||t>=e.l?(Ie(e),e.h[t]=n):e.g[t+e.j]=n}function Ne(e,t,n){e.i||(e.i={});var r=e.i[n];if(!r){var a=Te(e,n,!1);r=[];for(var o=!!Array.isArray(a)&&!!(2&de(a)),i=0;i<a.length;i++)r[i]=new t(a[i]),o&&fe(r[i].g);o&&(fe(r),Object.freeze(r)),e.i[n]=r}return r}function Ee(e,t,n,r,a){var o=Ne(e,r,t);n=n||new r,e=Te(e,t),null!=a?(o.splice(a,0,n),e.splice(a,0,Re(n))):(o.push(n),e.push(Re(n)))}function Re(e){if(e.i)for(var t in e.i){var n=e.i[t];if(Array.isArray(n))for(var r=0;r<n.length;r++)n[r]&&Re(n[r]);else n&&Re(n)}return e.g}function Ae(e,t){return null==(e=Se(e,t))?0:e}function Oe(e,t){return null==(e=Se(e,t))?"":e}function Me(e,t){if(e=e.m){se(t,t.g.end());for(var n=0;n<e.length;n++)se(t,e[n])}}function Fe(e){var t=e[0];switch(e.length){case 2:var n=e[1];return function(e,r,a){return t(e,r,a,n)};case 3:var r=e[1],a=e[2];return function(e,n,o){return t(e,n,o,r,a)};case 4:var o=e[1],i=e[2],s=e[3];return function(e,n,r){return t(e,n,r,o,i,s)};default:throw Error("unsupported number of parameters, expected [2-4], got "+e.length)}}function De(e,t,n){for(;ne(t)&&4!=t.h;){var r=t.i,a=n[r];if(a){if(Array.isArray(a)&&(a=n[r]=Fe(a)),!a(t,e,r)){a=e;var o=(r=t).l;re(r),ae(r,a,o)}}else a=e,o=(r=t).l,re(r),ae(r,a,o)}return e}function Pe(e,t){var n=new ie;if(t(e,n),0===(e=n.i+n.g.length()))n=new Uint8Array(0);else{e=new Uint8Array(e);for(var r=n.h,a=r.length,o=t=0;o<a;o++){var i=r[o];0!==i.length&&(e.set(i,t),t+=i.length)}0!==(a=(r=n.g).h)&&(e.set(r.g.subarray(0,a),t),r.h=0),n.h=[e],n=e}return n}function Le(e,t,n){if(oe.length){var r=oe.pop();e&&(K(r.g,e),r.i=-1,r.h=-1),e=r}else e=new te(e);try{return n(new t,e)}finally{(t=e.g).h=null,t.l=0,t.i=0,t.g=0,t.j=!1,t.u=!1,e.i=-1,e.h=-1,e.j=!1,100>oe.length&&oe.push(e)}}function Be(e,t,n){if(null!=(t=Se(t,n))){ee(e.g,8*n+5),e=e.g;var r=t;0===(r=(n=0>r?1:0)?-r:r)?q=0<1/r?0:2147483648:isNaN(r)?q=2147483647:34028234663852886e22<r?q=(n<<31|2139095040)>>>0:11754943508222875e-54>r?(r=Math.round(r/Math.pow(2,-149)),q=(n<<31|r)>>>0):(t=Math.floor(Math.log(r)/Math.LN2),r*=Math.pow(2,-t),16777216<=(r=Math.round(8388608*r))&&++t,q=(n<<31|t+127<<23|8388607&r)>>>0),$(e,(n=q)>>>0&255),$(e,n>>>8&255),$(e,n>>>16&255),$(e,n>>>24&255)}}function Ue(e,t,n){if(5!==e.h)return!1;var r=(e=e.g).h[e.g],a=e.h[e.g+1],o=e.h[e.g+2],i=e.h[e.g+3];return e.g+=4,Y(e),e=2*((a=(r|a<<8|o<<16|i<<24)>>>0)>>31)+1,r=a>>>23&255,a&=8388607,Ce(t,n,255==r?a?NaN:1/0*e:0==r?e*Math.pow(2,-149)*a:e*Math.pow(2,r-150)*(a+Math.pow(2,23))),!0}function Ve(e,t,n){if(0!==e.h)return!1;for(var r=e.g,a=128,o=0,i=e=0;4>i&&128<=a;i++)o|=(127&(a=r.h[r.g++]))<<7*i;if(128<=a&&(o|=(127&(a=r.h[r.g++]))<<28,e|=(127&a)>>4),128<=a)for(i=0;5>i&&128<=a;i++)e|=(127&(a=r.h[r.g++]))<<7*i+3;return 128>a?(r=o>>>0,(e=2147483648&(a=e>>>0))&&(a=~a>>>0,0==(r=1+~r>>>0)&&(a=a+1>>>0)),r=4294967296*a+(r>>>0),e=e?-r:r):(r.j=!0,E(),e=void 0),Ce(t,n,e),!0}function We(e,t,n){return 0===e.h&&(Ce(t,n,Q(e.g)),!0)}function ze(e,t,n){if(2!==e.h)return!1;var r,a=Q(e.g),o=(e=e.g).g;if(e.g+=a,Y(e),e=e.h,M)(r=A)||(r=A=new TextDecoder("utf-8",{fatal:!1})),r=r.decode(e.subarray(o,o+a));else{a=o+a;for(var i,s,u,c=[],l=null;o<a;)128>(i=e[o++])?c.push(i):224>i?o>=a?c.push(65533):(s=e[o++],194>i||128!=(192&s)?(o--,c.push(65533)):c.push((31&i)<<6|63&s)):240>i?o>=a-1?c.push(65533):128!=(192&(s=e[o++]))||224===i&&160>s||237===i&&160<=s||128!=(192&(r=e[o++]))?(o--,c.push(65533)):c.push((15&i)<<12|(63&s)<<6|63&r):244>=i?o>=a-2?c.push(65533):128!=(192&(s=e[o++]))||s-144+(i<<28)>>30||128!=(192&(r=e[o++]))||128!=(192&(u=e[o++]))?(o--,c.push(65533)):(i=(7&i)<<18|(63&s)<<12|(63&r)<<6|63&u,i-=65536,c.push(55296+(i>>10&1023),56320+(1023&i))):c.push(65533),8192<=c.length&&(l=R(l,c),c.length=0);r=R(l,c)}return Ce(t,n,r),!0}function Ge(e,t,n,r,a){if(2!==e.h)return!1;var o=new r,i=e.g.i,s=Q(e.g),u=e.g.g+s;if(e.g.i=u,a(o,e),0!=(a=u-e.g.g))throw Error("Message parsing ended unexpectedly. Expected to read "+s+" bytes, instead read "+(s-a)+" bytes, either the data ended unexpectedly or the message misreported its own length");return e.g.g=u,e.g.i=i,Ee(t,n,o,r,void 0),!0}function je(e){be.call(this,e)}function He(e,t){var n=Se(e,1);if(null!=n&&null!=n){ee(t.g,8);var r=t.g;if(0<=n)ee(r,n);else{for(var a=0;9>a;a++)$(r,127&n|128),n>>=7;$(r,1)}}Be(t,e,2),null!=(r=Se(e,3))&&ue(t,3,D(r)),null!=(r=Se(e,4))&&ue(t,4,D(r)),Me(e,t)}function qe(e,t){return De(e,t,xe||(xe={1:We,2:Ue,3:ze,4:ze}))}function Xe(e){be.call(this,e,-1,Je)}function Ke(e,t){return De(e,t,we||(we={1:[Ge,je,qe]}))}be.prototype.toJSON=function(){return ye(Re(this),ge)},be.prototype.toString=function(){return Re(this).toString()},f(je,be),f(Xe,be),Xe.prototype.addClassification=function(e,t){return Ee(this,1,e,je,t),this};var Ye,Qe,Je=[1];function Ze(e){be.call(this,e)}function $e(e,t){Be(t,e,1),Be(t,e,2),Be(t,e,3),Be(t,e,4),Be(t,e,5),Me(e,t)}function et(e,t){return De(e,t,Ye||(Ye={1:Ue,2:Ue,3:Ue,4:Ue,5:Ue}))}function tt(e){be.call(this,e,-1,at)}function nt(e,t){return De(e,t,Qe||(Qe={1:[Ge,Ze,et]}))}f(Ze,be),f(tt,be);var rt,at=[1];function ot(e){be.call(this,e)}function it(e,t){Be(t,e,1),Be(t,e,2),Be(t,e,3),Be(t,e,4),Be(t,e,5);var n=Se(e,6);if(null!=n&&null!=n){ee(t.g,48);var r=t.g,a=n;n=0>a;var o=(a=Math.abs(a))>>>0;for(a=Math.floor((a-o)/4294967296),a>>>=0,n&&(a=~a>>>0,4294967295<(o=1+(~o>>>0))&&(o=0,4294967295<++a&&(a=0))),n=q=o,o=a;0<o||127<n;)$(r,127&n|128),n=(n>>>7|o<<25)>>>0,o>>>=7;$(r,n)}Me(e,t)}function st(e,t){return De(e,t,rt||(rt={1:Ue,2:Ue,3:Ue,4:Ue,5:Ue,6:Ve}))}function ut(e,t,n){if(n=e.createShader(0===n?e.VERTEX_SHADER:e.FRAGMENT_SHADER),e.shaderSource(n,t),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS))throw Error("Could not compile WebGL shader.\n\n"+e.getShaderInfoLog(n));return n}function ct(e){return Ne(e,je,1).map((function(e){return{index:Ae(e,1),X:_e(e,2),label:null!=Se(e,3)?Oe(e,3):void 0,displayName:null!=Se(e,4)?Oe(e,4):void 0}}))}function lt(e){return{x:_e(e,1),y:_e(e,2),z:_e(e,3),visibility:null!=Se(e,4)?_e(e,4):void 0}}function pt(e){return Ne(Le(e,tt,nt),Ze,1).map(lt)}function dt(e,t){this.h=e,this.g=t,this.l=0}function ht(e,t,n){return function(e,t){var n=e.g;if(void 0===e.m){var r=ut(n,"\n  attribute vec2 aVertex;\n  attribute vec2 aTex;\n  varying vec2 vTex;\n  void main(void) {\n    gl_Position = vec4(aVertex, 0.0, 1.0);\n    vTex = aTex;\n  }",0),a=ut(n,"\n  precision mediump float;\n  varying vec2 vTex;\n  uniform sampler2D sampler0;\n  void main(){\n    gl_FragColor = texture2D(sampler0, vTex);\n  }",1),o=n.createProgram();if(n.attachShader(o,r),n.attachShader(o,a),n.linkProgram(o),!n.getProgramParameter(o,n.LINK_STATUS))throw Error("Could not compile WebGL program.\n\n"+n.getProgramInfoLog(o));r=e.m=o,n.useProgram(r),a=n.getUniformLocation(r,"sampler0"),e.j={I:n.getAttribLocation(r,"aVertex"),H:n.getAttribLocation(r,"aTex"),da:a},e.s=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.s),n.enableVertexAttribArray(e.j.I),n.vertexAttribPointer(e.j.I,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),e.o=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,e.o),n.enableVertexAttribArray(e.j.H),n.vertexAttribPointer(e.j.H,2,n.FLOAT,!1,0,0),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),n.uniform1i(a,0)}r=e.j,n.useProgram(e.m),n.canvas.width=t.width,n.canvas.height=t.height,n.viewport(0,0,t.width,t.height),n.activeTexture(n.TEXTURE0),e.h.bindTexture2d(t.glName),n.enableVertexAttribArray(r.I),n.bindBuffer(n.ARRAY_BUFFER,e.s),n.vertexAttribPointer(r.I,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,e.o),n.vertexAttribPointer(r.H,2,n.FLOAT,!1,0,0),n.bindFramebuffer(n.DRAW_FRAMEBUFFER?n.DRAW_FRAMEBUFFER:n.FRAMEBUFFER,null),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.colorMask(!0,!0,!0,!0),n.drawArrays(n.TRIANGLE_FAN,0,4),n.disableVertexAttribArray(r.I),n.disableVertexAttribArray(r.H),n.bindBuffer(n.ARRAY_BUFFER,null),e.h.bindTexture2d(0)}(e,t),"function"==typeof e.g.canvas.transferToImageBitmap?Promise.resolve(e.g.canvas.transferToImageBitmap()):n?Promise.resolve(e.g.canvas):"function"==typeof createImageBitmap?createImageBitmap(e.g.canvas):(void 0===e.i&&(e.i=document.createElement("canvas")),new Promise((function(t){e.i.height=e.g.canvas.height,e.i.width=e.g.canvas.width,e.i.getContext("2d",{}).drawImage(e.g.canvas,0,0,e.g.canvas.width,e.g.canvas.height),t(e.i)})))}function ft(e){this.g=e}f(ot,be);var mt=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function gt(e,t){return t+e}function vt(e,t){window[e]=t}function yt(e){if(this.g=e,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=e&&e.locateFile||gt,"object"==("undefined"==typeof window?"undefined":d(window)))var t=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else{if("undefined"==typeof location)throw Error("solutions can only be loaded on a web page or in a web worker");t=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/"}if(this.S=t,e.options)for(var n=(t=i(Object.keys(e.options))).next();!n.done;n=t.next()){n=n.value;var r=e.options[n].default;void 0!==r&&(this.j[n]="function"==typeof r?r():r)}}function bt(e,t){var n,r;return I((function(a){return t in e.F?a.return(e.F[t]):(n=e.locateFile(t,""),r=fetch(n).then((function(e){return e.arrayBuffer()})),e.F[t]=r,a.return(r))}))}function xt(e,t,n){var r,a,o,s,u,c,l,p,d,h,f,m,g,v;return I((function(b){switch(b.g){case 1:if(!n)return b.return(t);for(r={},a=0,o=i(Object.keys(n)),s=o.next();!s.done;s=o.next())u=s.value,"string"!=typeof(c=n[u])&&"texture"===c.type&&void 0!==t[c.stream]&&++a;1<a&&(e.G=!1),l=i(Object.keys(n)),s=l.next();case 2:if(s.done){b.g=4;break}if(p=s.value,"string"==typeof(d=n[p]))return g=r,v=p,y(b,function(e,t,n){var r;return I((function(a){return"number"==typeof n||n instanceof Uint8Array||n instanceof e.h.Uint8BlobList?a.return(n):n instanceof e.h.Texture2dDataOut?((r=e.s[t])||(r=new dt(e.h,e.D),e.s[t]=r),a.return(ht(r,n,e.G))):a.return(void 0)}))}(e,p,t[d]),14);if(h=t[d.stream],"detection_list"===d.type){if(h){for(var x=h.getRectList(),w=h.getLandmarksList(),k=h.getClassificationsList(),S=[],T=0;T<x.size();++T){var _=Le(x.get(T),ot,st);_={T:{Y:_e(_,1),Z:_e(_,2),height:_e(_,3),width:_e(_,4),rotation:_e(_,5,0),W:Ae(_,6)},O:pt(w.get(T)),M:ct(Le(k.get(T),Xe,Ke))},S.push(_)}x=S}else x=[];r[p]=x,b.g=7;break}if("proto_list"===d.type){if(h){for(x=Array(h.size()),w=0;w<h.size();w++)x[w]=h.get(w);h.delete()}else x=[];r[p]=x,b.g=7;break}if(void 0===h){b.g=3;break}if("float_list"===d.type){r[p]=h,b.g=7;break}if("proto"===d.type){r[p]=h,b.g=7;break}if("texture"!==d.type)throw Error("Unknown output config type: '"+d.type+"'");return(f=e.s[p])||(f=new dt(e.h,e.D),e.s[p]=f),y(b,ht(f,h,e.G),13);case 13:m=b.h,r[p]=m;case 7:d.transform&&r[p]&&(r[p]=d.transform(r[p])),b.g=3;break;case 14:g[v]=b.h;case 3:s=l.next(),b.g=2;break;case 4:return b.return(r)}}))}function wt(e,t){for(var n=t.name||"$",r=[].concat(s(t.wants)),a=new e.h.StringList,o=i(t.wants),u=o.next();!u.done;u=o.next())a.push_back(u.value);o=e.h.PacketListener.implement({onResults:function(a){for(var o={},i=0;i<t.wants.length;++i)o[r[i]]=a.get(i);var s=e.listeners[n];s&&(e.C=xt(e,o,t.outs).then((function(n){n=s(n);for(var a=0;a<t.wants.length;++a){var i=o[r[a]];"object"==d(i)&&i.hasOwnProperty&&i.hasOwnProperty("delete")&&i.delete()}n&&(e.C=n)})))}}),e.i.attachMultiListener(a,o),a.delete()}function kt(e){switch(void 0===e&&(e=0),e){case 1:return"pose_landmark_full.tflite";case 2:return"pose_landmark_heavy.tflite";default:return"pose_landmark_lite.tflite"}}function It(e){var t=this;e=e||{},this.g=new yt({locateFile:e.locateFile,files:function(e){return[{url:"pose_solution_packed_assets_loader.js"},{simd:!1,url:"pose_solution_wasm_bin.js"},{simd:!0,url:"pose_solution_simd_wasm_bin.js"},{data:!0,url:kt(e.modelComplexity)}]},graph:{url:"pose_web.binarypb"},listeners:[{wants:["pose_landmarks","world_landmarks","segmentation_mask","image_transformed"],outs:{image:{type:"texture",stream:"image_transformed"},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:pt},poseWorldLandmarks:{type:"proto",stream:"world_landmarks",transform:pt},segmentationMask:{type:"texture",stream:"segmentation_mask"}}}],inputs:{image:{type:"video",stream:"input_frames_gpu"}},options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(e){var n,r,a;return I((function(o){return 1==o.g?(n=kt(e),r="third_party/mediapipe/modules/pose_landmark/"+n,y(o,bt(t.g,n),2)):(a=o.h,t.g.overrideFile(r,a),o.return(!0))}))}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}}}})}(e=yt.prototype).close=function(){return this.i&&this.i.delete(),Promise.resolve()},e.reset=function(){var e=this;return I((function(t){e.i&&(e.i.reset(),e.m={},e.s={}),t.g=0}))},e.setOptions=function(e,t){var n=this;if(t=t||this.g.options){for(var r=[],a=[],o={},s=i(Object.keys(e)),u=s.next();!u.done;o={K:o.K,L:o.L},u=s.next()){var c=u.value;c in this.j&&this.j[c]===e[c]||(this.j[c]=e[c],void 0!==(u=t[c])&&(u.onChange&&(o.K=u.onChange,o.L=e[c],r.push(function(e){return function(){return I((function(t){if(1==t.g)return y(t,e.K(e.L),2);!0===t.h&&(n.o=!0),t.g=0}))}}(o))),u.graphOptionXref&&(c={valueNumber:1===u.type?e[c]:0,valueBoolean:0===u.type&&e[c],valueString:2===u.type?e[c]:""},u=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),u.graphOptionXref),c),a.push(u))))}0===r.length&&0===a.length||(this.o=!0,this.A=(void 0===this.A?[]:this.A).concat(a),this.v=(void 0===this.v?[]:this.v).concat(r))}},e.initialize=function(){var e=this;return I((function(t){return 1==t.g?y(t,function(e){var t,n,r,a,o,i,u,c,l,p,h;return I((function(f){switch(f.g){case 1:return e.R?(t=void 0===e.g.files?[]:"function"==typeof e.g.files?e.g.files(e.j):e.g.files,y(f,I((function(e){switch(e.g){case 1:return e.m=2,y(e,WebAssembly.instantiate(mt),4);case 4:e.g=3,e.m=0;break;case 2:return e.m=0,e.j=null,e.return(!1);case 3:return e.return(!0)}})),2)):f.return();case 2:if(n=f.h,"object"==("undefined"==typeof window?"undefined":d(window)))return vt("createMediapipeSolutionsWasm",{locateFile:e.locateFile}),vt("createMediapipeSolutionsPackedAssets",{locateFile:e.locateFile}),i=t.filter((function(e){return void 0!==e.data})),u=t.filter((function(e){return void 0===e.data})),c=Promise.all(i.map((function(t){var n=bt(e,t.url);if(void 0!==t.path){var r=t.path;n=n.then((function(t){return e.overrideFile(r,t),Promise.resolve(t)}))}return n}))),l=Promise.all(u.map((function(t){return void 0===t.simd||t.simd&&n||!t.simd&&!n?function(e){var t=document.createElement("script");return t.setAttribute("src",e),t.setAttribute("crossorigin","anonymous"),new Promise((function(e){t.addEventListener("load",(function(){e()}),!1),t.addEventListener("error",(function(){e()}),!1),document.body.appendChild(t)}))}(e.locateFile(t.url,e.S)):Promise.resolve()}))).then((function(){var t,n,r;return I((function(a){if(1==a.g)return t=window.createMediapipeSolutionsWasm,n=window.createMediapipeSolutionsPackedAssets,r=e,y(a,t(n),2);r.h=a.h,a.g=0}))})),p=I((function(t){return e.g.graph&&e.g.graph.url?t=y(t,bt(e,e.g.graph.url),0):(t.g=0,t=void 0),t})),y(f,Promise.all([l,c,p]),7);if("function"!=typeof importScripts)throw Error("solutions can only be loaded on a web page or in a web worker");return r=t.filter((function(e){return void 0===e.simd||e.simd&&n||!e.simd&&!n})).map((function(t){return e.locateFile(t.url,e.S)})),importScripts.apply(null,s(r)),a=e,y(f,createMediapipeSolutionsWasm(Module),6);case 6:a.h=f.h,e.l=new OffscreenCanvas(1,1),e.h.canvas=e.l,o=e.h.GL.createContext(e.l,{antialias:!1,alpha:!1,ba:"undefined"!=typeof WebGL2RenderingContext?2:1}),e.h.GL.makeContextCurrent(o),f.g=4;break;case 7:if(e.l=document.createElement("canvas"),!(h=e.l.getContext("webgl2",{}))&&!(h=e.l.getContext("webgl",{})))return alert("Failed to create WebGL canvas context when passing video frame."),f.return();e.D=h,e.h.canvas=e.l,e.h.createContext(e.l,!0,!0,{});case 4:e.i=new e.h.SolutionWasm,e.R=!1,f.g=0}}))}(e),2):3!=t.g?y(t,function(e){var t,n,r,a,o,s,u,c;return I((function(l){if(1==l.g)return e.g.graph&&e.g.graph.url&&e.P===e.g.graph.url?l.return():(e.o=!0,e.g.graph&&e.g.graph.url?(e.P=e.g.graph.url,y(l,bt(e,e.g.graph.url),3)):void(l.g=2));for(2!=l.g&&(t=l.h,e.i.loadGraph(t)),n=i(Object.keys(e.B)),r=n.next();!r.done;r=n.next())a=r.value,e.i.overrideFile(a,e.B[a]);if(e.B={},e.g.listeners)for(o=i(e.g.listeners),s=o.next();!s.done;s=o.next())u=s.value,wt(e,u);c=e.j,e.j={},e.setOptions(c),l.g=0}))}(e),3):y(t,function(e){var t,n,r,a,o,s;return I((function(u){switch(u.g){case 1:if(!e.o)return u.return();if(!e.v){u.g=2;break}t=i(e.v),n=t.next();case 3:if(n.done){u.g=5;break}return y(u,(0,n.value)(),4);case 4:n=t.next(),u.g=3;break;case 5:e.v=void 0;case 2:if(e.A){for(r=new e.h.GraphOptionChangeRequestList,a=i(e.A),o=a.next();!o.done;o=a.next())s=o.value,r.push_back(s);e.i.changeOptions(r),r.delete(),e.A=void 0}e.o=!1,u.g=0}}))}(e),0)}))},e.overrideFile=function(e,t){this.i?this.i.overrideFile(e,t):this.B[e]=t},e.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},e.send=function(e,t){var n,r,a,o,s,u,c,l,p,d=this;return I((function(h){switch(h.g){case 1:return d.g.inputs?(n=1e3*(null==t?performance.now():t),y(h,d.C,2)):h.return();case 2:return y(h,d.initialize(),3);case 3:for(r=new d.h.PacketDataList,a=i(Object.keys(e)),o=a.next();!o.done;o=a.next())if(s=o.value,u=d.g.inputs[s]){e:{var f=e[s];switch(u.type){case"video":var m=d.m[u.stream];if(m||(m=new dt(d.h,d.D),d.m[u.stream]=m),0===m.l&&(m.l=m.h.createTexture()),"undefined"!=typeof HTMLVideoElement&&f instanceof HTMLVideoElement)var g=f.videoWidth,v=f.videoHeight;else"undefined"!=typeof HTMLImageElement&&f instanceof HTMLImageElement?(g=f.naturalWidth,v=f.naturalHeight):(g=f.width,v=f.height);v={glName:m.l,width:g,height:v},(g=m.g).canvas.width=v.width,g.canvas.height=v.height,g.activeTexture(g.TEXTURE0),m.h.bindTexture2d(m.l),g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,f),m.h.bindTexture2d(0),m=v;break e;case"detections":for((m=d.m[u.stream])||(m=new ft(d.h),d.m[u.stream]=m),m.data||(m.data=new m.g.DetectionListData),m.data.reset(f.length),v=0;v<f.length;++v){g=f[v];var b=m.data,x=b.setBoundingBox,w=v,k=g.T,I=new ot;if(Ce(I,1,k.Y),Ce(I,2,k.Z),Ce(I,3,k.height),Ce(I,4,k.width),Ce(I,5,k.rotation),Ce(I,6,k.W),k=Pe(I,it),x.call(b,w,k),g.O)for(b=0;b<g.O.length;++b){var S=!!(I=g.O[b]).visibility;w=(x=m.data).addNormalizedLandmark,k=v,I=Object.assign(Object.assign({},I),{visibility:S?I.visibility:0}),Ce(S=new Ze,1,I.x),Ce(S,2,I.y),Ce(S,3,I.z),I.visibility&&Ce(S,4,I.visibility),I=Pe(S,$e),w.call(x,k,I)}if(g.M)for(b=0;b<g.M.length;++b)w=(x=m.data).addClassification,k=v,I=g.M[b],Ce(S=new je,2,I.X),I.index&&Ce(S,1,I.index),I.label&&Ce(S,3,I.label),I.displayName&&Ce(S,4,I.displayName),I=Pe(S,He),w.call(x,k,I)}m=m.data;break e;default:m={}}}switch(c=m,l=u.stream,u.type){case"video":r.pushTexture2d(Object.assign(Object.assign({},c),{stream:l,timestamp:n}));break;case"detections":(p=c).stream=l,p.timestamp=n,r.pushDetectionList(p);break;default:throw Error("Unknown input config type: '"+u.type+"'")}}return d.i.send(r),y(h,d.C,4);case 4:r.delete(),h.g=0}}))},e.onResults=function(e,t){this.listeners[t||"$"]=e},_("Solution",yt),_("OptionType",{BOOL:0,NUMBER:1,$:2,0:"BOOL",1:"NUMBER",2:"STRING"}),(e=It.prototype).reset=function(){this.g.reset()},e.close=function(){return this.g.close(),Promise.resolve()},e.onResults=function(e){this.g.onResults(e)},e.initialize=function(){var e=this;return I((function(t){return y(t,e.g.initialize(),0)}))},e.send=function(e,t){var n=this;return I((function(r){return y(r,n.g.send(e,t),0)}))},e.setOptions=function(e){this.g.setOptions(e)},_("Pose",It),_("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),_("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),_("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),_("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),_("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),_("VERSION","0.5.1635988162")}).call(xn);var HS=function(e,t){return(HS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function qS(e,t){function n(){this.constructor=e}HS(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var XS=function(){return(XS=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function KS(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}u((r=r.apply(e,t||[])).next())}))}function YS(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function QS(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}var JS=["nose","left_eye","right_eye","left_ear","right_ear","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle"],ZS=["nose","left_eye_inner","left_eye","left_eye_outer","right_eye_inner","right_eye","right_eye_outer","left_ear","right_ear","mouth_left","mouth_right","left_shoulder","right_shoulder","left_elbow","right_elbow","left_wrist","right_wrist","left_pinky","right_pinky","left_index","right_index","left_thumb","right_thumb","left_hip","right_hip","left_knee","right_knee","left_ankle","right_ankle","left_heel","right_heel","left_foot_index","right_foot_index"];function $S(e){return e instanceof SVGAnimatedLength?e.baseVal.value:e}function eT(e){return KS(this,void 0,void 0,(function(){var t,n;return YS(this,(function(r){switch(r.label){case 0:return t=document.createElement("canvas"),e instanceof kr?[4,gi(e,t)]:[3,2];case 1:return r.sent(),[3,3];case 2:t.width=$S(e.width),t.height=$S(e.height),n=t.getContext("2d"),e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0),r.label=3;case 3:return[2,t]}}))}))}function tT(e){return KS(this,void 0,void 0,(function(){var t,n,r,a,o,i;return YS(this,(function(s){switch(s.label){case 0:return e instanceof kr?(t=e.shape.slice(0,2),n=t[0],r=t[1],a=ImageData.bind,[4,gi(e)]):[3,2];case 1:return[2,new(a.apply(ImageData,[void 0,s.sent(),r,n]))];case 2:return o=document.createElement("canvas"),i=o.getContext("2d"),o.width=$S(e.width),o.height=$S(e.height),i.drawImage(e,0,0),[2,i.getImageData(0,0,o.width,o.height)]}}))}))}function nT(e){return KS(this,void 0,void 0,(function(){var t;return YS(this,(function(n){switch(n.label){case 0:return e instanceof SVGImageElement||e instanceof OffscreenCanvas?[4,eT(e)]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=e,n.label=3;case 3:return[2,yi(t,4)]}}))}))}function rT(e){if(e<0||e>=256)throw new Error("Mask value must be in range [0, 255] but got "+e);if(!Number.isInteger(e))throw new Error("Mask value must be an integer but got "+e)}var aT={runtime:"mediapipe",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,modelType:"full"},oT=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return KS(this,void 0,void 0,(function(){return YS(this,(function(e){return[2,this.mask]}))}))},e.prototype.toImageData=function(){return KS(this,void 0,void 0,(function(){return YS(this,(function(e){return[2,tT(this.mask)]}))}))},e.prototype.toTensor=function(){return KS(this,void 0,void 0,(function(){return YS(this,(function(e){return[2,nT(this.mask)]}))}))},e.prototype.getUnderlyingType=function(){return"canvasimagesource"},e}();function iT(e){return rT(e),"person"}var sT=function(){function e(e){var t,n=this;switch(this.width=0,this.height=0,this.selfieMode=!1,this.poseSolution=new jS.Pose({locateFile:function(t,n){return e.solutionPath?e.solutionPath.replace(/\/+$/,"")+"/"+t:n+"/"+t}}),e.modelType){case"lite":t=0;break;case"heavy":t=2;break;default:t=1}this.poseSolution.setOptions({modelComplexity:t,smoothLandmarks:e.enableSmoothing,enableSegmentation:e.enableSegmentation,smoothSegmentation:e.smoothSegmentation,selfieMode:this.selfieMode}),this.poseSolution.onResults((function(e){if(n.height=e.image.height,n.width=e.image.width,null==e.poseLandmarks)n.poses=[];else{var t=n.translateOutput(e.poseLandmarks,e.poseWorldLandmarks);e.segmentationMask&&(t.segmentation={maskValueToLabel:iT,mask:new oT(e.segmentationMask)}),n.poses=[t]}}))}return e.prototype.translateOutput=function(e,t){var n=this,r={keypoints:e.map((function(e,t){return{x:e.x*n.width,y:e.y*n.height,z:e.z,score:e.visibility,name:ZS[t]}}))};return null!=t&&(r.keypoints3D=t.map((function(e,t){return{x:e.x,y:e.y,z:e.z,score:e.visibility,name:ZS[t]}}))),r},e.prototype.estimatePoses=function(e,t,n){return KS(this,void 0,void 0,(function(){var r,a;return YS(this,(function(o){switch(o.label){case 0:return t&&t.flipHorizontal&&t.flipHorizontal!==this.selfieMode&&(this.selfieMode=t.flipHorizontal,this.poseSolution.setOptions({selfieMode:this.selfieMode})),e instanceof kr?(a=ImageData.bind,[4,gi(e)]):[3,2];case 1:return r=new(a.apply(ImageData,[void 0,o.sent(),e.shape[1],e.shape[0]])),[3,3];case 2:r=e,o.label=3;case 3:return e=r,[4,this.poseSolution.send({image:e},n)];case 4:return o.sent(),[2,this.poses]}}))}))},e.prototype.dispose=function(){this.poseSolution.close()},e.prototype.reset=function(){this.poseSolution.reset()},e.prototype.initialize=function(){return this.poseSolution.initialize()},e}();function uT(e){return KS(this,void 0,void 0,(function(){var t,n;return YS(this,(function(r){switch(r.label){case 0:return t=function(e){if(null==e)return XS({},aT);var t=XS({},e);return t.runtime="mediapipe",null==t.enableSegmentation&&(t.enableSegmentation=aT.enableSegmentation),null==t.enableSmoothing&&(t.enableSmoothing=aT.enableSmoothing),null==t.smoothSegmentation&&(t.smoothSegmentation=aT.smoothSegmentation),null==t.modelType&&(t.modelType=aT.modelType),t}(e),[4,(n=new sT(t)).initialize()];case 1:return r.sent(),[2,n]}}))}))}function cT(e){return e instanceof kr?{height:e.shape[0],width:e.shape[1]}:{height:e.height,width:e.width}}function lT(e){return e-2*Math.PI*Math.floor((e+Math.PI)/(2*Math.PI))}function pT(e){return e instanceof kr?e:yi(e)}function dT(e,t,n){return hT(n,"inputResolution"),[1/n.width*e[0][0]*t.width,1/n.height*e[0][1]*t.width,e[0][3]*t.width,1/n.width*e[1][0]*t.height,1/n.height*e[1][1]*t.height,e[1][3]*t.height,0,0]}function hT(e,t){H(0!==e.width,(function(){return t+" width cannot be 0."})),H(0!==e.height,(function(){return t+" height cannot be 0."}))}function fT(e,t,n){var r=n.rotationVectorStartKeypointIndex,a=n.rotationVectorEndKeypointIndex,o=e.locationData,i=o.relativeKeypoints[r].x*t.width,s=o.relativeKeypoints[r].y*t.height,u=o.relativeKeypoints[a].x*t.width,c=o.relativeKeypoints[a].y*t.height,l=2*Math.sqrt((u-i)*(u-i)+(c-s)*(c-s)),p=function(e,t,n){var r,a=e.locationData,o=n.rotationVectorStartKeypointIndex,i=n.rotationVectorEndKeypointIndex;r=n.rotationVectorTargetAngle?n.rotationVectorTargetAngle:Math.PI*n.rotationVectorTargetAngleDegree/180;var s=a.relativeKeypoints[o].x*t.width,u=a.relativeKeypoints[o].y*t.height,c=a.relativeKeypoints[i].x*t.width,l=a.relativeKeypoints[i].y*t.height;return lT(r-Math.atan2(-(l-u),c-s))}(e,t,n);return{xCenter:i/t.width,yCenter:s/t.height,width:l/t.width,height:l/t.height,rotation:p}}function mT(e){if(16!==e.length)throw new Error("Array length must be 16 but got "+e.length);return[[e[0],e[1],e[2],e[3]],[e[4],e[5],e[6],e[7]],[e[8],e[9],e[10],e[11]],[e[12],e[13],e[14],e[15]]]}function gT(e,t,n,r,a,o,i){return e[t][a]*(e[n][o]*e[r][i]-e[n][i]*e[r][o])}function vT(e,t,n){var r=(t+1)%4,a=(t+2)%4,o=(t+3)%4,i=(n+1)%4,s=(n+2)%4,u=(n+3)%4;return gT(e,r,a,o,i,s,u)+gT(e,a,o,r,i,s,u)+gT(e,o,r,a,i,s,u)}function yT(e,t,n){void 0===n&&(n={ignoreRotation:!1});for(var r=[],a=0,o=e;a<o.length;a++){var i=o[a],s=i.x-.5,u=i.y-.5,c=n.ignoreRotation?0:t.rotation,l=Math.cos(c)*s-Math.sin(c)*u,p=Math.sin(c)*s+Math.cos(c)*u;l=l*t.width+t.xCenter,p=p*t.height+t.yCenter;var d=i.z*t.width,h=XS({},i);h.x=l,h.y=p,h.z=d,r.push(h)}return r}function bT(e,t){var n=function(e,t,n,r){var a=(r-n)/255;return{scale:a,offset:n-0*a}}(0,0,t[0],t[1]);return si((function(){return Bi(Wi(e,n.scale),n.offset)}))}function xT(e,t,n){var r,a,o,i,s,u,c,l,p,d,h,f,m=t.outputTensorSize,g=t.keepAspectRatio,v=t.borderMode,y=t.outputTensorFloatRange,b=cT(e),x=function(e,t){return t?{xCenter:t.xCenter*e.width,yCenter:t.yCenter*e.height,width:t.width*e.width,height:t.height*e.height,rotation:t.rotation}:{xCenter:.5*e.width,yCenter:.5*e.height,width:e.width,height:e.height,rotation:0}}(b,n),w=function(e,t,n){if(void 0===n&&(n=!1),!n)return{top:0,left:0,right:0,bottom:0};var r=t.height,a=t.width;hT(t,"targetSize"),hT(e,"roi");var o,i,s=r/a,u=e.height/e.width,c=0,l=0;return s>u?(o=e.width,i=e.width*s,l=(1-u/s)/2):(o=e.height/s,i=e.height,c=(1-s/u)/2),e.width=o,e.height=i,{top:l,left:c,right:c,bottom:l}}(x,m,g),k=(r=x,a=b.width,o=b.height,i=r.width,s=r.height,u=Math.cos(r.rotation),c=Math.sin(r.rotation),l=r.xCenter,p=r.yCenter,d=1/a,h=1/o,(f=new Array(16))[0]=i*u*1*d,f[1]=-s*c*d,f[2]=0,f[3]=(-.5*i*u*1+.5*s*c+l)*d,f[4]=i*c*1*h,f[5]=s*u*h,f[6]=0,f[7]=(-.5*s*u-.5*i*c*1+p)*h,f[8]=0,f[9]=0,f[10]=i*d,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,mT(f));return{imageTensor:si((function(){var t=pT(e),n=$s(dT(k,b,m),[1,8]),r="zero"===v?"constant":"nearest",a=Mu.transform(As(oi(t,"float32")),n,"bilinear",r,0,[m.height,m.width]);return null!=y?bT(a,y):a})),padding:w,transformationMatrix:k}}function wT(e,t,n,r){return 1===r?.5*(e+t):e+(t-e)*n/(r-1)}function kT(e){return null!=e&&null!=e.currentTime}function IT(e){for(var t={locationData:{relativeKeypoints:[]}},n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER,i=0;i<e.length;++i){var s=e[i];n=Math.min(n,s.x),r=Math.max(r,s.x),a=Math.min(a,s.y),o=Math.max(o,s.y),t.locationData.relativeKeypoints.push({x:s.x,y:s.y})}return t.locationData.relativeBoundingBox={xMin:n,yMin:a,xMax:r,yMax:o,width:r-n,height:o-a},t}function ST(e,t,n,r){return KS(this,void 0,void 0,(function(){var r,a,o,i,s;return YS(this,(function(u){switch(u.label){case 0:return e.sort((function(e,t){return Math.max.apply(Math,t.score)-Math.max.apply(Math,e.score)})),r=$s(e.map((function(e){return[e.locationData.relativeBoundingBox.yMin,e.locationData.relativeBoundingBox.xMin,e.locationData.relativeBoundingBox.yMax,e.locationData.relativeBoundingBox.xMax]}))),a=Zs(e.map((function(e){return e.score[0]}))),[4,Mu.nonMaxSuppressionAsync(r,a,t,n)];case 1:return[4,(o=u.sent()).array()];case 2:return i=u.sent(),s=e.filter((function(e,t){return i.indexOf(t)>-1})),ui([r,a,o]),[2,s]}}))}))}function TT(e,t){return e.map((function(e){var n=XS(XS({},e),{x:e.x*t.width,y:e.y*t.height});return null!=e.z&&(n.z=e.z*t.width),n}))}function _T(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s,u,c,l,p,d,h,f,m,g,v,y,b,x,w,k,I,S,T,_;return YS(this,(function(C){switch(C.label){case 0:if(r=Ys(t,[0]),a=r.shape,o=a[0],i=a[1],s=a[2],e.length!==s)throw new Error("Expected heatmap to have same number of channels as the number of landmarks. But got landmarks length: "+e.length+", heatmap length: "+s);return u=[],[4,r.buffer()];case 1:for(c=C.sent(),l=0;l<e.length;l++)if(p=e[l],d=XS({},p),u.push(d),h=Math.trunc(d.x*i),f=Math.trunc(d.y*o),!(h<0||h>=i||f<0||h>=o)){for(m=Math.trunc((n.kernelSize-1)/2),g=Math.max(0,h-m),v=Math.min(i,h+m+1),y=Math.max(0,f-m),b=Math.min(o,f+m+1),x=0,w=0,k=0,I=0,S=y;S<b;++S)for(T=g;T<v;++T)_=c.get(S,T,l),x+=_,I=Math.max(I,_),w+=T*_,k+=S*_;I>=n.minConfidenceToRefine&&x>0&&(d.x=w/i/x,d.y=k/o/x)}return r.dispose(),[2,u]}}))}))}function CT(e,t){var n=t.left,r=t.top,a=t.left+t.right,o=t.top+t.bottom;return e.map((function(e){return XS(XS({},e),{x:(e.x-n)/(1-a),y:(e.y-r)/(1-o),z:e.z/(1-a)})}))}function NT(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s;return YS(this,(function(u){switch(u.label){case 0:return r=e[0],a=e[1],o=function(e,t,n){return si((function(){var r,a,o,i;n.reverseOutputOrder?(a=Ys(ss(e,[0,n.boxCoordOffset+0],[-1,1])),r=Ys(ss(e,[0,n.boxCoordOffset+1],[-1,1])),i=Ys(ss(e,[0,n.boxCoordOffset+2],[-1,1])),o=Ys(ss(e,[0,n.boxCoordOffset+3],[-1,1]))):(r=Ys(ss(e,[0,n.boxCoordOffset+0],[-1,1])),a=Ys(ss(e,[0,n.boxCoordOffset+1],[-1,1])),o=Ys(ss(e,[0,n.boxCoordOffset+2],[-1,1])),i=Ys(ss(e,[0,n.boxCoordOffset+3],[-1,1]))),a=Bi(Wi(Vi(a,n.xScale),t.w),t.x),r=Bi(Wi(Vi(r,n.yScale),t.h),t.y),n.applyExponentialOnBoxSize?(o=Wi(Rs(Vi(o,n.hScale)),t.h),i=Wi(Rs(Vi(i,n.wScale)),t.w)):(o=Wi(Vi(o,n.hScale),t.h),i=Wi(Vi(i,n.wScale),t.h));var s=Ls(r,Vi(o,2)),u=Ls(a,Vi(i,2)),c=Bi(r,Vi(o,2)),l=Bi(a,Vi(i,2)),p=os([rs(s,[n.numBoxes,1]),rs(u,[n.numBoxes,1]),rs(c,[n.numBoxes,1]),rs(l,[n.numBoxes,1])],1);if(n.numKeypoints)for(var d=0;d<n.numKeypoints;++d){var h=n.keypointCoordOffset+d*n.numValuesPerKeypoint,f=void 0,m=void 0;n.reverseOutputOrder?(f=Ys(ss(e,[0,h],[-1,1])),m=Ys(ss(e,[0,h+1],[-1,1]))):(m=Ys(ss(e,[0,h],[-1,1])),f=Ys(ss(e,[0,h+1],[-1,1])));var g=Bi(Wi(Vi(f,n.xScale),t.w),t.x),v=Bi(Wi(Vi(m,n.yScale),t.h),t.y);p=os([p,rs(g,[n.numBoxes,1]),rs(v,[n.numBoxes,1])],1)}return p}))}(a,t,n),i=si((function(){var e=r;return n.sigmoidScore?(null!=n.scoreClippingThresh&&(e=ds(r,-n.scoreClippingThresh,n.scoreClippingThresh)),e=is(e)):e})),[4,ET(o,i,n)];case 1:return s=u.sent(),ui([o,i]),[2,s]}}))}))}function ET(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s,u,c,l,p,d,h,f;return YS(this,(function(m){switch(m.label){case 0:return r=[],[4,e.data()];case 1:return a=m.sent(),[4,t.data()];case 2:for(o=m.sent(),i=0;i<n.numBoxes;++i)if(!(null!=n.minScoreThresh&&o[i]<n.minScoreThresh||(s=i*n.numCoords,u=RT(a[s+0],a[s+1],a[s+2],a[s+3],o[i],n.flipVertically,i),(c=u.locationData.relativeBoundingBox).width<0||c.height<0))){if(n.numKeypoints>0)for((l=u.locationData).relativeKeypoints=[],p=n.numKeypoints*n.numValuesPerKeypoint,d=0;d<p;d+=n.numValuesPerKeypoint)h=s+n.keypointCoordOffset+d,f={x:a[h+0],y:n.flipVertically?1-a[h+1]:a[h+1]},l.relativeKeypoints.push(f);r.push(u)}return[2,r]}}))}))}function RT(e,t,n,r,a,o,i){return{score:[a],ind:i,locationData:{relativeBoundingBox:{xMin:t,yMin:o?1-n:e,xMax:r,yMax:o?1-e:n,width:r-t,height:n-e}}}}function AT(e,t){return"none"===e?t:function(e){return 1/(1+Math.exp(-e))}(t)}function OT(e,t,n,r){return KS(this,void 0,void 0,(function(){var a,o,i,s,u,c,l,p;return YS(this,(function(d){switch(d.label){case 0:return n=n||t.flipHorizontally||!1,r=r||t.flipVertically||!1,a=e.size,o=a/t.numLandmarks,[4,e.data()];case 1:for(i=d.sent(),s=[],u=0;u<t.numLandmarks;++u)c=u*o,(p={x:0,y:0}).x=n?t.inputImageWidth-i[c]:i[c],o>1&&(p.y=r?t.inputImageHeight-i[c+1]:i[c+1]),o>2&&(p.z=i[c+2]),o>3&&(p.score=AT(t.visibilityActivation,i[c+3])),s.push(p);for(l=0;l<s.length;++l)(p=s[l]).x=p.x/t.inputImageWidth,p.y=p.y/t.inputImageHeight,p.z=p.z/t.inputImageWidth/(t.normalizeZ||1);return[2,s]}}))}))}function MT(e,t,n){var r=e.width,a=e.height,o=e.rotation;if(null==n.rotation&&null==n.rotationDegree||(o=function(e,t){return null!=t.rotation?e+=t.rotation:null!=t.rotationDegree&&(e+=Math.PI*t.rotationDegree/180),lT(e)}(o,n)),0===o)e.xCenter=e.xCenter+r*n.shiftX,e.yCenter=e.yCenter+a*n.shiftY;else{var i=(t.width*r*n.shiftX*Math.cos(o)-t.height*a*n.shiftY*Math.sin(o))/t.width,s=(t.width*r*n.shiftX*Math.sin(o)+t.height*a*n.shiftY*Math.cos(o))/t.height;e.xCenter=e.xCenter+i,e.yCenter=e.yCenter+s}if(n.squareLong){var u=Math.max(r*t.width,a*t.height);r=u/t.width,a=u/t.height}else if(n.squareShort){var c=Math.min(r*t.width,a*t.height);r=c/t.width,a=c/t.height}return e.width=r*n.scaleX,e.height=a*n.scaleY,e}var FT=function(){function e(e){this.alpha=e,this.initialized=!1}return e.prototype.apply=function(e,t){var n;return this.initialized?n=null==t?this.storedValue+this.alpha*(e-this.storedValue):this.storedValue+this.alpha*t*Math.asinh((e-this.storedValue)/t):(n=e,this.initialized=!0),this.rawValue=e,this.storedValue=n,n},e.prototype.applyWithAlpha=function(e,t,n){return this.alpha=t,this.apply(e,n)},e.prototype.hasLastRawValue=function(){return this.initialized},e.prototype.lastRawValue=function(){return this.rawValue},e.prototype.reset=function(){this.initialized=!1},e}(),DT=function(){function e(e){this.frequency=e.frequency,this.minCutOff=e.minCutOff,this.beta=e.beta,this.thresholdCutOff=e.thresholdCutOff,this.thresholdBeta=e.thresholdBeta,this.derivateCutOff=e.derivateCutOff,this.x=new FT(this.getAlpha(this.minCutOff)),this.dx=new FT(this.getAlpha(this.derivateCutOff)),this.lastTimestamp=0}return e.prototype.apply=function(e,t,n){if(null==e)return e;var r=Math.trunc(t);if(this.lastTimestamp>=r)return e;0!==this.lastTimestamp&&0!==r&&(this.frequency=1/(1e-6*(r-this.lastTimestamp))),this.lastTimestamp=r;var a=this.x.hasLastRawValue()?(e-this.x.lastRawValue())*n*this.frequency:0,o=this.dx.applyWithAlpha(a,this.getAlpha(this.derivateCutOff)),i=this.minCutOff+this.beta*Math.abs(o),s=null!=this.thresholdCutOff?this.thresholdCutOff+this.thresholdBeta*Math.abs(o):null;return this.x.applyWithAlpha(e,this.getAlpha(i),s)},e.prototype.getAlpha=function(e){return 1/(1+this.frequency/(2*Math.PI*e))},e}(),PT=function(){function e(e){this.config=e}return e.prototype.apply=function(e,t,n){var r=this;if(null==e)return this.reset(),null;this.initializeFiltersIfEmpty(e);var a=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return QS(e);a=1/n}return e.map((function(e,n){var o=XS(XS({},e),{x:r.xFilters[n].apply(e.x,t,a),y:r.yFilters[n].apply(e.y,t,a)});return null!=e.z&&(o.z=r.zFilters[n].apply(e.z,t,a)),o}))},e.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},e.prototype.initializeFiltersIfEmpty=function(e){var t=this;null!=this.xFilters&&this.xFilters.length===e.length||(this.xFilters=e.map((function(e){return new DT(t.config)})),this.yFilters=e.map((function(e){return new DT(t.config)})),this.zFilters=e.map((function(e){return new DT(t.config)})))},e}(),LT=function(){function e(e){this.config=e,this.window=[],this.lowPassFilter=new FT(1),this.lastValue=0,this.lastValueScale=1,this.lastTimestamp=-1}return e.prototype.apply=function(e,t,n){if(null==e)return e;var r,a=Math.trunc(t);if(this.lastTimestamp>=a)return e;if(-1===this.lastTimestamp)r=1;else{for(var o=e*n-this.lastValue*this.lastValueScale,i=a-this.lastTimestamp,s=o,u=i,c=(1+this.window.length)*(1e6/30),l=0,p=this.window;l<p.length;l++){var d=p[l];if(u+d.duration>c)break;s+=d.distance,u+=d.duration}var h=s/(1e-6*u);r=1-1/(1+this.config.velocityScale*Math.abs(h)),this.window.unshift({distance:o,duration:i}),this.window.length>this.config.windowSize&&this.window.pop()}return this.lastValue=e,this.lastValueScale=n,this.lastTimestamp=a,this.lowPassFilter.applyWithAlpha(e,r)},e}(),BT=function(){function e(e){this.config=e}return e.prototype.apply=function(e,t,n){var r=this;if(null==e)return this.reset(),null;var a=1;if(!this.config.disableValueScaling){if(n<this.config.minAllowedObjectScale)return QS(e);a=1/n}return this.initializeFiltersIfEmpty(e),e.map((function(e,n){var o=XS(XS({},e),{x:r.xFilters[n].apply(e.x,t,a),y:r.yFilters[n].apply(e.y,t,a)});return null!=e.z&&(o.z=r.zFilters[n].apply(e.z,t,a)),o}))},e.prototype.reset=function(){this.xFilters=null,this.yFilters=null,this.zFilters=null},e.prototype.initializeFiltersIfEmpty=function(e){var t=this;null!=this.xFilters&&this.xFilters.length===e.length||(this.xFilters=e.map((function(e){return new LT(t.config)})),this.yFilters=e.map((function(e){return new LT(t.config)})),this.zFilters=e.map((function(e){return new LT(t.config)})))},e}(),UT=function(){function e(e){if(null!=e.velocityFilter)this.keypointsFilter=new BT(e.velocityFilter);else{if(null==e.oneEuroFilter)throw new Error("Either configure velocityFilter or oneEuroFilter, but got "+e+".");this.keypointsFilter=new PT(e.oneEuroFilter)}}return e.prototype.apply=function(e,t,n,r,a){if(void 0===r&&(r=!1),null==e)return this.keypointsFilter.reset(),null;var o=null!=a?function(e,t){return(e.width*t.width+e.height*t.height)/2}(a,n):1,i=r?TT(e,n):e,s=this.keypointsFilter.apply(i,t,o);return r?function(e,t){return e.map((function(e){var n=XS(XS({},e),{x:e.x/t.width,y:e.y/t.height});return null!=e.z&&(e.z=e.z/t.width),n}))}(s,n):s},e}(),VT=function(){function e(e){this.alpha=e.alpha}return e.prototype.apply=function(e){var t=this;if(null==e)return this.visibilityFilters=null,null;null!=this.visibilityFilters&&this.visibilityFilters.length===e.length||(this.visibilityFilters=e.map((function(e){return new FT(t.alpha)})));for(var n=[],r=0;r<e.length;++r){var a=e[r],o=XS({},a);o.score=this.visibilityFilters[r].apply(a.score),n.push(o)}return n},e}(),WT={reduceBoxesInLowestlayer:!1,interpolatedScaleAspectRatio:1,featureMapHeight:[],featureMapWidth:[],numLayers:5,minScale:.1484375,maxScale:.75,inputSizeHeight:224,inputSizeWidth:224,anchorOffsetX:.5,anchorOffsetY:.5,strides:[8,16,32,32,32],aspectRatios:[1],fixedAnchorSize:!0},zT={runtime:"tfjs",modelType:"full",enableSmoothing:!0,enableSegmentation:!1,smoothSegmentation:!0,detectorModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/detector/1",landmarkModelUrl:"https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"},GT={maxPoses:1,flipHorizontal:!1},jT={applyExponentialOnBoxSize:!1,flipVertically:!1,ignoreClasses:[],numClasses:1,numBoxes:2254,numCoords:12,boxCoordOffset:0,keypointCoordOffset:4,numKeypoints:4,numValuesPerKeypoint:2,sigmoidScore:!0,scoreClippingThresh:100,reverseOutputOrder:!0,xScale:224,yScale:224,hScale:224,wScale:224,minScoreThresh:.5},HT={shiftX:0,shiftY:0,scaleX:1.25,scaleY:1.25,squareLong:!0},qT={outputTensorSize:{width:224,height:224},keepAspectRatio:!0,outputTensorFloatRange:[-1,1],borderMode:"zero"},XT={outputTensorSize:{width:256,height:256},keepAspectRatio:!0,outputTensorFloatRange:[0,1],borderMode:"zero"},KT={numLandmarks:39,inputImageWidth:256,inputImageHeight:256,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},YT={numLandmarks:39,inputImageWidth:1,inputImageHeight:1,visibilityActivation:"sigmoid",flipHorizontally:!1,flipVertically:!1},QT={kernelSize:7,minConfidenceToRefine:.5},JT={alpha:.1},ZT={oneEuroFilter:{frequency:30,minCutOff:.05,beta:80,derivateCutOff:1,minAllowedObjectScale:1e-6}},$T={oneEuroFilter:{frequency:30,minCutOff:.01,beta:10,derivateCutOff:1,minAllowedObjectScale:1e-6}},e_={oneEuroFilter:{frequency:30,minCutOff:.1,beta:40,derivateCutOff:1,minAllowedObjectScale:1e-6,disableValueScaling:!0}},t_={activation:"none"},n_={combineWithPreviousRatio:.7},r_=function(){function e(e){this.mask=e}return e.prototype.toCanvasImageSource=function(){return KS(this,void 0,void 0,(function(){return YS(this,(function(e){return[2,eT(this.mask)]}))}))},e.prototype.toImageData=function(){return KS(this,void 0,void 0,(function(){return YS(this,(function(e){return[2,tT(this.mask)]}))}))},e.prototype.toTensor=function(){return KS(this,void 0,void 0,(function(){return YS(this,(function(e){return[2,this.mask]}))}))},e.prototype.getUnderlyingType=function(){return"tensor"},e}();function a_(e){return rT(e),"person"}var o_=function(){function e(e,t,n,r,a,o){this.detectorModel=e,this.landmarkModel=t,this.enableSmoothing=n,this.enableSegmentation=r,this.smoothSegmentation=a,this.modelType=o,this.regionOfInterest=null,this.prevFilteredSegmentationMask=null,this.anchors=function(e){null==e.reduceBoxesInLowestLayer&&(e.reduceBoxesInLowestLayer=!1),null==e.interpolatedScaleAspectRatio&&(e.interpolatedScaleAspectRatio=1),null==e.fixedAnchorSize&&(e.fixedAnchorSize=!1);for(var t=[],n=0;n<e.numLayers;){for(var r=[],a=[],o=[],i=[],s=n;s<e.strides.length&&e.strides[s]===e.strides[n];){var u=wT(e.minScale,e.maxScale,s,e.strides.length);if(0===s&&e.reduceBoxesInLowestLayer)o.push(1),o.push(2),o.push(.5),i.push(.1),i.push(u),i.push(u);else{for(var c=0;c<e.aspectRatios.length;++c)o.push(e.aspectRatios[c]),i.push(u);if(e.interpolatedScaleAspectRatio>0){var l=s===e.strides.length-1?1:wT(e.minScale,e.maxScale,s+1,e.strides.length);i.push(Math.sqrt(u*l)),o.push(e.interpolatedScaleAspectRatio)}}s++}for(var p=0;p<o.length;++p){var d=Math.sqrt(o[p]);r.push(i[p]/d),a.push(i[p]*d)}var h=0,f=0;if(e.featureMapHeight.length>0)h=e.featureMapHeight[n],f=e.featureMapWidth[n];else{var m=e.strides[n];h=Math.ceil(e.inputSizeHeight/m),f=Math.ceil(e.inputSizeWidth/m)}for(var g=0;g<h;++g)for(var v=0;v<f;++v)for(var y=0;y<r.length;++y){var b={xCenter:(v+e.anchorOffsetX)/f,yCenter:(g+e.anchorOffsetY)/h,width:0,height:0};e.fixedAnchorSize?(b.width=1,b.height=1):(b.width=a[y],b.height=r[y]),t.push(b)}n=s}return t}(WT);var i=Zs(this.anchors.map((function(e){return e.width}))),s=Zs(this.anchors.map((function(e){return e.height}))),u=Zs(this.anchors.map((function(e){return e.xCenter}))),c=Zs(this.anchors.map((function(e){return e.yCenter})));this.anchorTensor={x:u,y:c,w:i,h:s},this.prevFilteredSegmentationMask=this.enableSegmentation?$s([],[0,0]):null}return e.prototype.estimatePoses=function(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s,u,c,l,p,d,h,f,m,g,v,y,b,x,w,k,I,S,T;return YS(this,(function(_){switch(_.label){case 0:return r=function(e){var t;if(null==(t=null==e?GT:XS({},e)).maxPoses&&(t.maxPoses=1),t.maxPoses<=0)throw new Error("Invalid maxPoses "+t.maxPoses+". Should be > 0.");if(t.maxPoses>1)throw new Error("Multi-pose detection is not implemented yet. Please set maxPoses to 1.");return t}(t),null==e?(this.reset(),[2,[]]):(this.maxPoses=r.maxPoses,this.timestamp=null!=n?1e3*n:kT(e)?1e6*e.currentTime:null,a=cT(e),o=si((function(){return oi(pT(e),"float32")})),null!=(i=this.regionOfInterest)?[3,2]:[4,this.detectPose(o)]);case 1:if(0===(s=_.sent()).length)return this.reset(),o.dispose(),[2,[]];u=s[0],i=this.poseDetectionToRoi(u,a),_.label=2;case 2:return[4,this.poseLandmarksByRoi(i,o)];case 3:return c=_.sent(),o.dispose(),null==c?(this.reset(),[2,[]]):(l=c.landmarks,p=c.auxiliaryLandmarks,d=c.poseScore,h=c.worldLandmarks,f=c.segmentationMask,m=this.poseLandmarkFiltering(l,p,h,a),g=m.actualLandmarksFiltered,v=m.auxiliaryLandmarksFiltered,y=m.actualWorldLandmarksFiltered,b=this.poseLandmarksToRoi(v,a),this.regionOfInterest=b,x=this.smoothSegmentation&&null!=f?this.poseSegmentationFiltering(f):f,null!=(w=null!=g?TT(g,a):null)&&w.forEach((function(e,t){e.name=ZS[t]})),null!=(k=y)&&k.forEach((function(e,t){e.name=ZS[t]})),I={score:d,keypoints:w,keypoints3D:k},null!==x&&(S=si((function(){var e=As(x,2),t=Ws(e,[[0,0],[0,0],[0,1]]);return Vs(t,[[0,0],[0,0],[0,2]],"symmetric")})),this.smoothSegmentation||ui(x),T={maskValueToLabel:a_,mask:new r_(S)},I.segmentation=T),[2,[I]])}}))}))},e.prototype.poseSegmentationFiltering=function(e){var t=this.prevFilteredSegmentationMask;return 0===t.size?this.prevFilteredSegmentationMask=e:(this.prevFilteredSegmentationMask=function(e,t,n){return"webgl"===pi()?function(e,t,n){var r=n.combineWithPreviousRatio.toFixed(2),a={variableNames:["prevMask","newMask"],outputShape:e.shape,userCode:"\n  void main() {\n      ivec2 coords = getOutputCoords();\n      int height = coords[0];\n      int width = coords[1];\n\n      float prevMaskValue = getPrevMask(height, width);\n      float newMaskValue = getNewMask(height, width);\n\n      /*\n      * Assume p := newMaskValue\n      * H(p) := 1 + (p * log(p) + (1-p) * log(1-p)) / log(2)\n      * uncertainty alpha(p) =\n      *   Clamp(1 - (1 - H(p)) * (1 - H(p)), 0, 1) [squaring the\n      * uncertainty]\n      *\n      * The following polynomial approximates uncertainty alpha as a\n      * function of (p + 0.5):\n      */\n      const float c1 = 5.68842;\n      const float c2 = -0.748699;\n      const float c3 = -57.8051;\n      const float c4 = 291.309;\n      const float c5 = -624.717;\n      float t = newMaskValue - 0.5;\n      float x = t * t;\n\n      float uncertainty =\n        1.0 - min(1.0, x * (c1 + x * (c2 + x * (c3 + x * (c4 + x * c5)))));\n\n      float outputValue = newMaskValue + (prevMaskValue - newMaskValue) *\n                             (uncertainty * "+r+");\n\n      setOutput(outputValue);\n    }\n"},o=Br.backend;return si((function(){var n=o.compileAndRun(a,[e,t]);return ii().makeTensorFromDataId(n.dataId,n.shape,n.dtype)}))}(e,t,n):si((function(){var r=Ls(t,.5),a=Ns(r),o=Ls(1,Us(1,Wi(a,Bi(5.68842,Wi(a,Bi(-.748699,Wi(a,Bi(-57.8051,Wi(a,Bi(291.309,Wi(a,-624.717)))))))))));return Bi(t,Wi(Ls(e,t),Wi(o,n.combineWithPreviousRatio)))}))}(t,e,n_),ui(e)),ui(t),this.prevFilteredSegmentationMask},e.prototype.dispose=function(){this.detectorModel.dispose(),this.landmarkModel.dispose(),ui([this.anchorTensor.x,this.anchorTensor.y,this.anchorTensor.w,this.anchorTensor.h,this.prevFilteredSegmentationMask])},e.prototype.reset=function(){this.regionOfInterest=null,this.enableSegmentation&&(ui(this.prevFilteredSegmentationMask),this.prevFilteredSegmentationMask=$s([],[0,0])),this.visibilitySmoothingFilterActual=null,this.visibilitySmoothingFilterAuxiliary=null,this.landmarksSmoothingFilterActual=null,this.landmarksSmoothingFilterAuxiliary=null},e.prototype.detectPose=function(e){return KS(this,void 0,void 0,(function(){var t,n,r,a,o,i,s,u,c,l;return YS(this,(function(p){switch(p.label){case 0:return t=xT(e,qT),n=t.imageTensor,r=t.padding,a=this.detectorModel.predict(n),o=function(e){return si((function(){var t=function(e){return si((function(){return[ss(e,[0,0,0],[1,-1,1]),ss(e,[0,0,1],[1,-1,-1])]}))}(e),n=t[0],r=t[1];return{boxes:Ys(r),logits:Ys(n)}}))}(a),i=o.boxes,[4,NT([s=o.logits,i],this.anchorTensor,jT)];case 1:return 0===(u=p.sent()).length?(ui([n,a,s,i]),[2,u]):[4,ST(u,this.maxPoses,.3)];case 2:return c=p.sent(),l=function(e,t){void 0===e&&(e=[]);for(var n=t.left,r=t.top,a=t.left+t.right,o=t.top+t.bottom,i=0;i<e.length;i++){var s=e[i],u=s.locationData.relativeBoundingBox,c=(u.xMin-n)/(1-a),l=(u.yMin-r)/(1-o),p=u.width/(1-a),d=u.height/(1-o);u.xMin=c,u.yMin=l,u.width=p,u.height=d,u.xMax=c+p,u.yMax=l+d;var h=s.locationData.relativeKeypoints;h&&h.forEach((function(e){var t=(e.x-n)/(1-a),i=(e.y-r)/(1-o);e.x=t,e.y=i}))}return e}(c,r),ui([n,a,s,i]),[2,l]}}))}))},e.prototype.poseDetectionToRoi=function(e,t){return MT(fT(e,t,{rotationVectorEndKeypointIndex:1,rotationVectorStartKeypointIndex:0,rotationVectorTargetAngleDegree:90}),t,HT)},e.prototype.poseLandmarksByRoi=function(e,t){return KS(this,void 0,void 0,(function(){var n,r,a,o,i,s,u,c,l,p,d,h,f,m;return YS(this,(function(g){switch(g.label){case 0:if(n=cT(t),r=xT(t,XT,e),a=r.imageTensor,o=r.padding,i=r.transformationMatrix,"lite"!==this.modelType&&"full"!==this.modelType&&"heavy"!==this.modelType)throw new Error("Model type must be one of lite, full or heavy,but got "+this.modelType);return s=["ld_3d","output_poseflag","activation_heatmap","world_3d"],this.enableSegmentation&&s.push("activation_segmentation"),u=this.landmarkModel.execute(a,s),[4,this.tensorsToPoseLandmarksAndSegmentation(u)];case 1:return null==(c=g.sent())?(ui(u),ui(a),[2,null]):(l=c.landmarks,p=c.auxiliaryLandmarks,d=c.poseScore,h=c.worldLandmarks,f=c.segmentationMask,[4,this.poseLandmarksAndSegmentationInverseProjection(n,e,o,i,l,p,h,f)]);case 2:return m=g.sent(),ui(u),ui(a),[2,XS({poseScore:d},m)]}}))}))},e.prototype.poseLandmarksAndSegmentationInverseProjection=function(e,t,n,r,a,o,i,s){return KS(this,void 0,void 0,(function(){var u,c,l,p,d,h;return YS(this,(function(f){return u=CT(a,n),c=CT(o,n),l=yT(u,t),p=yT(c,t),d=function(e,t){for(var n=[],r=0,a=e;r<a.length;r++){var o=a[r],i=o.x,s=o.y,u=t.rotation,c=Math.cos(u)*i-Math.sin(u)*s,l=Math.sin(u)*i+Math.cos(u)*s,p=XS({},o);p.x=c,p.y=l,n.push(p)}return n}(i,t),h=null,this.enableSegmentation&&(h=si((function(){var t=s.shape,n=t[0],a=t[1],o=$s(dT(function(e){var t=mT(new Array(16).fill(0));t[0][0]=vT(e,0,0),t[1][0]=-vT(e,0,1),t[2][0]=vT(e,0,2),t[3][0]=-vT(e,0,3),t[0][2]=vT(e,2,0),t[1][2]=-vT(e,2,1),t[2][2]=vT(e,2,2),t[3][2]=-vT(e,2,3),t[0][1]=-vT(e,1,0),t[1][1]=vT(e,1,1),t[2][1]=-vT(e,1,2),t[3][1]=vT(e,1,3),t[0][3]=-vT(e,3,0),t[1][3]=vT(e,3,1),t[2][3]=-vT(e,3,2),t[3][3]=vT(e,3,3);for(var n=e[0][0]*t[0][0]+e[1][0]*t[0][1]+e[2][0]*t[0][2]+e[3][0]*t[0][3],r=0;r<t.length;r++)for(var a=0;a<t.length;a++)t[r][a]/=n;return t}(r),{width:a,height:n},e),[1,8]),i=[1,n,a,1];return Ys(Mu.transform(rs(s,i),o,"bilinear","constant",0,[e.height,e.width]),[0,3])})),ui(s)),[2,{landmarks:l,auxiliaryLandmarks:p,worldLandmarks:d,segmentationMask:h}]}))}))},e.prototype.tensorsToPoseLandmarksAndSegmentation=function(e){return KS(this,void 0,void 0,(function(){var t,n,r,a,o,i,s,u,c,l,p,d,h;return YS(this,(function(f){switch(f.label){case 0:return t=e[0],n=e[1],r=e[2],a=e[3],o=this.enableSegmentation?e[4]:null,[4,n.data()];case 1:return(i=f.sent()[0])<.5?[2,null]:[4,OT(t,KT)];case 2:return[4,_T(f.sent(),r,QT)];case 3:return s=f.sent(),u=s.slice(0,33),c=s.slice(33,35),[4,OT(a,YT)];case 4:return l=f.sent(),p=l.slice(0,33),d=function(e,t,n){void 0===n&&(n=!0);for(var r=[],a=0;a<e.length;a++){var o=XS({},t[a]);n&&(o.score=e[a].score),r.push(o)}return r}(u,p,!0),h=this.enableSegmentation?function(e,t,n){return si((function(){var n=Ys(e,[0]),r=n.shape[2];if(1===r){var a=n;switch(t.activation){case"none":break;case"sigmoid":a=is(a);break;case"softmax":throw new Error("Softmax activation requires two channels.");default:throw new Error("Activation not supported ("+t.activation+")")}return Ys(a,[2])}throw new Error("Unsupported number of tensor channels "+r)}))}(o,t_):null,[2,{landmarks:u,auxiliaryLandmarks:c,poseScore:i,worldLandmarks:d,segmentationMask:h}]}}))}))},e.prototype.poseLandmarksToRoi=function(e,t){return MT(fT(IT(e),t,{rotationVectorStartKeypointIndex:0,rotationVectorEndKeypointIndex:1,rotationVectorTargetAngleDegree:90}),t,HT)},e.prototype.poseLandmarkFiltering=function(e,t,n,r){var a,o,i;if(null!=this.timestamp&&this.enableSmoothing){var s=fT(IT(t),r,{rotationVectorEndKeypointIndex:0,rotationVectorStartKeypointIndex:1,rotationVectorTargetAngleDegree:90});null==this.visibilitySmoothingFilterActual&&(this.visibilitySmoothingFilterActual=new VT(JT)),a=this.visibilitySmoothingFilterActual.apply(e),null==this.visibilitySmoothingFilterAuxiliary&&(this.visibilitySmoothingFilterAuxiliary=new VT(JT)),o=this.visibilitySmoothingFilterAuxiliary.apply(t),i=this.visibilitySmoothingFilterActual.apply(n),null==this.landmarksSmoothingFilterActual&&(this.landmarksSmoothingFilterActual=new UT(ZT)),a=this.landmarksSmoothingFilterActual.apply(a,this.timestamp,r,!0,s),null==this.landmarksSmoothingFilterAuxiliary&&(this.landmarksSmoothingFilterAuxiliary=new UT($T)),o=this.landmarksSmoothingFilterAuxiliary.apply(o,this.timestamp,r,!0,s),null==this.worldLandmarksSmoothingFilterActual&&(this.worldLandmarksSmoothingFilterActual=new UT(e_)),i=this.worldLandmarksSmoothingFilterActual.apply(n,this.timestamp)}else a=e,o=t,i=n;return{actualLandmarksFiltered:a,auxiliaryLandmarksFiltered:o,actualWorldLandmarksFiltered:i}},e}();function i_(e){return KS(this,void 0,void 0,(function(){var t,n,r,a,o,i;return YS(this,(function(s){switch(s.label){case 0:return t=function(e){var t=XS({},null==e?zT:e);if(null==t.enableSmoothing&&(t.enableSmoothing=zT.enableSmoothing),null==t.enableSegmentation&&(t.enableSegmentation=zT.enableSegmentation),null==t.smoothSegmentation&&(t.smoothSegmentation=zT.smoothSegmentation),null==t.modelType&&(t.modelType=zT.modelType),null==t.detectorModelUrl&&(t.detectorModelUrl=zT.detectorModelUrl),null==t.landmarkModelUrl)switch(t.modelType){case"lite":t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/lite/2";break;case"heavy":t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/heavy/2";break;default:t.landmarkModelUrl="https://tfhub.dev/mediapipe/tfjs-model/blazepose_3d/landmark/full/2"}return t}(e),n="string"==typeof t.detectorModelUrl&&t.detectorModelUrl.indexOf("https://tfhub.dev")>-1,r="string"==typeof t.landmarkModelUrl&&t.landmarkModelUrl.indexOf("https://tfhub.dev")>-1,[4,Promise.all([zS(t.detectorModelUrl,{fromTFHub:n}),zS(t.landmarkModelUrl,{fromTFHub:r})])];case 1:return a=s.sent(),o=a[0],i=a[1],[2,new o_(o,i,t.enableSmoothing,t.enableSegmentation,t.smoothSegmentation,t.modelType)]}}))}))}var s_,u_,c_,l_=function(){function e(e){!function(e){if(e.maxTracks<1)throw new Error("Must specify 'maxTracks' to be at least 1, but encountered "+e.maxTracks);if(e.maxAge<=0)throw new Error("Must specify 'maxAge' to be positive, but encountered "+e.maxAge);if(void 0!==e.keypointTrackerParams){if(e.keypointTrackerParams.keypointConfidenceThreshold<0||e.keypointTrackerParams.keypointConfidenceThreshold>1)throw new Error("Must specify 'keypointConfidenceThreshold' to be in the range [0, 1], but encountered "+e.keypointTrackerParams.keypointConfidenceThreshold);if(e.keypointTrackerParams.minNumberOfKeypoints<1)throw new Error("Must specify 'minNumberOfKeypoints' to be at least 1, but encountered "+e.keypointTrackerParams.minNumberOfKeypoints);for(var t=0,n=e.keypointTrackerParams.keypointFalloff;t<n.length;t++){var r=n[t];if(r<=0)throw new Error("Must specify each keypoint falloff parameterto be positive but encountered "+r)}}}(e),this.tracks=[],this.maxTracks=e.maxTracks,this.maxAge=1e3*e.maxAge,this.minSimilarity=e.minSimilarity,this.nextID=1}return e.prototype.apply=function(e,t){this.filterOldTracks(t);var n=this.computeSimilarity(e);return this.assignTracks(e,n,t),this.updateTracks(t),e},e.prototype.getTracks=function(){return this.tracks.slice()},e.prototype.getTrackIDs=function(){return new Set(this.tracks.map((function(e){return e.id})))},e.prototype.filterOldTracks=function(e){var t=this;this.tracks=this.tracks.filter((function(n){return e-n.lastTimestamp<=t.maxAge}))},e.prototype.assignTracks=function(e,t,n){for(var r=Array.from(Array(t[0].length).keys()),a=[],o=0,i=Array.from(Array(e.length).keys());o<i.length;o++){var s=i[o];if(0!==r.length){for(var u=-1,c=-1,l=0,p=r;l<p.length;l++){var d=p[l],h=t[s][d];h>=this.minSimilarity&&h>c&&(u=d,c=h)}if(u>=0){var f=this.tracks[u];f=Object.assign(f,this.createTrack(e[s],n,f.id)),e[s].id=f.id;var m=r.indexOf(u);r.splice(m,1)}else a.push(s)}else a.push(s)}for(var g=0,v=a;g<v.length;g++){s=v[g];var y=this.createTrack(e[s],n);this.tracks.push(y),e[s].id=y.id}},e.prototype.updateTracks=function(e){this.tracks.sort((function(e,t){return t.lastTimestamp-e.lastTimestamp})),this.tracks=this.tracks.slice(0,this.maxTracks)},e.prototype.createTrack=function(e,t,n){var r={id:n||this.nextTrackID(),lastTimestamp:t,keypoints:QS(e.keypoints).map((function(e){return XS({},e)}))};return void 0!==e.box&&(r.box=XS({},e.box)),r},e.prototype.nextTrackID=function(){var e=this.nextID;return this.nextID+=1,e},e.prototype.remove=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.tracks=this.tracks.filter((function(t){return!e.includes(t.id)}))},e.prototype.reset=function(){this.tracks=[]},e}(),p_=function(e){function t(t){return e.call(this,t)||this}return qS(t,e),t.prototype.computeSimilarity=function(e){var t=this;return 0===e.length||0===this.tracks.length?[[]]:e.map((function(e){return t.tracks.map((function(n){return t.iou(e,n)}))}))},t.prototype.iou=function(e,t){var n=Math.max(e.box.xMin,t.box.xMin),r=Math.max(e.box.yMin,t.box.yMin),a=Math.min(e.box.xMax,t.box.xMax),o=Math.min(e.box.yMax,t.box.yMax);if(n>=a||r>=o)return 0;var i=(a-n)*(o-r);return i/(e.box.width*e.box.height+t.box.width*t.box.height-i)},t}(l_),d_=function(e){function t(t){var n=e.call(this,t)||this;return n.keypointThreshold=t.keypointTrackerParams.keypointConfidenceThreshold,n.keypointFalloff=t.keypointTrackerParams.keypointFalloff,n.minNumKeyoints=t.keypointTrackerParams.minNumberOfKeypoints,n}return qS(t,e),t.prototype.computeSimilarity=function(e){if(0===e.length||0===this.tracks.length)return[[]];for(var t=[],n=0,r=e;n<r.length;n++){for(var a=r[n],o=[],i=0,s=this.tracks;i<s.length;i++){var u=s[i];o.push(this.oks(a,u))}t.push(o)}return t},t.prototype.oks=function(e,t){for(var n=this.area(t.keypoints)+1e-6,r=0,a=0,o=0;o<e.keypoints.length;++o){var i=e.keypoints[o],s=t.keypoints[o];if(!(i.score<this.keypointThreshold||s.score<this.keypointThreshold)){a+=1;var u=Math.pow(i.x-s.x,2)+Math.pow(i.y-s.y,2),c=2*this.keypointFalloff[o];r+=Math.exp(-1*u/(2*n*Math.pow(c,2)))}}return a<this.minNumKeyoints?0:r/a},t.prototype.area=function(e){var t=this,n=e.filter((function(e){return e.score>t.keypointThreshold})),r=Math.min.apply(Math,QS([1],n.map((function(e){return e.x})))),a=Math.max.apply(Math,QS([0],n.map((function(e){return e.x})))),o=Math.min.apply(Math,QS([1],n.map((function(e){return e.y}))));return(a-r)*(Math.max.apply(Math,QS([0],n.map((function(e){return e.y}))))-o)},t}(l_);(c_=s_||(s_={})).Keypoint="keypoint",c_.BoundingBox="boundingBox",function(e){e.MoveNet="MoveNet",e.BlazePose="BlazePose",e.PoseNet="PoseNet"}(u_||(u_={}));var h_=["SinglePose.Lightning","SinglePose.Thunder","MultiPose.Lightning"],f_={modelType:"SinglePose.Lightning",enableSmoothing:!0},m_={},g_={frequency:30,minCutOff:2.5,beta:300,derivateCutOff:2.5,thresholdCutOff:.5,thresholdBeta:5,disableValueScaling:!0},v_={maxTracks:18,maxAge:1e3,minSimilarity:.2,keypointTrackerParams:{keypointConfidenceThreshold:.3,keypointFalloff:[.026,.025,.025,.035,.035,.079,.079,.072,.072,.062,.062,.107,.107,.087,.087,.089,.089],minNumberOfKeypoints:4}},y_={maxTracks:18,maxAge:1e3,minSimilarity:.15,trackerParams:{}};function b_(e,t){var n,r,a,o;return e?t.width>t.height?(n=1,r=t.height/t.width,a=0,o=(t.width/2-t.height/2)/t.width):(n=t.width/t.height,r=1,a=(t.height/2-t.width/2)/t.height,o=0):t.width>t.height?(n=t.width/t.height,r=1,a=(t.height/2-t.width/2)/t.height,o=0):(n=1,r=t.height/t.width,a=0,o=(t.width/2-t.height/2)/t.width),{yMin:a,xMin:o,yMax:a+n,xMax:o+r,height:n,width:r}}function x_(e,t){var n={maxTracks:e.maxTracks,maxAge:e.maxAge,minSimilarity:e.minSimilarity};return null!=t.maxTracks&&(n.maxTracks=t.maxTracks),null!=t.maxAge&&(n.maxAge=t.maxAge),null!=t.minSimilarity&&(n.minSimilarity=t.minSimilarity),n}var w_=function(){function e(e,t){this.moveNetModel=e,this.modelInputResolution={height:0,width:0},this.keypointIndexByName=function(e){switch(e){case u_.BlazePose:return ZS.reduce((function(e,t,n){return e[t]=n,e}),{});case u_.PoseNet:case u_.MoveNet:return JS.reduce((function(e,t,n){return e[t]=n,e}),{});default:throw new Error("Model "+e+" is not supported.")}}(u_.MoveNet),"SinglePose.Lightning"===t.modelType?(this.modelInputResolution.width=192,this.modelInputResolution.height=192):"SinglePose.Thunder"===t.modelType&&(this.modelInputResolution.width=256,this.modelInputResolution.height=256),this.multiPoseModel="MultiPose.Lightning"===t.modelType,this.multiPoseModel||(this.keypointFilter=new PT(g_),this.cropRegionFilterYMin=new FT(.9),this.cropRegionFilterXMin=new FT(.9),this.cropRegionFilterYMax=new FT(.9),this.cropRegionFilterXMax=new FT(.9)),this.enableSmoothing=t.enableSmoothing,t.minPoseScore?this.minPoseScore=t.minPoseScore:this.minPoseScore=.25,t.multiPoseMaxDimension?this.multiPoseMaxDimension=t.multiPoseMaxDimension:this.multiPoseMaxDimension=256,this.enableTracking=t.enableTracking,this.multiPoseModel&&this.enableTracking&&(t.trackerType===s_.Keypoint?this.tracker=new d_(t.trackerConfig):t.trackerType===s_.BoundingBox&&(this.tracker=new p_(t.trackerConfig)),this.enableSmoothing&&(this.keypointFilterMap=new Map))}return e.prototype.runSinglePersonPoseModel=function(e){return KS(this,void 0,void 0,(function(){var t,n,r,a,o;return YS(this,(function(i){switch(i.label){case 0:if(4!==(t=this.moveNetModel.execute(e)).shape.length||1!==t.shape[0]||1!==t.shape[1]||17!==t.shape[2]||3!==t.shape[3])throw t.dispose(),new Error("Unexpected output shape from model: ["+t.shape+"]");return"webgpu"===pi()?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=i.sent(),i.label=3;case 3:for(t.dispose(),r={keypoints:[],score:0},a=0,o=0;o<17;++o)r.keypoints[o]={y:n[3*o],x:n[3*o+1],score:n[3*o+2]},r.keypoints[o].score>.2&&(++a,r.score+=r.keypoints[o].score);return a>0&&(r.score/=a),[2,r]}}))}))},e.prototype.runMultiPersonPoseModel=function(e){return KS(this,void 0,void 0,(function(){var t,n,r,a,o,i,s,u;return YS(this,(function(c){switch(c.label){case 0:if(3!==(t=this.moveNetModel.execute(e)).shape.length||1!==t.shape[0]||56!==t.shape[2])throw t.dispose(),new Error("Unexpected output shape from model: ["+t.shape+"]");return"webgpu"===pi()?[3,1]:(n=t.dataSync(),[3,3]);case 1:return[4,t.data()];case 2:n=c.sent(),c.label=3;case 3:for(t.dispose(),r=[],a=n.length/56,o=0;o<a;++o)for(r[o]={keypoints:[]},i=56*o+51,r[o].box={yMin:n[i],xMin:n[i+1],yMax:n[i+2],xMax:n[i+3],width:n[i+3]-n[i+1],height:n[i+2]-n[i]},s=56*o+55,r[o].score=n[s],r[o].keypoints=[],u=0;u<17;++u)r[o].keypoints[u]={y:n[56*o+3*u],x:n[56*o+3*u+1],score:n[56*o+3*u+2]};return[2,r]}}))}))},e.prototype.estimatePoses=function(e,t,n){return void 0===t&&(t=m_),KS(this,void 0,void 0,(function(){var r,a,o,i,s,u;return YS(this,(function(c){switch(c.label){case 0:return t=function(e){return null==e?m_:XS({},e)}(t),null==e?(this.reset(),[2,[]]):(null==n?kT(e)&&(n=1e6*e.currentTime):n*=1e3,r=pT(e),a=cT(r),o=As(r,0),e instanceof kr||r.dispose(),i=[],this.multiPoseModel?[3,2]:[4,this.estimateSinglePose(o,a,n)]);case 1:return i=c.sent(),[3,4];case 2:return[4,this.estimateMultiplePoses(o,a,n)];case 3:i=c.sent(),c.label=4;case 4:for(s=0;s<i.length;++s)for(u=0;u<i[s].keypoints.length;++u)i[s].keypoints[u].name=JS[u],i[s].keypoints[u].y*=a.height,i[s].keypoints[u].x*=a.width;return[2,i]}}))}))},e.prototype.estimateSinglePose=function(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s=this;return YS(this,(function(u){switch(u.label){case 0:return this.cropRegion||(this.cropRegion=b_(null==this.cropRegion,t)),r=si((function(){var t=$s([[s.cropRegion.yMin,s.cropRegion.xMin,s.cropRegion.yMax,s.cropRegion.xMax]]),n=Bs([1],"int32"),r=[s.modelInputResolution.height,s.modelInputResolution.width];return oi(Mu.cropAndResize(e,t,n,r,"bilinear",0),"int32")})),e.dispose(),[4,this.runSinglePersonPoseModel(r)];case 1:if(a=u.sent(),r.dispose(),a.score<this.minPoseScore)return this.reset(),[2,[]];for(o=0;o<a.keypoints.length;++o)a.keypoints[o].y=this.cropRegion.yMin+a.keypoints[o].y*this.cropRegion.height,a.keypoints[o].x=this.cropRegion.xMin+a.keypoints[o].x*this.cropRegion.width;return null!=n&&this.enableSmoothing&&(a.keypoints=this.keypointFilter.apply(a.keypoints,n,1)),i=function(e,t,n,r){for(var a={},o=0,i=JS;o<i.length;o++){var s=i[o];a[s]=[t[n[s]].y*r.height,t[n[s]].x*r.width]}if(function(e,t){return(e[t.left_hip].score>.2||e[t.right_hip].score>.2)&&(e[t.left_shoulder].score>.2||e[t.right_shoulder].score>.2)}(t,n)){var u=(a.left_hip[0]+a.right_hip[0])/2,c=(a.left_hip[1]+a.right_hip[1])/2,l=function(e,t,n,r,a){for(var o=["left_shoulder","right_shoulder","left_hip","right_hip"],i=0,s=0,u=0;u<o.length;u++)(h=Math.abs(r-n[o[u]][0]))>i&&(i=h),(f=Math.abs(a-n[o[u]][1]))>s&&(s=f);for(var c=0,l=0,p=0,d=Object.keys(n);p<d.length;p++){var h,f,m=d[p];e[t[m]].score<.2||((h=Math.abs(r-n[m][0]))>c&&(c=h),(f=Math.abs(a-n[m][1]))>l&&(l=f))}return[i,s,c,l]}(t,n,a,u,c),p=l[0],d=l[1],h=l[2],f=l[3],m=Math.max(1.9*d,1.9*p,1.2*h,1.2*f),g=[u-(m=Math.min(m,Math.max(c,r.width-c,u,r.height-u))),c-m];if(m>Math.max(r.width,r.height)/2)return b_(null==e,r);var v=2*m;return{yMin:g[0]/r.height,xMin:g[1]/r.width,yMax:(g[0]+v)/r.height,xMax:(g[1]+v)/r.width,height:(g[0]+v)/r.height-g[0]/r.height,width:(g[1]+v)/r.width-g[1]/r.width}}return b_(null==e,r)}(this.cropRegion,a.keypoints,this.keypointIndexByName,t),this.cropRegion=this.filterCropRegion(i),[2,[a]]}}))}))},e.prototype.estimateMultiplePoses=function(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s,u,c,l,p,d,h,f=this;return YS(this,(function(m){switch(m.label){case 0:return t.width>t.height?(a=this.multiPoseMaxDimension,o=Math.round(this.multiPoseMaxDimension*t.height/t.width),r=Mu.resizeBilinear(e,[o,a]),s=a,u=32*Math.ceil(o/32),i=Ws(r,[[0,0],[0,u-o],[0,0],[0,0]])):(a=Math.round(this.multiPoseMaxDimension*t.width/t.height),o=this.multiPoseMaxDimension,r=Mu.resizeBilinear(e,[o,a]),s=32*Math.ceil(a/32),u=o,i=Ws(r,[[0,0],[0,0],[0,s-a],[0,0]])),r.dispose(),e.dispose(),c=oi(i,"int32"),i.dispose(),[4,this.runMultiPersonPoseModel(c)];case 1:for(l=m.sent(),c.dispose(),l=l.filter((function(e){return e.score>=f.minPoseScore})),d=0;d<l.length;++d)for(p=0;p<l[d].keypoints.length;++p)l[d].keypoints[p].y*=u/o,l[d].keypoints[p].x*=s/a;if(this.enableTracking&&(this.tracker.apply(l,n),this.enableSmoothing)){for(d=0;d<l.length;++d)this.keypointFilterMap.has(l[d].id)||this.keypointFilterMap.set(l[d].id,new PT(g_)),l[d].keypoints=this.keypointFilterMap.get(l[d].id).apply(l[d].keypoints,n,1);h=this.tracker.getTrackIDs(),this.keypointFilterMap.forEach((function(e,t){h.has(t)||f.keypointFilterMap.delete(t)}))}return[2,l]}}))}))},e.prototype.filterCropRegion=function(e){if(e){var t=this.cropRegionFilterYMin.apply(e.yMin),n=this.cropRegionFilterXMin.apply(e.xMin),r=this.cropRegionFilterYMax.apply(e.yMax),a=this.cropRegionFilterXMax.apply(e.xMax);return{yMin:t,xMin:n,yMax:r,xMax:a,height:r-t,width:a-n}}return this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset(),null},e.prototype.dispose=function(){this.moveNetModel.dispose()},e.prototype.reset=function(){this.cropRegion=null,this.resetFilters()},e.prototype.resetFilters=function(){this.keypointFilter.reset(),this.cropRegionFilterYMin.reset(),this.cropRegionFilterXMin.reset(),this.cropRegionFilterYMax.reset(),this.cropRegionFilterXMax.reset()},e}();function k_(e){return void 0===e&&(e=f_),KS(this,void 0,void 0,(function(){var t,n,r,a;return YS(this,(function(o){switch(o.label){case 0:return t=function(e){var t,n=null==e?f_:XS({},e);if(null==n.modelType)n.modelType="SinglePose.Lightning";else if(h_.indexOf(n.modelType)<0)throw new Error("Invalid architecture "+n.modelType+". Should be one of "+h_);if(null==n.enableSmoothing&&(n.enableSmoothing=!0),null!=n.minPoseScore&&(n.minPoseScore<0||n.minPoseScore>1))throw new Error("minPoseScore should be between 0.0 and 1.0");if(null!=n.multiPoseMaxDimension&&(n.multiPoseMaxDimension%32!=0||n.multiPoseMaxDimension<32))throw new Error("multiPoseMaxDimension must be a multiple of 32 and higher than 0");if("MultiPose.Lightning"===n.modelType&&null==n.enableTracking&&(n.enableTracking=!0),"MultiPose.Lightning"===n.modelType&&!0===n.enableTracking)if(null==n.trackerType&&(n.trackerType=s_.BoundingBox),n.trackerType===s_.Keypoint)null!=n.trackerConfig?n.trackerConfig=function(e){var t=x_(v_,e);return t.keypointTrackerParams=XS({},v_.keypointTrackerParams),null!=e.keypointTrackerParams&&(null!=e.keypointTrackerParams.keypointConfidenceThreshold&&(t.keypointTrackerParams.keypointConfidenceThreshold=e.keypointTrackerParams.keypointConfidenceThreshold),null!=e.keypointTrackerParams.keypointFalloff&&(t.keypointTrackerParams.keypointFalloff=e.keypointTrackerParams.keypointFalloff),null!=e.keypointTrackerParams.minNumberOfKeypoints&&(t.keypointTrackerParams.minNumberOfKeypoints=e.keypointTrackerParams.minNumberOfKeypoints)),t}(n.trackerConfig):n.trackerConfig=v_;else{if(n.trackerType!==s_.BoundingBox)throw new Error("Tracker type not supported by MoveNet");null!=n.trackerConfig?n.trackerConfig=(t=n.trackerConfig,x_(y_,t)):n.trackerConfig=y_}return n}(e),r=!0,t.modelUrl?(r="string"==typeof t.modelUrl&&t.modelUrl.indexOf("https://tfhub.dev")>-1,[4,zS(t.modelUrl,{fromTFHub:r})]):[3,2];case 1:return n=o.sent(),[3,4];case 2:return a=void 0,"SinglePose.Lightning"===t.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4":"SinglePose.Thunder"===t.modelType?a="https://tfhub.dev/google/tfjs-model/movenet/singlepose/thunder/4":"MultiPose.Lightning"===t.modelType&&(a="https://tfhub.dev/google/tfjs-model/movenet/multipose/lightning/1"),[4,zS(a,{fromTFHub:r})];case 3:n=o.sent(),o.label=4;case 4:return"webgl"===pi()&&Ie().set("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",0),[2,new w_(n,t)]}}))}))}var I_={architecture:"MobileNetV1",outputStride:16,multiplier:.75,inputResolution:{height:257,width:257}},S_=["MobileNetV1","ResNet50"],T_={MobileNetV1:[8,16],ResNet50:[16]},__=[8,16,32],C_={MobileNetV1:[.5,.75,1],ResNet50:[1]},N_=[1,2,4],E_={maxPoses:1,flipHorizontal:!1},R_={maxPoses:5,flipHorizontal:!1,scoreThreshold:.5,nmsRadius:20},A_=[-123.15,-115.9,-103.06];function O_(e){return Math.floor(e/2)}var M_=function(){function e(e,t){this.priorityQueue=new Array(e),this.numberOfElements=-1,this.getElementValue=t}return e.prototype.enqueue=function(e){this.priorityQueue[++this.numberOfElements]=e,this.swim(this.numberOfElements)},e.prototype.dequeue=function(){var e=this.priorityQueue[0];return this.exchange(0,this.numberOfElements--),this.sink(0),this.priorityQueue[this.numberOfElements+1]=null,e},e.prototype.empty=function(){return-1===this.numberOfElements},e.prototype.size=function(){return this.numberOfElements+1},e.prototype.all=function(){return this.priorityQueue.slice(0,this.numberOfElements+1)},e.prototype.max=function(){return this.priorityQueue[0]},e.prototype.swim=function(e){for(;e>0&&this.less(O_(e),e);)this.exchange(e,O_(e)),e=O_(e)},e.prototype.sink=function(e){for(;2*e<=this.numberOfElements;){var t=2*e;if(t<this.numberOfElements&&this.less(t,t+1)&&t++,!this.less(e,t))break;this.exchange(e,t),e=t}},e.prototype.getValueAt=function(e){return this.getElementValue(this.priorityQueue[e])},e.prototype.less=function(e,t){return this.getValueAt(e)<this.getValueAt(t)},e.prototype.exchange=function(e,t){var n=this.priorityQueue[e];this.priorityQueue[e]=this.priorityQueue[t],this.priorityQueue[t]=n},e}();function F_(e,t,n,r,a,o){for(var i=o.shape,s=i[0],u=i[1],c=!0,l=Math.max(n-a,0),p=Math.min(n+a+1,s),d=l;d<p;++d){for(var h=Math.max(r-a,0),f=Math.min(r+a+1,u),m=h;m<f;++m)if(o.get(d,m,e)>t){c=!1;break}if(!c)break}return c}function D_(e){return KS(this,void 0,void 0,(function(){return YS(this,(function(t){return[2,Promise.all(e.map((function(e){return e.buffer()})))]}))}))}function P_(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+17)}}function L_(e,t,n){var r=P_(e.heatmapY,e.heatmapX,e.id,n),a=r.y,o=r.x;return{x:e.heatmapX*t+o,y:e.heatmapY*t+a}}function B_(e,t,n,r){var a=n.x,o=n.y;return e.some((function(e){var n,i,s,u,c=e.keypoints;return n=o,i=a,(s=c[r].y-n)*s+(u=c[r].x-i)*u<=t}))}var U_=JS.reduce((function(e,t,n){return e[t]=n,e}),{}),V_=[["nose","left_eye"],["left_eye","left_ear"],["nose","right_eye"],["right_eye","right_ear"],["nose","left_shoulder"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["nose","right_shoulder"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"]].map((function(e){var t=e[0],n=e[1];return[U_[t],U_[n]]})),W_=V_.map((function(e){return e[1]})),z_=V_.map((function(e){return e[0]}));function G_(e,t,n){return e<t?t:e>n?n:e}function j_(e,t,n,r){return{y:G_(Math.round(e.y/t),0,n-1),x:G_(Math.round(e.x/t),0,r-1)}}function H_(e,t){return{x:e.x+t.x,y:e.y+t.y}}function q_(e,t,n,r,a,o,i,s){void 0===s&&(s=2);for(var u=r.shape,c=u[0],l=u[1],p={y:t.y,x:t.x},d=H_(p,function(e,t,n){var r=n.shape[2]/2;return{y:n.get(t.y,t.x,e),x:n.get(t.y,t.x,r+e)}}(e,j_(p,o,c,l),i)),h=0;h<s;h++){var f=j_(d,o,c,l),m=P_(f.y,f.x,n,a);d=H_({x:f.x*o,y:f.y*o},{x:m.x,y:m.y})}var g=j_(d,o,c,l),v=r.get(g.y,g.x,n);return{y:d.y,x:d.x,name:JS[n],score:v}}function X_(e,t,n,r,a,o){var i=t.shape[2],s=W_.length,u=new Array(i),c=e.part,l=e.score,p=L_(c,r,n);u[c.id]={score:l,name:JS[c.id],y:p.y,x:p.x};for(var d=s-1;d>=0;--d){var h=W_[d],f=z_[d];u[h]&&!u[f]&&(u[f]=q_(d,u[h],f,t,n,r,o))}for(d=0;d<s;++d)h=z_[d],f=W_[d],u[h]&&!u[f]&&(u[f]=q_(d,u[h],f,t,n,r,a));return u}function K_(e,t,n){return n.reduce((function(n,r,a){var o=r.y,i=r.x,s=r.score;return B_(e,t,{y:o,x:i},a)||(n+=s),n}),0)/n.length}function Y_(e,t,n,r,a,o,i,s){return void 0===i&&(i=.5),void 0===s&&(s=20),KS(this,void 0,void 0,(function(){var u,c,l,p,d,h,f,m,g,v,y,b;return YS(this,(function(x){switch(x.label){case 0:return[4,D_([e,t,n,r])];case 1:for(u=x.sent(),c=u[0],l=u[1],p=u[2],d=u[3],h=[],f=function(e,t,n){for(var r=n.shape,a=r[0],o=r[1],i=r[2],s=new M_(a*o*i,(function(e){return e.score})),u=0;u<a;++u)for(var c=0;c<o;++c)for(var l=0;l<i;++l){var p=n.get(u,c,l);p<e||F_(l,p,u,c,1,n)&&s.enqueue({score:p,part:{heatmapY:u,heatmapX:c,id:l}})}return s}(i,0,c),m=s*s;h.length<o&&!f.empty();)g=f.dequeue(),v=L_(g.part,a,l),B_(h,m,v,g.part.id)||(y=X_(g,c,l,a,p,d),b=K_(h,m,y),h.push({keypoints:y,score:b}));return[2,h]}}))}))}function Q_(e,t,n){return si((function(){var r=function(e,t){for(var n=[],r=0;r<JS.length;r++){var a=J_(e.get(r,0).valueOf(),e.get(r,1).valueOf(),r,t),o=a.x,i=a.y;n.push(i),n.push(o)}return $s(n,[JS.length,2])}(e,n);return Bi(oi(Wi(e.toTensor(),_s(t,"int32")),"float32"),r)}))}function J_(e,t,n,r){return{y:r.get(e,t,n),x:r.get(e,t,n+JS.length)}}function Z_(e,t,n){return KS(this,void 0,void 0,(function(){var r,a,o,i,s,u,c,l,p,d;return YS(this,(function(h){switch(h.label){case 0:return r=0,a=function(e){var t=e.shape,n=t[0],r=t[1],a=t[2];return si((function(){var t,o,i=rs(e,[n*r,a]),s=zi(i,0),u=As(Vi(s,_s(r,"int32")),1),c=As((t=s,o=r,si((function(){var e=Vi(t,_s(o,"int32"));return Ls(t,Wi(e,_s(o,"int32")))}))),1);return os([u,c],1)}))}(e),[4,Promise.all([e.buffer(),t.buffer(),a.buffer()])];case 1:return o=h.sent(),i=o[0],s=o[1],u=o[2],[4,(c=Q_(u,n,s)).buffer()];case 2:return l=h.sent(),p=Array.from(function(e,t){for(var n=t.shape[0],r=new Float32Array(n),a=0;a<n;a++){var o=t.get(a,0),i=t.get(a,1);r[a]=e.get(o,i,a)}return r}(i,u)),d=p.map((function(e,t){return r+=e,{y:l.get(t,0),x:l.get(t,1),score:e,name:JS[t]}})),a.dispose(),c.dispose(),[2,{keypoints:d,score:r/d.length}]}}))}))}function $_(e,t){return(e-1)%t==0}var eC="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/mobilenet/",tC="https://storage.googleapis.com/tfjs-models/savedmodel/posenet/resnet50/";function nC(e,t){return function(e,t){return(e-1)%t==0}(e,t)?e:Math.floor(e/t)*t+1}var rC=function(){function e(e,t){this.posenetModel=e;var n=this.posenetModel.inputs[0].shape;H(-1===n[1]&&-1===n[2],(function(){return"Input shape ["+n[1]+", "+n[2]+"] must both be equal to or -1"}));var r,a,o=(r=t.inputResolution,a=t.outputStride,{height:nC(r.height,a),width:nC(r.width,a)});!function(e){H(__.indexOf(e)>=0,(function(){return"outputStride of "+e+" is invalid. It must be either 8 or 16."}))}(t.outputStride),function(e,t){H($_(e.height,t),(function(){return"height of "+e.height+" is invalid for output stride "+t+"."})),H($_(e.width,t),(function(){return"width of "+e.width+" is invalid for output stride "+t+"."}))}(o,t.outputStride),this.inputResolution=o,this.outputStride=t.outputStride,this.architecture=t.architecture}return e.prototype.estimatePoses=function(e,t){return void 0===t&&(t=E_),KS(this,void 0,void 0,(function(){var n,r,a,o,i,s,u,c,l,p,d,h,f,m,g;return YS(this,(function(v){switch(v.label){case 0:return n=function(e){var t=e;if(null==t.maxPoses&&(t.maxPoses=1),t.maxPoses<=0)throw new Error("Invalid maxPoses "+t.maxPoses+". Should be > 0.");if(t.maxPoses>1){if((t=XS(XS({},R_),t)).scoreThreshold<0||t.scoreThreshold>1)throw new Error("Invalid scoreThreshold "+t.scoreThreshold+". Should be in range [0.0, 1.0]");if(t.nmsRadius<=0)throw new Error("Invalid nmsRadius "+t.nmsRadius+".")}return t}(t),null==e?[2,[]]:(this.maxPoses=n.maxPoses,r=xT(e,{outputTensorSize:this.inputResolution,keepAspectRatio:!0,borderMode:"replicate"}),a=r.imageTensor,o=r.padding,i="ResNet50"===this.architecture?Bi(a,A_):bT(a,[-1,1]),s=this.posenetModel.predict(i),"ResNet50"===this.architecture?(u=Ys(s[2],[0]),c=Ys(s[3],[0]),l=Ys(s[0],[0]),p=Ys(s[1],[0])):(u=Ys(s[0],[0]),c=Ys(s[1],[0]),l=Ys(s[2],[0]),p=Ys(s[3],[0])),d=is(c),1!==this.maxPoses?[3,2]:[4,Z_(d,u,this.outputStride)]);case 1:return f=v.sent(),h=[f],[3,4];case 2:return[4,Y_(d,u,l,p,this.outputStride,this.maxPoses,n.scoreThreshold,n.nmsRadius)];case 3:h=v.sent(),v.label=4;case 4:return m=cT(e),g=function(e,t,n,r){var a=t.height,o=t.width,i=a/(n.height*(1-r.top-r.bottom)),s=o/(n.width*(1-r.left-r.right)),u=-r.top*n.height,c=-r.left*n.width;if(1===s&&1===i&&0===u&&0===c)return e;for(var l=0,p=e;l<p.length;l++)for(var d=0,h=p[l].keypoints;d<h.length;d++){var f=h[d];f.x=(f.x+c)*s,f.y=(f.y+u)*i}return e}(h,m,this.inputResolution,o),n.flipHorizontal&&(g=function(e,t){for(var n=0,r=e;n<r.length;n++)for(var a=0,o=r[n].keypoints;a<o.length;a++){var i=o[a];i.x=t.width-1-i.x}return e}(g,m)),a.dispose(),i.dispose(),ui(s),u.dispose(),c.dispose(),l.dispose(),p.dispose(),d.dispose(),[2,g]}}))}))},e.prototype.dispose=function(){this.posenetModel.dispose()},e.prototype.reset=function(){},e}();function aC(e){return void 0===e&&(e=I_),KS(this,void 0,void 0,(function(){var t,n,r,a,o;return YS(this,(function(i){switch(i.label){case 0:return"ResNet50"!==(t=function(e){var t=e||I_;if(null==t.architecture&&(t.architecture="MobileNetV1"),S_.indexOf(t.architecture)<0)throw new Error("Invalid architecture "+t.architecture+". Should be one of "+S_);if(null==t.inputResolution&&(t.inputResolution={height:257,width:257}),null==t.outputStride&&(t.outputStride=16),T_[t.architecture].indexOf(t.outputStride)<0)throw new Error("Invalid outputStride "+t.outputStride+". Should be one of "+T_[t.architecture]+" for architecture "+t.architecture+".");if(null==t.multiplier&&(t.multiplier=1),C_[t.architecture].indexOf(t.multiplier)<0)throw new Error("Invalid multiplier "+t.multiplier+". Should be one of "+C_[t.architecture]+" for architecture "+t.architecture+".");if(null==t.quantBytes&&(t.quantBytes=4),N_.indexOf(t.quantBytes)<0)throw new Error("Invalid quantBytes "+t.quantBytes+". Should be one of "+N_+" for architecture "+t.architecture+".");if("MobileNetV1"===t.architecture&&32===t.outputStride&&1!==t.multiplier)throw new Error("When using an output stride of 32, you must select 1 as the multiplier.");return t}(e)).architecture?[3,2]:(s=t.outputStride,u=t.quantBytes,c="model-stride"+s+".json",n=4===u?tC+"float/"+c:tC+"quant"+u+"/"+c,[4,zS(t.modelUrl||n)]);case 1:return r=i.sent(),[2,new rC(r,t)];case 2:return a=function(e,t,n){var r={1:"100",.75:"075",.5:"050"},a="model-stride"+e+".json";return 4===n?eC+"float/"+r[t]+"/"+a:eC+"quant"+n+"/"+r[t]+"/"+a}(t.outputStride,t.multiplier,t.quantBytes),[4,zS(t.modelUrl||a)];case 3:return o=i.sent(),[2,new rC(o,t)]}var s,u,c}))}))}var oC="SinglePose.Lightning",iC="SinglePose.Thunder";function sC(e){return e instanceof Array==0?e:e.map((function(e){return e instanceof Array?sC(e):e instanceof Date?e:"object"==d(e)?uC(e):e}))}function uC(e,t){return e instanceof Array?sC(e):(t||(t={}),e&&"object"==d(e)?(Object.keys(e).forEach((function(n){e[n]instanceof Array?t[n]=sC(e[n]):e[n]instanceof Date?t[n]=e[n]:"object"==d(e[n])?t[n]=uC(e[n]):t[n]=e[n]})),t):null)}function cC(e){if(!e)return!1;if(!/^[0-9]{17}([0-9]|X){1}$/.test(e))return!1;var t=parseInt(e.substr(6,4));if(t<=1890)return!1;if((t=parseInt(e.substr(10,2)))<1||t>12)return!1;if((t=parseInt(e.substr(12,2)))<1||t>31)return!1;for(var n=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],r=0,a=0;a<17;a++)r+=parseInt(e.substr(a,1))*n[a];var o=r%11;return e.substr(17,1)===["1","0","X","9","8","7","6","5","4","3","2"][o]}for(var lC={clone:uC,formatDate:function(e,t){if(e){switch(t||(t="yyyy-MM-dd"),d(e)){case"string":var n=/^\/Date\((\-?\d+)\)\/$/;if(n.test(e)){var r=n.exec(e);e=parseInt(r[1]),e=new Date(e)}else-1!==e.indexOf("T")?(-1===e.indexOf("+")&&(e+="+08:00"),e=new Date(e)):e=new Date(Date.parse(e.replace(/-/g,"/")));break;case"number":e=new Date(e)}if(!(!e instanceof Date)){var a={yyyy:e.getFullYear(),M:e.getMonth()+1,d:e.getDate(),H:e.getHours(),m:e.getMinutes(),s:e.getSeconds(),MM:(""+(e.getMonth()+101)).substr(1),dd:(""+(e.getDate()+100)).substr(1),HH:(""+(e.getHours()+100)).substr(1),mm:(""+(e.getMinutes()+100)).substr(1),ss:(""+(e.getSeconds()+100)).substr(1)};return t.replace(/(yyyy|MM?|dd?|HH?|ss?|mm?)/g,(function(){return a[arguments[0]]}))}}},formatThousands:function(e){var t=(e=e||0).toString(),n=/\.\d*$/,r=n.exec(t);return t=(t=t.replace(n,"")).replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"),r&&(t+=r[0]),t},isCardId:cC,extractBirth:function(e){if(!cC(e))return null;var t=e.substr(6,4);return t+="-",t+=e.substr(10,2),t+="-",t+=e.substr(12,2)},judgmentGender:function(e){return cC(e)?parseInt(e.substr(16,1))%2==1:null},isBankNo:function(e){if(!/^\d{2,}$/.test(e))return!1;for(var t="",n=e.length-1;n>=0;n--)t+=e.substr(n,1);for(var r=0,a=0;a<t.length;a++){var o=a+1,i=parseInt(t.substr(a,1));o%2==0&&((i*=2)>=9&&(i-=9)),r+=i}return r%10==0},isMobile:function(e){return/^1[0-9]{10}$/.test(e)},isEmail:function(e){return e&&/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/.test(e)},maskPrivacy:function(e,t,n){if(!e)return e;if(t>=e.length)return"".padEnd(t,"*");if(!n){var r=e.length-t;r%2==1&&r--,n=r/2}var a="";return n>0&&(a+=e.slice(0,n)),a+="".padEnd(t,"*"),a+=e.slice(n+t)},trimEndRegion:function(e){return e?e=(e=e.replace(/[省|市|县|区|盟|旗|镇|乡|村|组]$/,"")).replace(/[自治区|自治州|街道]+$/,""):""},timestamp:function(){var e=(new Date).getTime()/1e3;return e=parseInt(e)},readExcelCell:function(e,t){var n=e[t];return n?n.w||n.v:null},executePipes:function e(t,n){!t||t.length<1||t.shift()((function(n){e(t,n)}),n)},invoke:function(e){return e instanceof Function?e:function(){}},guid:function(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},isNone:function(e){return null==e||""===e},isEmptyArray:function(e){return e instanceof Array==0||e.length<1}},pC=[],dC=[],hC="undefined"!=typeof Uint8Array?Uint8Array:Array,fC="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mC=0;mC<64;++mC)pC[mC]=fC[mC],dC[fC.charCodeAt(mC)]=mC;function gC(e,t,n){for(var r,a,o=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),o.push(pC[(a=r)>>18&63]+pC[a>>12&63]+pC[a>>6&63]+pC[63&a]);return o.join("")}dC["-".charCodeAt(0)]=62,dC["_".charCodeAt(0)]=63;var vC="tfjs_models",yC="info",bC="model_without_weight",xC="weight_data",wC="weight_data_size",kC=function(){return p((function e(t){if(l(this,e),this.keys=null,null==t||!t)throw new Error("modelPath不能为空");var n;this.keys={info:[vC,n=t,yC].join("/"),modelArtifactsWithoutWeights:[vC,n,bC].join("/"),weightData:[vC,n,xC].join("/"),weightDataChunkSize:[vC,n,wC].join("/")}}),[{key:"save",value:function(t){var n=this;if(t.modelTopology instanceof ArrayBuffer)throw new Error("AsyncStorageHandler.save() does not support saving model topology in binary format.");var r,a=function(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("非JSON模型描述信息");return{dateSaved:new Date,modelTopologyType:"JSON",weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}(t),o=t.weightData,i=e(t,h),s=(r=function(e){for(var t,n=e.length,r=n%3,a=[],o=16383,i=0,s=n-r;i<s;i+=o)a.push(gC(e,i,i+o>s?s:i+o));return 1===r?(t=e[n-1],a.push(pC[t>>2]+pC[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],a.push(pC[t>>10]+pC[t>>4&63]+pC[t<<2&63]+"=")),a.join("")}(new Uint8Array(o)),819200,r.match(new RegExp(".{1,".concat(819200,"}"),"g")));try{return wx.setStorageSync(this.keys.info,JSON.stringify(a)),wx.setStorageSync(this.keys.modelArtifactsWithoutWeights,JSON.stringify(i)),wx.setStorageSync(this.keys.weightDataChunkSize,s.length),s.forEach((function(e,t){wx.setStorageSync("".concat(n.keys.weightData,":").concat(t),e)})),{modelArtifactsInfo:a}}catch(t){throw wx.removeStorageSync(this.keys.info),s.forEach((function(e,t){wx.removeStorageSync("".concat(n.keys.weightData,":").concat(t))})),wx.removeStorageSync(this.keys.weightDataChunkSize),wx.removeStorageSync(this.keys.modelArtifactsWithoutWeights),new Error("Failed to save model '".concat(this.modelPath,"' to local storage.\n              Error info ").concat(t))}}},{key:"load",value:function(){var e=wx.getStorageSync(this.keys.info);if(!e)return null;var t=JSON.parse(e);if(null==t)throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");e=wx.getStorageSync(this.keys.modelArtifactsWithoutWeights);for(var n=JSON.parse(e),r=wx.getStorageSync(this.keys.weightDataChunkSize),a="",o=0;o<r;o++){var i=wx.getStorageSync("".concat(this.keys.weightData,":").concat(o));if(null==i)throw new Error("In local storage, the binary weight values of model '".concat(this.modelPath,"' are missing."));a+=i}return n.weightData=function(e){var t,n,r=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}(e),a=r[0],o=r[1],i=new hC(function(e,t,n){return 3*(t+n)/4-n}(0,a,o)),s=0,u=o>0?a-4:a;for(n=0;n<u;n+=4)t=dC[e.charCodeAt(n)]<<18|dC[e.charCodeAt(n+1)]<<12|dC[e.charCodeAt(n+2)]<<6|dC[e.charCodeAt(n+3)],i[s++]=t>>16&255,i[s++]=t>>8&255,i[s++]=255&t;return 2===o&&(t=dC[e.charCodeAt(n)]<<2|dC[e.charCodeAt(n+1)]>>4,i[s++]=255&t),1===o&&(t=dC[e.charCodeAt(n)]<<10|dC[e.charCodeAt(n+1)]<<4|dC[e.charCodeAt(n+2)]>>2,i[s++]=t>>8&255,i[s++]=255&t),i}(a).buffer,n}}])}(),IC=Object.freeze({__proto__:null,dispose:function(){},loadModel:function(e,t){e=e||"lightning";var n=null,r=null,a=null,o=global.reduceTfjs.saber,i=new global.reduceTfjs.RealtimeLogger("move-net"),s=global.reduceTfjs.config;if("thunder"==e?(n=s.moveNet.thunder,r=iC,a=null):(n=s.moveNet.lightning,r=oC,a=null),null==a){var u=function(){var n=new kC(c),s={modelType:r,modelUrl:n};(function(e,t){return KS(this,void 0,void 0,(function(){var n,r;return YS(this,(function(a){switch(e){case u_.PoseNet:return[2,aC(t)];case u_.BlazePose:if(r=void 0,null!=(n=t)){if("tfjs"===n.runtime)return[2,i_(t)];if("mediapipe"===n.runtime)return[2,uT(t)];r=n.runtime}throw new Error("Expect modelConfig.runtime to be either 'tfjs' or 'mediapipe', but got "+r);case u_.MoveNet:return[2,k_(t)];default:throw new Error(e+" is not a supported model name.")}}))}))})(u_.MoveNet,s).then((function(n){a=n,lC.invoke(t)(a),o.writeConsoleDebug("Model ".concat(e,"加载成功。"))})).catch((function(e){console.error("Model加载失败：",e),i.error("loadRawModel",e),lC.invoke(t)(null,e)}))},c="MOVE_NET_".concat(e);Br.ready().then((function(){!function(e,t,n){var r=global.reduceTfjs.saber,a=new global.reduceTfjs.RealtimeLogger("move-net"),o=new kC(e);zS(o).then((function(e){r.writeConsoleDebug("Model从本地缓存加载成功。"),lC.invoke(n)(e)})).catch((function(e){r.writeConsoleDebug("未能从缓存加载Model",e),zS(t).then((function(e){e.save(o),lC.invoke(n)(e)})).catch((function(e){console.error("Model加载失败：",e),a.error("loadGraphModel",e),lC.invoke(n)(null,e)}))}))}(c,n,u)}))}else lC.invoke(t)(a)}});return global.reduceTfjs={RealtimeLogger:null,saber:null,config:null},{initialize:function(e,t,n){if(!e)throw new Error("config不能为空");if(!t)throw new Error("saber不能为空");if(!n)throw new Error("loggerType不能为空");global.reduceTfjs.config=e,global.reduceTfjs.saber=t,global.reduceTfjs.RealtimeLogger=n},wechatExtensions:SI,moveNet:IC}}));